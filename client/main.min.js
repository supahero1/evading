const e=window.localStorage,k=e.getItem.bind(e),aa=e.setItem.bind(e),ba=e.removeItem.bind(e),ca=k("keybinds"),da={settings:"Escape",up:"KeyW",left:"KeyA",right:"KeyD",down:"KeyS",slowwalk:"ShiftLeft",spec_prev:"KeyA",spec_next:"KeyD"};let l=null!=ca?JSON.parse(ca):da;for(const a in da)a in l||(l[a]=da[a]);for(const a in l)a in da||delete l[a];function ea(){aa("keybinds",JSON.stringify(l))}
const fa=k("settings"),m={fov:{min:.25,max:4,value:1.75,step:.05},chat_on:!0,max_chat_messages:{min:1,max:1E3,value:100,step:1},chat_text_scale:{min:1,max:2,value:1,step:.05},draw_ball_fill:!0,draw_ball_stroke:!0,draw_ball_stroke_bright:!0,ball_stroke:{min:0,max:100,value:20,step:1},draw_player_fill:!0,draw_player_stroke:!0,draw_player_stroke_bright:!0,player_stroke:{min:0,max:100,value:10,step:1},draw_player_name:!0,draw_death_arrow:!0,death_arrow_size:{min:10,max:100,value:40,step:1},show_tutorial:!0,
show_ping:!1};let n=null!=fa?JSON.parse(fa):JSON.parse(JSON.stringify(m));for(const a in m)a in n||(n[a]=m[a]);for(const a in n)a in m?(n[a].min&&n[a].min!=m[a].min&&(n[a].min=m[a].min),n[a].max&&n[a].max!=m[a].max&&(n[a].max=m[a].max),n[a].step&&n[a].step!=m[a].step&&(n[a].step=m[a].step),n[a].value=Math.max(Math.min(n[a].value,n[a].max),n[a].min)):delete n[a];function ha(){aa("settings",JSON.stringify(n))}
const r=document.getElementById.bind(document),t=document.createElement.bind(document),u=r("ID_status"),ia=k("token");let ja=[];"string"==typeof ia&&(ja=ia.split(",").map(a=>+a));function ka(){setTimeout(location.reload.bind(location),1E3)}function la(a){return"#"+(.8*parseInt(a.substring(1,3),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(a.substring(3,5),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(a.substring(5,7),16)>>0).toString(16).padStart(2,"0")+a.substring(7)}
function ma(a){const b=a.match(/\/\/(.*?)\.shadam\.xyz/),c=a.match(/\/\/(.*?)[\/:]/);return b?b[1]:c?c[1]:a}WebSocket.prototype.send=new Proxy(WebSocket.prototype.send,{apply:function(a,b,c){if(b.readyState==WebSocket.OPEN)return a.apply(b,c)},configurable:!0,enumerable:!0});WebSocket.prototype.close=new Proxy(WebSocket.prototype.close,{apply:function(a,b,c){if(b.readyState==WebSocket.CONNECTING||b.readyState==WebSocket.OPEN)return a.apply(b,c)},configurable:!0,enumerable:!0});
function na(a){return function(b){const c=b instanceof ClipboardEvent;if(!c||"paste"==b.type){var d=b.target.value+(c?b.clipboardData.getData("text"):b.key);if((new TextEncoder).encode(d).byteLength-b.target.selectionEnd+b.target.selectionStart>a){if(""==b.target.value&&c){const f=b.target.placeholder;b.target.placeholder="Text too long to paste!";setTimeout(function(){b.target.placeholder=f},1E3)}b.preventDefault()}}}}
function ra(a,b){var c=.75*sa.size;c*=v.h;a=.5*v.width+(a-w.x)*v.h;const d=.5*v.height+(b-w.y)*v.h;b=!1;if(0>a||a>v.width-0)b=!0,a=Math.max(Math.min(a,v.width-c),c);0>d||d>v.height-0?(b=!0,c=Math.max(Math.min(d,v.height-c),c)):c=d;return[(a-.5*v.width)/v.h+w.x,(c-.5*v.height)/v.h+w.y,b]}function x(a,b,c){return a+(b-a)*c}if(0==window.s.length)throw u.innerHTML="No servers found",ka(),Error(u.innerHTML);u.innerHTML="Connecting";
const y=new Uint32Array([3722305023,2863311615,858993663,4276058367]),ta=Array.from(y).map(a=>"#"+a.toString(16)),ua=new Uint32Array([2155905279,4232489727,8421631,4287497983,1021313023,1715110655]),va=Array.from(ua).map(a=>"#"+a.toString(16));
function wa(a,b){const c=a[0],d=a[1],f=a[2],g=a[3],p=a[4],q=a[5],h=a[6],D=a[7],I=a[8],Q=b[0],L=b[1],R=b[2],X=b[3],M=b[4],oa=b[5],pa=b[6],qa=b[7];b=b[8];a[0]=Q*c+L*g+R*h;a[1]=Q*d+L*p+R*D;a[2]=Q*f+L*q+R*I;a[3]=X*c+M*g+oa*h;a[4]=X*d+M*p+oa*D;a[5]=X*f+M*q+oa*I;a[6]=pa*c+qa*g+b*h;a[7]=pa*d+qa*p+b*D;a[8]=pa*f+qa*q+b*I;return a}
class xa extends Float32Array{constructor(){super([2/z.width,0,0,0,-2/z.height,0,-1,1,1])}translate(a,b){return wa(this,new Float32Array([1,0,0,0,1,0,a,b,1]))}rotate(a){const b=Math.cos(a);a=Math.sin(a);return wa(this,new Float32Array([b,-a,0,a,b,0,0,0,1]))}}const A=WebGL2RenderingContext.prototype;function ya(a,b,c){b=a.g.createShader(b);a.g.shaderSource(b,c);a.g.compileShader(b);if(a.g.getShaderParameter(b,A.COMPILE_STATUS))return b;throw Error(a.g.getShaderInfoLog(b));}
class za{constructor(a,b=!1){this.v=a?r(a):t("canvas");this.g=this.v.getContext("webgl2",{alpha:!0,depth:b,antialias:!0,failIfMajorPerformanceCaveat:!1});if(!this.g)throw Error("Your browser/device does not support WebGL2.");this.D=ya(this,A.VERTEX_SHADER,"#version 300 es\n\n\n    layout(location = 0) in vec2 a_position;\n    layout(location = 1) in vec4 a_color;\n    layout(location = 2) in vec2 a_texcoord;\n\n    uniform mat3 u_matrix;\n\n    out vec4 v_color;\n    out vec2 v_texcoord;\n\n    void main() {\n      gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1);\n      if(a_texcoord.x < 0.00375 || a_texcoord.x > 0.09625 || a_texcoord.y < 0.00375 || a_texcoord.y > 0.09625) {\n        v_color = a_color * vec4(0.8, 0.8, 0.8, 1);\n      } else {\n        v_color = a_color;\n      }\n      //v_color = a_color;\n      v_texcoord = a_texcoord;\n    }\n    ");
this.B=ya(this,A.FRAGMENT_SHADER,`#version 300 es\n

    precision mediump float;

    in vec4 v_color;
    in vec2 v_texcoord;

    out vec4 outColor;

    void main() {
      ${b?"\n      float len = length(v_texcoord - vec2(0.5, 0.5));\n      if(len <= 0.5) {\n        if(len >= 0.4) {\n          outColor = v_color * vec4(0.8, 0.8, 0.8, 1);\n        } else {\n          outColor = v_color;\n        }\n      } else {\n        discard;\n      }\n      ":"\n      outColor = v_color;\n      "}
    }
    `);a=this.g.createProgram();this.g.attachShader(a,this.D);this.g.attachShader(a,this.B);this.g.linkProgram(a);if(!this.g.getProgramParameter(a,A.LINK_STATUS))throw Error(this.g.getProgramInfoLog(a));this.o=a;this.u=this.g.createVertexArray();this.g.bindVertexArray(this.u);this.i=this.g.createBuffer();this.g.bindBuffer(A.ARRAY_BUFFER,this.i);this.g.vertexAttribPointer(0,2,A.UNSIGNED_SHORT,!1,10,0);this.g.vertexAttribPointer(1,4,A.UNSIGNED_BYTE,!0,10,4);this.g.vertexAttribPointer(2,2,A.UNSIGNED_BYTE,
!0,10,8);this.g.enableVertexAttribArray(0);this.g.enableVertexAttribArray(1);this.g.enableVertexAttribArray(2);this.C=this.g.getUniformLocation(this.o,"u_matrix");this.h=null;this.l=0;this.j=b}}
function Aa(a){a.h.innerHTML="";for(const b of a.o){const c=t("option");c.value=b[2];b[2]==B.A.url&&(c.selected=!0,c.disabled=!0,a.g=c);b[0]>=b[1]&&(c.disabled=1);const d=ma(b[2]);c.innerHTML=d[0].toUpperCase()+d.substring(1)+` (${b[0]}/${b[1]})`;a.h.appendChild(c)}a.h.onfocus=function(){aa("psfy_tooltip","");this.J.style.display="none"}.bind(a);a.h.onchange=async function(){this.g.disabled=!1;const b=this.g;this.g=this.h.selectedOptions[0];this.g.disabled=!0;Ba();let c;const d=new Promise(function(g){c=
g}),f=new Ca(this.g.value,c,1);setTimeout(c,2E3);await d;0==f.L||f.A.readyState!=WebSocket.OPEN?(f.stop(),u.innerHTML="Couldn't connect, returning to previous server",this.g.disabled=!1,this.g=b,this.g.disabled=!0,setTimeout(C.l.bind(C),1E3)):Da(f)}.bind(a);Ea(a)}function Fa(){var a=E;Aa(a);a.H=setInterval(function(){fetch("servers.json").then(b=>b.json()).then(function(b){E.o=b;Aa(E)})},5E3)}function Ga(){E.j.style.display="block"}
function Ha(){var a=E;const b=t("h5");b.id="ID_spec_help";b.innerHTML=a.R;setTimeout(function(){b.style.opacity=0},3E3);b.addEventListener("transitionend",a.G.bind(a));document.body.insertBefore(b,E.j);a.i=b}function Ea(a){void 0==k("psfy_tooltip")&&(a.T.innerHTML="We picked a server<br>for you automatically.<br><br>You can change it here.",a.J.style.display="table")}
class Ia{constructor(){this.j=r("ID_menu");this.name=r("ID_name");this.h=r("ID_select_serv");this.g=null;this.o=window.s;this.J=r("ID_picked_server_for_you");this.T=r("ID_picked_server_for_you_tooltip");this.v=r("ID_ping");this.K();this.B=r("ID_play");this.u=r("ID_spec");this.i=null;this.R="";this.l();this.D=r("ID_spectating");this.C=r("ID_refresh");var a=r("ID_spec_help");a.parentElement.removeChild(a);this.C.onclick=location.reload.bind(location);this.name.onkeypress=this.name.onpaste=na(16);this.name.onchange=
function(){C.i=!1;aa("name",this.value)};this.H=-1;a=k("name");"string"==typeof a&&16>=(new TextEncoder).encode(a).length&&(this.name.value=a);this.B.onclick=function(){var b=F;Ja(b);b.g[0]=0;b.h=1;G(B)};this.u.onclick=function(){Ka(0);G(B)}}l(){this.R=`Press ${l.spec_prev} or ${l.spec_next} to switch between players<br><br>Type "/menu" in chat to return to the main menu`}G(){null!=this.i&&(this.i.parentElement.removeChild(this.i),this.i=null)}K(){this.v.style.display=n.show_ping?"block":"none"}}
function G(a){a.A.send(F.g.subarray(0,F.h))}function Da(a){var b=B;null!=b.A&&(b.stop(),b.once=!1,b.i=!1,b.g=[0,0]);b.I=a.I;b.M=a.M;b.F=a.F;b.m=a.m;b.A=a.A;b.A.onmessage=function({data:c}){try{this.message({data:c})}catch(d){console.log(d),console.log(Array.from(new Uint8Array(c)).map(f=>f.toString(16).padStart(2,"0")).join(" "))}}.bind(b);b.A.onclose=b.close.bind(b);La();G(b);b.h()}
function Ma(a){a.I[a.m]=(new Date).getTime()-a.M;a.F=0;let b=a.m,c=0;for(let d=0;10>d;++d)0!=a.I[b]&&(a.F+=(10-c)/11*a.I[b],++c),b=(b+1)%10;0!=c&&(a.F/=.5*c);a.m=(a.m+1)%10;setTimeout(a.j.bind(a),10)}
class Na{constructor(){this.A=null;this.i=this.once=!1;this.I=Array(10).fill(0);this.m=this.F=this.M=0;this.g=[0,0]}h(){this.once=!0;var a=H;a.o=Array(5).fill(0);a.j=0;a.h.innerHTML="";a.i=0;a.u=!1;a.B="Press enter to chat";a.v();w.g=!1;J.g=Array(100);K.g=Array(65535);a=v;a.h=n.fov.value;a.j=a.h;cancelAnimationFrame(a.v);a.v=-1;a.C=!1;a.u=0;a.B=0;N.j=-1;a=O;a.g=!1;a.o=!1;a.u=1;a.h=1;a=C;a.g=!1;a.h=!1;a.i=!1;a.id=-1}message({data:a}){F.set(new Uint8Array(a));if(0==F.h)Ma(this);else{var b=P()-1;a=!1;
b!=C.id&&(C.id=b,a=!0);b=P();var c=b&1;c&&!C.h?(C.h=!0,E.j.style.display="none",Ha(),E.D.style.display="block"):!c&&C.h&&(C.h=!1,Ga(),E.G(),E.D.style.display="none",O.o=!1);(c=b&2)&&!C.g?(C.g=!0,E.j.style.display="none"):!c&&C.g&&(C.g=!1,Ga(),O.o=!1);E.u.disabled=b&4;this.g[0]=this.g[1];this.g[1]=performance.now();b=J;for(c=0;100>c;++c)void 0!=b.g[c]&&(b.g[c].x1=b.g[c].x2,b.g[c].y1=b.g[c].y2,b.g[c].r1=b.g[c].r2);b=K;for(c=0;65535>c;++c)void 0!=b.g[c]&&(b.g[c].x1=b.g[c].x2,b.g[c].y1=b.g[c].y2,b.g[c].r1=
b.g[c].r2);Oa(w);for(b=!1;F.m<F.h;)switch(P()){case 0:b=!0;K.g=Array(65535);c=N;c.j=P();var d=P(),f=P(),g=P();c.i=Array(P());for(var p=0;p<c.i.length;++p)c.i[p]=[(P()+.5)*g,(P()+.5)*g,P()];c.width=d*g;c.height=f*g;c.g=g;p=new ArrayBuffer(d*f*60);var q=new DataView(p),h=0,D=0,I=g;for(var Q=0;Q<d;++Q){var L=0;let R=g;for(let X=0;X<f;++X){const M=F.g[F.m];2!=M&&(q.setUint16(h,I,!0),h+=2,q.setUint16(h,L,!0),h+=2,q.setUint32(h,y[M],!1),h+=4,q.setUint8(h++,255),q.setUint8(h++,0),q.setUint16(h,D,!0),h+=
2,q.setUint16(h,L,!0),h+=2,q.setUint32(h,y[M],!1),h+=4,q.setUint8(h++,0),q.setUint8(h++,0),q.setUint16(h,I,!0),h+=2,q.setUint16(h,R,!0),h+=2,q.setUint32(h,y[M],!1),h+=4,q.setUint8(h++,255),q.setUint8(h++,255),q.setUint16(h,I,!0),h+=2,q.setUint16(h,R,!0),h+=2,q.setUint32(h,y[M],!1),h+=4,q.setUint8(h++,255),q.setUint8(h++,255),q.setUint16(h,D,!0),h+=2,q.setUint16(h,L,!0),h+=2,q.setUint32(h,y[M],!1),h+=4,q.setUint8(h++,0),q.setUint8(h++,0),q.setUint16(h,D,!0),h+=2,q.setUint16(h,R,!0),h+=2,q.setUint32(h,
y[M],!1),h+=4,q.setUint8(h++,0),q.setUint8(h++,255));++F.m;L=R;R+=g}D=I;I+=g}c.h.l=h/10;c=c.h;d=(new Uint8Array(p)).subarray(0,h);console.log(d);c.g.bindBuffer(A.ARRAY_BUFFER,c.i);c.g.bufferData(A.ARRAY_BUFFER,d,A.DYNAMIC_DRAW);break;case 1:c=J;d=P();for(f=0;f<d;++f)if(g=P(),void 0==c.g[g])p=S(),h=S(),q=S(),D=P(),D=Pa(D),I=P(),Q=0,I&&(Q=P()),L=P(),0<L&&T(H,D,Pa(L)),c.g[g]={x:0,y:0,r:0,x1:p,x2:p,y1:h,y2:h,r1:q,r2:q,name:D,N:I,O:Q,P:0,S:!0},C.id==g&&(g=w,g.g||(g.x2=p,g.y2=h));else if(p=P(),0==p)delete c.g[g];
else{do{switch(p){case 1:c.g[g].x2=S();C.id==g&&(p=w,p.g||(p.x2=c.g[g].x2));break;case 2:c.g[g].y2=S();C.id==g&&(p=w,p.g||(p.y2=c.g[g].y2));break;case 3:c.g[g].r2=S();break;case 4:c.g[g].N=P();c.g[g].N&&(c.g[g].O=P());break;case 5:p=P();T(H,c.g[g].name,Pa(p));break;default:throw Error();}p=P()}while(p)}break;case 2:c=K;d=Qa();for(f=0;f<d;++f)if(g=Qa(),void 0==c.g[g])p=P()-1,h=S(),q=S(),D=S(),c.g[g]={type:p,x:0,y:0,r:0,x1:h,x2:h,y1:q,y2:q,r1:D,r2:D,S:!1};else if(p=P(),0==p)delete c.g[g];else{do{switch(p){case 1:c.g[g].x2=
S();break;case 2:c.g[g].y2=S();break;case 3:c.g[g].r2=S();break;default:throw Error();}p=P()}while(p)}break;case 3:c=H;d=P();for(f=0;f<d;++f)p=P(),g=(new TextDecoder).decode(F.g.subarray(F.m,F.m+p)),F.m+=p,p=P(),T(c,g,(new TextDecoder).decode(F.g.subarray(F.m,F.m+p))),F.m+=p;break;default:throw Error();}if(F.m>F.h)throw Error();if(-1==C.id)a=w,b=.5*N.height,a.g||(a.x2=.5*N.width,a.y2=b),Oa(a);else if(a||b)a=w,c=J.g[C.id].y2,a.g||(a.x2=J.g[C.id].x2,a.y2=c),b&&Oa(w);0==this.g[0]||this.i||(this.i=!0,
a=v,a.v=window.requestAnimationFrame(a.D.bind(a)),C.l())}}close(a){4E3==a?(Ra(),u.innerHTML="Server is full"):Ra()}j(){this.M=(new Date).getTime();this.A.send(new Uint8Array(0))}stop(){this.A.onopen=this.A.onmessage=this.A.onclose=null;this.A.close()}}function Sa(a){a.A=new WebSocket(a.l);a.A.binaryType="arraybuffer";a.A.onopen=a.h.bind(a);a.A.onmessage=a.message.bind(a);a.A.onclose=a.close.bind(a)}
class Ca extends Na{constructor(a,b,c=8){super();this.L=0;this.o=c;this.u=b;this.l=a;Sa(this)}h(){this.j()}message(){Ma(this);++this.L==this.o&&this.u(this.A.url)}close(){Sa(this)}}function Ka(a){var b=F;b.g[0]=4;b.g[1]=a;b.h=2}function La(){var a=F;0==ja.length?a.h=1:(a.g.set(ja),a.h=ja.length)}function P(){var a=F;return a.g[a.m++]}function Qa(){var a=F;const b=a.g[a.m]|a.g[a.m+1]<<8;a.m+=2;return b}function S(){var a=F;const b=a.view.getFloat32(a.m,!0);a.m+=4;return b}
function Pa(a){var b=F;const c=(new TextDecoder).decode(b.g.subarray(b.m,b.m+a));b.m+=a;return c}function Ja(a){if(!C.i){C.i=!0;a.g[0]=3;var b=E;b=(new TextEncoder).encode(b.name.value);a.g.set(b,1);a.h=b.length+1;G(B)}}class Ta{constructor(){this.i=new ArrayBuffer(1048576);this.g=new Uint8Array(this.i);this.view=new DataView(this.i);this.m=this.h=0}set(a){this.g.set(a);this.h=a.length;this.m=0}}function Ua(a){var b=sa;a.drawImage(b.h,.5*-b.h.width,.5*-b.h.height)}
class Va{constructor(){this.h=t("canvas");this.g=this.h.getContext("2d");this.size=0;this.i()}i(){this.size=n.death_arrow_size.value;this.h.width=this.h.height=this.size;const a=.5*this.h.width,b=this.h.width;this.g.beginPath();this.g.moveTo(a+.45*b,a);this.g.lineTo(a-.225*b,a-.675*b/Math.sqrt(3));this.g.lineTo(a-.225*b,a+.675*b/Math.sqrt(3));this.g.closePath();this.g.fillStyle="#bbbbbbb0";this.g.fill();this.g.lineWidth=.1*a;this.g.strokeStyle="#f00";this.g.stroke()}}
function Wa(a){void 0==k("tth_tooltip")&&(a.K.innerHTML='Try "/help"',a.D.style.display="inline-block")}function T(a,b,c,d=!1){const f=t("p");f.appendChild(document.createTextNode((d?"":b+": ")+c));a.h.insertBefore(f,a.h.firstChild);++a.i>n.max_chat_messages.value&&a.h.removeChild(a.h.lastChild)}function Xa(a){a.g.value="";a.g.blur();v.l.focus()}function Ya(a,b){a.B=a.g.placeholder;a.g.placeholder=b;a.g.disabled=!0;a.g.value="";v.l.focus()}
function Za(){var a=H;!a.u&&n.chat_on&&(a.C.style.display="block")}
class $a{constructor(){this.o=Array(5).fill(0);this.j=0;this.C=r("ID_chat");this.h=r("ID_messages");this.g=r("ID_sendmsg");this.D=r("ID_try_typing_help");this.K=r("ID_try_typing_help_tooltip");Wa(this);this.J=na(128);this.i=0;this.u=!1;this.B="";this.l=-1;this.g.onkeydown=function(a){a.stopPropagation();if("Enter"==a.code){a=this.g.value.trim();switch(a){case "/help":T(this,null,">",!0);T(this,null,"Available commands:",!0);T(this,null,"/clear /c => clear the chat",!0);T(this,null,"/respawn /r => tp to the first area",
!0);T(this,null,"/die /d => become downed",!0);T(this,null,"/menu /m => quit the game and open the menu",!0);T(this,null,"/spectate /s => start/stop spectating",!0);T(this,null,">",!0);Xa(this);aa("tth_tooltip","");this.D.style.display="none";return;case "/c":case "/clear":this.h.innerHTML="";this.i=0;Xa(this);return}a=(new TextEncoder).encode(a);if(0<a.length){var b=F;Ja(b);b.g[0]=2;b.g.set(a,1);b.h=a.length+1;G(B);this.o[this.j]=(new Date).getTime();a=(this.j+1)%5;b=5E3-this.o[this.j]+this.o[a];
this.j=a;0<b?(Ya(this,"You are on cooldown for sending too many messages too quickly"),this.l=setTimeout(this.v.bind(this),b)):Xa(this)}}}.bind(this);this.g.onkeyup=function(a){a.stopPropagation()};this.g.onkeypress=this.g.onpaste=this.J}v(){-1!=this.l&&(clearTimeout(this.l),this.l=-1);this.g.disabled=!1;this.g.placeholder=this.B}focus(){this.g.focus()}G(){for(;this.i>n.max_chat_messages.value;)this.h.removeChild(this.h.lastChild),--this.i}H(){this.h.style["font-size"]=n.chat_text_scale.value+"em"}}
function Oa(a){a.x1=a.x2;a.y1=a.y2}function U(a,b,c){var d=w;d.x2=x(d.x2,a,c);d.y2=x(d.y2,b,c)}class ab{constructor(){this.y2=this.x2=this.y1=this.x1=this.y=this.x=0;this.g=!1}block(){this.g=!0}}class bb{constructor(){this.g=Array(100)}}class cb{constructor(){this.g=Array(65535)}}function db(){var a=eb;a.g=!0;return new Promise(function(b){a.h=function(c){a.g=!1;b(c)}})}class fb{constructor(){this.h=null;this.g=!1}}
function gb(a){switch(hb.g){case 0:n.show_tutorial&&0==N.j&&v.text("Need help? Press KeyT for a tutorial.",.5*N.width,2.5*N.g);break;case 1:U(J.g[C.id].x2,J.g[C.id].y2,.2*a);v.text("<-- Your character",w.x+110,w.y);v.text("Your character --\x3e",w.x-110,w.y);v.text("This is your character. You can control it with these keys:",w.x,w.y-220);v.text(`${l.up}: up`,w.x,w.y-170);v.text(`${l.left}: left`,w.x,w.y-130);v.text(`${l.down}: down`,w.x,w.y-90);v.text(`${l.right}: right`,w.x,w.y-50);v.text("You can also control it with mouse. Just",
w.x,w.y+50);v.text("press any mouse button to start or stop moving.",w.x,w.y+70);v.text("Scroll to change your field of view.",w.x,w.y+110);v.text("Note that you won't be able to perform some",w.x,w.y+150);v.text("of the above actions until the tutorial ends.",w.x,w.y+170);v.text("Press KeyT to continue",w.x,w.y+220);break;case 2:var b=.5*N.width-6*N.g,c=.5*N.height;U(b,c,.2*a);v.text("--\x3e",b+2*N.g,c-1*N.g);v.text("--\x3e",b+2*N.g,c);v.text("--\x3e",b+2*N.g,c+1*N.g);v.text("<--",b-2*N.g,c-2*N.g);
v.text("<--",b-3*N.g,c-1*N.g);v.text("<--",b-4*N.g,c);v.text("<--",b-3*N.g,c+1*N.g);v.text("<--",b-2*N.g,c+2*N.g);v.text("These are safezones. Enemies can't",b,c-130);v.text("reach you inside of these tiles.",b,c-110);v.text("Press KeyT to continue",b,c+110);break;case 3:b=.5*N.width+6*N.g;c=.5*N.height;U(b,c,.2*a);v.text("<--",b-2*N.g,c-2*N.g);v.text("<--",b-1*N.g,c-3*N.g);v.text("<--",b,c-4*N.g);v.text("<--",b-2*N.g,c+2*N.g);v.text("<--",b-1*N.g,c+3*N.g);v.text("<--",b,c+4*N.g);v.text("--\x3e",
b+2*N.g,c-3*N.g);v.text("--\x3e",b+2*N.g,c+3*N.g);v.text("<--",b+5*N.g,c-2*N.g);v.text("<--",b+6*N.g,c-1*N.g);v.text("<--",b+7*N.g,c);v.text("<--",b+6*N.g,c+1*N.g);v.text("<--",b+5*N.g,c+2*N.g);v.text("These are walls. Players can't walk over them.",b,c-40);v.text("However, some types (colors) of enemies can.",b,c-10);v.text("Press KeyT to continue",b,c+40);break;case 4:b=.5*N.g;c=.5*N.height;U(b,c,.2*a);v.text("--\x3e",b,c);v.text("This is a teleport tile. If you walk on it,",b,c-130);v.text("you will be teleported to the area it points to.",
b,c-110);v.text("Minimap is not yet implemented, but once it is, you",b,c-70);v.text("will be able to see where any area is located at.",b,c-50);v.text("If a teleport doesn't have a number on it, it doesn't point",b,c+50);v.text("anywhere (perhaps because the next area is under construction).",b,c+70);v.text("Press KeyT to continue",b,c+120);break;case 5:for(c=0;65535>c;++c)if(K.g[c]){b=K.g[c];break}c=b.x2;b=b.y2;U(c,b,.2*a);v.text("Enemy ball --\x3e",c-110,b);v.text("<-- Enemy ball",c+110,b);v.text("This is an enemy, also simply called a ball. A grey ball",
c,b-110);v.text("doesn't do a lot - it simply moves in one direction. However,",c,b-90);v.text("as you are about to find out when you start exploring the game,",c,b-70);v.text("there are lots of types of enemies, each having their own color.",c,b-50);v.text("Coming in contact with an enemy downs you. While downed, you can't move,",c,b+50);v.text("and after a while, you die, unless other players revive you by touching you.",c,b+70);v.text("Press KeyT to continue",c,b+120);break;case 6:b=J.g[C.id].x2,
c=J.g[C.id].y2,U(b,c,.2*a),v.text(`You can press ${l.settings} to open settings.`,b,c-80),v.text("There are a lot of cool options to change. Try it out later.",b,c-60),v.text("That's it for this tutorial. See how far you can go!",b,c+60),v.text("GLHF!",b,c+80),v.text("Press KeyT to end the tutorial",b,c+130)}}
class ib{constructor(){this.i=this.g=0;this.h=null}progress(){0==this.g?n.show_tutorial&&C.g&&(this.g=1,this.i=v.j,v.j=1.75,w.block(),jb(),O.stop(),O.block()):7==++this.g&&(this.h.click(),this.g=0,v.j=this.i,w.g=!1,V.g=!1,O.g=!1,O.start())}}function jb(){var a=V;a.i&&(a.g=!1,kb(a));a.g=!0}
function lb(a){a.l.innerHTML="";mb(a,"CHAT");a.add(a.text("Show chat"),W("chat_on",function(b){b?Za():(b=H,b.u||(b.C.style.display="none"))}));a.add(a.text("Max number of chat messages"),nb(a,"max_chat_messages","",H.G.bind(H)));a.add(a.text("Chat text scale"),nb(a,"chat_text_scale","",H.H.bind(H)));mb(a,"MENU");a.add(a.text("Show latency"),W("show_ping",E.K.bind(E)));mb(a,"GAME");hb.h=W("show_tutorial");a.add(a.text("Enable tutorial"),hb.h);mb(a,"VISUALS");a.add(a.text("Default FOV"),nb(a,"fov"));
a.add(a.text("Draw balls' fill"),W("draw_ball_fill"));a.add(a.text("Draw balls' stroke"),W("draw_ball_stroke"));a.add(a.text("Draw stroke-only balls with brighter color"),W("draw_ball_stroke_bright"));a.add(a.text("Balls' stroke radius percentage"),nb(a,"ball_stroke","%"));a.add(a.text("Draw players' fill"),W("draw_player_fill"));a.add(a.text("Draw players' stroke"),W("draw_player_stroke"));a.add(a.text("Draw stroke-only players with brighter color"),W("draw_player_stroke_bright"));a.add(a.text("Players' stroke radius percentage"),
nb(a,"player_stroke","%"));a.add(a.text("Draw players' name"),W("draw_player_name"));a.add(a.text("Draw an arrow towards dead players"),W("draw_death_arrow"));a.add(a.text("Death arrow size"),nb(a,"death_arrow_size","px",sa.i.bind(sa)));mb(a,"KEYBINDS");ob(a,pb("h5","To change, click a button on the right side and then press the key you want to assign to it."));a.add(a.text("Settings"),Y("settings"));a.add(a.text("Move up"),Y("up"));a.add(a.text("Move left"),Y("left"));a.add(a.text("Move down"),Y("down"));
a.add(a.text("Move right"),Y("right"));a.add(a.text("Move slowly"),Y("slowwalk"));a.add(a.text("Spectate the previous player"),Y("spec_prev",E.l.bind(E)));a.add(a.text("Spectate the next player"),Y("spec_next",E.l.bind(E)));mb(a,"RESET");a.add(a.text("Reset settings"),a.button("RESET",function(){n=JSON.parse(JSON.stringify(m));ha();lb(this)}.bind(a)));a.add(a.text("Reset keybinds"),a.button("RESET",function(){l=JSON.parse(JSON.stringify(da));ea();lb(this)}.bind(a)));a.add(a.text("Reset all tooltips"),
a.button("RESET",function(){ba("psfy_tooltip");Ea(E);ba("tth_tooltip");Wa(H)}));a.end()}function kb(a){a.g||(a.i=!1,a.j.style.display="none",O.g=!1,O.start())}function ob(a,b){a.l.appendChild(b)}function mb(a,b){a.end();ob(a,pb("h1",b));a.h=t("table")}function pb(a,b){a=t(a);a.innerHTML=b;return a}
function W(a,b=function(){}){const c=t("button");n[a]=!n[a];let d=!0;c.onclick=function(){n[a]=!n[a];1==n[a]?(c.innerHTML="ON",c.style["background-color"]="#23c552"):(c.innerHTML="OFF",c.style["background-color"]="#f84f31");ha();d?d=!1:b(n[a])};c.onclick();return c}function Y(a,b=function(){}){const c=t("button");c.innerHTML=l[a];c.onclick=async function(){c.innerHTML="...";const d=await db();c.innerHTML=d;l[a]=d;ea();b()};c.style.color="#000";return c}
function nb(a,b,c="",d=function(){}){const f=t("div");f.className="input";const g=t("input");g.type="range";g.min=n[b].min;g.max=n[b].max;g.step=n[b].step;g.value=n[b].value;g.oninput=function(){g.nextElementSibling.innerHTML=g.value+c;n[b].value=g.valueAsNumber;d()};g.onchange=ha;f.appendChild(g);f.appendChild(a.text(g.value+c));return f}
class qb{constructor(){this.j=r("ID_settings_container");this.l=r("ID_settings");this.g=this.i=!1;this.h=null;lb(this)}add(a,b){const c=t("tr");let d=t("td");d.appendChild(a);c.appendChild(d);d=t("td");d.appendChild(b);b.onchange=ha;c.appendChild(d);this.h.appendChild(c)}end(){null!=this.h&&(ob(this,this.h),this.h=null)}text(a){return pb("h3",a)}button(a,b){const c=t("button");c.innerHTML=a;c.onclick=b;return c}}
class rb{constructor(){this.l=t("canvas");this.g=this.l.getContext("2d");this.o=r("ID_text");this.i=this.o.getContext("2d");new za("ID_circles",!0);this.height=this.width=0;this.j=this.h=n.fov.value;this.v=-1;this.C=!1;this.B=this.u=0;this.o.onwheel=this.H.bind(this);this.o.onmousedown=this.G.bind(this)}stop(){this.C=!0;this.l.parentElement.removeChild(this.l)}H(a){a=.05*-Math.sign(a.deltaY);this.j=1<this.j?this.j+3*a:this.j+a;this.j=Math.min(Math.max(this.j,n.fov.min),n.fov.max)}G(){O.o=!O.o;Z(O)}text(a,
b,c){this.i.font="700 20px Ubuntu";this.i.textAlign="center";this.i.textBaseline="middle";this.i.fillStyle="#fff";this.i.strokeStyle="#333";this.i.lineWidth=1;this.i.fillText(a,b,c);this.i.strokeText(a,b,c)}D(a){if(!this.C){this.u=Math.min(Math.max(this.u,B.g[0]),B.g[1]);var b=this.h;this.h=x(this.h,this.j,.1);this.h!=b&&Z(O);b=B.g[0]==B.g[1]?1:(this.u-B.g[0])/(B.g[1]-B.g[0]);this.u+=a-this.B;this.B=a;n.show_ping&&(E.v.innerHTML=B.F.toFixed(1)+"ms");w.x=x(w.x1,w.x2,b);w.y=x(w.y1,w.y2,b);sb();a=Array(65635);
var c=0,d=0;if(n.draw_player_fill||n.draw_player_stroke)for(var f=0;100>f;++f)if(void 0!=J.g[f]){J.g[f].x=x(J.g[f].x1,J.g[f].x2,b);J.g[f].y=x(J.g[f].y1,J.g[f].y2,b);var g=x(J.g[f].r1,J.g[f].r2,b);J.g[f].r=g;g>d&&(d=g);a[c++]=J.g[f]}if(n.draw_ball_fill||n.draw_ball_stroke)for(f=0;65535>f;++f)void 0!=K.g[f]&&(K.g[f].x=x(K.g[f].x1,K.g[f].x2,b),K.g[f].y=x(K.g[f].y1,K.g[f].y2,b),g=x(K.g[f].r1,K.g[f].r2,b),K.g[f].r=g,g>d&&(d=g),a[c++]=K.g[f]);a.sort((p,q)=>q.r-p.r);for(c=0;c<a.length;++c)if(void 0!=a[c])if(this.g.beginPath(),
d=a[c],d.S){if(f=n.player_stroke.value/200*d.r,this.g.moveTo(d.x+d.r-f,d.y),this.g.arc(d.x,d.y,d.r-f,0,2*Math.PI),n.draw_player_fill&&(this.g.fillStyle="#ebecf0",this.g.fill()),n.draw_player_stroke&&(!n.draw_player_fill&&n.draw_player_stroke_bright?this.g.strokeStyle="#ebecf0":this.g.strokeStyle=la("#ebecf0"),this.g.lineWidth=2*f,this.g.stroke()),n.draw_player_name&&0!=d.name.length&&(this.g.font=`700 ${d.r/this.h}px Ubuntu`,this.g.textAlign="center",this.g.textBaseline="middle",this.g.fillStyle=
"#00000080",d.P=x(d.P,1<this.h?.5*d.r:.5*d.r+2/(this.h*this.h),.1),this.g.fillText(d.name,d.x,d.y-d.r-d.P)),d.N&&(this.g.font=`700 ${d.r/Math.min(this.h,1)}px Ubuntu`,this.g.textAlign="center",this.g.textBaseline="middle",this.g.fillStyle="#f00",this.g.fillText(d.O,d.x,d.y),n.draw_death_arrow)){const [p,q,h]=ra(d.x,d.y);h&&(this.g.translate(p,q),f=Math.atan2(d.y-q,d.x-p),this.g.rotate(f),Ua(this.g),this.g.rotate(-f),this.g.font=`700 ${.3*sa.size}px Ubuntu`,this.g.fillText(d.O,0,0),this.g.translate(-p,
-q))}}else f=n.ball_stroke.value/200*d.r,this.g.moveTo(d.x+d.r-f,d.y),this.g.arc(d.x,d.y,d.r-f,0,2*Math.PI),n.draw_ball_fill&&(this.g.fillStyle=va[d.type],this.g.fill()),n.draw_ball_stroke&&(this.g.strokeStyle=!n.draw_ball_fill&&n.draw_ball_stroke_bright?va[d.type]:la(va[d.type]),this.g.lineWidth=2*f,this.g.stroke());gb(b);this.v=window.requestAnimationFrame(this.D.bind(this))}}}
function sb(){var a=N;a.h.h=new xa;var b=a.h.h.translate(.5*z.width,.5*z.height),c=v.h;wa(b,new Float32Array([c,0,0,0,c,0,0,0,1])).translate(-w.x,-w.y);b=a.h;if(b.g.canvas.width!=z.width||b.g.canvas.height!=z.height)b.g.canvas.width=z.width,b.g.canvas.height=z.height;b.g.viewport(0,0,b.g.canvas.width,b.g.canvas.height);b.g.clearColor(0,0,0,0);b.g.clear(A.COLOR_BUFFER_BIT|b.j*A.DEPTH_BUFFER_BIT);b.j&&b.g.enable(A.DEPTH_TEST);b.g.useProgram(b.o);b.g.bindVertexArray(b.u);b.g.uniformMatrix3fv(b.C,!1,
b.h);b.g.drawArrays(A.TRIANGLES,0,b.l);if(v.o.width!=z.width||v.o.height!=z.height)v.o.width=z.width,v.o.height=z.height;b=new DOMMatrix;v.i.setTransform(b);v.i.clearRect(0,0,z.width,z.height);b=b.translate(.5*z.width,.5*z.height).scale(v.h,v.h).translate(-w.x,-w.y);v.i.setTransform(b);v.i.font=`700 ${a.g/1.75|0}px Ubuntu`;v.i.textAlign="center";v.i.textBaseline="middle";v.i.fillStyle=la(ta[3]);for(const d of a.i)v.i.fillText(d[2],d[0],d[1])}
class tb{constructor(){this.h=new za("ID_background");this.g=this.height=this.width=0;this.i=[];this.j=-1}}
class ub{constructor(){this.height=this.width=this.h=this.i=this.g=0;this.j=[0,0];window.onresize=this.l.bind(this);window.onkeyup=this.v.bind(this);window.onkeydown=this.u.bind(this);window.onmousemove=this.B.bind(this);window.onbeforeunload=this.o.bind(this)}l(){if(window.devicePixelRatio!=this.g||window.innerWidth!=this.i||window.innerHeight!=this.h){this.g=window.devicePixelRatio;this.i=window.innerWidth;this.h=window.innerHeight;this.width=this.i*this.g;this.height=this.h*this.g;var a=v;a.width=
z.width;a.height=z.height;a.l.width=a.width;a.l.height=a.height}}u(a){if(!a.repeat)if(eb.g)a.preventDefault(),eb.h(a.code);else if(a.code==l.settings)V.i?kb(V):(a=V,a.g||(a.i=!0,a.j.style.display="block",O.stop(),O.block()));else{if(C.h)switch(a.code){case l.spec_prev:Ka(-1);G(B);break;case l.spec_next:Ka(1),G(B)}switch(a.code){case "Enter":H.focus(a);break;case l.up:O.v||(O.v=1,Z(O));break;case l.down:O.l||(O.l=1,Z(O));break;case l.left:O.i||(O.i=1,Z(O));break;case l.right:O.j||(O.j=1,Z(O));break;
case l.slowwalk:1==O.u&&(vb(.5),Z(O));break;case "KeyT":hb.progress()}}}v(a){if(!a.repeat)switch(a.code){case l.up:O.v&&(O.v=0,Z(O));break;case l.down:O.l&&(O.l=0,Z(O));break;case l.left:O.i&&(O.i=0,Z(O));break;case l.right:O.j&&(O.j=0,Z(O));break;case l.slowwalk:.5==O.u&&(vb(1),Z(O))}}B(a){this.j=[a.clientX*this.g,a.clientY*this.g];Z(O)}o(a){if(C.g)return a.preventDefault(),a.returnValue="Are you sure you want to quit?"}}
function Z(a){if(C.g&&!a.g){a=F;let c=0;var b=0;if(O.o){b=z.j[0]-.5*v.l.width;const d=z.j[1]-.5*v.l.height;c=Math.atan2(d,b);b=Math.hypot(b,d)/v.h}else if(O.v!=O.l||O.i!=O.j)c=Math.atan2(O.l-O.v,O.j-O.i),b=160*z.g;a.g[0]=1;a.view.setFloat32(1,c,!0);a.g[5]=b>=160*z.g?255*O.h:1.59375*b/z.g*O.h;a.h=6;G(B)}}function vb(a){var b=O;b.g||(b.h=a);b.u=a}
class wb{constructor(){this.o=!1;this.h=this.u=1;this.g=!1;this.j=this.i=this.l=this.v=0}block(){this.g=!0}stop(){this.g||(this.u=this.h,this.h=0,Z(this))}start(){this.g||(this.h=this.u,Z(this))}}function Ba(){var a=C;u.innerHTML="Connecting";a.j?(Ga(),E.name.style.display="none",Za(),Ya(H,"Waiting for connection..."),jb()):a.j=!0}
function Ra(){C.g=!1;u.innerHTML="Disconnected";Ga();var a=E;B.once||ka();a.name.style.display="none";a.B.style.display="none";a.u.style.display="none";a.C.style.display="block";clearInterval(a.H);jb()}class xb{constructor(){this.i=this.h=this.g=!1;this.id=-1;this.j=!1}l(){Ga();E.name.style.display="block";u.innerHTML="";Za();H.v();V.g=!1}}const E=new Ia,B=new Na,F=new Ta,sa=new Va,H=new $a,w=new ab,J=new bb,K=new cb,eb=new fb,hb=new ib,V=new qb,v=new rb,N=new tb,z=new ub,O=new wb,C=new xb;z.l();
(async function(){Ba();let a;var b=new Promise(function(f){a=f});const c=[];for(const [,,f]of E.o)c[c.length]=new Ca(f,a);setTimeout(a,2E3,"");b=await b;let d;if(0==b.length){b=0;for(const f of c)f.A.readyState==WebSocket.OPEN&&f.L>b&&(b=f.L,d=f.A.url)}else d=b;if(void 0==d)throw u.innerHTML="Couldn't connect to any server",ka(),Error(u.innerHTML);for(const f of c)f.A.url!=d?f.stop():Da(f);Fa()})();
