const e=window.localStorage,aa=Math.sin,ba=Math.cos,ca=Math.max,da=Math.min,ea=Math.abs,fa=e.getItem("keybinds"),ia={settings:"Escape",up:"KeyW",left:"KeyA",right:"KeyD",down:"KeyS",slowwalk:"ShiftLeft",spec_prev:"KeyA",spec_next:"KeyD"};let k=null!=fa?JSON.parse(fa):ia;for(const a in ia)a in k||(k[a]=ia[a]);for(const a in k)a in ia||delete k[a];function ja(){var a=JSON.stringify(k);e.setItem("keybinds",a)}
const ka=e.getItem("settings"),l={fov:{min:.25,max:4,value:1.75,step:.05},chat_on:!0,max_chat_messages:{min:1,max:1E3,value:100,step:1},chat_text_scale:{min:1,max:2,value:1,step:.05},draw_ball_fill:!0,draw_ball_stroke:!0,draw_ball_stroke_bright:!0,ball_stroke:{min:0,max:100,value:20,step:1},draw_player_fill:!0,draw_player_stroke:!0,draw_player_stroke_bright:!0,player_stroke:{min:0,max:100,value:10,step:1},draw_player_name:!0,draw_death_arrow:!0,death_arrow_size:{min:10,max:76,value:40,step:1},show_tutorial:!0,
show_ping:!1,slowwalk_speed:{min:0,max:100,value:50,step:1}};let n=null!=ka?JSON.parse(ka):JSON.parse(JSON.stringify(l));for(const a in l)a in n||(n[a]=l[a]);for(const a in n)a in l?(n[a].min&&n[a].min!=l[a].min&&(n[a].min=l[a].min),n[a].max&&n[a].max!=l[a].max&&(n[a].max=l[a].max),n[a].step&&n[a].step!=l[a].step&&(n[a].step=l[a].step),n[a].value=ca(da(n[a].value,n[a].max),n[a].min)):delete n[a];function la(){var a=JSON.stringify(n);e.setItem("settings",a)}const p=n.fov.max;
function q(a){return document.getElementById(a)}function t(a){return document.createElement(a)}const u=q("ID_status"),ma=e.getItem("token");let na=[];"string"==typeof ma&&(na=ma.split(",").map(a=>+a));const oa=location.reload.bind(location);function pa(){oa()}const qa=WebSocket.prototype.send,ra=WebSocket.prototype.close;
WebSocket=class extends WebSocket{constructor(...a){super(...a)}send(a){this.readyState==WebSocket.OPEN&&qa.call(this,a)}close(){this.readyState!=WebSocket.CONNECTING&&this.readyState!=WebSocket.OPEN||ra.call(this)}};
function sa(a){return function(b){const c=b instanceof ClipboardEvent;if(!c||"paste"==b.type){var f=b.target,g=f.value+(c?b.clipboardData.getData("text"):b.key);if((new TextEncoder).encode(g).byteLength-f.selectionEnd+f.selectionStart>a){if(""==f.value&&c){const d=f.placeholder;f.placeholder="Text too long to paste!";setTimeout(function(){f.placeholder=d},1E3)}b.preventDefault()}}}}function v(a,b,c){return a+(b-a)*c}
if(0==window.s.length)throw u.innerHTML="No servers found",setTimeout(oa,1E3),Error(u.innerHTML);const ta=new Uint32Array([3722305023,2863311615,858993663,4276058367]);Array.from(ta).map(a=>"#"+a.toString(16));const za=new Uint32Array([2155905279,4232489727,8421631,4287497983,1021313023,1715110655]);Array.from(za).map(a=>"#"+a.toString(16));const x=new ArrayBuffer(1048560);new Uint8Array(x);const y=new Float32Array(x),z=new DataView(x);
Float32Array.prototype.multiply=function(a){const b=this[0],c=this[1],f=this[2],g=this[3],d=this[4],h=this[5],m=this[6],r=this[7],w=this[8],B=a[0],Q=a[1],ha=a[2],ua=a[3],va=a[4],wa=a[5],xa=a[6],ya=a[7];a=a[8];return new Float32Array([B*b+Q*g+ha*m,B*c+Q*d+ha*r,B*f+Q*h+ha*w,ua*b+va*g+wa*m,ua*c+va*d+wa*r,ua*f+va*h+wa*w,xa*b+ya*g+a*m,xa*c+ya*d+a*r,xa*f+ya*h+a*w])};function Aa(a,b,c){return a.multiply(new Float32Array([1,0,0,0,1,0,b,c,1]))}
function Ba(a,b,c=b){return a.multiply(new Float32Array([b,0,0,0,c,0,0,0,1]))}class Ca extends Float32Array{constructor(){super([2/A.width,0,0,0,-2/A.height,0,-1,1,1])}}const C=WebGL2RenderingContext.prototype;let Da=null;function Ea(a){a=(a?q(a):t("canvas")).getContext("webgl2",{premultipliedAlpha:!1,failIfMajorPerformanceCaveat:!1});if(!a)throw u.innerHTML="Your browser/device does not support WebGL2.",Error("Your browser/device does not support WebGL2.");return a}
function Fa(a,b,c){b=a.g.createShader(b);a.g.shaderSource(b,c);a.g.compileShader(b);if(a.g.getShaderParameter(b,C.COMPILE_STATUS))return b;throw Error(a.g.getShaderInfoLog(b));}function Ga(a){Da!=a&&(Da=a,a.g.useProgram(a.o),a.g.bindVertexArray(a.G),null!=a.D&&a.g.uniformMatrix3fv(a.D,!1,a.l))}
function D(a,b,c,f){const g=a.g.createTexture();a.g.bindTexture(C.TEXTURE_2D,g);a.g.texImage2D(C.TEXTURE_2D,0,C.RGBA,c,f,0,C.RGBA,C.UNSIGNED_BYTE,b);a.g.generateMipmap(C.TEXTURE_2D);a.g.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,C.LINEAR);a.g.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,C.LINEAR_MIPMAP_LINEAR);a.g.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE);a.g.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE);return g}
class Ha{constructor(a,b,c){this.g=a instanceof WebGL2RenderingContext?a:Ea(a);a="#version 300 es\nprecision mediump float;\nout vec4 fragColor;\n"+c;c=this.g.createProgram();this.g.attachShader(c,Fa(this,C.VERTEX_SHADER,"#version 300 es\n"+b));this.g.attachShader(c,Fa(this,C.FRAGMENT_SHADER,a));this.g.linkProgram(c);if(this.g.getProgramParameter(c,C.LINK_STATUS))b=c;else throw Error(this.g.getProgramInfoLog(c));this.o=b;this.G=this.g.createVertexArray();this.g.bindVertexArray(this.G);this.D=this.g.getUniformLocation(this.o,
"u_matrix");this.h=0}set(a,b){this.g.bindBuffer(C.ARRAY_BUFFER,this.i);this.g.bufferData(C.ARRAY_BUFFER,a,C.DYNAMIC_DRAW);this.h=b}}
class Ia extends Ha{constructor(){super(E.l,"\n      layout(location = 0) in vec2 a_position;\n      layout(location = 1) in vec3 a_offset;\n\n      uniform mat3 u_matrix;\n      uniform sampler2D u_texture;\n      uniform float u_light;\n\n      out vec4 v_color;\n\n      void main() {\n        gl_Position = vec4((u_matrix * vec3(a_position + a_offset.xy, 1.0)).xy, 0.5, 1.0);\n        v_color = vec4(texelFetch(u_texture, ivec2(int(a_offset.z), 0), 0).xyz * u_light, 1.0);\n      }\n      ","\n      in vec4 v_color;\n\n      void main() {\n        fragColor = v_color;\n      }\n    ");
this.B=new Float32Array([0,1,.0375,.9625,1,1,.9625,.9625,1,0,.9625,.0375,0,0,.0375,.0375,0,1,.0375,.9625]);this.model=new Float32Array([.0375,.0375,.9625,.0375,.0375,.9625,.9625,.9625]);this.v=this.g.getUniformLocation(this.o,"u_light");this.u=this.g.createBuffer();this.g.bindBuffer(C.ARRAY_BUFFER,this.u);this.g.vertexAttribPointer(0,2,C.FLOAT,!1,0,0);this.g.enableVertexAttribArray(0);this.i=this.g.createBuffer();this.g.bindBuffer(C.ARRAY_BUFFER,this.i);this.g.vertexAttribPointer(1,3,C.UNSIGNED_BYTE,
!1,0,0);this.g.vertexAttribDivisor(1,1);this.g.enableVertexAttribArray(1);for(let a=0;a<ta.length;++a)z.setUint32(a<<2,ta[a]);this.H=D(this,new Uint8Array(x.slice(0,ta.length<<2)),ta.length,1)}j(){Ga(this);this.g.bindTexture(C.TEXTURE_2D,this.H);this.g.uniform1f(this.v,1);this.g.bindBuffer(C.ARRAY_BUFFER,this.u);this.g.bufferData(C.ARRAY_BUFFER,this.model,C.DYNAMIC_DRAW);this.g.drawArraysInstanced(C.TRIANGLE_STRIP,0,4,this.h);this.g.uniform1f(this.v,.8);this.g.bindBuffer(C.ARRAY_BUFFER,this.u);this.g.bufferData(C.ARRAY_BUFFER,
this.B,C.DYNAMIC_DRAW);this.g.drawArraysInstanced(C.TRIANGLE_STRIP,0,10,this.h)}}
class Ja extends Ha{constructor(a){super(a,"\n      layout(location = 0) in vec2 a_position;\n      layout(location = 1) in vec2 a_offset;\n      layout(location = 2) in float a_scale;\n      layout(location = 3) in vec4 a_color;\n\n      uniform mat3 u_matrix;\n      uniform int u_precision;\n\n      flat out vec4 v_color;\n\n      void main() {\n        gl_Position = vec4((u_matrix * vec3(a_position * a_scale + a_offset, 1.0)).xy, -1.0 / a_scale, 1.0);\n        if(gl_VertexID < u_precision) {\n          v_color = a_color;\n        } else {\n          v_color = vec4(a_color.xyz * 0.8, a_color.w);\n        }\n      }\n      ","\n      flat in vec4 v_color;\n\n      void main() {\n        fragColor = v_color;\n      }\n    ");
this.v=this.g.getUniformLocation(this.o,"u_precision");this.u=this.g.createBuffer();this.g.bindBuffer(C.ARRAY_BUFFER,this.u);this.g.vertexAttribPointer(0,2,C.FLOAT,!1,0,0);this.g.enableVertexAttribArray(0);this.i=this.g.createBuffer();this.g.bindBuffer(C.ARRAY_BUFFER,this.i);this.g.vertexAttribPointer(1,2,C.FLOAT,!1,16,0);this.g.vertexAttribPointer(2,1,C.FLOAT,!1,16,8);this.g.vertexAttribPointer(3,4,C.UNSIGNED_BYTE,!0,16,12);this.g.vertexAttribDivisor(1,1);this.g.vertexAttribDivisor(2,1);this.g.vertexAttribDivisor(3,
1);this.g.enableVertexAttribArray(1);this.g.enableVertexAttribArray(2);this.g.enableVertexAttribArray(3)}j(a,b,c,f){if(a||b){Ga(this);b||(c=0);var g=252*a+4+512*b,d=Math.PI/64,h=0;if(a){var m=aa(d),r=ba(d),w=1-c,B=0;y[h++]=w;y[h++]=B;for(let Q=1;64>Q;++Q){let ha=w*r-B*m;B=w*m+B*r;w=ha;y[h++]=w;y[h++]=B;y[h++]=w;y[h++]=-B}y[h++]=-1+c;y[h++]=0}if(b){b=aa(-d);d=ba(-d);a||(m=-1+c,r=0,w=m*d-r*b,y[h++]=w,y[h++]=-(m*b+r*d),y[h++]=-1+c,y[h++]=0);m=-1;r=0;y[h++]=m;y[h++]=r;for(w=0;127>w;++w)B=m*d-r*b,r=m*
b+r*d,m=B,y[h++]=m*(1-c),y[h++]=r*(1-c),y[h++]=m,y[h++]=r;y[h++]=-1;y[h++]=0}console.assert(h==g);this.g.bindBuffer(C.ARRAY_BUFFER,this.u);this.g.bufferData(C.ARRAY_BUFFER,y.subarray(0,g),C.DYNAMIC_DRAW);this.g.uniform1i(this.v,a?128:f?258:0);this.g.drawArraysInstanced(C.TRIANGLE_STRIP,0,g>>1,this.h)}}}
function Ka(a,b,c,f){c*=p;const g=t("canvas"),d=g.getContext("2d");d.font=`700 ${c}px Ubuntu`;d.textAlign="center";d.textBaseline="alphabetic";d.fillStyle=f;const h=d.measureText(b),m=Math.ceil(h.width),r=Math.ceil(h.actualBoundingBoxAscent+h.actualBoundingBoxDescent);g.width=m;g.height=r;d.font=`700 ${c}px Ubuntu`;d.textAlign="center";d.textBaseline="alphabetic";d.fillStyle=f;d.fillText(b,h.actualBoundingBoxLeft,h.actualBoundingBoxAscent);return{L:D(a,g,m,r),w:.5*m/p,$:.5*r/p,size:c/p,color:f,da:performance.now()}}
function La(a){a.u=!1;if(0!=a.h){var b=x.slice(0,40*a.h);a.g.bindBuffer(C.ARRAY_BUFFER,a.i);a.g.bufferSubData(C.ARRAY_BUFFER,0,b);for(b=0;b<a.h;++b)a.g.activeTexture(C.TEXTURE0+b),a.g.bindTexture(C.TEXTURE_2D,a.B[b]);a.g.drawArraysInstanced(C.TRIANGLE_STRIP,0,4,a.h);a.h=0;a.g.activeTexture(C.TEXTURE0)}}function Ma(a,b,c,f,g){let d=[];if(0==b)d=[0];else for(;b;)d[d.length]=b%10,b=Math.floor(b/10);c-=5.7*(d.length-1);for(b=d.length-1;0<=b;--b)a.j(a.v[d[b]],c+11.4*(d.length-b-1),f,g)}
class Na extends Ha{constructor(a){super(a,"\n      layout(location = 0) in vec2 a_position;\n      layout(location = 1) in vec2 a_texcoord;\n      layout(location = 2) in float a_depth;\n      layout(location = 3) in mat3 a_matrix;\n\n      out vec2 v_texcoord;\n      flat out int v_id;\n\n      void main() {\n        gl_Position = vec4((a_matrix * vec3(a_position, 1.0)).xy, -1.0 / a_depth, 1.0);\n        v_texcoord = a_texcoord;\n        v_id = gl_InstanceID;\n      }\n      ",`
      in vec2 v_texcoord;
      flat in int v_id;

      uniform sampler2D u_texture[16];

      void main() {
        switch(v_id) {
          ${[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15].map(b=>`case ${b}: fragColor = texture(u_texture[${b}], v_texcoord); break;\n`).join("")}
        }
      }
    `);this.g.pixelStorei(C.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);this.H=this.g.createBuffer();this.g.bindBuffer(C.ARRAY_BUFFER,this.H);this.g.bufferData(C.ARRAY_BUFFER,new Float32Array([-1,1,0,1,-1,-1,0,0,1,1,1,1,1,-1,1,0]),C.STATIC_DRAW);this.g.vertexAttribPointer(0,2,C.FLOAT,!1,16,0);this.g.vertexAttribPointer(1,2,C.FLOAT,!1,16,8);this.g.enableVertexAttribArray(0);this.g.enableVertexAttribArray(1);this.i=this.g.createBuffer();this.g.bindBuffer(C.ARRAY_BUFFER,this.i);this.g.vertexAttribPointer(2,1,
C.FLOAT,!1,40,0);for(a=0;3>a;++a)this.g.vertexAttribPointer(3+a,3,C.FLOAT,!1,40,4+12*a);this.g.vertexAttribDivisor(2,1);for(a=0;3>a;++a)this.g.vertexAttribDivisor(3+a,1);this.g.enableVertexAttribArray(2);for(a=0;3>a;++a)this.g.enableVertexAttribArray(3+a);this.g.bindBuffer(C.ARRAY_BUFFER,this.i);this.g.bufferData(C.ARRAY_BUFFER,640,C.DYNAMIC_DRAW);this.h=640;this.u=!1;this.B=Array(16);this.g.useProgram(this.o);for(a=0;16>a;++a)this.g.uniform1i(this.g.getUniformLocation(this.o,`u_texture[${a}]`),a);
this.cache=Array(1);for(a=0;1>a;++a)this.cache[a]={};setInterval(this.J.bind(this),1E3);this.v=Array(10);for(a=0;10>a;++a)this.v[a]=Ka(this,a.toString(),19,"#f00")}J(){const a=performance.now();for(let b=0;1>b;++b)for(const c in this.cache[b]){const f=this.cache[b][c];1E3<a-f.da&&(this.delete(f),delete this.cache[b][c])}}delete({L:a}){this.g.deleteTexture(a)}create(a,b,c,f){const g="EVADING"+a,d=this.cache[f][g];if(void 0!==d){if(.01>ea(d.size-b)&&d.color==c)return d.da=performance.now(),d;this.delete(d);
delete this.cache[f][g]}a=Ka(this,a,b,c);return this.cache[f][g]=a}j({L:a,w:b,$:c},f,g,d){Ga(this);this.u||(this.h=0,this.u=!0);this.B[this.h]=a;a=Ba(Aa(this.l,f,g),b,c);z.setFloat32(40*this.h,d,!0);for(d=0;3>d;++d)for(b=0;3>b;++b)z.setFloat32(40*this.h+4+4*(3*d+b),a[3*d+b],!0);16==++this.h&&La(this)}}
class Oa extends Ha{constructor(a){super(a,"\n      layout(location = 0) in vec2 a_position;\n      layout(location = 1) in vec2 a_offset;\n\n      uniform mat3 u_matrix;\n\n      void main() {\n        gl_Position = vec4((u_matrix * vec3(a_position + a_offset, 1.0)).xy, -1.0, 1.0);\n      }\n      ","\n      void main() {\n        fragColor = vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    ");new Float32Array([0,0,0,1]);new Float32Array([0,0,1,0]);this.u=this.g.createBuffer();this.g.bindBuffer(C.ARRAY_BUFFER,
this.u);this.g.vertexAttribPointer(0,2,C.FLOAT,!1,0,0);this.g.enableVertexAttribArray(0);this.i=this.g.createBuffer();this.g.bindBuffer(C.ARRAY_BUFFER,this.i);this.g.vertexAttribPointer(1,2,C.BYTE,!1,0,0);this.g.vertexAttribDivisor(1,1);this.g.enableVertexAttribArray(1)}}
function Pa(a){a.i.innerHTML="";let b,c,f;for([b,c,f]of a.v){const d=t("option");d.value=f;f==F.C.url&&(d.selected=!0,d.disabled=!0,a.g=d);b>=c&&(d.disabled=!0);var g=f;const h=g.match(/\/\/(.*?)\.shadam\.xyz/),m=g.match(/\/\/(.*?)[\/:]/);g=h?h[1]:m?m[1]:g;d.innerHTML=g[0].toUpperCase()+g.substring(1)+` (${b}/${c})`;a.i.appendChild(d)}a.i.onfocus=a.ha.bind(a);a.i.onchange=a.ga.bind(a);Qa(a)}
function Ra(){var a=G;Pa(a);a.O=setInterval(function(){fetch("servers.json",{cache:"no-store"}).then(b=>b.json()).then(function(b){G.v=b;Pa(G)})},5E3)}function Sa(){G.l.style.display="block"}function Ta(a){a.o=0;a:{switch(a.o){case 0:var b=`Press ${k.spec_prev} or ${k.spec_next} to switch between players<br><br>Type "/menu" in chat to return to the main menu`;break a}b=void 0}a.u=b;null!=a.h&&(a.h.innerHTML=a.u)}function Ua(){var a=G;0==a.o&&Ta(a)}
function Va(){var a=G;const b=t("h5");b.id="ID_general_tooltip";b.innerHTML=a.u;setTimeout(function(){b.style.opacity=0},5E3);b.addEventListener("transitionend",a.N.bind(a));document.body.insertBefore(b,G.l);a.h=b}
function Qa(a){void 0==e.getItem("psfy_tooltip")&&(a.fa.innerHTML="We picked a server<br>for you automatically.<br><br>You can change it here.",a.P.style.display="table");void 0==e.getItem("tume_tooltip")&&(a.ia.innerHTML="Try out the map editor!<br><br>Submit your maps<br>in our Discord server",a.ca.style.display="inline-block")}
class Wa{constructor(){this.l=q("ID_menu");this.name=q("ID_name");this.i=q("ID_select_serv");this.v=window.s;this.P=q("ID_picked_server_for_you");this.fa=q("ID_picked_server_for_you_tooltip");this.ca=q("ID_try_map_editor");this.ia=q("ID_try_map_editor_tooltip");q("ID_map_editor_click").onclick=this.ea.bind(this);q("ID_press_esc_to_open_settings");this.D=q("ID_ping");this.R();this.G=q("ID_play");this.B=q("ID_spec");this.h=null;this.u="";this.o=-1;this.J=q("ID_spectating");this.H=q("ID_refresh");var a=
q("ID_general_tooltip");a.parentElement.removeChild(a);this.H.onclick=pa;this.name.onkeypress=this.name.onpaste=sa(16);this.name.onchange=function(){H.i=!1;e.setItem("name",this.value)};this.O=-1;a=e.getItem("name");"string"==typeof a&&16>=(new TextEncoder).encode(a).length&&(this.name.value=a);this.G.onclick=function(){var b=I;Xa(b);b.g[0]=0;b.h=1;J(F)};this.B.onclick=function(){Ya(0);J(F)}}ea(){e.setItem("tume_tooltip","");this.ca.style.display="none"}N(){null!=this.h&&(this.h.parentElement.removeChild(this.h),
this.h=null,this.o=-1)}R(){this.D.style.display=n.show_ping?"block":"none"}ha(){e.setItem("psfy_tooltip","");this.P.style.display="none"}async ga(){this.g.disabled=!1;const a=this.g;this.g=this.i.selectedOptions[0];this.g.disabled=!0;Za();let b;const c=new Promise(function(g){b=g}),f=new $a(this.g.value,b,1);setTimeout(b,2E3);await c;0==f.U||f.C.readyState!=WebSocket.OPEN?(f.stop(),u.innerHTML="Couldn't connect, returning to previous server",this.g.disabled=!1,this.g=a,this.g.disabled=!0,setTimeout(H.o.bind(H),
1E3)):ab(f)}}function J(a){a.C.send(I.i.slice(0,I.h))}function ab(a){var b=F;null!=b.C&&(b.stop(),b.once=!1,b.i=!1,b.g=[0,0]);b.M=a.M;b.V=a.V;b.I=a.I;b.A=a.A;b.C=a.C;b.C.onmessage=function({data:c}){try{this.message({data:c})}catch(f){console.log(I.A,I.h,f),console.log(Array.from(new Uint8Array(c)).map(g=>g.toString(16).padStart(2,"0")).join(" "))}}.bind(b);b.C.onclose=b.close.bind(b);bb();J(b);b.h()}
function cb(a){a.M[a.A]=(new Date).getTime()-a.V;a.I=0;let b=a.A,c=0;for(let f=0;10>f;++f)0!=a.M[b]&&(a.I+=(10-c)/11*a.M[b],++c),b=(b+1)%10;0!=c&&(a.I/=.5*c);a.A=(a.A+1)%10;setTimeout(a.l.bind(a),10)}
class db{constructor(){this.C=null;this.i=this.once=!1;this.M=Array(10).fill(0);this.A=this.I=this.V=0;this.g=[0,0]}h(){this.once=!0;var a=K;a.v=Array(5).fill(0);a.l=0;a.h.innerHTML="";a.i=0;a.B=!1;a.D="Press enter to chat";a.o();L.g=!1;a=M;for(let b=0;a.h;++b)void 0!=a.g[b]&&(E.g.delete(a.g[b].aa),delete a.g[b],--a.h);a.i=!1;eb();a=E;a.h=n.fov.value;a.i=a.h;cancelAnimationFrame(a.v);a.v=-1;a.o=0;a.B=0;N.l=-1;a=O;a.u=!1;a.v=1;a.h=1;a.g=!1;a=H;a.g=!1;a.h=!1;a.i=!1;a.id=-1}message({data:a}){I.set(new Uint8Array(a));
if(0==I.h)cb(this);else{var b=P()-1;a=!1;b!=H.id&&(H.id=b,a=!0);b=P();var c=b&1;c&&!H.h?(H.h=!0,G.l.style.display="none",Ta(G),Va(),G.J.style.display="block"):!c&&H.h&&(H.h=!1,Sa(),G.N(),G.J.style.display="none",O.u=!1);(c=b&2)&&!H.g?(H.g=!0,G.l.style.display="none",M.i=!0):!c&&H.g&&(H.g=!1,Sa(),R.stop(),O.u=!1);G.B.disabled=b&4;this.g[0]=this.g[1];this.g[1]=performance.now();b=M;c=b.h;for(var f=0;c;++f)void 0!=b.g[f]&&(b.g[f].x1=b.g[f].x2,b.g[f].y1=b.g[f].y2,b.g[f].r1=b.g[f].r2,--c);b=L;b.x1=b.x2;
b.y1=b.y2;b=P();if(b!=N.l)c=N,c.l=b,c.width=c.h.width,c.height=c.h.height,c.m=c.h.m,c.W=c.h.W,c.X=c.h.X,eb();else for(b=S,c=b.h,f=0;c;++f)void 0!=b.g[f]&&(b.g[f].x1=b.g[f].x2,b.g[f].y1=b.g[f].y2,b.g[f].r1=b.g[f].r2,--c);for(;I.A<I.h;)switch(P()){case 1:b=M;c=P();for(f=0;f<c;++f){var g=P();if(void 0==b.g[g]){var d=T(),h=T(),m=T(),r=P();r=fb(r);const B=P();let Q=0;B&&(Q=P());var w=P();0<w&&U(K,r,fb(w));w=Ka(E.g,r,.666*m,"#00000080");b.g[g]={x:0,y:0,r:0,x1:d,x2:d,y1:h,y2:h,r1:m,r2:m,name:r,Y:B,Z:Q,aa:w,
ba:0};H.id==g&&(g=L,g.g||(g.x2=d,g.y2=h));++b.h}else if(d=P(),0==d){if(void 0==b.g[g])throw Error("trying to delete an unknown player entity id "+g);E.g.delete(b.g[g].aa);delete b.g[g];--b.h}else{do{switch(d){case 1:b.g[g].x2=T();H.id==g&&(d=L,d.g||(d.x2=b.g[g].x2));break;case 2:b.g[g].y2=T();H.id==g&&(d=L,d.g||(d.y2=b.g[g].y2));break;case 3:b.g[g].r2=T();break;case 4:b.g[g].Y=P();b.g[g].Y&&(b.g[g].Z=P());break;case 5:d=P();U(K,b.g[g].name,fb(d));break;default:throw Error();}d=P()}while(0<d&&16>d);
128==d&&(d=b,h=g,d.g[h].x1=d.g[h].x2,d.g[h].y1=d.g[h].y2,d.g[h].r1=d.g[h].r2,b.i=g==H.id)}}break;case 2:b=S;c=gb();for(f=0;f<c;++f)if(g=gb(),void 0==b.g[g])d=P()-1,h=T(),m=T(),r=T(),b.g[g]={type:d,x:0,y:0,r:0,x1:h,x2:h,y1:m,y2:m,r1:r,r2:r},++b.h;else if(d=P(),0==d){if(void 0==b.g[g])throw Error("trying to delete an unknown ball entity id "+g);delete b.g[g];--b.h}else{do{switch(d){case 1:b.g[g].x2=T();break;case 2:b.g[g].y2=T();break;case 3:b.g[g].r2=T();break;default:throw Error();}d=P()}while(d)
}break;case 3:b=K;c=P();for(f=0;f<c;++f)d=P(),g=(new TextDecoder).decode(I.g.subarray(I.A,I.A+d)),I.A+=d,d=P(),U(b,g,(new TextDecoder).decode(I.g.subarray(I.A,I.A+d))),I.A+=d;break;default:throw Error();}if(I.A>I.h)throw Error();-1==H.id?hb(.5*N.width,.5*N.height):M.i?(hb(M.g[H.id].x2,M.g[H.id].y2),M.i=!1):a&&(a=L,a.g||(b=M.g[H.id].y2,a.x2=M.g[H.id].x2,a.y2=b));0==this.g[0]||this.i||(this.i=!0,a=E,a.v=window.requestAnimationFrame(a.j.bind(a)),H.o())}}close(a){4E3==a?(ib(),u.innerHTML="Server is full"):
ib()}l(){this.V=(new Date).getTime();this.C.send(new ArrayBuffer(0))}stop(){this.C.onopen=this.C.onmessage=this.C.onclose=null;this.C.close()}}function jb(a){a.C=new WebSocket(a.o);a.C.binaryType="arraybuffer";a.C.onopen=a.h.bind(a);a.C.onmessage=a.message.bind(a);a.C.onclose=a.close.bind(a)}class $a extends db{constructor(a,b,c=8){super();this.U=0;this.u=c;this.v=b;this.o=a;jb(this)}h(){this.l()}message(){cb(this);++this.U==this.u&&this.v(this.C.url)}close(){jb(this)}}
function Ya(a){var b=I;b.g[0]=4;b.g[1]=a;b.h=2}function bb(){var a=I;0==na.length?a.h=1:(a.g.set(na),a.h=na.length)}function P(){var a=I;return a.g[a.A++]}function gb(){var a=I;const b=a.g[a.A]|a.g[a.A+1]<<8;a.A+=2;return b}function T(){var a=I;const b=a.view.getFloat32(a.A,!0);a.A+=4;return b}function fb(a){var b=I;const c=(new TextDecoder).decode(b.g.subarray(b.A,b.A+a));b.A+=a;return c}
function Xa(a){if(!H.i){H.i=!0;a.g[0]=3;var b=G;b=(new TextEncoder).encode(b.name.value);a.g.set(b,1);a.h=b.length+1;J(F)}}class kb{constructor(){this.i=new ArrayBuffer(1048576);this.g=new Uint8Array(this.i);this.view=new DataView(this.i);this.A=this.h=0}set(a){this.g.set(a);this.h=a.length;this.A=0}}
class lb{constructor(){this.size=0}g(){this.size=n.death_arrow_size.value;const a=t("canvas");a.width=a.height=Math.ceil(this.size*p);const b=.5*a.width,c=a.width,f=a.getContext("2d");f.beginPath();f.moveTo(b+.45*c,b);f.lineTo(b-.225*c,b-.675*c/Math.sqrt(3));f.lineTo(b-.225*c,b+.675*c/Math.sqrt(3));f.closePath();f.fillStyle="#bbbbbbb0";f.fill();f.lineWidth=.1*b;f.strokeStyle="#f00";f.stroke();this.L={L:D(E.g,a,c,c),w:b/p,$:b/p}}}
function mb(a){void 0==e.getItem("tth_tooltip")&&(a.R.innerHTML='Try "/help"',a.J.style.display="inline-block",a.H.style.width="130%")}function U(a,b,c,f=!1){const g=t("p");g.appendChild(document.createTextNode((f?"":b+": ")+c));a.h.insertBefore(g,a.h.firstChild);++a.i>n.max_chat_messages.value&&a.h.removeChild(a.h.lastChild)}function nb(a){a.g.value="";a.g.blur();E.l.canvas.focus()}function ob(a,b){a.D=a.g.placeholder;a.g.placeholder=b;a.g.disabled=!0;a.g.value="";E.l.canvas.focus()}
function pb(){var a=K;!a.B&&n.chat_on&&(a.G.style.display="block")}
class qb{constructor(){this.v=Array(5).fill(0);this.l=0;this.G=q("ID_chat");this.h=q("ID_messages");this.g=q("ID_sendmsg");this.H=q("ID_chat_fix");this.J=q("ID_try_typing_help");this.R=q("ID_try_typing_help_tooltip");mb(this);this.P=sa(128);this.i=0;this.B=!1;this.D="";this.u=-1;this.g.onkeydown=function(a){a.stopPropagation();if("Enter"==a.code){a=this.g.value.trim();switch(a){case "/help":U(this,null,">",!0);U(this,null,"Available commands:",!0);U(this,null,"/clear /c => clear the chat",!0);U(this,
null,"/respawn /r => tp to the first area",!0);U(this,null,"/die /d => become downed",!0);U(this,null,"/menu /m => quit the game and open the menu",!0);U(this,null,"/spectate /s => start/stop spectating",!0);U(this,null,">",!0);nb(this);e.setItem("tth_tooltip","");this.J.style.display="none";this.H.style.width="100%";return;case "/c":case "/clear":this.h.innerHTML="";this.i=0;nb(this);return}a=(new TextEncoder).encode(a);if(0<a.length){var b=I;Xa(b);b.g[0]=2;b.g.set(a,1);b.h=a.length+1;J(F);this.v[this.l]=
(new Date).getTime();a=(this.l+1)%5;b=5E3-this.v[this.l]+this.v[a];this.l=a;0<b?(ob(this,"You are on cooldown for sending too many messages too quickly"),this.u=setTimeout(this.o.bind(this),b)):nb(this)}}}.bind(this);this.g.onkeyup=function(a){a.stopPropagation()};this.g.onkeypress=this.g.onpaste=this.P}o(){-1!=this.u&&(clearTimeout(this.u),this.u=-1);this.g.disabled=!1;this.g.placeholder=this.D}focus(){this.g.focus()}N(){for(;this.i>n.max_chat_messages.value;)this.h.removeChild(this.h.lastChild),
--this.i}O(){this.h.style["font-size"]=n.chat_text_scale.value+"em"}}function hb(a,b){var c=L;c.g||(c.x2=a,c.y2=b,c.x1=c.x2,c.y1=c.y2)}class rb{constructor(){this.y2=this.x2=this.y1=this.x1=this.y=this.x=0;this.g=!1}block(){this.g=!0}}class sb{constructor(){this.g=Array(100);this.h=0;this.i=!1}}function eb(){var a=S;a.g=Array(65535);a.h=0}class tb{constructor(){this.g=Array(65535);this.h=0}}function ub(){var a=vb;a.g=!0;return new Promise(function(b){a.h=function(c){a.g=!1;b(c)}})}
class wb{constructor(){this.h=null;this.g=!1}}
function xb({ja:a,ka:b}){switch(R.g){case 0:n.show_tutorial&&0==N.l&&E.g.j(E.g.create("Need help? Press KeyT for a tutorial.",20,"#f48",0),.5*N.width,2.5*N.m,1);break;case 1:E.g.j(E.g.create("<-- Your character",20,"#f48",0),L.x+110,L.y,1);E.g.j(E.g.create("Your character --\x3e",20,"#f48",0),L.x-110,L.y,1);E.g.j(E.g.create("This is your character. You can control it with these keys:",20,"#f48",0),L.x,L.y-220,1);E.g.j(E.g.create(`${k.up}: up`,20,"#f48",0),L.x,L.y-170,1);E.g.j(E.g.create(`${k.left}: left`,
20,"#f48",0),L.x,L.y-130,1);E.g.j(E.g.create(`${k.down}: down`,20,"#f48",0),L.x,L.y-90,1);E.g.j(E.g.create(`${k.right}: right`,20,"#f48",0),L.x,L.y-50,1);E.g.j(E.g.create("You can also control it with mouse. Just",20,"#f48",0),L.x,L.y+50,1);E.g.j(E.g.create("press any mouse button to start or stop moving.",20,"#f48",0),L.x,L.y+70,1);E.g.j(E.g.create("Scroll to change your field of view.",20,"#f48",0),L.x,L.y+110,1);E.g.j(E.g.create("Note that you won't be able to perform some",20,"#f48",0),L.x,L.y+
150,1);E.g.j(E.g.create("of the above actions until the tutorial ends.",20,"#f48",0),L.x,L.y+170,1);E.g.j(E.g.create("Press KeyT to continue",20,"#f48",0),L.x,L.y+220,1);break;case 2:E.g.j(E.g.create("--\x3e",20,"#f48",0),a+2*N.m,b-1*N.m,1);E.g.j(E.g.create("--\x3e",20,"#f48",0),a+2*N.m,b,1);E.g.j(E.g.create("--\x3e",20,"#f48",0),a+2*N.m,b+1*N.m,1);E.g.j(E.g.create("<--",20,"#f48",0),a-2*N.m,b-2*N.m,1);E.g.j(E.g.create("<--",20,"#f48",0),a-3*N.m,b-1*N.m,1);E.g.j(E.g.create("<--",20,"#f48",0),a-4*
N.m,b,1);E.g.j(E.g.create("<--",20,"#f48",0),a-3*N.m,b+1*N.m,1);E.g.j(E.g.create("<--",20,"#f48",0),a-2*N.m,b+2*N.m,1);E.g.j(E.g.create("These are safezones. Enemies can't",20,"#f48",0),a,b-130,1);E.g.j(E.g.create("reach you inside of these tiles.",20,"#f48",0),a,b-110,1);E.g.j(E.g.create("Press KeyT to continue",20,"#f48",0),a,b+110,1);break;case 3:E.g.j(E.g.create("<--",20,"#f48",0),a-2*N.m,b-2*N.m,1);E.g.j(E.g.create("<--",20,"#f48",0),a-1*N.m,b-3*N.m,1);E.g.j(E.g.create("<--",20,"#f48",0),a,b-
4*N.m,1);E.g.j(E.g.create("<--",20,"#f48",0),a-2*N.m,b+2*N.m,1);E.g.j(E.g.create("<--",20,"#f48",0),a-1*N.m,b+3*N.m,1);E.g.j(E.g.create("<--",20,"#f48",0),a,b+4*N.m,1);E.g.j(E.g.create("--\x3e",20,"#f48",0),a+2*N.m,b-3*N.m,1);E.g.j(E.g.create("--\x3e",20,"#f48",0),a+2*N.m,b+3*N.m,1);E.g.j(E.g.create("<--",20,"#f48",0),a+5*N.m,b-2*N.m,1);E.g.j(E.g.create("<--",20,"#f48",0),a+6*N.m,b-1*N.m,1);E.g.j(E.g.create("<--",20,"#f48",0),a+7*N.m,b,1);E.g.j(E.g.create("<--",20,"#f48",0),a+6*N.m,b+1*N.m,1);E.g.j(E.g.create("<--",
20,"#f48",0),a+5*N.m,b+2*N.m,1);E.g.j(E.g.create("These are walls. Players can't walk over them.",20,"#f48",0),a,b-40,1);E.g.j(E.g.create("However, some types (colors) of enemies can.",20,"#f48",0),a,b-10,1);E.g.j(E.g.create("Press KeyT to continue",20,"#f48",0),a,b+40,1);break;case 4:E.g.j(E.g.create("--\x3e",20,"#f48",0),a,b,1);E.g.j(E.g.create("This is a teleport tile. If you walk on it,",20,"#f48",0),a,b-130,1);E.g.j(E.g.create("you will be teleported to the area it points to.",20,"#f48",0),a,
b-110,1);E.g.j(E.g.create("If instead of an arrow you see a dot, that means you",20,"#f48",0),a,b-70,1);E.g.j(E.g.create("will be teleported to a tile somewhere in the same area.",20,"#f48",0),a,b-50,1);E.g.j(E.g.create("If instead you see an X mark, that teleport does not lead",20,"#f48",0),a,b+50,1);E.g.j(E.g.create("anywhere. Simply, the next area does not exist in that case.",20,"#f48",0),a,b+70,1);E.g.j(E.g.create("Press KeyT to continue",20,"#f48",0),a,b+120,1);break;case 5:E.g.j(E.g.create("Enemy ball --\x3e",
20,"#f48",0),a-110,b,1);E.g.j(E.g.create("<-- Enemy ball",20,"#f48",0),a+110,b,1);E.g.j(E.g.create("This is an enemy, also called a ball. A grey ball",20,"#f48",0),a,b-110,1);E.g.j(E.g.create("doesn't do a lot - it simply moves in one direction. However,",20,"#f48",0),a,b-90,1);E.g.j(E.g.create("as you are about to find out when you start exploring the game,",20,"#f48",0),a,b-70,1);E.g.j(E.g.create("there are lots of types of enemies, each having their own color.",20,"#f48",0),a,b-50,1);E.g.j(E.g.create("Coming in contact with an enemy downs you. While downed, you can't move,",
20,"#f48",0),a,b+50,1);E.g.j(E.g.create("and after a while, you die, unless other players revive you by touching you.",20,"#f48",0),a,b+70,1);E.g.j(E.g.create("Press KeyT to continue",20,"#f48",0),a,b+120,1);break;case 6:E.g.j(E.g.create(`You can press ${k.settings} to open settings.`,20,"#f48",0),a,b-80,1),E.g.j(E.g.create("There are a lot of cool options to change. Try it out later.",20,"#f48",0),a,b-60,1),E.g.j(E.g.create("That's it for this tutorial. See how far you can go!",20,"#f48",0),a,b+
60,1),E.g.j(E.g.create("GLHF!",20,"#f48",0),a,b+80,1),E.g.j(E.g.create("Press KeyT to end the tutorial",20,"#f48",0),a,b+130,1)}}class yb{constructor(){this.l=this.g=0;this.h=null;this.i=!1}progress(){0==this.g?n.show_tutorial&&H.g&&0==N.l&&(this.g=1,this.l=E.i,ob(K,"Waiting for the tutorial to finish..."),E.i=1.75,L.block(),zb(),O.stop(),O.block()):this.i&&(this.i=!1,7==++this.g&&(this.h.click(),E.i=this.l,this.stop()))}stop(){this.g=0;K.o();L.g=!1;V.g=!1;O.g=!1;O.start()}}
function zb(){var a=V;a.i&&(a.g=!1,Ab(a));a.g=!0}
function Bb(a){a.o.innerHTML="";Cb(a,"CHAT");a.add(a.text("Show chat"),W("chat_on",function(b){b?pb():(b=K,b.B||(b.G.style.display="none"))}));a.add(a.text("Max number of chat messages"),X(a,"max_chat_messages","",K.N.bind(K)));a.add(a.text("Chat text scale"),X(a,"chat_text_scale","",K.O.bind(K)));Cb(a,"MENU");a.add(a.text("Show latency"),W("show_ping",G.R.bind(G)));Cb(a,"GAME");R.h=W("show_tutorial");a.add(a.text("Enable tutorial"),R.h);a.add(a.text("Slow movement speed"),X(a,"slowwalk_speed","%"));
Cb(a,"VISUALS");a.add(a.text("Default FOV"),X(a,"fov"));a.add(a.text("Draw balls' fill"),W("draw_ball_fill"));a.add(a.text("Draw balls' stroke"),W("draw_ball_stroke"));a.add(a.text("Draw stroke-only balls with brighter color"),W("draw_ball_stroke_bright"));a.add(a.text("Balls' stroke radius percentage"),X(a,"ball_stroke","%"));a.add(a.text("Draw players' fill"),W("draw_player_fill"));a.add(a.text("Draw players' stroke"),W("draw_player_stroke"));a.add(a.text("Draw stroke-only players with brighter color"),
W("draw_player_stroke_bright"));a.add(a.text("Players' stroke radius percentage"),X(a,"player_stroke","%"));a.add(a.text("Draw players' name"),W("draw_player_name"));a.add(a.text("Draw an arrow towards dead players"),W("draw_death_arrow"));a.add(a.text("Death arrow size"),X(a,"death_arrow_size","px",Db.g.bind(Db)));Cb(a,"KEYBINDS");Eb(a,Fb("h5","To change, click a button on the right side and then press the key you want to assign to it."));a.add(a.text("Settings"),Y("settings"));a.add(a.text("Move up"),
Y("up"));a.add(a.text("Move left"),Y("left"));a.add(a.text("Move down"),Y("down"));a.add(a.text("Move right"),Y("right"));a.add(a.text("Move slowly"),Y("slowwalk"));a.add(a.text("Spectate the previous player"),Y("spec_prev",function(){Ua()}));a.add(a.text("Spectate the next player"),Y("spec_next",function(){Ua()}));Cb(a,"RESET");a.add(a.text("Reset settings"),a.button("RESET",function(){n=JSON.parse(JSON.stringify(l));la();Bb(this)}.bind(a)));a.add(a.text("Reset keybinds"),a.button("RESET",function(){k=
JSON.parse(JSON.stringify(ia));ja();Bb(this)}.bind(a)));a.add(a.text("Reset all tooltips"),a.button("RESET",function(){e.removeItem("psfy_tooltip");e.removeItem("tume_tooltip");Qa(G);e.removeItem("tth_tooltip");mb(K)}));a.end()}function Ab(a){a.g||(a.i=!1,a.l.style.display="none",O.g=!1,O.start())}function Eb(a,b){a.o.appendChild(b)}function Cb(a,b){a.end();Eb(a,Fb("h1",b));a.h=t("table")}function Fb(a,b){a=t(a);a.innerHTML=b;return a}
function W(a,b=function(){}){const c=t("button");n[a]=!n[a];let f=!0;c.onclick=function(){n[a]=!n[a];1==n[a]?(c.innerHTML="ON",c.style["background-color"]="#23c552"):(c.innerHTML="OFF",c.style["background-color"]="#f84f31");la();f?f=!1:b(n[a])};c.onclick();return c}function Y(a,b=function(){}){const c=t("button");c.innerHTML=k[a];c.onclick=async function(){c.innerHTML="...";const f=await ub();c.innerHTML=f;k[a]=f;ja();b()};c.style.color="#000";return c}
function X(a,b,c="",f=function(){}){const g=t("div");g.className="input";const d=t("input");d.type="range";d.min=n[b].min;d.max=n[b].max;d.step=n[b].step;d.value=n[b].value;d.oninput=function(){d.nextElementSibling.innerHTML=d.value+c;n[b].value=d.valueAsNumber;f()};d.onchange=la;g.appendChild(d);g.appendChild(a.text(d.value+c));return g}
class Gb{constructor(){this.l=q("ID_settings_container");this.o=q("ID_settings");this.g=this.i=!1;this.h=null;Bb(this)}add(a,b){const c=t("tr");let f=t("td");f.appendChild(a);c.appendChild(f);f=t("td");f.appendChild(b);b.onchange=la;c.appendChild(f);this.h.appendChild(c)}end(){null!=this.h&&(Eb(this,this.h),this.h=null)}text(a){return Fb("h3",a)}button(a,b){const c=t("button");c.innerHTML=a;c.onclick=b;return c}}
class Hb{constructor(){this.l=Ea("ID_canvas");this.u=new Ja(this.l);this.g=new Na(this.l);new Oa(this.l);this.i=this.h=n.fov.value;this.v=-1;this.B=this.o=0;this.l.canvas.onwheel=this.G.bind(this);this.l.canvas.onmousedown=this.D.bind(this)}G(a){a=.05*-Math.sign(a.deltaY);this.i=1<this.i?this.i+3*a:this.i+a;this.i=da(ca(this.i,n.fov.min),p)}D(){O.u=!O.u;Z(O)}j(a){this.o=da(ca(this.o,F.g[0]),F.g[1]);var b=this.h;this.h=+v(this.h,this.i,.1).toPrecision(5);this.h!=b&&Z(O);b=F.g[0]==F.g[1]?1:(this.o-
F.g[0])/(F.g[1]-F.g[0]);this.o+=a-this.B;this.B=a;n.show_ping&&(G.D.innerHTML=F.I.toFixed(1)+"ms");a=this.l;a.canvas.width!=A.width&&(a.canvas.width=A.width);a.canvas.height!=A.height&&(a.canvas.height=A.height);a.viewport(0,0,a.canvas.width,a.canvas.height);a.clearColor(.2,.2,.2,1);a.clear(C.COLOR_BUFFER_BIT|C.DEPTH_BUFFER_BIT);a.enable(C.DEPTH_TEST);a.enable(C.BLEND);a.blendFunc(C.ONE,C.ONE_MINUS_SRC_ALPHA);a.depthFunc(C.LEQUAL);a=R;var c=0,f=0;switch(a.g){case 1:c=M.g[H.id].x2;f=M.g[H.id].y2;break;
case 2:c=.5*N.width-6*N.m;f=.5*N.height;break;case 3:c=.5*N.width+6*N.m;f=.5*N.height;break;case 4:c=.5*N.m;f=.5*N.height;break;case 5:for(c=0;65535>c;++c)if(S.g[c]){var g=S.g[c];break}c=g.x;f=g.y;break;case 6:c=M.g[H.id].x2,f=M.g[H.id].y2}if(0!=a.g){g=.2*b;var d=L;d.x2=v(d.x2,c,g);d.y2=v(d.y2,f,g)}ea(L.x-c)<=10*A.g&&ea(L.y-f)<=10*A.g&&(a.i=1);g={ja:c,ka:f};L.x=v(L.x1,L.x2,b);L.y=v(L.y1,L.y2,b);N.j();this.u.l=N.i;this.g.l=N.i;c=0;a=S.h;for(f=0;a;++f)d=S.g[f],void 0!=d&&(--a,d.x=v(d.x1,d.x2,b),z.setFloat32(c,
d.x,!0),c+=4,d.y=v(d.y1,d.y2,b),z.setFloat32(c,d.y,!0),c+=4,d.r=v(d.r1,d.r2,b),z.setFloat32(c,d.r,!0),c+=4,z.setUint32(c,za[d.type]),c+=4);this.u.set(x.slice(0,c),c>>4);this.u.j(n.draw_ball_fill,n.draw_ball_stroke,n.ball_stroke.value/100,n.draw_ball_stroke_bright);c=0;a=M.h;for(f=0;a;++f)d=M.g[f],void 0!=d&&(--a,d.x=v(d.x1,d.x2,b),z.setFloat32(c,d.x,!0),c+=4,d.y=v(d.y1,d.y2,b),z.setFloat32(c,d.y,!0),c+=4,d.r=v(d.r1,d.r2,b),z.setFloat32(c,d.r,!0),c+=4,z.setUint32(c,3991793919),c+=4);this.u.set(x.slice(0,
c),c>>4);this.u.j(n.draw_player_fill,n.draw_player_stroke,n.player_stroke.value/100,n.draw_player_stroke_bright);a=M.h;for(b=0;a;++b)if(c=M.g[b],void 0!=c&&(--a,n.draw_player_name&&0!=c.name.length&&(c.ba=v(c.ba,10,.1),this.g.j(c.aa,c.x,c.y-c.r-c.ba,c.r)),c.Y&&(Ma(this.g,c.Z,c.x,c.y,c.r),n.draw_death_arrow))){var h=void 0;d=.75*Db.size;d*=E.h;h=.5*A.width+(c.x-L.x)*E.h;var m=.5*A.height+(c.y-L.y)*E.h;f=!1;(0>h||h>A.width-0)&&(f=!0);h=ca(da(h,A.width-d),d);(0>m||m>A.height-0)&&(f=!0);d=ca(da(m,A.height-
d),d);const [r,w,B]=[(h-.5*A.width)/E.h+L.x,(d-.5*A.height)/E.h+L.y,f];B&&(h=Math.atan2(c.y-w,c.x-r),d=Aa(N.i,r,w),f=this.g,m=-h,h=ba(m),m=aa(m),h=d.multiply(new Float32Array([h,-m,0,m,h,0,0,0,1])),f.l=h,this.g.j(Db.L,0,0,1),this.g.l=Ba(d,.3*Db.size/19),Ma(this.g,c.Z,0,0,1),this.g.l=N.i)}xb(g);La(this.g);this.v=window.requestAnimationFrame(this.j.bind(this))}}
function Ib(a){var b=N;let c=0;for(;c<a.length;){var f=a[c++];const g=a[c++],d=a[c++],h={m:d,width:f*d,height:g*d,W:f,X:g,K:new Uint8Array(f*g*3),T:new Uint8Array(131072),S:new Uint8Array(131072),F:[]};let m=0;for(let r=0;r<f;++r)for(let w=0;w<g;++w){const B=a[c++];2!=B&&(3==B&&(h.F[h.F.length]=[(r+.5)*d,(w+.5)*d,0]),h.K[m++]=r,h.K[m++]=w,h.K[m++]=B)}h.K=h.K.subarray(0,m);for(m=0;;){f=a[c++];if(255==f)break;h.T[m++]=f;h.T[m++]=a[c++]}h.T=h.T.subarray(0,m);for(m=0;;){f=a[c++];if(255==f)break;h.S[m++]=
f;h.S[m++]=a[c++]}h.S=h.S.subarray(0,m);for(m=0;m<h.F.length;++m)h.F[m][2]=a[c++];b.o[b.o.length]=h}}
class Jb{constructor(){this.g=new Ia;this.X=this.W=this.m=this.height=this.width=0;this.o=[];this.i=null;this.F=Array(6);const a=t("canvas"),b=a.getContext("2d");a.width=a.height=512;b.fillStyle=b.strokeStyle="#cbb260";b.lineWidth=32;b.lineCap="round";b.arc(256,256,64,0,2*Math.PI);b.fill();this.F[0]=D(this.g,a,512,512);b.beginPath();b.clearRect(0,0,512,512);b.moveTo(256,384);b.lineTo(256,128);b.moveTo(256,128);b.lineTo(128,256);b.moveTo(256,128);b.lineTo(384,256);b.stroke();this.F[1]=D(this.g,a,512,
512);b.beginPath();b.clearRect(0,0,512,512);b.moveTo(384,256);b.lineTo(128,256);b.moveTo(128,256);b.lineTo(256,128);b.moveTo(128,256);b.lineTo(256,384);b.stroke();this.F[2]=D(this.g,a,512,512);b.beginPath();b.clearRect(0,0,512,512);b.moveTo(128,256);b.lineTo(384,256);b.moveTo(384,256);b.lineTo(256,128);b.moveTo(384,256);b.lineTo(256,384);b.stroke();this.F[3]=D(this.g,a,512,512);b.beginPath();b.clearRect(0,0,512,512);b.moveTo(256,128);b.lineTo(256,384);b.moveTo(256,384);b.lineTo(128,256);b.moveTo(256,
384);b.lineTo(384,256);b.stroke();this.F[4]=D(this.g,a,512,512);b.beginPath();b.clearRect(0,0,512,512);b.moveTo(128,128);b.lineTo(384,384);b.moveTo(384,128);b.lineTo(128,384);b.stroke();this.F[5]=D(this.g,a,512,512);this.l=-1}get h(){return this.o[this.l]}j(){this.g.set(this.h.K,this.h.K.length/3);this.i=Aa(Ba(Aa(new Ca,.5*A.width,.5*A.height),E.h),-L.x,-L.y);this.g.l=Ba(this.i,this.m);this.g.j();E.g.l=this.i;const a=this.m>>1;for(const [b,c,f]of this.h.F)E.g.j({L:this.F[f],w:a,$:a},b,c,-2);La(E.g)}}
class Kb{constructor(){this.height=this.width=this.h=this.i=this.g=0;this.l=[0,0];window.onresize=this.o.bind(this);window.onkeyup=this.B.bind(this);window.onkeydown=this.v.bind(this);window.onmousemove=this.D.bind(this);window.onbeforeunload=this.u.bind(this)}o(){if(window.devicePixelRatio!=this.g||window.innerWidth!=this.i||window.innerHeight!=this.h)this.g=window.devicePixelRatio,this.i=window.innerWidth,this.h=window.innerHeight,this.width=this.i*this.g,this.height=this.h*this.g}v(a){if(!a.repeat)if(vb.g)a.preventDefault(),
vb.h(a.code);else if(a.code==k.settings)V.i?Ab(V):(a=V,a.g||(a.i=!0,a.l.style.display="block",O.stop(),O.block()));else if(H.h)switch(a.code){case k.spec_prev:Ya(-1);J(F);break;case k.spec_next:Ya(1),J(F)}else switch(a.code){case "Enter":K.focus(a);break;case k.up:O.B||(O.B=1,Z(O));break;case k.down:O.o||(O.o=1,Z(O));break;case k.left:O.i||(O.i=1,Z(O));break;case k.right:O.l||(O.l=1,Z(O));break;case k.slowwalk:1==O.v&&(Lb(n.slowwalk_speed.value/100),Z(O));break;case "KeyT":R.progress()}}B(a){if(!a.repeat)switch(a.code){case k.up:O.B&&
(O.B=0,Z(O));break;case k.down:O.o&&(O.o=0,Z(O));break;case k.left:O.i&&(O.i=0,Z(O));break;case k.right:O.l&&(O.l=0,Z(O));break;case k.slowwalk:1!=O.v&&(Lb(1),Z(O))}}D(a){this.l=[a.clientX*this.g,a.clientY*this.g];Z(O)}u(a){if(H.g)return a.preventDefault(),a.returnValue="Are you sure you want to quit?"}}
function Z(a){if(H.g&&!a.g){a=I;let c=0;var b=0;if(O.u){b=A.l[0]-.5*A.width;const f=A.l[1]-.5*A.height;c=Math.atan2(f,b);b=Math.hypot(b,f)/E.h}else if(O.B!=O.o||O.i!=O.l)c=Math.atan2(O.o-O.B,O.l-O.i),b=160*A.g;a.g[0]=1;a.view.setFloat32(1,c,!0);a.g[5]=b>=160*A.g?255*O.h:1.59375*b/A.g*O.h;a.h=6;J(F)}}function Lb(a){var b=O;b.g||(b.h=a);b.v=a}
class Mb{constructor(){this.u=!1;this.h=this.v=1;this.g=!1;this.l=this.i=this.o=this.B=0}block(){this.g=!0}stop(){this.g||(this.v=this.h,this.h=0,Z(this))}start(){this.g||(this.h=this.v,Z(this))}}function Za(){var a=H;u.innerHTML="Connecting";a.l?(Sa(),G.name.style.display="none",pb(),ob(K,"Waiting for connection..."),zb()):a.l=!0}
function ib(){H.g=!1;u.innerHTML="Disconnected";Sa();ob(K,"You have been disconnected");var a=G;F.once||setTimeout(oa,1E3);a.name.style.display="none";a.G.style.display="none";a.B.style.display="none";a.H.style.display="block";clearInterval(a.O);zb()}class Nb{constructor(){this.i=this.h=this.g=!1;this.id=-1;this.l=!1}o(){Sa();G.name.style.display="block";u.innerHTML="";pb();K.o();V.g=!1}}var G,F,I,Db,K,L,M,S,vb,R,V,E,N,A,O,H;
(async function(){var a=new Uint8Array(await (await fetch("memory.mem",{cache:"force-cache"})).arrayBuffer());await document.fonts.ready;G=new Wa;F=new db;I=new kb;Db=new lb;K=new qb;L=new rb;M=new sb;S=new tb;vb=new wb;R=new yb;V=new Gb;E=new Hb;N=new Jb;A=new Kb;O=new Mb;H=new Nb;A.o();Db.g();Ib(a);Za();let b;const c=new Promise(function(d){b=d});a=[];for(var [,,f]of G.v)a[a.length]=new $a(f,b);setTimeout(b,2E3,"");f=await c;let g;if(0==f.length){f=0;for(const d of a)d.C.readyState==WebSocket.OPEN&&
d.U>f&&(f=d.U,g=d.C.url)}else g=f;if(void 0==g)throw u.innerHTML="Couldn't connect to any server",setTimeout(oa,1E3),Error(u.innerHTML);for(const d of a)d.C.url!=g?d.stop():ab(d);Ra()})();
