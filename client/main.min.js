const f=window.localStorage,h=f.getItem.bind(f),k=f.setItem.bind(f),aa=f.removeItem.bind(f),ba=h("keybinds"),m={settings:"Escape",up:"KeyW",left:"KeyA",right:"KeyD",down:"KeyS",slowwalk:"ShiftLeft",spec_prev:"KeyA",spec_next:"KeyD"};let n=null!=ba?JSON.parse(ba):m;for(const a in m)a in n||(n[a]=m[a]);for(const a in n)a in m||delete n[a];function ca(){k("keybinds",JSON.stringify(n))}
const da=h("settings"),p={fov:{min:.25,max:4,value:1.75,step:.05},chat_on:!0,max_chat_messages:{min:1,max:1E3,value:100,step:1},chat_text_scale:{min:1,max:2,value:1,step:.05},stroke_thickness:{min:0,max:100,value:15,step:1},draw_player_name:!0,draw_death_arrow:!0,death_arrow_size:{min:10,max:100,value:40,step:1},show_tutorial:!0,show_ping:!1};let q=null!=da?JSON.parse(da):JSON.parse(JSON.stringify(p));for(const a in p)a in q||(q[a]=p[a]);
for(const a in q)a in p?(q[a].min&&q[a].min!=p[a].min&&(q[a].min=p[a].min),q[a].max&&q[a].max!=p[a].max&&(q[a].max=p[a].max),q[a].step&&q[a].step!=p[a].step&&(q[a].step=p[a].step),q[a].value=Math.max(Math.min(q[a].value,q[a].max),q[a].min)):delete q[a];function ea(){k("settings",JSON.stringify(q))}const r=document.getElementById.bind(document),t=document.createElement.bind(document),u=r("ID_status"),fa=h("token");let ha=[];"string"==typeof fa&&(ha=fa.split(",").map(a=>+a));
function ia(){setTimeout(location.reload.bind(location),1E3)}function ja(a){const b=a.match(/\/\/(.*?)\.shadam\.xyz/),c=a.match(/\/\/(.*?)[\/:]/);return b?b[1]:c?c[1]:a}WebSocket.prototype.send=new Proxy(WebSocket.prototype.send,{apply:function(a,b,c){if(b.readyState==WebSocket.OPEN)return a.apply(b,c)},configurable:!0,enumerable:!0});
WebSocket.prototype.close=new Proxy(WebSocket.prototype.close,{apply:function(a,b,c){if(b.readyState==WebSocket.CONNECTING||b.readyState==WebSocket.OPEN)return a.apply(b,c)},configurable:!0,enumerable:!0});
function ka(a){return function(b){const c=b instanceof ClipboardEvent;if(!c||"paste"==b.type){var g=b.target.value+(c?b.clipboardData.getData("text"):b.key);if((new TextEncoder).encode(g).byteLength-b.target.selectionEnd+b.target.selectionStart>a){if(""==b.target.value&&c){const d=b.target.placeholder;b.target.placeholder="Text too long to paste!";setTimeout(function(){b.target.placeholder=d},1E3)}b.preventDefault()}}}}function v(a,b,c){return a+(b-a)*c}
if(0==window.s.length)throw u.innerHTML="No servers found",ia(),Error(u.innerHTML);u.innerHTML="Connecting";const ra=new Uint32Array([14540253,11184810,3355443,16703352]),sa=Array.from(ra).map(a=>"#"+a.toString(16)),ta=new Uint32Array([2155905279,4232489727,8421631,4287497983,1021313023,1715110655]);Array.from(ta).map(a=>"#"+a.toString(16));const ua=new ArrayBuffer(1050160),w=new DataView(ua);
function va(a,b){const c=a[0],g=a[1],d=a[2],e=a[3],l=a[4],G=a[5],H=a[6],E=a[7],O=a[8],M=b[0],T=b[1],la=b[2],ma=b[3],na=b[4],oa=b[5],pa=b[6],qa=b[7];b=b[8];a[0]=M*c+T*e+la*H;a[1]=M*g+T*l+la*E;a[2]=M*d+T*G+la*O;a[3]=ma*c+na*e+oa*H;a[4]=ma*g+na*l+oa*E;a[5]=ma*d+na*G+oa*O;a[6]=pa*c+qa*e+b*H;a[7]=pa*g+qa*l+b*E;a[8]=pa*d+qa*G+b*O;return a}class wa extends Float32Array{constructor(){super([2/x.width,0,0,0,-2/x.height,0,-1,1,1])}}const y=WebGL2RenderingContext.prototype;
function xa(a){a=(a?r(a):t("canvas")).getContext("webgl2",{premultipliedAlpha:!1,failIfMajorPerformanceCaveat:!1});if(!a)throw u.innerHTML="Your browser/device does not support WebGL2.",Error("Your browser/device does not support WebGL2.");return a}function ya(a,b,c){b=a.g.createShader(b);a.g.shaderSource(b,c);a.g.compileShader(b);if(a.g.getShaderParameter(b,y.COMPILE_STATUS))return b;throw Error(a.g.getShaderInfoLog(b));}
function za(a){a.g.useProgram(a.h);a.g.bindVertexArray(a.u);a.g.uniformMatrix3fv(a.B,!1,a.matrix)}
class Aa{constructor(a,b,c){a instanceof WebGL2RenderingContext?this.g=a:this.g=xa(a);a=this.g.createProgram();this.g.attachShader(a,ya(this,y.VERTEX_SHADER,b));this.g.attachShader(a,ya(this,y.FRAGMENT_SHADER,c));this.g.linkProgram(a);if(this.g.getProgramParameter(a,y.LINK_STATUS))b=a;else throw Error(this.g.getProgramInfoLog(a));this.h=b;this.u=this.g.createVertexArray();this.g.bindVertexArray(this.u);this.i=null;this.B=this.g.getUniformLocation(this.h,"u_matrix");this.matrix=null;this.j=0}set(a,
b){this.g.bindBuffer(y.ARRAY_BUFFER,this.i);this.g.bufferData(y.ARRAY_BUFFER,a,y.DYNAMIC_DRAW);this.j=b}}
class Ba extends Aa{constructor(){super(z.u,"#version 300 es\n\n\n      layout(location = 0) in vec2 a_position;\n      layout(location = 1) in vec2 a_offset;\n      layout(location = 2) in float a_scale;\n      layout(location = 3) in vec3 a_color;\n\n      uniform mat3 u_matrix;\n\n      out vec3 v_color;\n\n      void main() {\n        gl_Position = vec4((u_matrix * vec3(a_position * a_scale + a_offset, 1)).xy, 0.5, 1.0);\n        v_color = a_color;\n      }\n      ","#version 300 es\n\n\n      precision mediump float;\n\n      uniform float u_light;\n\n      in vec3 v_color;\n\n      out vec4 fragColor;\n\n      void main() {\n        fragColor = vec4(v_color.xyz * u_light, 1.0);\n      }\n    ");
this.v=new Float32Array([0,1,.0375,.9625,1,1,.9625,.9625,1,0,.9625,.0375,0,0,.0375,.0375,0,1,.0375,.9625]);this.model=new Float32Array([.0375,.0375,.9625,.0375,.0375,.9625,.9625,.9625]);this.o=this.g.getUniformLocation(this.h,"u_light");this.l=this.g.createBuffer();this.g.bindBuffer(y.ARRAY_BUFFER,this.l);this.g.vertexAttribPointer(0,2,y.FLOAT,!1,0,0);this.g.enableVertexAttribArray(0);this.i=this.g.createBuffer();this.g.bindBuffer(y.ARRAY_BUFFER,this.i);this.g.vertexAttribPointer(1,2,y.SHORT,!1,8,
0);this.g.vertexAttribPointer(2,1,y.UNSIGNED_BYTE,!1,8,4);this.g.vertexAttribPointer(3,3,y.UNSIGNED_BYTE,!0,8,5);this.g.vertexAttribDivisor(1,1);this.g.vertexAttribDivisor(2,1);this.g.vertexAttribDivisor(3,1);this.g.enableVertexAttribArray(1);this.g.enableVertexAttribArray(2);this.g.enableVertexAttribArray(3)}}
class Ca extends Aa{constructor(a){super(a,"#version 300 es\n\n\n      layout(location = 0) in vec2 a_position;\n      layout(location = 1) in vec2 a_offset;\n      layout(location = 2) in float a_scale;\n      layout(location = 3) in vec4 a_color;\n      layout(location = 4) in vec2 a_texcoord;\n\n      uniform mat3 u_matrix;\n\n      out vec4 v_color;\n      out vec2 v_texcoord;\n      out float v_scale;\n\n      void main() {\n        gl_Position = vec4((u_matrix * vec3(a_position * a_scale + a_offset, 1)).xy, -1.0 / a_scale, 1.0);\n        v_color = a_color;\n        v_texcoord = a_texcoord;\n      }\n      ","#version 300 es\n\n\n      precision mediump float;\n\n      uniform float u_stroke;\n      uniform float u_scale;\n\n      in vec4 v_color;\n      in vec2 v_texcoord;\n\n      out vec4 fragColor;\n\n      void main() {\n        float dist = length(v_texcoord - vec2(0.5, 0.5));\n        float AA = 0.015625 * 4.0;\n\n        if(dist > 0.5) {\n\n          discard;\n\n        } else if(dist > 0.5 - AA) {\n\n          float mul;\n\n          if(u_stroke >= AA) {\n\n            mul = 0.8;\n\n          } else {\n\n            mul = 1.0 - smoothstep(0.0, AA, u_stroke) * 0.2;\n\n          }\n\n          fragColor = vec4(v_color.xyz * mul, v_color.w * (1.0 - smoothstep(0.5 - AA, 0.5, dist)));\n\n        } else if(dist > 0.5 - u_stroke) {\n\n          fragColor = vec4(v_color.xyz * 0.8, v_color.w);\n\n        } else if(dist > 0.5 - u_stroke - AA) {\n\n          float step = 1.0 - smoothstep(0.5 - u_stroke - AA, 0.5 - u_stroke, dist) * 0.2;\n\n          fragColor = vec4(v_color.xyz * step, v_color.w);\n\n        } else {\n\n          fragColor = v_color;\n\n        }\n      }\n    ");
this.v=this.g.getUniformLocation(this.h,"u_stroke");this.o=this.g.getUniformLocation(this.h,"u_scale");this.l=this.g.createBuffer();this.g.bindBuffer(y.ARRAY_BUFFER,this.l);this.g.bufferData(y.ARRAY_BUFFER,new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]),y.DYNAMIC_DRAW);this.g.vertexAttribPointer(0,2,y.FLOAT,!1,16,0);this.g.vertexAttribPointer(4,2,y.FLOAT,!1,16,8);this.g.enableVertexAttribArray(0);this.g.enableVertexAttribArray(4);this.i=this.g.createBuffer();this.g.bindBuffer(y.ARRAY_BUFFER,
this.i);this.g.vertexAttribPointer(1,2,y.FLOAT,!1,16,0);this.g.vertexAttribPointer(2,1,y.FLOAT,!1,16,8);this.g.vertexAttribPointer(3,4,y.UNSIGNED_BYTE,!0,16,12);this.g.vertexAttribDivisor(1,1);this.g.vertexAttribDivisor(2,1);this.g.vertexAttribDivisor(3,1);this.g.enableVertexAttribArray(1);this.g.enableVertexAttribArray(2);this.g.enableVertexAttribArray(3)}}
function Da(a){a.h.innerHTML="";for(const b of a.o){const c=t("option");c.value=b[2];b[2]==A.A.url&&(c.selected=!0,c.disabled=!0,a.g=c);b[0]>=b[1]&&(c.disabled=1);const g=ja(b[2]);c.innerHTML=g[0].toUpperCase()+g.substring(1)+` (${b[0]}/${b[1]})`;a.h.appendChild(c)}a.h.onfocus=function(){k("psfy_tooltip","");this.J.style.display="none"}.bind(a);a.h.onchange=async function(){this.g.disabled=!1;const b=this.g;this.g=this.h.selectedOptions[0];this.g.disabled=!0;Ea();let c;const g=new Promise(function(e){c=
e}),d=new Fa(this.g.value,c,1);setTimeout(c,2E3);await g;0==d.K||d.A.readyState!=WebSocket.OPEN?(d.stop(),u.innerHTML="Couldn't connect, returning to previous server",this.g.disabled=!1,this.g=b,this.g.disabled=!0,setTimeout(B.l.bind(B),1E3)):Ga(d)}.bind(a);Ha(a)}function Ia(){var a=C;Da(a);a.H=setInterval(function(){fetch("servers.json").then(b=>b.json()).then(function(b){C.o=b;Da(C)})},5E3)}function D(){C.j.style.display="block"}
function Ja(){var a=C;const b=t("h5");b.id="ID_spec_help";b.innerHTML=a.N;setTimeout(function(){b.style.opacity=0},3E3);b.addEventListener("transitionend",a.G.bind(a));document.body.insertBefore(b,C.j);a.i=b}function Ha(a){void 0==h("psfy_tooltip")&&(a.P.innerHTML="We picked a server<br>for you automatically.<br><br>You can change it here.",a.J.style.display="table")}
class Ka{constructor(){this.j=r("ID_menu");this.name=r("ID_name");this.h=r("ID_select_serv");this.g=null;this.o=window.s;this.J=r("ID_picked_server_for_you");this.P=r("ID_picked_server_for_you_tooltip");this.v=r("ID_ping");this.M();this.B=r("ID_play");this.u=r("ID_spec");this.i=null;this.N="";this.l();this.F=r("ID_spectating");this.C=r("ID_refresh");var a=r("ID_spec_help");a.parentElement.removeChild(a);this.C.onclick=location.reload.bind(location);this.name.onkeypress=this.name.onpaste=ka(16);this.name.onchange=
function(){B.i=!1;k("name",this.value)};this.H=-1;a=h("name");"string"==typeof a&&16>=(new TextEncoder).encode(a).length&&(this.name.value=a);this.B.onclick=function(){var b=F;La(b);b.g[0]=0;b.h=1;I(A)};this.u.onclick=function(){Ma(0);I(A)}}l(){this.N=`Press ${n.spec_prev} or ${n.spec_next} to switch between players<br><br>Type "/menu" in chat to return to the main menu`}G(){null!=this.i&&(this.i.parentElement.removeChild(this.i),this.i=null)}M(){this.v.style.display=q.show_ping?"block":"none"}}
function I(a){a.A.send(F.g.subarray(0,F.h))}function Ga(a){var b=A;null!=b.A&&(b.stop(),b.once=!1,b.i=!1,b.g=[0,0]);b.I=a.I;b.L=a.L;b.D=a.D;b.m=a.m;b.A=a.A;b.A.onmessage=function({data:c}){try{this.message({data:c})}catch(g){console.log(g),console.log(Array.from(new Uint8Array(c)).map(d=>d.toString(16).padStart(2,"0")).join(" "))}}.bind(b);b.A.onclose=b.close.bind(b);Na();I(b);b.h()}
function Oa(a){a.I[a.m]=(new Date).getTime()-a.L;a.D=0;let b=a.m,c=0;for(let g=0;10>g;++g)0!=a.I[b]&&(a.D+=(10-c)/11*a.I[b],++c),b=(b+1)%10;0!=c&&(a.D/=.5*c);a.m=(a.m+1)%10;setTimeout(a.j.bind(a),10)}
class Pa{constructor(){this.A=null;this.i=this.once=!1;this.I=Array(10).fill(0);this.m=this.D=this.L=0;this.g=[0,0]}h(){this.once=!0;J.clear();K.g=!1;L.clear();N.clear();z.clear();P.clear();Q.clear();B.clear()}message({data:a}){F.set(new Uint8Array(a));if(0==F.h)Oa(this);else{var b=R()-1;a=!1;b!=B.id&&(B.id=b,a=!0);b=R();var c=b&1;c&&!B.h?(B.h=!0,C.j.style.display="none",Ja(),C.F.style.display="block"):!c&&B.h&&(B.h=!1,D(),C.G(),C.F.style.display="none",Q.o=!1);(c=b&2)&&!B.g?(B.g=!0,C.j.style.display=
"none"):!c&&B.g&&(B.g=!1,D(),Q.o=!1);C.u.disabled=b&4;this.g[0]=this.g[1];this.g[1]=performance.now();b=L;c=b.h;for(var g=0;c;++g)void 0!=b.g[g]&&(b.g[g].x1=b.g[g].x2,b.g[g].y1=b.g[g].y2,b.g[g].r1=b.g[g].r2,--c);b=N;c=b.h;for(g=0;c;++g)void 0!=b.g[g]&&(b.g[g].x1=b.g[g].x2,b.g[g].y1=b.g[g].y2,b.g[g].r1=b.g[g].r2,--c);Qa(K);for(b=!1;F.m<F.h;)switch(R()){case 0:b=!0;N.clear();c=P;c.j=R();g=R();var d=R(),e=R();c.i=Array(R());for(var l=0;l<c.i.length;++l)c.i[l]=[(R()+.5)*e,(R()+.5)*e,R()];var G=l=0;for(var H=
0;H<g;++H){var E=0;for(var O=0;O<d;++O){var M=F.g[F.m];2!=M&&(w.setInt16(l,G,!0),l+=2,w.setInt16(l,E,!0),l+=2,w.setUint8(l++,e),w.setUint8(l++,ra[M]>>16),w.setUint8(l++,ra[M]>>8),w.setUint8(l++,ra[M]));++F.m;E+=e}G+=e}c.h.set(ua.slice(0,l),l>>3);c.width=g*e;c.height=d*e;c.g=e;break;case 1:c=L;g=R();for(d=0;d<g;++d)if(e=R(),void 0==c.g[e]){l=S();G=S();H=S();E=R();E=Ra(E);O=R();M=0;O&&(M=R());const T=R();0<T&&U(J,E,Ra(T));c.g[e]={x:0,y:0,r:0,x1:l,x2:l,y1:G,y2:G,r1:H,r2:H,name:E,O,R:M,T:0,S:!0};B.id==
e&&(e=K,e.g||(e.x2=l,e.y2=G));++c.h}else if(l=R(),0==l)delete c.g[e]&&--c.h;else{do{switch(l){case 1:c.g[e].x2=S();B.id==e&&(l=K,l.g||(l.x2=c.g[e].x2));break;case 2:c.g[e].y2=S();B.id==e&&(l=K,l.g||(l.y2=c.g[e].y2));break;case 3:c.g[e].r2=S();break;case 4:c.g[e].O=R();c.g[e].O&&(c.g[e].R=R());break;case 5:l=R();U(J,c.g[e].name,Ra(l));break;default:throw Error();}l=R()}while(l)}break;case 2:c=N;g=Sa();for(d=0;d<g;++d)if(e=Sa(),void 0==c.g[e])l=R()-1,G=S(),H=S(),E=S(),c.g[e]={type:l,x:0,y:0,r:0,x1:G,
x2:G,y1:H,y2:H,r1:E,r2:E,S:!1},++c.h;else if(l=R(),0==l)delete c.g[e]&&--c.h;else{do{switch(l){case 1:c.g[e].x2=S();break;case 2:c.g[e].y2=S();break;case 3:c.g[e].r2=S();break;default:throw Error();}l=R()}while(l)}break;case 3:c=J;g=R();for(d=0;d<g;++d)l=R(),e=(new TextDecoder).decode(F.g.subarray(F.m,F.m+l)),F.m+=l,l=R(),U(c,e,(new TextDecoder).decode(F.g.subarray(F.m,F.m+l))),F.m+=l;break;default:throw Error();}if(F.m>F.h)throw Error();if(-1==B.id)a=K,b=.5*P.height,a.g||(a.x2=.5*P.width,a.y2=b),
Qa(a);else if(a||b)a=K,c=L.g[B.id].y2,a.g||(a.x2=L.g[B.id].x2,a.y2=c),b&&Qa(K);0==this.g[0]||this.i||(this.i=!0,a=z,a.o=window.requestAnimationFrame(a.F.bind(a)),B.l())}}close(a){4E3==a?(Ta(),u.innerHTML="Server is full"):Ta()}j(){this.L=(new Date).getTime();this.A.send(new Uint8Array(0))}stop(){this.A.onopen=this.A.onmessage=this.A.onclose=null;this.A.close()}}
function Ua(a){a.A=new WebSocket(a.l);a.A.binaryType="arraybuffer";a.A.onopen=a.h.bind(a);a.A.onmessage=a.message.bind(a);a.A.onclose=a.close.bind(a)}class Fa extends Pa{constructor(a,b,c=8){super();this.K=0;this.o=c;this.u=b;this.l=a;Ua(this)}h(){this.j()}message(){Oa(this);++this.K==this.o&&this.u(this.A.url)}close(){Ua(this)}}function Ma(a){var b=F;b.g[0]=4;b.g[1]=a;b.h=2}function Na(){var a=F;0==ha.length?a.h=1:(a.g.set(ha),a.h=ha.length)}function R(){var a=F;return a.g[a.m++]}
function Sa(){var a=F;const b=a.g[a.m]|a.g[a.m+1]<<8;a.m+=2;return b}function S(){var a=F;const b=a.view.getFloat32(a.m,!0);a.m+=4;return b}function Ra(a){var b=F;const c=(new TextDecoder).decode(b.g.subarray(b.m,b.m+a));b.m+=a;return c}function La(a){if(!B.i){B.i=!0;a.g[0]=3;var b=C;b=(new TextEncoder).encode(b.name.value);a.g.set(b,1);a.h=b.length+1;I(A)}}
class Va{constructor(){this.i=new ArrayBuffer(1048576);this.g=new Uint8Array(this.i);this.view=new DataView(this.i);this.m=this.h=0}set(a){this.g.set(a);this.h=a.length;this.m=0}clear(){this.m=this.h=0}}
class Wa{constructor(){this.canvas=t("canvas");this.g=this.canvas.getContext("2d");this.size=0;this.h()}h(){this.size=q.death_arrow_size.value;this.canvas.width=this.canvas.height=this.size;const a=.5*this.canvas.width,b=this.canvas.width;this.g.beginPath();this.g.moveTo(a+.45*b,a);this.g.lineTo(a-.225*b,a-.675*b/Math.sqrt(3));this.g.lineTo(a-.225*b,a+.675*b/Math.sqrt(3));this.g.closePath();this.g.fillStyle="#bbbbbbb0";this.g.fill();this.g.lineWidth=.1*a;this.g.strokeStyle="#f00";this.g.stroke()}}
function Xa(a){void 0==h("tth_tooltip")&&(a.J.innerHTML='Try "/help"',a.C.style.display="inline-block")}function U(a,b,c,g=!1){const d=t("p");d.appendChild(document.createTextNode((g?"":b+": ")+c));a.h.insertBefore(d,a.h.firstChild);++a.i>q.max_chat_messages.value&&a.h.removeChild(a.h.lastChild)}function Ya(a){a.g.value="";a.g.blur();z.canvas.focus()}function Za(a,b){a.v=a.g.placeholder;a.g.placeholder=b;a.g.disabled=!0;a.g.value="";z.canvas.focus()}
function $a(){var a=J;!a.u&&q.chat_on&&(a.B.style.display="block")}
class ab{constructor(){this.o=Array(5).fill(0);this.j=0;this.B=r("ID_chat");this.h=r("ID_messages");this.g=r("ID_sendmsg");this.C=r("ID_try_typing_help");this.J=r("ID_try_typing_help_tooltip");Xa(this);this.H=ka(128);this.i=0;this.u=!1;this.v="";this.l=-1;this.g.onkeydown=function(a){a.stopPropagation();if("Enter"==a.code){a=this.g.value.trim();switch(a){case "/help":U(this,null,">",!0);U(this,null,"Available commands:",!0);U(this,null,"/clear /c => clear the chat",!0);U(this,null,"/respawn /r => tp to the first area",
!0);U(this,null,"/die /d => become downed",!0);U(this,null,"/menu /m => quit the game and open the menu",!0);U(this,null,"/spectate /s => start/stop spectating",!0);U(this,null,">",!0);Ya(this);k("tth_tooltip","");this.C.style.display="none";return;case "/c":case "/clear":this.h.innerHTML="";this.i=0;Ya(this);return}a=(new TextEncoder).encode(a);if(0<a.length){var b=F;La(b);b.g[0]=2;b.g.set(a,1);b.h=a.length+1;I(A);this.o[this.j]=(new Date).getTime();a=(this.j+1)%5;b=5E3-this.o[this.j]+this.o[a];
this.j=a;0<b?(Za(this,"You are on cooldown for sending too many messages too quickly"),this.l=setTimeout(this.enable.bind(this),b)):Ya(this)}}}.bind(this);this.g.onkeyup=function(a){a.stopPropagation()};this.g.onkeypress=this.g.onpaste=this.H}clear(){this.o=Array(5).fill(0);this.j=0;this.h.innerHTML="";this.i=0;this.u=!1;this.v="Press enter to chat";this.enable()}enable(){-1!=this.l&&(clearTimeout(this.l),this.l=-1);this.g.disabled=!1;this.g.placeholder=this.v}focus(){this.g.focus()}F(){for(;this.i>
q.max_chat_messages.value;)this.h.removeChild(this.h.lastChild),--this.i}G(){this.h.style["font-size"]=q.chat_text_scale.value+"em"}}function Qa(a){a.x1=a.x2;a.y1=a.y2}function V(a,b,c){var g=K;g.x2=v(g.x2,a,c);g.y2=v(g.y2,b,c)}class bb{constructor(){this.y2=this.x2=this.y1=this.x1=this.y=this.x=0;this.g=!1}block(){this.g=!0}}class cb{constructor(){this.g=Array(100);this.h=0}clear(){this.g=Array(100);this.h=0}}
class db{constructor(){this.g=Array(65535);this.h=0}clear(){this.g=Array(65535);this.h=0}}function eb(){var a=fb;a.g=!0;return new Promise(function(b){a.h=function(c){a.g=!1;b(c)}})}class gb{constructor(){this.h=null;this.g=!1}}class hb{constructor(){this.i=this.g=0;this.h=null}progress(){0==this.g?q.show_tutorial&&B.g&&(this.g=1,this.i=z.i,z.i=1.75,K.block(),ib(),Q.stop(),Q.block()):7==++this.g&&(this.h.click(),this.g=0,z.i=this.i,K.g=!1,W.g=!1,Q.g=!1,Q.start())}}
function ib(){var a=W;a.i&&(a.g=!1,jb(a));a.g=!0}
function kb(a){a.l.innerHTML="";X(a,"CHAT");a.add(a.text("Show chat"),lb("chat_on",function(b){b?$a():(b=J,b.u||(b.B.style.display="none"))}));a.add(a.text("Max number of chat messages"),mb(a,"max_chat_messages","",J.F.bind(J)));a.add(a.text("Chat text scale"),mb(a,"chat_text_scale","",J.G.bind(J)));X(a,"MENU");a.add(a.text("Show latency"),lb("show_ping",C.M.bind(C)));X(a,"GAME");nb.h=lb("show_tutorial");a.add(a.text("Enable tutorial"),nb.h);X(a,"VISUALS");a.add(a.text("Default FOV"),mb(a,"fov"));
a.add(a.text("Stroke radius percentage"),mb(a,"stroke_thickness","%"));a.add(a.text("Draw players' name"),lb("draw_player_name"));a.add(a.text("Draw an arrow towards dead players"),lb("draw_death_arrow"));a.add(a.text("Death arrow size"),mb(a,"death_arrow_size","px",ob.h.bind(ob)));X(a,"KEYBINDS");pb(a,qb("h5","To change, click a button on the right side and then press the key you want to assign to it."));a.add(a.text("Settings"),Y("settings"));a.add(a.text("Move up"),Y("up"));a.add(a.text("Move left"),
Y("left"));a.add(a.text("Move down"),Y("down"));a.add(a.text("Move right"),Y("right"));a.add(a.text("Move slowly"),Y("slowwalk"));a.add(a.text("Spectate the previous player"),Y("spec_prev",C.l.bind(C)));a.add(a.text("Spectate the next player"),Y("spec_next",C.l.bind(C)));X(a,"RESET");a.add(a.text("Reset settings"),a.button("RESET",function(){q=JSON.parse(JSON.stringify(p));ea();kb(this)}.bind(a)));a.add(a.text("Reset keybinds"),a.button("RESET",function(){n=JSON.parse(JSON.stringify(m));ca();kb(this)}.bind(a)));
a.add(a.text("Reset all tooltips"),a.button("RESET",function(){aa("psfy_tooltip");Ha(C);aa("tth_tooltip");Xa(J)}));a.end()}function jb(a){a.g||(a.i=!1,a.j.style.display="none",Q.g=!1,Q.start())}function pb(a,b){a.l.appendChild(b)}function X(a,b){a.end();pb(a,qb("h1",b));a.h=t("table")}function qb(a,b){a=t(a);a.innerHTML=b;return a}
function lb(a,b=function(){}){const c=t("button");q[a]=!q[a];let g=!0;c.onclick=function(){q[a]=!q[a];1==q[a]?(c.innerHTML="ON",c.style["background-color"]="#23c552"):(c.innerHTML="OFF",c.style["background-color"]="#f84f31");ea();g?g=!1:b(q[a])};c.onclick();return c}function Y(a,b=function(){}){const c=t("button");c.innerHTML=n[a];c.onclick=async function(){c.innerHTML="...";const g=await eb();c.innerHTML=g;n[a]=g;ca();b()};c.style.color="#000";return c}
function mb(a,b,c="",g=function(){}){const d=t("div");d.className="input";const e=t("input");e.type="range";e.min=q[b].min;e.max=q[b].max;e.step=q[b].step;e.value=q[b].value;e.oninput=function(){e.nextElementSibling.innerHTML=e.value+c;q[b].value=e.valueAsNumber;g()};e.onchange=ea;d.appendChild(e);d.appendChild(a.text(e.value+c));return d}
class rb{constructor(){this.j=r("ID_settings_container");this.l=r("ID_settings");this.g=this.i=!1;this.h=null;kb(this)}add(a,b){const c=t("tr");let g=t("td");g.appendChild(a);c.appendChild(g);g=t("td");g.appendChild(b);b.onchange=ea;c.appendChild(g);this.h.appendChild(c)}end(){null!=this.h&&(pb(this,this.h),this.h=null)}text(a){return qb("h3",a)}button(a,b){const c=t("button");c.innerHTML=a;c.onclick=b;return c}}
class sb{constructor(){this.canvas=t("canvas");this.canvas.getContext("2d");this.u=xa("ID_canvas");this.j=r("ID_text");this.g=this.j.getContext("2d");this.v=new Ca(this.u);this.height=this.width=0;this.i=this.h=q.fov.value;this.o=-1;this.C=!1;this.B=this.l=0;this.j.onwheel=this.H.bind(this);this.j.onmousedown=this.G.bind(this)}clear(){this.i=this.h=q.fov.value;cancelAnimationFrame(this.o);this.o=-1;this.C=!1;this.B=this.l=0}stop(){this.C=!0;this.canvas.parentElement.removeChild(this.canvas)}H(a){a=
.05*-Math.sign(a.deltaY);this.i=1<this.i?this.i+3*a:this.i+a;this.i=Math.min(Math.max(this.i,q.fov.min),q.fov.max)}G(){Q.o=!Q.o;Z(Q)}text(a,b,c){this.g.font="700 20px Ubuntu";this.g.textAlign="center";this.g.textBaseline="middle";this.g.fillStyle="#fff";this.g.strokeStyle="#333";this.g.lineWidth=1;this.g.fillText(a,b,c);this.g.strokeText(a,b,c)}F(a){if(!this.C){this.l=Math.min(Math.max(this.l,A.g[0]),A.g[1]);var b=this.h;this.h=v(this.h,this.i,.1);this.h!=b&&Z(Q);b=A.g[0]==A.g[1]?1:(this.l-A.g[0])/
(A.g[1]-A.g[0]);this.l+=a-this.B;this.B=a;q.show_ping&&(C.v.innerHTML=A.D.toFixed(1)+"ms");K.x=v(K.x1,K.x2,b);K.y=v(K.y1,K.y2,b);a=this.u;if(a.canvas.width!=x.width||a.canvas.height!=x.height)a.canvas.width=x.width,a.canvas.height=x.height;a.viewport(0,0,a.canvas.width,a.canvas.height);a.clearColor(.2,.2,.2,1);a.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT);a.enable(y.DEPTH_TEST);a.enable(y.BLEND);a.blendFunc(y.SRC_ALPHA,y.ONE_MINUS_SRC_ALPHA);a=P;a.h.matrix=new wa;var c=va(a.h.matrix,new Float32Array([1,
0,0,0,1,0,.5*x.width,.5*x.height,1]));var g=z.h;c=va(c,new Float32Array([g,0,0,0,g,0,0,0,1]));va(c,new Float32Array([1,0,0,0,1,0,-K.x,-K.y,1]));c=a.h;za(c);c.g.uniform1f(c.o,.8);c.g.bindBuffer(y.ARRAY_BUFFER,c.l);c.g.bufferData(y.ARRAY_BUFFER,c.v,y.DYNAMIC_DRAW);c.g.drawArraysInstanced(y.TRIANGLE_STRIP,0,10,c.j);c.g.uniform1f(c.o,1);c.g.bindBuffer(y.ARRAY_BUFFER,c.l);c.g.bufferData(y.ARRAY_BUFFER,c.model,y.DYNAMIC_DRAW);c.g.drawArraysInstanced(y.TRIANGLE_STRIP,0,4,c.j);if(z.j.width!=x.width||z.j.height!=
x.height)z.j.width=x.width,z.j.height=x.height;c=new DOMMatrix;z.g.setTransform(c);z.g.clearRect(0,0,x.width,x.height);c=c.translate(.5*x.width,.5*x.height).scale(z.h,z.h).translate(-K.x,-K.y);z.g.setTransform(c);z.g.font=`700 ${a.g/1.75|0}px Ubuntu`;z.g.textAlign="center";z.g.textBaseline="middle";c=z.g;g=sa[3];g="#"+(.8*parseInt(g.substring(1,3),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(g.substring(3,5),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(g.substring(5,7),16)>>0).toString(16).padStart(2,
"0")+g.substring(7);c.fillStyle=g;for(var d of a.i)z.g.fillText(d[2],d[0],d[1]);d=0;a=L.h;for(c=0;a;++c)void 0!=L.g[c]&&(L.g[c].x=v(L.g[c].x1,L.g[c].x2,b),w.setFloat32(d,L.g[c].x,!0),d+=4,L.g[c].y=v(L.g[c].y1,L.g[c].y2,b),w.setFloat32(d,L.g[c].y,!0),d+=4,L.g[c].r=v(L.g[c].r1,L.g[c].r2,b),w.setFloat32(d,L.g[c].r,!0),d+=4,w.setUint32(d,ta[0]),d+=4,--a);a=N.h;for(c=0;a;++c)void 0!=N.g[c]&&(N.g[c].x=v(N.g[c].x1,N.g[c].x2,b),w.setFloat32(d,N.g[c].x,!0),d+=4,N.g[c].y=v(N.g[c].y1,N.g[c].y2,b),w.setFloat32(d,
N.g[c].y,!0),d+=4,N.g[c].r=v(N.g[c].r1,N.g[c].r2,b),w.setFloat32(d,N.g[c].r,!0),d+=4,w.setUint32(d,ta[N.g[c].type]),d+=4,--a);this.v.set(ua.slice(0,d),d>>4);this.v.matrix=P.h.matrix;d=this.v;a=this.h;c=q.stroke_thickness.value/200;za(d);d.g.uniform1f(d.v,c);d.g.uniform1f(d.o,a);d.g.drawArraysInstanced(y.TRIANGLE_STRIP,0,4,d.j);switch(nb.g){case 0:q.show_tutorial&&0==P.j&&z.text("Need help? Press KeyT for a tutorial.",.5*P.width,2.5*P.g);break;case 1:V(L.g[B.id].x2,L.g[B.id].y2,.2*b);z.text("<-- Your character",
K.x+110,K.y);z.text("Your character --\x3e",K.x-110,K.y);z.text("This is your character. You can control it with these keys:",K.x,K.y-220);z.text(`${n.up}: up`,K.x,K.y-170);z.text(`${n.left}: left`,K.x,K.y-130);z.text(`${n.down}: down`,K.x,K.y-90);z.text(`${n.right}: right`,K.x,K.y-50);z.text("You can also control it with mouse. Just",K.x,K.y+50);z.text("press any mouse button to start or stop moving.",K.x,K.y+70);z.text("Scroll to change your field of view.",K.x,K.y+110);z.text("Note that you won't be able to perform some",
K.x,K.y+150);z.text("of the above actions until the tutorial ends.",K.x,K.y+170);z.text("Press KeyT to continue",K.x,K.y+220);break;case 2:var e=.5*P.width-6*P.g;d=.5*P.height;V(e,d,.2*b);z.text("--\x3e",e+2*P.g,d-1*P.g);z.text("--\x3e",e+2*P.g,d);z.text("--\x3e",e+2*P.g,d+1*P.g);z.text("<--",e-2*P.g,d-2*P.g);z.text("<--",e-3*P.g,d-1*P.g);z.text("<--",e-4*P.g,d);z.text("<--",e-3*P.g,d+1*P.g);z.text("<--",e-2*P.g,d+2*P.g);z.text("These are safezones. Enemies can't",e,d-130);z.text("reach you inside of these tiles.",
e,d-110);z.text("Press KeyT to continue",e,d+110);break;case 3:e=.5*P.width+6*P.g;d=.5*P.height;V(e,d,.2*b);z.text("<--",e-2*P.g,d-2*P.g);z.text("<--",e-1*P.g,d-3*P.g);z.text("<--",e,d-4*P.g);z.text("<--",e-2*P.g,d+2*P.g);z.text("<--",e-1*P.g,d+3*P.g);z.text("<--",e,d+4*P.g);z.text("--\x3e",e+2*P.g,d-3*P.g);z.text("--\x3e",e+2*P.g,d+3*P.g);z.text("<--",e+5*P.g,d-2*P.g);z.text("<--",e+6*P.g,d-1*P.g);z.text("<--",e+7*P.g,d);z.text("<--",e+6*P.g,d+1*P.g);z.text("<--",e+5*P.g,d+2*P.g);z.text("These are walls. Players can't walk over them.",
e,d-40);z.text("However, some types (colors) of enemies can.",e,d-10);z.text("Press KeyT to continue",e,d+40);break;case 4:e=.5*P.g;d=.5*P.height;V(e,d,.2*b);z.text("--\x3e",e,d);z.text("This is a teleport tile. If you walk on it,",e,d-130);z.text("you will be teleported to the area it points to.",e,d-110);z.text("Minimap is not yet implemented, but once it is, you",e,d-70);z.text("will be able to see where any area is located at.",e,d-50);z.text("If a teleport doesn't have a number on it, it doesn't point",
e,d+50);z.text("anywhere (perhaps because the next area is under construction).",e,d+70);z.text("Press KeyT to continue",e,d+120);break;case 5:for(d=0;65535>d;++d)if(N.g[d]){e=N.g[d];break}d=e.x2;e=e.y2;V(d,e,.2*b);z.text("Enemy ball --\x3e",d-110,e);z.text("<-- Enemy ball",d+110,e);z.text("This is an enemy, also simply called a ball. A grey ball",d,e-110);z.text("doesn't do a lot - it simply moves in one direction. However,",d,e-90);z.text("as you are about to find out when you start exploring the game,",
d,e-70);z.text("there are lots of types of enemies, each having their own color.",d,e-50);z.text("Coming in contact with an enemy downs you. While downed, you can't move,",d,e+50);z.text("and after a while, you die, unless other players revive you by touching you.",d,e+70);z.text("Press KeyT to continue",d,e+120);break;case 6:e=L.g[B.id].x2,d=L.g[B.id].y2,V(e,d,.2*b),z.text(`You can press ${n.settings} to open settings.`,e,d-80),z.text("There are a lot of cool options to change. Try it out later.",
e,d-60),z.text("That's it for this tutorial. See how far you can go!",e,d+60),z.text("GLHF!",e,d+80),z.text("Press KeyT to end the tutorial",e,d+130)}this.o=window.requestAnimationFrame(this.F.bind(this))}}}class tb{constructor(){this.h=new Ba;this.g=this.height=this.width=0;this.i=[];this.j=-1}clear(){this.j=-1}}
class ub{constructor(){this.height=this.width=this.h=this.i=this.g=0;this.j=[0,0];window.onresize=this.l.bind(this);window.onkeyup=this.v.bind(this);window.onkeydown=this.u.bind(this);window.onmousemove=this.B.bind(this);window.onbeforeunload=this.o.bind(this)}l(){if(window.devicePixelRatio!=this.g||window.innerWidth!=this.i||window.innerHeight!=this.h){this.g=window.devicePixelRatio;this.i=window.innerWidth;this.h=window.innerHeight;this.width=this.i*this.g;this.height=this.h*this.g;var a=z;a.width=
x.width;a.height=x.height;a.canvas.width=a.width;a.canvas.height=a.height}}u(a){if(!a.repeat)if(fb.g)a.preventDefault(),fb.h(a.code);else if(a.code==n.settings)W.i?jb(W):(a=W,a.g||(a.i=!0,a.j.style.display="block",Q.stop(),Q.block()));else{if(B.h)switch(a.code){case n.spec_prev:Ma(-1);I(A);break;case n.spec_next:Ma(1),I(A)}switch(a.code){case "Enter":J.focus(a);break;case n.up:Q.v||(Q.v=1,Z(Q));break;case n.down:Q.l||(Q.l=1,Z(Q));break;case n.left:Q.i||(Q.i=1,Z(Q));break;case n.right:Q.j||(Q.j=1,
Z(Q));break;case n.slowwalk:1==Q.u&&(vb(.5),Z(Q));break;case "KeyT":nb.progress()}}}v(a){if(!a.repeat)switch(a.code){case n.up:Q.v&&(Q.v=0,Z(Q));break;case n.down:Q.l&&(Q.l=0,Z(Q));break;case n.left:Q.i&&(Q.i=0,Z(Q));break;case n.right:Q.j&&(Q.j=0,Z(Q));break;case n.slowwalk:.5==Q.u&&(vb(1),Z(Q))}}B(a){this.j=[a.clientX*this.g,a.clientY*this.g];Z(Q)}o(a){if(B.g)return a.preventDefault(),a.returnValue="Are you sure you want to quit?"}}
function Z(a){if(B.g&&!a.g){a=F;let c=0;var b=0;if(Q.o){b=x.j[0]-.5*z.canvas.width;const g=x.j[1]-.5*z.canvas.height;c=Math.atan2(g,b);b=Math.hypot(b,g)/z.h}else if(Q.v!=Q.l||Q.i!=Q.j)c=Math.atan2(Q.l-Q.v,Q.j-Q.i),b=160*x.g;a.g[0]=1;a.view.setFloat32(1,c,!0);a.g[5]=b>=160*x.g?255*Q.h:1.59375*b/x.g*Q.h;a.h=6;I(A)}}function vb(a){var b=Q;b.g||(b.h=a);b.u=a}
class wb{constructor(){this.o=!1;this.h=this.u=1;this.g=!1;this.j=this.i=this.l=this.v=0}clear(){this.o=this.g=!1;this.h=this.u=1}block(){this.g=!0}stop(){this.g||(this.u=this.h,this.h=0,Z(this))}start(){this.g||(this.h=this.u,Z(this))}}function Ea(){var a=B;u.innerHTML="Connecting";a.j?(D(),C.name.style.display="none",$a(),Za(J,"Waiting for connection..."),ib()):a.j=!0}
function Ta(){B.g=!1;u.innerHTML="Disconnected";D();var a=C;A.once||ia();a.name.style.display="none";a.B.style.display="none";a.u.style.display="none";a.C.style.display="block";clearInterval(a.H);ib()}class xb{constructor(){this.i=this.h=this.g=!1;this.id=-1;this.j=!1}clear(){this.i=this.h=this.g=!1;this.id=-1}l(){D();C.name.style.display="block";u.innerHTML="";$a();J.enable();W.g=!1}}
const C=new Ka,A=new Pa,F=new Va,ob=new Wa,J=new ab,K=new bb,L=new cb,N=new db,fb=new gb,nb=new hb,W=new rb,z=new sb,P=new tb,x=new ub,Q=new wb,B=new xb;x.l();
(async function(){Ea();let a;var b=new Promise(function(d){a=d});const c=[];for(const [,,d]of C.o)c[c.length]=new Fa(d,a);setTimeout(a,2E3,"");b=await b;let g;if(0==b.length){b=0;for(const d of c)d.A.readyState==WebSocket.OPEN&&d.K>b&&(b=d.K,g=d.A.url)}else g=b;if(void 0==g)throw u.innerHTML="Couldn't connect to any server",ia(),Error(u.innerHTML);for(const d of c)d.A.url!=g?d.stop():Ga(d);Ia()})();
