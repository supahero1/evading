const d=window.localStorage,k=d.getItem.bind(d),l=d.setItem.bind(d),aa=d.removeItem.bind(d),m=Math.sin,n=Math.cos,p=Math.max,ba=Math.min,ca=Math.abs,da=k("keybinds"),ea={settings:"Escape",up:"KeyW",left:"KeyA",right:"KeyD",down:"KeyS",slowwalk:"ShiftLeft",spec_prev:"KeyA",spec_next:"KeyD"};let t=null!=da?JSON.parse(da):ea;for(const a in ea)a in t||(t[a]=ea[a]);for(const a in t)a in ea||delete t[a];function fa(){l("keybinds",JSON.stringify(t))}
const ha=k("settings"),v={fov:{min:.25,max:4,value:1.75,step:.05},chat_on:!0,max_chat_messages:{min:1,max:1E3,value:100,step:1},chat_text_scale:{min:1,max:2,value:1,step:.05},draw_ball_fill:!0,draw_ball_stroke:!0,draw_ball_stroke_bright:!0,ball_stroke:{min:0,max:100,value:20,step:1},draw_player_fill:!0,draw_player_stroke:!0,draw_player_stroke_bright:!0,player_stroke:{min:0,max:100,value:10,step:1},draw_player_name:!0,draw_death_arrow:!0,death_arrow_size:{min:10,max:100,value:40,step:1},show_tutorial:!0,
show_ping:!1,slowwalk_speed:{min:0,max:100,value:50,step:1}};let w=null!=ha?JSON.parse(ha):JSON.parse(JSON.stringify(v));for(const a in v)a in w||(w[a]=v[a]);for(const a in w)a in v?(w[a].min&&w[a].min!=v[a].min&&(w[a].min=v[a].min),w[a].max&&w[a].max!=v[a].max&&(w[a].max=v[a].max),w[a].step&&w[a].step!=v[a].step&&(w[a].step=v[a].step),w[a].value=p(ba(w[a].value,w[a].max),w[a].min)):delete w[a];function ia(){l("settings",JSON.stringify(w))}
const x=document.getElementById.bind(document),y=document.createElement.bind(document),z=x("ID_status"),ja=k("token");let ka=[];"string"==typeof ja&&(ka=ja.split(",").map(a=>+a));function la(){setTimeout(location.reload.bind(location),1E3)}function ma(a){const b=a.match(/\/\/(.*?)\.shadam\.xyz/),c=a.match(/\/\/(.*?)[\/:]/);return b?b[1]:c?c[1]:a}WebSocket.prototype.send=new Proxy(WebSocket.prototype.send,{apply:function(a,b,c){if(b.readyState==WebSocket.OPEN)return a.apply(b,c)},configurable:!0,enumerable:!0});
WebSocket.prototype.close=new Proxy(WebSocket.prototype.close,{apply:function(a,b,c){if(b.readyState==WebSocket.CONNECTING||b.readyState==WebSocket.OPEN)return a.apply(b,c)},configurable:!0,enumerable:!0});
function na(a){return function(b){const c=b instanceof ClipboardEvent;if(!c||"paste"==b.type){var e=b.target.value+(c?b.clipboardData.getData("text"):b.key);if((new TextEncoder).encode(e).byteLength-b.target.selectionEnd+b.target.selectionStart>a){if(""==b.target.value&&c){const g=b.target.placeholder;b.target.placeholder="Text too long to paste!";setTimeout(function(){b.target.placeholder=g},1E3)}b.preventDefault()}}}}function A(a,b,c){return a+(b-a)*c}
if(0==window.s.length)throw z.innerHTML="No servers found",la(),Error(z.innerHTML);z.innerHTML="Connecting";const oa=new Uint32Array([14540253,11184810,3355443,16703352]),pa=Array.from(oa).map(a=>"#"+a.toString(16)),qa=new Uint32Array([2155905279,4232489727,8421631,4287497983,1021313023,1715110655]);Array.from(qa).map(a=>"#"+a.toString(16));const ra=new ArrayBuffer(1048560),C=new DataView(ra);
function sa(a,b){const c=a[0],e=a[1],g=a[2],f=a[3],h=a[4],q=a[5],u=a[6],r=a[7],B=a[8],I=b[0],P=b[1],ua=b[2],va=b[3],wa=b[4],xa=b[5],ya=b[6],za=b[7];b=b[8];a[0]=I*c+P*f+ua*u;a[1]=I*e+P*h+ua*r;a[2]=I*g+P*q+ua*B;a[3]=va*c+wa*f+xa*u;a[4]=va*e+wa*h+xa*r;a[5]=va*g+wa*q+xa*B;a[6]=ya*c+za*f+b*u;a[7]=ya*e+za*h+b*r;a[8]=ya*g+za*q+b*B;return a}function ta(a,b,c){return sa(a,new Float32Array([1,0,0,0,1,0,b,c,1]))}function Aa(a,b){const c=n(b);b=m(b);return sa(a,new Float32Array([c,-b,0,b,c,0,0,0,1]))}
class Ba extends Float32Array{constructor(){super([2/D.width,0,0,0,-2/D.height,0,-1,1,1])}}const E=WebGL2RenderingContext.prototype;function Ca(a){a=(a?x(a):y("canvas")).getContext("webgl2",{premultipliedAlpha:!1,failIfMajorPerformanceCaveat:!1});if(!a)throw z.innerHTML="Your browser/device does not support WebGL2.",Error("Your browser/device does not support WebGL2.");return a}
function Da(a,b,c){b=a.h.createShader(b);a.h.shaderSource(b,c);a.h.compileShader(b);if(a.h.getShaderParameter(b,E.COMPILE_STATUS))return b;throw Error(a.h.getShaderInfoLog(b));}function Ea(a){a.h.uniformMatrix3fv(a.C,!1,a.matrix)}function Fa(a){a.h.useProgram(a.l);a.h.bindVertexArray(a.v);Ea(a)}
class Ga{constructor(a,b,c){a instanceof WebGL2RenderingContext?this.h=a:this.h=Ca(a);a="#version 300 es\nprecision mediump float;\nout vec4 fragColor;\n"+c;c=this.h.createProgram();this.h.attachShader(c,Da(this,E.VERTEX_SHADER,"#version 300 es\n"+b));this.h.attachShader(c,Da(this,E.FRAGMENT_SHADER,a));this.h.linkProgram(c);if(this.h.getProgramParameter(c,E.LINK_STATUS))b=c;else throw Error(this.h.getProgramInfoLog(c));this.l=b;this.v=this.h.createVertexArray();this.h.bindVertexArray(this.v);this.g=
null;this.C=this.h.getUniformLocation(this.l,"u_matrix");this.matrix=null;this.i=0}set(a,b){this.h.bindBuffer(E.ARRAY_BUFFER,this.g);this.h.bufferData(E.ARRAY_BUFFER,a,E.DYNAMIC_DRAW);this.i=b}}
class Ha extends Ga{constructor(){super(F.h,"\n      layout(location = 0) in vec2 a_position;\n      layout(location = 1) in vec2 a_offset;\n      layout(location = 2) in float a_scale;\n      layout(location = 3) in vec3 a_color;\n\n      uniform mat3 u_matrix;\n\n      out vec3 v_color;\n\n      void main() {\n        gl_Position = vec4((u_matrix * vec3(a_position * a_scale + a_offset, 1)).xy, 0.5, 1.0);\n        v_color = a_color;\n      }\n      ","\n      uniform float u_light;\n\n      in vec3 v_color;\n\n      void main() {\n        fragColor = vec4(v_color.xyz * u_light, 1.0);\n      }\n    ");
this.A=new Float32Array([0,1,.0375,.9625,1,1,.9625,.9625,1,0,.9625,.0375,0,0,.0375,.0375,0,1,.0375,.9625]);this.model=new Float32Array([.0375,.0375,.9625,.0375,.0375,.9625,.9625,.9625]);this.o=this.h.getUniformLocation(this.l,"u_light");this.m=this.h.createBuffer();this.h.bindBuffer(E.ARRAY_BUFFER,this.m);this.h.vertexAttribPointer(0,2,E.FLOAT,!1,0,0);this.h.enableVertexAttribArray(0);this.g=this.h.createBuffer();this.h.bindBuffer(E.ARRAY_BUFFER,this.g);this.h.vertexAttribPointer(1,2,E.SHORT,!1,8,
0);this.h.vertexAttribPointer(2,1,E.UNSIGNED_BYTE,!1,8,4);this.h.vertexAttribPointer(3,3,E.UNSIGNED_BYTE,!0,8,5);this.h.vertexAttribDivisor(1,1);this.h.vertexAttribDivisor(2,1);this.h.vertexAttribDivisor(3,1);this.h.enableVertexAttribArray(1);this.h.enableVertexAttribArray(2);this.h.enableVertexAttribArray(3)}j(){Fa(this);this.h.uniform1f(this.o,.8);this.h.bindBuffer(E.ARRAY_BUFFER,this.m);this.h.bufferData(E.ARRAY_BUFFER,this.A,E.DYNAMIC_DRAW);this.h.drawArraysInstanced(E.TRIANGLE_STRIP,0,10,this.i);
this.h.uniform1f(this.o,1);this.h.bindBuffer(E.ARRAY_BUFFER,this.m);this.h.bufferData(E.ARRAY_BUFFER,this.model,E.DYNAMIC_DRAW);this.h.drawArraysInstanced(E.TRIANGLE_STRIP,0,4,this.i)}}
class Ia extends Ga{constructor(a){super(a,"\n      layout(location = 0) in vec2 a_position;\n      layout(location = 1) in vec2 a_offset;\n      layout(location = 2) in float a_scale;\n      layout(location = 3) in vec4 a_color;\n\n      uniform mat3 u_matrix;\n      uniform int u_precision;\n\n      flat out vec4 v_color;\n\n      void main() {\n        gl_Position = vec4((u_matrix * vec3(a_position * a_scale + a_offset, 1)).xy, -1.0 / a_scale, 1.0);\n        if(gl_VertexID < u_precision) {\n          v_color = a_color;\n        } else {\n          v_color = vec4(a_color.xyz * 0.8, a_color.w);\n        }\n      }\n      ","\n      flat in vec4 v_color;\n\n      void main() {\n        fragColor = v_color;\n      }\n    ");
this.o=this.h.getUniformLocation(this.l,"u_precision");this.m=this.h.createBuffer();this.h.bindBuffer(E.ARRAY_BUFFER,this.m);this.h.vertexAttribPointer(0,2,E.FLOAT,!1,0,0);this.h.enableVertexAttribArray(0);this.g=this.h.createBuffer();this.h.bindBuffer(E.ARRAY_BUFFER,this.g);this.h.vertexAttribPointer(1,2,E.FLOAT,!1,16,0);this.h.vertexAttribPointer(2,1,E.FLOAT,!1,16,8);this.h.vertexAttribPointer(3,4,E.UNSIGNED_BYTE,!0,16,12);this.h.vertexAttribDivisor(1,1);this.h.vertexAttribDivisor(2,1);this.h.vertexAttribDivisor(3,
1);this.h.enableVertexAttribArray(1);this.h.enableVertexAttribArray(2);this.h.enableVertexAttribArray(3)}j(a,b,c,e){if(a||b){Fa(this);b||(c=0);var g=new Float32Array(252*a+4+512*b),f=Math.PI/64,h=0;if(a){var q=m(f),u=n(f),r=1-c,B=0;g[0]=r;g[1]=B;h=2;for(let I=1;64>I;++I){let P=r*u-B*q;B=r*q+B*u;r=P;g[h++]=r;g[h++]=B;g[h++]=r;g[h++]=-B}g[h++]=-1+c;g[h++]=0}if(b){a||(b=m(-f),q=n(-f),u=-1+c,r=0,B=u*q-r*b,g[h++]=B,g[h++]=-(u*b+r*q),g[h++]=-1+c,g[h++]=0);b=Math.PI;for(q=0;127>q;++q)g[h++]=n(b),g[h++]=
m(b),b-=f,g[h++]=n(b)*(1-c),g[h++]=m(b)*(1-c);g[h++]=n(b);g[h++]=m(b);b-=f;g[h++]=n(b);g[h++]=m(b)}this.h.bindBuffer(E.ARRAY_BUFFER,this.m);this.h.bufferData(E.ARRAY_BUFFER,g,E.DYNAMIC_DRAW);this.h.uniform1i(this.o,a?128:e?258:0);this.h.drawArraysInstanced(E.TRIANGLE_STRIP,0,g.length>>1,this.i)}}}function Ja(a){Fa(a);a.h.blendFunc(E.ONE,E.ONE_MINUS_SRC_ALPHA);a.h.depthFunc(E.LEQUAL)}
class Ka extends Ga{constructor(a){super(a,"\n      layout(location = 0) in vec3 a_position;\n      layout(location = 1) in vec2 a_texcoord;\n\n      out vec2 v_texcoord;\n      \n      uniform mat3 u_matrix;\n\n      void main() {\n        gl_Position = vec4((u_matrix * vec3(a_position.xy, 1.0)).xy, a_position.z, 1.0);\n        v_texcoord = a_texcoord;\n      }\n      ","\n      in vec2 v_texcoord;\n\n      uniform sampler2D u_texture;\n\n      void main() {\n        fragColor = texture(u_texture, v_texcoord);\n      }\n    ");
this.h.pixelStorei(E.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);this.m=this.h.createBuffer();this.h.bindBuffer(E.ARRAY_BUFFER,this.m);this.h.vertexAttribPointer(0,3,E.FLOAT,!1,20,0);this.h.vertexAttribPointer(1,2,E.FLOAT,!1,20,12);this.h.enableVertexAttribArray(0);this.h.enableVertexAttribArray(1);this.canvas=y("canvas");this.canvas.getContext("2d");this.cache=Array(5);for(a=0;5>a;++a)this.cache[a]={};setInterval(function(){const b=performance.now();for(let c=0;5>c;++c)for(const e in this.cache[c]){const g=
this.cache[c][e];1E3<b-g.W&&(this.h.deleteTexture(g.F),delete this.cache[c][e])}}.bind(this),1E3)}create(a,b,c,e,g,f){b/=c;c*=e;const h="EVADING"+a;var q=this.cache[f][h];if(void 0!==q){if(.01>ca(q.size-b)&&.01>ca(q.D-c)&&.01>ca(q.precision-e)&&q.color==g)return q.W=performance.now(),q;this.h.deleteTexture(q.F);delete this.cache[f][h]}q=y("canvas");const u=q.getContext("2d");u.font=`700 ${b}px Ubuntu`;u.fillStyle=g;var r=u.measureText(a);const B=.75*(r.actualBoundingBoxLeft+r.actualBoundingBoxRight);
r=.75*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent);q.width=Math.ceil(2*B*c);q.height=Math.ceil(2*r*c);u.font=`700 ${b*c}px Ubuntu`;u.fillStyle=g;u.textAlign="center";u.textBaseline="middle";u.fillText(a,B*c,r*c);a=this.h.createTexture();this.h.bindTexture(E.TEXTURE_2D,a);this.h.texImage2D(E.TEXTURE_2D,0,E.RGBA,q.width,q.height,0,E.RGBA,E.UNSIGNED_BYTE,q);this.h.generateMipmap(E.TEXTURE_2D);this.h.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.LINEAR);this.h.texParameteri(E.TEXTURE_2D,
E.TEXTURE_MIN_FILTER,E.LINEAR_MIPMAP_LINEAR);this.h.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE);this.h.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE);b={F:a,w:B,X:r,size:b,D:c,precision:e,color:g,W:performance.now()};return this.cache[f][h]=b}j({F:a,w:b,X:c},e,g,f){this.h.bindTexture(E.TEXTURE_2D,a);this.h.bindBuffer(E.ARRAY_BUFFER,this.m);this.h.bufferData(E.ARRAY_BUFFER,new Float32Array([e-b,g-c,f,0,0,e+b,g-c,f,1,0,e-b,g+c,f,0,1,e+b,g+c,f,1,1]),E.DYNAMIC_DRAW);this.h.drawArrays(E.TRIANGLE_STRIP,
0,4)}}
function La(a){a.i.innerHTML="";for(const b of a.o){const c=y("option");c.value=b[2];b[2]==G.B.url&&(c.selected=!0,c.disabled=!0,a.g=c);b[0]>=b[1]&&(c.disabled=1);const e=ma(b[2]);c.innerHTML=e[0].toUpperCase()+e.substring(1)+` (${b[0]}/${b[1]})`;a.i.appendChild(c)}a.i.onfocus=function(){l("psfy_tooltip","");this.M.style.display="none"}.bind(a);a.i.onchange=async function(){this.g.disabled=!1;const b=this.g;this.g=this.i.selectedOptions[0];this.g.disabled=!0;Ma();let c;const e=new Promise(function(f){c=f}),
g=new Na(this.g.value,c,1);setTimeout(c,2E3);await e;0==g.N||g.B.readyState!=WebSocket.OPEN?(g.stop(),z.innerHTML="Couldn't connect, returning to previous server",this.g.disabled=!1,this.g=b,this.g.disabled=!0,setTimeout(H.o.bind(H),1E3)):Oa(g)}.bind(a);Pa(a)}function Qa(){var a=J;La(a);a.L=setInterval(function(){fetch("servers.json").then(b=>b.json()).then(function(b){J.o=b;La(J)})},5E3)}function Ra(){J.D.style.display="block"}
function Sa(){var a=J;const b=y("h5");b.id="ID_spec_help";b.innerHTML=a.U;setTimeout(function(){b.style.opacity=0},3E3);b.addEventListener("transitionend",a.K.bind(a));document.body.insertBefore(b,J.D);a.l=b}
function Pa(a){void 0==k("psfy_tooltip")&&(a.Y.innerHTML="We picked a server<br>for you automatically.<br><br>You can change it here.",a.M.style.display="table");void 0==k("tume_tooltip")&&(a.Z.innerHTML="Try out the map editor!<br><br>Submit your maps<br>in our Discord server",a.V.style.display="inline-block")}
class Ta{constructor(){this.D=x("ID_menu");this.name=x("ID_name");this.i=x("ID_select_serv");this.g=null;this.o=window.s;this.M=x("ID_picked_server_for_you");this.Y=x("ID_picked_server_for_you_tooltip");this.V=x("ID_try_map_editor");this.Z=x("ID_try_map_editor_tooltip");x("ID_map_editor_click").onclick=function(){l("tume_tooltip","");this.V.style.display="none"}.bind(this);x("ID_press_esc_to_open_settings");this.A=x("ID_ping");this.T();this.C=x("ID_play");this.v=x("ID_spec");this.l=null;this.U="";
this.m();this.J=x("ID_spectating");this.G=x("ID_refresh");var a=x("ID_spec_help");a.parentElement.removeChild(a);this.G.onclick=location.reload.bind(location);this.name.onkeypress=this.name.onpaste=na(16);this.name.onchange=function(){H.l=!1;l("name",this.value)};this.L=-1;a=k("name");"string"==typeof a&&16>=(new TextEncoder).encode(a).length&&(this.name.value=a);this.C.onclick=function(){var b=K;Ua(b);b.g[0]=0;b.i=1;L(G)};this.v.onclick=function(){Va(0);L(G)}}m(){this.U=`Press ${t.spec_prev} or ${t.spec_next} to switch between players<br><br>Type "/menu" in chat to return to the main menu`}K(){null!=
this.l&&(this.l.parentElement.removeChild(this.l),this.l=null)}T(){this.A.style.display=w.show_ping?"block":"none"}}function L(a){a.B.send(K.g.subarray(0,K.i))}
function Oa(a){var b=G;null!=b.B&&(b.stop(),b.once=!1,b.l=!1,b.g=[0,0]);b.I=a.I;b.O=a.O;b.H=a.H;b.u=a.u;b.B=a.B;b.B.onmessage=function({data:c}){try{this.message({data:c})}catch(e){console.log(e),console.log(Array.from(new Uint8Array(c)).map(g=>g.toString(16).padStart(2,"0")).join(" "))}}.bind(b);b.B.onclose=b.close.bind(b);Wa();L(b);b.i()}
function Xa(a){a.I[a.u]=(new Date).getTime()-a.O;a.H=0;let b=a.u,c=0;for(let e=0;10>e;++e)0!=a.I[b]&&(a.H+=(10-c)/11*a.I[b],++c),b=(b+1)%10;0!=c&&(a.H/=.5*c);a.u=(a.u+1)%10;setTimeout(a.m.bind(a),10)}
class Ya{constructor(){this.B=null;this.l=this.once=!1;this.I=Array(10).fill(0);this.u=this.H=this.O=0;this.g=[0,0]}i(){this.once=!0;M.clear();N.g=!1;O.clear();Q.clear();F.clear();R.clear();S.clear();H.clear()}message({data:a}){K.set(new Uint8Array(a));if(0==K.i)Xa(this);else{var b=T()-1;a=!1;b!=H.id&&(H.id=b,a=!0);b=T();var c=b&1;c&&!H.i?(H.i=!0,J.D.style.display="none",Sa(),J.J.style.display="block"):!c&&H.i&&(H.i=!1,Ra(),J.K(),J.J.style.display="none",S.v=!1);(c=b&2)&&!H.g?(H.g=!0,J.D.style.display=
"none"):!c&&H.g&&(H.g=!1,Ra(),Za.stop(),S.v=!1);J.v.disabled=b&4;this.g[0]=this.g[1];this.g[1]=performance.now();b=O;c=b.i;for(var e=0;c;++e)void 0!=b.g[e]&&(b.g[e].x1=b.g[e].x2,b.g[e].y1=b.g[e].y2,b.g[e].r1=b.g[e].r2,--c);b=Q;c=b.i;for(e=0;c;++e)void 0!=b.g[e]&&(b.g[e].x1=b.g[e].x2,b.g[e].y1=b.g[e].y2,b.g[e].r1=b.g[e].r2,--c);$a(N);for(b=!1;K.u<K.i;)switch(T()){case 0:b=!0;Q.clear();c=R;c.i=T();e=T();var g=T(),f=T();c.l=Array(T());for(var h=0;h<c.l.length;++h)c.l[h]=[(T()+.5)*f,(T()+.5)*f,T()];var q=
h=0;for(var u=0;u<e;++u){var r=0;for(var B=0;B<g;++B){var I=K.g[K.u];2!=I&&(C.setInt16(h,q,!0),h+=2,C.setInt16(h,r,!0),h+=2,C.setUint8(h++,f),C.setUint8(h++,oa[I]>>16),C.setUint8(h++,oa[I]>>8),C.setUint8(h++,oa[I]));++K.u;r+=f}q+=f}c.h.set(ra.slice(0,h),h>>3);c.width=e*f;c.height=g*f;c.g=f;break;case 1:c=O;e=T();for(g=0;g<e;++g)if(f=T(),void 0==c.g[f]){h=U();q=U();u=U();r=T();r=ab(r);B=T();I=0;B&&(I=T());const P=T();0<P&&V(M,r,ab(P));c.g[f]={x:0,y:0,r:0,x1:h,x2:h,y1:q,y2:q,r1:u,r2:u,name:r,P:B,R:I,
S:0};H.id==f&&bb(N,h,q);++c.i}else if(h=T(),0==h)delete c.g[f]&&--c.i;else{do{switch(h){case 1:c.g[f].x2=U();H.id==f&&(h=N,h.g||(h.x2=c.g[f].x2));break;case 2:c.g[f].y2=U();H.id==f&&(h=N,h.g||(h.y2=c.g[f].y2));break;case 3:c.g[f].r2=U();break;case 4:c.g[f].P=T();c.g[f].P&&(c.g[f].R=T());break;case 5:h=T();V(M,c.g[f].name,ab(h));break;default:throw Error();}h=T()}while(0<h&&16>h);128==h&&(h=c,h.g[f].x1=h.g[f].x2,h.g[f].y1=h.g[f].y2,h.g[f].r1=h.g[f].r2,c.l=!0)}break;case 2:c=Q;e=cb();for(g=0;g<e;++g)if(f=
cb(),void 0==c.g[f])h=T()-1,q=U(),u=U(),r=U(),c.g[f]={type:h,x:0,y:0,r:0,x1:q,x2:q,y1:u,y2:u,r1:r,r2:r},++c.i;else if(h=T(),0==h)delete c.g[f]&&--c.i;else{do{switch(h){case 1:c.g[f].x2=U();break;case 2:c.g[f].y2=U();break;case 3:c.g[f].r2=U();break;default:throw Error();}h=T()}while(h)}break;case 3:c=M;e=T();for(g=0;g<e;++g)h=T(),f=(new TextDecoder).decode(K.g.subarray(K.u,K.u+h)),K.u+=h,h=T(),V(c,f,(new TextDecoder).decode(K.g.subarray(K.u,K.u+h))),K.u+=h;break;default:throw Error();}if(K.u>K.i)throw Error();
if(-1==H.id)a=N,bb(a,.5*R.width,.5*R.height),$a(a);else if(a&&bb(N,O.g[H.id].x2,O.g[H.id].y2),b||O.l)a=N,bb(a,O.g[H.id].x2,O.g[H.id].y2),$a(a),O.l=!1;0==this.g[0]||this.l||(this.l=!0,a=F,a.v=window.requestAnimationFrame(a.j.bind(a)),H.o())}}close(a){4E3==a?(db(),z.innerHTML="Server is full"):db()}m(){this.O=(new Date).getTime();this.B.send(new Uint8Array(0))}stop(){this.B.onopen=this.B.onmessage=this.B.onclose=null;this.B.close()}}
function eb(a){a.B=new WebSocket(a.o);a.B.binaryType="arraybuffer";a.B.onopen=a.i.bind(a);a.B.onmessage=a.message.bind(a);a.B.onclose=a.close.bind(a)}class Na extends Ya{constructor(a,b,c=8){super();this.N=0;this.v=c;this.A=b;this.o=a;eb(this)}i(){this.m()}message(){Xa(this);++this.N==this.v&&this.A(this.B.url)}close(){eb(this)}}function Va(a){var b=K;b.g[0]=4;b.g[1]=a;b.i=2}function Wa(){var a=K;0==ka.length?a.i=1:(a.g.set(ka),a.i=ka.length)}function T(){var a=K;return a.g[a.u++]}
function cb(){var a=K;const b=a.g[a.u]|a.g[a.u+1]<<8;a.u+=2;return b}function U(){var a=K;const b=a.view.getFloat32(a.u,!0);a.u+=4;return b}function ab(a){var b=K;const c=(new TextDecoder).decode(b.g.subarray(b.u,b.u+a));b.u+=a;return c}function Ua(a){if(!H.l){H.l=!0;a.g[0]=3;var b=J;b=(new TextEncoder).encode(b.name.value);a.g.set(b,1);a.i=b.length+1;L(G)}}
class fb{constructor(){this.l=new ArrayBuffer(1048576);this.g=new Uint8Array(this.l);this.view=new DataView(this.l);this.u=this.i=0}set(a){this.g.set(a);this.i=a.length;this.u=0}clear(){this.u=this.i=0}}
class gb{constructor(){this.size=0;this.F=null}g(){null!=this.F&&F.g.h.deleteTexture(this.F.F);this.size=w.death_arrow_size.value;const a=y("canvas");a.width=a.height=Math.ceil(2*this.size);var b=.5*a.width,c=a.width;const e=a.getContext("2d");e.beginPath();e.moveTo(b+.45*c,b);e.lineTo(b-.225*c,b-.675*c/Math.sqrt(3));e.lineTo(b-.225*c,b+.675*c/Math.sqrt(3));e.closePath();e.fillStyle="#bbbbbbb0";e.fill();e.lineWidth=.1*b;e.strokeStyle="#f00";e.stroke();b=F.g;c=b.h.createTexture();b.h.bindTexture(E.TEXTURE_2D,
c);b.h.texImage2D(E.TEXTURE_2D,0,E.RGBA,a.width,a.height,0,E.RGBA,E.UNSIGNED_BYTE,a);b.h.generateMipmap(E.TEXTURE_2D);b.h.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.LINEAR);b.h.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.LINEAR_MIPMAP_LINEAR);b.h.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE);b.h.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE);this.F={F:c,w:.5*a.width/2,X:.5*a.height/2}}j(){F.g.j(this.F,0,0,-1)}}
function hb(a){void 0==k("tth_tooltip")&&(a.M.innerHTML='Try "/help"',a.G.style.display="inline-block")}function V(a,b,c,e=!1){const g=y("p");g.appendChild(document.createTextNode((e?"":b+": ")+c));a.i.insertBefore(g,a.i.firstChild);++a.l>w.max_chat_messages.value&&a.i.removeChild(a.i.lastChild)}function ib(a){a.g.value="";a.g.blur();F.h.canvas.focus()}function jb(a,b){a.C=a.g.placeholder;a.g.placeholder=b;a.g.disabled=!0;a.g.value="";F.h.canvas.focus()}
function kb(){var a=M;!a.A&&w.chat_on&&(a.D.style.display="block")}
class lb{constructor(){this.v=Array(5).fill(0);this.m=0;this.D=x("ID_chat");this.i=x("ID_messages");this.g=x("ID_sendmsg");this.G=x("ID_try_typing_help");this.M=x("ID_try_typing_help_tooltip");hb(this);this.L=na(128);this.l=0;this.A=!1;this.C="";this.o=-1;this.g.onkeydown=function(a){a.stopPropagation();if("Enter"==a.code){a=this.g.value.trim();switch(a){case "/help":V(this,null,">",!0);V(this,null,"Available commands:",!0);V(this,null,"/clear /c => clear the chat",!0);V(this,null,"/respawn /r => tp to the first area",
!0);V(this,null,"/die /d => become downed",!0);V(this,null,"/menu /m => quit the game and open the menu",!0);V(this,null,"/spectate /s => start/stop spectating",!0);V(this,null,">",!0);ib(this);l("tth_tooltip","");this.G.style.display="none";return;case "/c":case "/clear":this.i.innerHTML="";this.l=0;ib(this);return}a=(new TextEncoder).encode(a);if(0<a.length){var b=K;Ua(b);b.g[0]=2;b.g.set(a,1);b.i=a.length+1;L(G);this.v[this.m]=(new Date).getTime();a=(this.m+1)%5;b=5E3-this.v[this.m]+this.v[a];
this.m=a;0<b?(jb(this,"You are on cooldown for sending too many messages too quickly"),this.o=setTimeout(this.enable.bind(this),b)):ib(this)}}}.bind(this);this.g.onkeyup=function(a){a.stopPropagation()};this.g.onkeypress=this.g.onpaste=this.L}clear(){this.v=Array(5).fill(0);this.m=0;this.i.innerHTML="";this.l=0;this.A=!1;this.C="Press enter to chat";this.enable()}enable(){-1!=this.o&&(clearTimeout(this.o),this.o=-1);this.g.disabled=!1;this.g.placeholder=this.C}focus(){this.g.focus()}J(){for(;this.l>
w.max_chat_messages.value;)this.i.removeChild(this.i.lastChild),--this.l}K(){this.i.style["font-size"]=w.chat_text_scale.value+"em"}}function $a(a){a.x1=a.x2;a.y1=a.y2}function bb(a,b,c){a.g||(a.x2=b,a.y2=c)}class mb{constructor(){this.y2=this.x2=this.y1=this.x1=this.y=this.x=0;this.g=!1}block(){this.g=!0}}class nb{constructor(){this.g=Array(100);this.i=0;this.l=!1}clear(){this.g=Array(100);this.i=0;this.l=!1}}
class ob{constructor(){this.g=Array(65535);this.i=0}clear(){this.g=Array(65535);this.i=0}}function pb(){var a=qb;a.g=!0;return new Promise(function(b){a.i=function(c){a.g=!1;b(c)}})}class rb{constructor(){this.i=null;this.g=!1}}
function sb({$:a,aa:b}){switch(Za.g){case 0:w.show_tutorial&&0==R.i&&F.g.j(F.g.create("Need help? Press KeyT for a tutorial.",20,1,2,"#f48",3),.5*R.width,2.5*R.g,-1);break;case 1:F.g.j(F.g.create("<-- Your character",20,1,2,"#f48",3),N.x+110,N.y,-1);F.g.j(F.g.create("Your character --\x3e",20,1,2,"#f48",3),N.x-110,N.y,-1);F.g.j(F.g.create("This is your character. You can control it with these keys:",20,1,2,"#f48",3),N.x,N.y-220,-1);F.g.j(F.g.create(`${t.up}: up`,20,1,2,"#f48",3),N.x,N.y-170,-1);F.g.j(F.g.create(`${t.left}: left`,
20,1,2,"#f48",3),N.x,N.y-130,-1);F.g.j(F.g.create(`${t.down}: down`,20,1,2,"#f48",3),N.x,N.y-90,-1);F.g.j(F.g.create(`${t.right}: right`,20,1,2,"#f48",3),N.x,N.y-50,-1);F.g.j(F.g.create("You can also control it with mouse. Just",20,1,2,"#f48",3),N.x,N.y+50,-1);F.g.j(F.g.create("press any mouse button to start or stop moving.",20,1,2,"#f48",3),N.x,N.y+70,-1);F.g.j(F.g.create("Scroll to change your field of view.",20,1,2,"#f48",3),N.x,N.y+110,-1);F.g.j(F.g.create("Note that you won't be able to perform some",
20,1,2,"#f48",3),N.x,N.y+150,-1);F.g.j(F.g.create("of the above actions until the tutorial ends.",20,1,2,"#f48",3),N.x,N.y+170,-1);F.g.j(F.g.create("Press KeyT to continue",20,1,2,"#f48",3),N.x,N.y+220,-1);break;case 2:F.g.j(F.g.create("--\x3e",20,1,2,"#f48",3),a+2*R.g,b-1*R.g,-1);F.g.j(F.g.create("--\x3e",20,1,2,"#f48",3),a+2*R.g,b,-1);F.g.j(F.g.create("--\x3e",20,1,2,"#f48",3),a+2*R.g,b+1*R.g,-1);F.g.j(F.g.create("<--",20,1,2,"#f48",3),a-2*R.g,b-2*R.g,-1);F.g.j(F.g.create("<--",20,1,2,"#f48",3),
a-3*R.g,b-1*R.g,-1);F.g.j(F.g.create("<--",20,1,2,"#f48",3),a-4*R.g,b,-1);F.g.j(F.g.create("<--",20,1,2,"#f48",3),a-3*R.g,b+1*R.g,-1);F.g.j(F.g.create("<--",20,1,2,"#f48",3),a-2*R.g,b+2*R.g,-1);F.g.j(F.g.create("These are safezones. Enemies can't",20,1,2,"#f48",3),a,b-130,-1);F.g.j(F.g.create("reach you inside of these tiles.",20,1,2,"#f48",3),a,b-110,-1);F.g.j(F.g.create("Press KeyT to continue",20,1,2,"#f48",3),a,b+110,-1);break;case 3:F.g.j(F.g.create("<--",20,1,2,"#f48",3),a-2*R.g,b-2*R.g,-1);
F.g.j(F.g.create("<--",20,1,2,"#f48",3),a-1*R.g,b-3*R.g,-1);F.g.j(F.g.create("<--",20,1,2,"#f48",3),a,b-4*R.g,-1);F.g.j(F.g.create("<--",20,1,2,"#f48",3),a-2*R.g,b+2*R.g,-1);F.g.j(F.g.create("<--",20,1,2,"#f48",3),a-1*R.g,b+3*R.g,-1);F.g.j(F.g.create("<--",20,1,2,"#f48",3),a,b+4*R.g,-1);F.g.j(F.g.create("--\x3e",20,1,2,"#f48",3),a+2*R.g,b-3*R.g,-1);F.g.j(F.g.create("--\x3e",20,1,2,"#f48",3),a+2*R.g,b+3*R.g,-1);F.g.j(F.g.create("<--",20,1,2,"#f48",3),a+5*R.g,b-2*R.g,-1);F.g.j(F.g.create("<--",20,1,
2,"#f48",3),a+6*R.g,b-1*R.g,-1);F.g.j(F.g.create("<--",20,1,2,"#f48",3),a+7*R.g,b,-1);F.g.j(F.g.create("<--",20,1,2,"#f48",3),a+6*R.g,b+1*R.g,-1);F.g.j(F.g.create("<--",20,1,2,"#f48",3),a+5*R.g,b+2*R.g,-1);F.g.j(F.g.create("These are walls. Players can't walk over them.",20,1,2,"#f48",3),a,b-40,-1);F.g.j(F.g.create("However, some types (colors) of enemies can.",20,1,2,"#f48",3),a,b-10,-1);F.g.j(F.g.create("Press KeyT to continue",20,1,2,"#f48",3),a,b+40,-1);break;case 4:F.g.j(F.g.create("--\x3e",
20,1,2,"#f48",3),a,b,-1);F.g.j(F.g.create("This is a teleport tile. If you walk on it,",20,1,2,"#f48",3),a,b-130,-1);F.g.j(F.g.create("you will be teleported to the area it points to.",20,1,2,"#f48",3),a,b-110,-1);F.g.j(F.g.create("Minimap is not yet implemented, but once it is, you",20,1,2,"#f48",3),a,b-70,-1);F.g.j(F.g.create("will be able to see where any area is located at.",20,1,2,"#f48",3),a,b-50,-1);F.g.j(F.g.create("If a teleport doesn't have a number on it, it doesn't point",20,1,2,"#f48",
3),a,b+50,-1);F.g.j(F.g.create("anywhere (perhaps because the next area is under construction).",20,1,2,"#f48",3),a,b+70,-1);F.g.j(F.g.create("Press KeyT to continue",20,1,2,"#f48",3),a,b+120,-1);break;case 5:F.g.j(F.g.create("Enemy ball --\x3e",20,1,2,"#f48",3),a-110,b,-1);F.g.j(F.g.create("<-- Enemy ball",20,1,2,"#f48",3),a+110,b,-1);F.g.j(F.g.create("This is an enemy, also called a ball. A grey ball",20,1,2,"#f48",3),a,b-110,-1);F.g.j(F.g.create("doesn't do a lot - it simply moves in one direction. However,",
20,1,2,"#f48",3),a,b-90,-1);F.g.j(F.g.create("as you are about to find out when you start exploring the game,",20,1,2,"#f48",3),a,b-70,-1);F.g.j(F.g.create("there are lots of types of enemies, each having their own color.",20,1,2,"#f48",3),a,b-50,-1);F.g.j(F.g.create("Coming in contact with an enemy downs you. While downed, you can't move,",20,1,2,"#f48",3),a,b+50,-1);F.g.j(F.g.create("and after a while, you die, unless other players revive you by touching you.",20,1,2,"#f48",3),a,b+70,-1);F.g.j(F.g.create("Press KeyT to continue",
20,1,2,"#f48",3),a,b+120,-1);break;case 6:F.g.j(F.g.create(`You can press ${t.settings} to open settings.`,20,1,2,"#f48",3),a,b-80,-1),F.g.j(F.g.create("There are a lot of cool options to change. Try it out later.",20,1,2,"#f48",3),a,b-60,-1),F.g.j(F.g.create("That's it for this tutorial. See how far you can go!",20,1,2,"#f48",3),a,b+60,-1),F.g.j(F.g.create("GLHF!",20,1,2,"#f48",3),a,b+80,-1),F.g.j(F.g.create("Press KeyT to end the tutorial",20,1,2,"#f48",3),a,b+130,-1)}}
class tb{constructor(){this.m=this.g=0;this.i=null;this.l=!1}progress(){0==this.g?w.show_tutorial&&H.g&&0==R.i&&(this.g=1,this.m=F.l,jb(M,"Waiting for the tutorial to finish..."),F.l=1.75,N.block(),ub(),S.stop(),S.block()):this.l&&(this.l=!1,7==++this.g&&(this.i.click(),F.l=this.m,this.stop()))}stop(){this.g=0;M.enable();N.g=!1;vb.g=!1;S.g=!1;S.start()}}function ub(){var a=vb;a.l&&(a.g=!1,wb(a));a.g=!0}
function xb(a){a.m.innerHTML="";yb(a,"CHAT");a.add(a.text("Show chat"),W("chat_on",function(b){b?kb():(b=M,b.A||(b.D.style.display="none"))}));a.add(a.text("Max number of chat messages"),X(a,"max_chat_messages","",M.J.bind(M)));a.add(a.text("Chat text scale"),X(a,"chat_text_scale","",M.K.bind(M)));yb(a,"MENU");a.add(a.text("Show latency"),W("show_ping",J.T.bind(J)));yb(a,"GAME");Za.i=W("show_tutorial");a.add(a.text("Enable tutorial"),Za.i);yb(a,"VISUALS");a.add(a.text("Default FOV"),X(a,"fov"));a.add(a.text("Draw balls' fill"),
W("draw_ball_fill"));a.add(a.text("Draw balls' stroke"),W("draw_ball_stroke"));a.add(a.text("Draw stroke-only balls with brighter color"),W("draw_ball_stroke_bright"));a.add(a.text("Balls' stroke radius percentage"),X(a,"ball_stroke","%"));a.add(a.text("Draw players' fill"),W("draw_player_fill"));a.add(a.text("Draw players' stroke"),W("draw_player_stroke"));a.add(a.text("Draw stroke-only players with brighter color"),W("draw_player_stroke_bright"));a.add(a.text("Players' stroke radius percentage"),
X(a,"player_stroke","%"));a.add(a.text("Draw players' name"),W("draw_player_name"));a.add(a.text("Draw an arrow towards dead players"),W("draw_death_arrow"));a.add(a.text("Death arrow size"),X(a,"death_arrow_size","px",zb.g.bind(zb)));a.add(a.text("Slow movement speed"),X(a,"slowwalk_speed","%"));yb(a,"KEYBINDS");Ab(a,Bb("h5","To change, click a button on the right side and then press the key you want to assign to it."));a.add(a.text("Settings"),Y("settings"));a.add(a.text("Move up"),Y("up"));a.add(a.text("Move left"),
Y("left"));a.add(a.text("Move down"),Y("down"));a.add(a.text("Move right"),Y("right"));a.add(a.text("Move slowly"),Y("slowwalk"));a.add(a.text("Spectate the previous player"),Y("spec_prev",J.m.bind(J)));a.add(a.text("Spectate the next player"),Y("spec_next",J.m.bind(J)));yb(a,"RESET");a.add(a.text("Reset settings"),a.button("RESET",function(){w=JSON.parse(JSON.stringify(v));ia();xb(this)}.bind(a)));a.add(a.text("Reset keybinds"),a.button("RESET",function(){t=JSON.parse(JSON.stringify(ea));fa();xb(this)}.bind(a)));
a.add(a.text("Reset all tooltips"),a.button("RESET",function(){aa("psfy_tooltip");aa("tume_tooltip");Pa(J);aa("tth_tooltip");hb(M)}));a.end()}function wb(a){a.g||(a.l=!1,a.D.style.display="none",S.g=!1,S.start())}function Ab(a,b){a.m.appendChild(b)}function yb(a,b){a.end();Ab(a,Bb("h1",b));a.i=y("table")}function Bb(a,b){a=y(a);a.innerHTML=b;return a}
function W(a,b=function(){}){const c=y("button");w[a]=!w[a];let e=!0;c.onclick=function(){w[a]=!w[a];1==w[a]?(c.innerHTML="ON",c.style["background-color"]="#23c552"):(c.innerHTML="OFF",c.style["background-color"]="#f84f31");ia();e?e=!1:b(w[a])};c.onclick();return c}function Y(a,b=function(){}){const c=y("button");c.innerHTML=t[a];c.onclick=async function(){c.innerHTML="...";const e=await pb();c.innerHTML=e;t[a]=e;fa();b()};c.style.color="#000";return c}
function X(a,b,c="",e=function(){}){const g=y("div");g.className="input";const f=y("input");f.type="range";f.min=w[b].min;f.max=w[b].max;f.step=w[b].step;f.value=w[b].value;f.oninput=function(){f.nextElementSibling.innerHTML=f.value+c;w[b].value=f.valueAsNumber;e()};f.onchange=ia;g.appendChild(f);g.appendChild(a.text(f.value+c));return g}
class Cb{constructor(){this.D=x("ID_settings_container");this.m=x("ID_settings");this.g=this.l=!1;this.i=null;xb(this)}add(a,b){const c=y("tr");let e=y("td");e.appendChild(a);c.appendChild(e);e=y("td");e.appendChild(b);b.onchange=ia;c.appendChild(e);this.i.appendChild(c)}end(){null!=this.i&&(Ab(this,this.i),this.i=null)}text(a){return Bb("h3",a)}button(a,b){const c=y("button");c.innerHTML=a;c.onclick=b;return c}}
class Db{constructor(){this.h=Ca("ID_canvas");this.o=new Ia(this.h);this.g=new Ka(this.h);this.l=this.i=w.fov.value;this.v=-1;this.A=this.m=0;this.h.canvas.onwheel=this.G.bind(this);this.h.canvas.onmousedown=this.C.bind(this)}clear(){this.l=this.i=w.fov.value;cancelAnimationFrame(this.v);this.v=-1;this.A=this.m=0}G(a){a=.05*-Math.sign(a.deltaY);this.l=1<this.l?this.l+3*a:this.l+a;this.l=ba(p(this.l,w.fov.min),w.fov.max)}C(){S.v=!S.v;Z(S)}j(a){this.m=ba(p(this.m,G.g[0]),G.g[1]);var b=this.i;this.i=
A(this.i,this.l,.1);this.i!=b&&Z(S);b=G.g[0]==G.g[1]?1:(this.m-G.g[0])/(G.g[1]-G.g[0]);this.m+=a-this.A;this.A=a;w.show_ping&&(J.A.innerHTML=G.H.toFixed(1)+"ms");a=this.h;a.canvas.width!=D.width&&(a.canvas.width=D.width);a.canvas.height!=D.height&&(a.canvas.height=D.height);a.viewport(0,0,a.canvas.width,a.canvas.height);a.clearColor(.2,.2,.2,1);a.clear(E.COLOR_BUFFER_BIT|E.DEPTH_BUFFER_BIT);a.enable(E.DEPTH_TEST);a.enable(E.BLEND);a.blendFunc(E.ONE,E.ONE_MINUS_SRC_ALPHA);a=Za;var c=0,e=0;switch(a.g){case 1:c=
O.g[H.id].x2;e=O.g[H.id].y2;break;case 2:c=.5*R.width-6*R.g;e=.5*R.height;break;case 3:c=.5*R.width+6*R.g;e=.5*R.height;break;case 4:c=.5*R.g;e=.5*R.height;break;case 5:for(c=0;65535>c;++c)if(Q.g[c]){var g=Q.g[c];break}c=g.x;e=g.y;break;case 6:c=O.g[H.id].x2,e=O.g[H.id].y2}if(0!=a.g){g=.2*b;var f=N;f.x2=A(f.x2,c,g);f.y2=A(f.y2,e,g)}ca(N.x-c)<=10*D.g&&ca(N.y-e)<=10*D.g&&(a.l=1);g={$:c,aa:e};N.x=A(N.x1,N.x2,b);N.y=A(N.y1,N.y2,b);R.j();this.o.matrix=R.h.matrix;this.g.matrix=R.h.matrix;c=0;a=Q.i;for(e=
0;a;++e)f=Q.g[e],void 0!=f&&(--a,f.x=A(f.x1,f.x2,b),C.setFloat32(c,f.x,!0),c+=4,f.y=A(f.y1,f.y2,b),C.setFloat32(c,f.y,!0),c+=4,f.r=A(f.r1,f.r2,b),C.setFloat32(c,f.r,!0),c+=4,C.setUint32(c,qa[f.type]),c+=4);this.o.set(ra.slice(0,c),c>>4);this.o.j(w.draw_ball_fill,w.draw_ball_stroke,w.ball_stroke.value/100,w.draw_ball_stroke_bright);c=0;a=O.i;for(e=0;a;++e)f=O.g[e],void 0!=f&&(--a,f.x=A(f.x1,f.x2,b),C.setFloat32(c,f.x,!0),c+=4,f.y=A(f.y1,f.y2,b),C.setFloat32(c,f.y,!0),c+=4,f.r=A(f.r1,f.r2,b),C.setFloat32(c,
f.r,!0),c+=4,C.setUint32(c,3958108415),c+=4);this.o.set(ra.slice(0,c),c>>4);this.o.j(w.draw_player_fill,w.draw_player_stroke,w.player_stroke.value/100,w.draw_player_stroke_bright);Ja(this.g);a=O.i;for(b=0;a;++b)if(c=O.g[b],void 0!=c&&(--a,w.draw_player_name&&0!=c.name.length&&(c.S=A(c.S,1<this.i?.5*c.r:.5*c.r+2/(this.i*this.i),.1),e=this.g.create(c.name,c.r,this.i,4,"#00000080",0),this.g.j(e,c.x,c.y-c.r-c.S,-1/c.r)),c.P&&(e=this.g.create(c.R,c.r,ba(this.i,1),4*p(this.i,1),"#f00",1),this.g.j(e,c.x,
c.y,-1/c.r),w.draw_death_arrow))){var h=void 0;f=.75*zb.size;f*=F.i;h=.5*D.width+(c.x-N.x)*F.i;const q=.5*D.height+(c.y-N.y)*F.i;e=!1;(0>h||h>D.width-0)&&(e=!0);h=p(ba(h,D.width-f),f);(0>q||q>D.height-0)&&(e=!0);f=p(ba(q,D.height-f),f);const [u,r,B]=[(h-.5*D.width)/F.i+N.x,(f-.5*D.height)/F.i+N.y,e];B&&(e=Math.atan2(c.y-r,c.x-u),this.g.matrix=Aa(ta(this.g.matrix,u,r),-e),Ea(this.g),zb.j(),this.g.matrix=Aa(this.g.matrix,e),Ea(this.g),e=this.g.create(c.R,.3*zb.size,1,4,"#f00",4),this.g.j(e,0,0,-1),
this.g.matrix=ta(this.g.matrix,-u,-r),Ea(this.g))}sb(g);this.g.h.depthFunc(E.LESS);this.v=window.requestAnimationFrame(this.j.bind(this))}}
class Eb{constructor(){this.h=new Ha;this.g=this.height=this.width=0;this.l=[];this.i=-1}clear(){this.i=-1}j(){this.h.matrix=new Ba;var a=ta(this.h.matrix,.5*D.width,.5*D.height);var b=F.i;a=sa(a,new Float32Array([b,0,0,0,b,0,0,0,1]));ta(a,-N.x,-N.y);this.h.j();F.g.matrix=this.h.matrix;Ja(F.g);a=this.g/1.75|0;b=pa[3];b="#"+(.8*parseInt(b.substring(1,3),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(b.substring(3,5),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(b.substring(5,7),16)>>0).toString(16).padStart(2,
"0")+b.substring(7);for(const c of this.l){const e=F.g.create(c[2],a,1,4,b,2);F.g.j(e,c[0],c[1],.5)}F.g.h.depthFunc(E.LESS)}}
class Fb{constructor(){this.height=this.width=this.i=this.l=this.g=0;this.m=[0,0];window.onresize=this.o.bind(this);window.onkeyup=this.C.bind(this);window.onkeydown=this.A.bind(this);window.onmousemove=this.G.bind(this);window.onbeforeunload=this.v.bind(this)}o(){if(window.devicePixelRatio!=this.g||window.innerWidth!=this.l||window.innerHeight!=this.i)this.g=window.devicePixelRatio,this.l=window.innerWidth,this.i=window.innerHeight,this.width=this.l*this.g,this.height=this.i*this.g}A(a){if(!a.repeat)if(qb.g)a.preventDefault(),
qb.i(a.code);else if(a.code==t.settings)vb.l?wb(vb):(a=vb,a.g||(a.l=!0,a.D.style.display="block",S.stop(),S.block()));else{if(H.i)switch(a.code){case t.spec_prev:Va(-1);L(G);break;case t.spec_next:Va(1),L(G)}switch(a.code){case "Enter":M.focus(a);break;case t.up:S.C||(S.C=1,Z(S));break;case t.down:S.o||(S.o=1,Z(S));break;case t.left:S.l||(S.l=1,Z(S));break;case t.right:S.m||(S.m=1,Z(S));break;case t.slowwalk:1==S.A&&(Gb(w.slowwalk_speed.value/100),Z(S));break;case "KeyT":Za.progress()}}}C(a){if(!a.repeat)switch(a.code){case t.up:S.C&&
(S.C=0,Z(S));break;case t.down:S.o&&(S.o=0,Z(S));break;case t.left:S.l&&(S.l=0,Z(S));break;case t.right:S.m&&(S.m=0,Z(S));break;case t.slowwalk:1!=S.A&&(Gb(1),Z(S))}}G(a){this.m=[a.clientX*this.g,a.clientY*this.g];Z(S)}v(a){if(H.g)return a.preventDefault(),a.returnValue="Are you sure you want to quit?"}}
function Z(a){if(H.g&&!a.g){a=K;let c=0;var b=0;if(S.v){b=D.m[0]-.5*D.width;const e=D.m[1]-.5*D.height;c=Math.atan2(e,b);b=Math.hypot(b,e)/F.i}else if(S.C!=S.o||S.l!=S.m)c=Math.atan2(S.o-S.C,S.m-S.l),b=160*D.g;a.g[0]=1;a.view.setFloat32(1,c,!0);a.g[5]=b>=160*D.g?255*S.i:1.59375*b/D.g*S.i;a.i=6;L(G)}}function Gb(a){var b=S;b.g||(b.i=a);b.A=a}
class Hb{constructor(){this.v=!1;this.i=this.A=1;this.g=!1;this.m=this.l=this.o=this.C=0}clear(){this.v=this.g=!1;this.i=this.A=1}block(){this.g=!0}stop(){this.g||(this.A=this.i,this.i=0,Z(this))}start(){this.g||(this.i=this.A,Z(this))}}function Ma(){var a=H;z.innerHTML="Connecting";a.m?(Ra(),J.name.style.display="none",kb(),jb(M,"Waiting for connection..."),ub()):a.m=!0}
function db(){H.g=!1;z.innerHTML="Disconnected";Ra();jb(M,"You have been disconnected");var a=J;G.once||la();a.name.style.display="none";a.C.style.display="none";a.v.style.display="none";a.G.style.display="block";clearInterval(a.L);ub()}class Ib{constructor(){this.l=this.i=this.g=!1;this.id=-1;this.m=!1}clear(){this.l=this.i=this.g=!1;this.id=-1}o(){Ra();J.name.style.display="block";z.innerHTML="";kb();M.enable();vb.g=!1}}
const J=new Ta,G=new Ya,K=new fb,zb=new gb,M=new lb,N=new mb,O=new nb,Q=new ob,qb=new rb,Za=new tb,vb=new Cb,F=new Db,R=new Eb,D=new Fb,S=new Hb,H=new Ib;D.o();zb.g();
(async function(){Ma();let a;var b=new Promise(function(g){a=g});const c=[];for(const [,,g]of J.o)c[c.length]=new Na(g,a);setTimeout(a,2E3,"");b=await b;let e;if(0==b.length){b=0;for(const g of c)g.B.readyState==WebSocket.OPEN&&g.N>b&&(b=g.N,e=g.B.url)}else e=b;if(void 0==e)throw z.innerHTML="Couldn't connect to any server",la(),Error(z.innerHTML);for(const g of c)g.B.url!=e?g.stop():Oa(g);Qa()})();
