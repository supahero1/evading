!function(){const e=window.localStorage,aa=Math.sin,ba=Math.cos,ca=Math.max,da=Math.min,ea=Math.abs,fa=e.getItem("keybinds"),ia={settings:"Escape",up:"KeyW",left:"KeyA",right:"KeyD",down:"KeyS",slowwalk:"ShiftLeft",spec_prev:"KeyA",spec_next:"KeyD",menu:"KeyM",freecam:"KeyF"};let h=null!=fa?JSON.parse(fa):ia;for(const a in h)a in ia||delete h[a];for(const a in ia)a in h||(h[a]=ia[a]);function ja(){var a=JSON.stringify(h);e.setItem("keybinds",a)}const ka=e.getItem("settings"),m={fov:{min:.25,max:4,value:1.75,step:.05},chat_on:!0,max_chat_messages:{min:1,max:1E3,value:100,step:1},chat_text_scale:{min:1,max:2,value:1,step:.05},draw_ball_fill:!0,draw_ball_stroke:!0,draw_ball_stroke_bright:!0,ball_stroke:{min:0,max:100,value:20,step:1},draw_player_fill:!0,draw_player_stroke:!0,draw_player_stroke_bright:!0,player_stroke:{min:0,max:100,value:10,step:1},draw_player_name:!0,draw_death_arrow:!0,death_arrow_size:{min:10,max:76,value:40,step:1},show_tutorial:!0,show_ping:!1,slowwalk_speed:{min:0,max:100,value:50,step:1},show_target_arrows:!0,target_arrow_size:{min:.2,max:4,value:1.2,step:.05},target_arrow_dist:{min:.05,max:4,value:.6,step:.05},target_arrow_opacity:{min:0,max:100,value:20,step:1}};let n=null!=ka?JSON.parse(ka):JSON.parse(JSON.stringify(m));for(const a in m)a in n||(n[a]=m[a]);for(const a in n)a in m?(n[a].min&&n[a].min!=m[a].min&&(n[a].min=m[a].min),n[a].max&&n[a].max!=m[a].max&&(n[a].max=m[a].max),n[a].step&&n[a].step!=m[a].step&&(n[a].step=m[a].step),n[a].value=ca(da(n[a].value,n[a].max),n[a].min)):delete n[a];function la(){var a=JSON.stringify(n);e.setItem("settings",a)}const ma=n.fov.max;function p(a){return document.getElementById(a)}function q(a){return document.createElement(a)}const t=p("ID_status"),na=window.token;let oa=[];"string"==typeof na&&(oa=na.split(",").map(a=>+a));const pa=location.reload.bind(location);function qa(){pa()}const ra=WebSocket.prototype.send,sa=WebSocket.prototype.close;WebSocket=class extends WebSocket{constructor(...a){super(...a)}send(a){this.readyState==WebSocket.OPEN&&ra.call(this,a)}close(){this.readyState!=WebSocket.CONNECTING&&this.readyState!=WebSocket.OPEN||sa.call(this)}};function ta(a){return function(b){const c=b instanceof ClipboardEvent;if(!c||"paste"==b.type){var d=b.target,f=d.value+(c?b.clipboardData.getData("text"):b.key);if((new TextEncoder).encode(f).byteLength-d.selectionEnd+d.selectionStart>a){if(""==d.value&&c){const g=d.placeholder;d.placeholder="Text too long to paste!";setTimeout(function(){d.placeholder=g},1E3)}b.preventDefault()}}}}function ua(a){a();return a}function va(a,b,c,d){c*=u.h;a=.5*w.width+(a-x.x)*u.h;b=.5*w.height+(b-x.y)*u.h;const f=d?0:c;d=!1;(a<f||a>w.width-f)&&(d=!0);a=ca(da(a,w.width-c),c);(b<f||b>w.height-f)&&(d=!0);c=ca(da(b,w.height-c),c);return[(a-.5*w.width)/u.h+x.x,(c-.5*w.height)/u.h+x.y,d]}function A(a,b,c){return a+(b-a)*c}if(0==window.s.length)throw t.innerHTML="No servers found",setTimeout(pa,1E3),Error(t.innerHTML);var wa=!1;const xa=new Uint32Array([3722305023,2863311615,858993663,4276058367]);Array.from(xa).map(a=>"#"+a.toString(16));const ya=new Uint32Array([2155905279,4232489727,8421631,4287497983,1021313023,1715110655]);Array.from(ya).map(a=>"#"+a.toString(16));const za=new ArrayBuffer(1048560);new Uint8Array(za);const B=new Float32Array(za),C=new DataView(za);Float32Array.prototype.multiply=function(a){const b=this[0],c=this[1],d=this[2],f=this[3],g=this[4],k=this[5],l=this[6],r=this[7],v=this[8],y=a[0],O=a[1],S=a[2],z=a[3],ha=a[4],Ha=a[5],Ia=a[6],Ja=a[7];a=a[8];return new Float32Array([y*b+O*f+S*l,y*c+O*g+S*r,y*d+O*k+S*v,z*b+ha*f+Ha*l,z*c+ha*g+Ha*r,z*d+ha*k+Ha*v,Ia*b+Ja*f+a*l,Ia*c+Ja*g+a*r,Ia*d+Ja*k+a*v])};function Aa(a,b,c){return a.multiply(new Float32Array([1,0,0,0,1,0,b,c,1]))}function Ba(a,b,c=b){return a.multiply(new Float32Array([b,0,0,0,c,0,0,0,1]))}class Ca extends Float32Array{constructor(){super([2/w.width,0,0,0,-2/w.height,0,-1,1,1])}}const D=WebGL2RenderingContext.prototype,Da=new Map;function Ea(a){a=(a?p(a):q("canvas")).getContext("webgl2",{premultipliedAlpha:!1,failIfMajorPerformanceCaveat:!1});if(!a)throw t.innerHTML="Your browser/device does not support WebGL2.",Error("Your browser/device does not support WebGL2.");return a}function Fa(a,b,c){b=a.g.createShader(b);a.g.shaderSource(b,c);a.g.compileShader(b);if(a.g.getShaderParameter(b,D.COMPILE_STATUS))return b;throw Error(a.g.getShaderInfoLog(b));}function Ga(a){Da.get(a.g)!=a&&(Da.set(a.g,a),a.g.useProgram(a.m),a.g.bindVertexArray(a.H),null!=a.F&&null!=a.l&&a.g.uniformMatrix3fv(a.F,!1,a.l))}function E(a,b,c,d){const f=a.g.createTexture();a.g.bindTexture(D.TEXTURE_2D,f);a.g.texImage2D(D.TEXTURE_2D,0,D.RGBA,c,d,0,D.RGBA,D.UNSIGNED_BYTE,b);a.g.generateMipmap(D.TEXTURE_2D);a.g.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.LINEAR);a.g.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR_MIPMAP_LINEAR);a.g.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE);a.g.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE);return f}class Ka{constructor(a,b,c){this.g=a instanceof WebGL2RenderingContext?a:Ea(a);a="#version 300 es\nprecision mediump float;\nout vec4 fragColor;\n"+c;c=this.g.createProgram();this.g.attachShader(c,Fa(this,D.VERTEX_SHADER,"#version 300 es\n"+b));this.g.attachShader(c,Fa(this,D.FRAGMENT_SHADER,a));this.g.linkProgram(c);if(this.g.getProgramParameter(c,D.LINK_STATUS))b=c;else throw Error(this.g.getProgramInfoLog(c));this.m=b;this.H=this.g.createVertexArray();this.g.bindVertexArray(this.H);this.F=this.g.getUniformLocation(this.m,"u_matrix");this.h=0}set(a,b){this.g.bindBuffer(D.ARRAY_BUFFER,this.i);this.g.bufferData(D.ARRAY_BUFFER,a,D.DYNAMIC_DRAW);this.h=b}}class La extends Ka{constructor(){super(u.l,"\n      layout(location = 0) in vec2 a_position;\n      layout(location = 1) in vec3 a_offset;\n\n      uniform mat3 u_matrix;\n      uniform sampler2D u_texture;\n      uniform float u_light;\n\n      out vec4 v_color;\n\n      void main() {\n        gl_Position = vec4((u_matrix * vec3(a_position + a_offset.xy, 1.0)).xy, 0.5, 1.0);\n        v_color = vec4(texelFetch(u_texture, ivec2(int(a_offset.z), 0), 0).xyz * u_light, 1.0);\n      }\n      ","\n      in vec4 v_color;\n\n      void main() {\n        fragColor = v_color;\n      }\n    ");this.B=new Float32Array([0,1,.0375,.9625,1,1,.9625,.9625,1,0,.9625,.0375,0,0,.0375,.0375,0,1,.0375,.9625]);this.model=new Float32Array([.0375,.0375,.9625,.0375,.0375,.9625,.9625,.9625]);this.v=this.g.getUniformLocation(this.m,"u_light");this.u=this.g.createBuffer();this.g.bindBuffer(D.ARRAY_BUFFER,this.u);this.g.vertexAttribPointer(0,2,D.FLOAT,!1,0,0);this.g.enableVertexAttribArray(0);this.i=this.g.createBuffer();this.g.bindBuffer(D.ARRAY_BUFFER,this.i);this.g.vertexAttribPointer(1,3,D.UNSIGNED_BYTE,!1,0,0);this.g.vertexAttribDivisor(1,1);this.g.enableVertexAttribArray(1);for(let a=0;a<xa.length;++a)C.setUint32(a<<2,xa[a]);this.D=E(this,new Uint8Array(za.slice(0,xa.length<<2)),xa.length,1)}j(){Ga(this);this.g.bindTexture(D.TEXTURE_2D,this.D);this.g.uniform1f(this.v,1);this.g.bindBuffer(D.ARRAY_BUFFER,this.u);this.g.bufferData(D.ARRAY_BUFFER,this.model,D.DYNAMIC_DRAW);this.g.drawArraysInstanced(D.TRIANGLE_STRIP,0,4,this.h);this.g.uniform1f(this.v,.8);this.g.bindBuffer(D.ARRAY_BUFFER,this.u);this.g.bufferData(D.ARRAY_BUFFER,this.B,D.DYNAMIC_DRAW);this.g.drawArraysInstanced(D.TRIANGLE_STRIP,0,10,this.h)}}class Ma extends Ka{constructor(a){super(a,"\n      layout(location = 0) in vec2 a_position;\n      layout(location = 1) in vec2 a_offset;\n      layout(location = 2) in float a_scale;\n      layout(location = 3) in vec4 a_color;\n\n      uniform mat3 u_matrix;\n      uniform int u_precision;\n\n      flat out vec4 v_color;\n\n      void main() {\n        gl_Position = vec4((u_matrix * vec3(a_position * a_scale + a_offset, 1.0)).xy, -1.0 / a_scale, 1.0);\n        if(gl_VertexID < u_precision) {\n          v_color = a_color;\n        } else {\n          v_color = vec4(a_color.xyz * 0.8, a_color.w);\n        }\n      }\n      ","\n      flat in vec4 v_color;\n\n      void main() {\n        fragColor = v_color;\n      }\n    ");this.v=this.g.getUniformLocation(this.m,"u_precision");this.u=this.g.createBuffer();this.g.bindBuffer(D.ARRAY_BUFFER,this.u);this.g.vertexAttribPointer(0,2,D.FLOAT,!1,0,0);this.g.enableVertexAttribArray(0);this.i=this.g.createBuffer();this.g.bindBuffer(D.ARRAY_BUFFER,this.i);this.g.vertexAttribPointer(1,2,D.FLOAT,!1,16,0);this.g.vertexAttribPointer(2,1,D.FLOAT,!1,16,8);this.g.vertexAttribPointer(3,4,D.UNSIGNED_BYTE,!0,16,12);this.g.vertexAttribDivisor(1,1);this.g.vertexAttribDivisor(2,1);this.g.vertexAttribDivisor(3,1);this.g.enableVertexAttribArray(1);this.g.enableVertexAttribArray(2);this.g.enableVertexAttribArray(3)}j(a,b,c,d){if(a||b){Ga(this);b||(c=0);var f=252*a+4+512*b,g=Math.PI/64,k=0;if(a){var l=aa(g),r=ba(g),v=1-c,y=0;B[k++]=v;B[k++]=y;for(let O=1;64>O;++O){let S=v*r-y*l;y=v*l+y*r;v=S;B[k++]=v;B[k++]=y;B[k++]=v;B[k++]=-y}B[k++]=-1+c;B[k++]=0}if(b){b=aa(-g);g=ba(-g);a||(l=-1+c,r=0,v=l*g-r*b,B[k++]=v,B[k++]=-(l*b+r*g),B[k++]=-1+c,B[k++]=0);l=-1;r=0;B[k++]=l;B[k++]=r;for(v=0;127>v;++v)y=l*g-r*b,r=l*b+r*g,l=y,B[k++]=l*(1-c),B[k++]=r*(1-c),B[k++]=l,B[k++]=r;B[k++]=-1;B[k++]=0}console.assert(k==f);this.g.bindBuffer(D.ARRAY_BUFFER,this.u);this.g.bufferData(D.ARRAY_BUFFER,B.subarray(0,f),D.DYNAMIC_DRAW);this.g.uniform1i(this.v,a?128:d?258:0);this.g.drawArraysInstanced(D.TRIANGLE_STRIP,0,f>>1,this.h)}}}function Na(a,b,c,d){c*=ma;const f=q("canvas"),g=f.getContext("2d");g.font=`700 ${c}px Ubuntu`;g.textAlign="center";g.textBaseline="alphabetic";g.fillStyle=d;const k=g.measureText(b),l=Math.ceil(k.width),r=Math.ceil(k.actualBoundingBoxAscent+k.actualBoundingBoxDescent);f.width=l;f.height=r;g.font=`700 ${c}px Ubuntu`;g.textAlign="center";g.textBaseline="alphabetic";g.fillStyle=d;g.fillText(b,k.actualBoundingBoxLeft,k.actualBoundingBoxAscent);return{M:E(a,f,l,r),w:.5*l/ma,Z:.5*r/ma,size:c/ma,color:d,ha:performance.now()}}function Oa(a){a.v=!1;if(0!=a.h){Ga(a);var b=a.u.slice(0,40*a.h);a.g.bindBuffer(D.ARRAY_BUFFER,a.i);a.g.bufferSubData(D.ARRAY_BUFFER,0,b);for(b=0;b<a.h;++b)a.g.activeTexture(D.TEXTURE0+b),a.g.bindTexture(D.TEXTURE_2D,a.D[b]);a.g.drawArraysInstanced(D.TRIANGLE_STRIP,0,4,a.h);a.h=0;a.g.activeTexture(D.TEXTURE0)}}function Pa(a,b,c,d,f){let g=[];if(0==b)g=[0];else for(;b;)g[g.length]=b%10,b=Math.floor(b/10);c-=5.7*(g.length-1);for(b=g.length-1;0<=b;--b)a.j(a.B[g[b]],c+11.4*(g.length-b-1),d,f)}class Qa extends Ka{constructor(a){super(a,"\n      layout(location = 0) in vec2  a_position;\n      layout(location = 1) in vec2  a_texcoord;\n      layout(location = 2) in float a_depth;\n      layout(location = 3) in mat3  a_matrix;\n\n      out vec2 v_texcoord;\n      flat out int v_id;\n\n      void main() {\n        gl_Position = vec4((a_matrix * vec3(a_position, 1.0)).xy, -1.0 / a_depth, 1.0);\n        v_texcoord = a_texcoord;\n        v_id = gl_InstanceID;\n      }\n      ",`      in vec2 v_texcoord;      flat in int v_id;      uniform sampler2D u_texture[16];      void main() {        switch(v_id) {          ${[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15].map(b=>`case ${b}: fragColor = texture(u_texture[${b}], v_texcoord); break;\n`).join("")}        }      }    `);this.g.pixelStorei(D.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);this.u=this.g.createBuffer();this.g.bindBuffer(D.ARRAY_BUFFER,this.u);this.g.bufferData(D.ARRAY_BUFFER,new Float32Array([-1,1,0,1,-1,-1,0,0,1,1,1,1,1,-1,1,0]),D.STATIC_DRAW);this.g.vertexAttribPointer(0,2,D.FLOAT,!1,16,0);this.g.vertexAttribPointer(1,2,D.FLOAT,!1,16,8);this.g.enableVertexAttribArray(0);this.g.enableVertexAttribArray(1);this.i=this.g.createBuffer();this.g.bindBuffer(D.ARRAY_BUFFER,this.i);this.g.vertexAttribPointer(2,1,D.FLOAT,!1,40,0);for(a=0;3>a;++a)this.g.vertexAttribPointer(3+a,3,D.FLOAT,!1,40,4+12*a);this.g.vertexAttribDivisor(2,1);for(a=0;3>a;++a)this.g.vertexAttribDivisor(3+a,1);this.g.enableVertexAttribArray(2);for(a=0;3>a;++a)this.g.enableVertexAttribArray(3+a);this.g.bindBuffer(D.ARRAY_BUFFER,this.i);this.g.bufferData(D.ARRAY_BUFFER,640,D.DYNAMIC_DRAW);this.h=640;this.v=!1;this.D=Array(16);this.g.useProgram(this.m);for(a=0;16>a;++a)this.g.uniform1i(this.g.getUniformLocation(this.m,`u_texture[${a}]`),a);this.cache=Array(1);for(a=0;1>a;++a)this.cache[a]={};setInterval(this.I.bind(this),1E3);this.u=new ArrayBuffer(640);this.view=new DataView(this.u);this.B=Array(10);for(a=0;10>a;++a)this.B[a]=Na(this,a.toString(),19,"#f00")}I(){const a=performance.now();for(let b=0;1>b;++b)for(const c in this.cache[b]){const d=this.cache[b][c];1E3<a-d.ha&&(this.delete(d),delete this.cache[b][c])}}delete({M:a}){this.g.deleteTexture(a)}create(a,b,c,d){const f="EVADING"+a,g=this.cache[d][f];if(void 0!==g){if(.01>ea(g.size-b)&&g.color==c)return g.ha=performance.now(),g;this.delete(g);delete this.cache[d][f]}a=Na(this,a,b,c);return this.cache[d][f]=a}j({M:a,w:b,Z:c},d,f,g){this.v||(this.h=0,this.v=!0);this.D[this.h]=a;a=Ba(Aa(this.l,d,f),b,c);this.view.setFloat32(40*this.h,g,!0);for(g=0;3>g;++g)for(b=0;3>b;++b)this.view.setFloat32(40*this.h+4+4*(3*g+b),a[3*g+b],!0);16==++this.h&&Oa(this)}}class Ra extends Ka{constructor(a){super(a,"\n      layout(location = 0) in vec2 a_position;\n      layout(location = 1) in vec2 a_offset;\n\n      uniform mat3 u_matrix;\n\n      void main() {\n        gl_Position = vec4((u_matrix * vec3(a_position + a_offset, 1.0)).xy, -1.0, 1.0);\n      }\n      ","\n      void main() {\n        fragColor = vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    ");new Float32Array([0,0,0,1]);new Float32Array([0,0,1,0]);this.u=this.g.createBuffer();this.g.bindBuffer(D.ARRAY_BUFFER,this.u);this.g.vertexAttribPointer(0,2,D.FLOAT,!1,0,0);this.g.enableVertexAttribArray(0);this.i=this.g.createBuffer();this.g.bindBuffer(D.ARRAY_BUFFER,this.i);this.g.vertexAttribPointer(1,2,D.BYTE,!1,0,0);this.g.vertexAttribDivisor(1,1);this.g.enableVertexAttribArray(1)}}class Sa extends Ka{constructor(a){super(a,"\n      layout(location = 0) in vec2  a_position;\n      layout(location = 1) in vec2  a_offset;\n      layout(location = 2) in vec2  a_angle;\n      layout(location = 3) in float a_depth;\n\n      uniform mat3 u_matrix;\n      uniform float u_size;\n      uniform float u_dist;\n\n      void main() {\n        mat3 rotation;\n        rotation[0] = vec3(a_angle[0], -a_angle[1], 0);\n        rotation[1] = vec3(a_angle[1], a_angle[0], 0);\n        rotation[2] = vec3(0, 0, 1);\n        vec2 pos = ((vec3(a_position, 1.0) * rotation).xy + a_angle * u_size * u_dist) * a_depth * u_size * 0.5;\n        pos = (u_matrix * vec3(pos + a_offset + a_angle * a_depth * 1.2, 1.0)).xy;\n        gl_Position = vec4(pos, -1.0 / a_depth, 1.0);\n      }\n      ","\n      uniform float u_opacity;\n\n      void main() {\n        fragColor = vec4(0.0, 0.0, 0.0, u_opacity);\n      }\n    ");this.L=this.g.getUniformLocation(this.m,"u_size");this.D=this.g.getUniformLocation(this.m,"u_dist");this.I=this.g.getUniformLocation(this.m,"u_opacity");this.u=this.g.createBuffer();this.g.bindBuffer(D.ARRAY_BUFFER,this.u);this.g.bufferData(D.ARRAY_BUFFER,new Float32Array([-.8660254037844386,-1,-.8660254037844386,1,.8660254037844386,0]),D.STATIC_DRAW);this.g.vertexAttribPointer(0,2,D.FLOAT,!1,0,0);this.g.enableVertexAttribArray(0);this.i=this.g.createBuffer();this.g.bindBuffer(D.ARRAY_BUFFER,this.i);this.g.vertexAttribPointer(1,2,D.FLOAT,!1,20,0);this.g.vertexAttribPointer(2,2,D.FLOAT,!1,20,8);this.g.vertexAttribPointer(3,1,D.FLOAT,!1,20,16);this.g.vertexAttribDivisor(1,1);this.g.vertexAttribDivisor(2,1);this.g.vertexAttribDivisor(3,1);this.g.enableVertexAttribArray(1);this.g.enableVertexAttribArray(2);this.g.enableVertexAttribArray(3)}size(){var a=this.L,b=n.target_arrow_size.value;Ga(this);this.g.uniform1f(a,b)}B(){var a=this.D,b=n.target_arrow_dist.value;Ga(this);this.g.uniform1f(a,b)}v(){var a=this.I,b=n.target_arrow_opacity.value/100;Ga(this);this.g.uniform1f(a,b)}j(){Ga(this);this.g.drawArraysInstanced(D.TRIANGLE_STRIP,0,3,this.h)}}function Ta(a){if(a.ka||a.h[0][1]!=a.D)a.D=a.h[0][1],a.D?a.ja():a.da()&&a.ia()}function Ua(a,b,c,d,f=!0){[a.ja,a.ia,a.h,a.ka]=[b,c,[[0,d]],!1];f?(a.D=!d,Ta(a)):a.D=d}function Va(a,b){a.da=b}function F(a,b,c){const d=a.h.findIndex(f=>f[0]==b);-1==d?(a.h.push([b,c]),a.h.sort((f,g)=>g[0]-f[0])):a.h[d][1]=c;Ta(a)}function G(a,b){const c=a.h.findIndex(d=>d[0]==b);-1!=c&&(a.h.splice(c,1),Ta(a))}function Wa(a,b){return b==a.ca?a.ga:b>=a.ca}function Xa(a){const b=a.h.findIndex(c=>0==c[0]);-1!=b&&(a.h[b][1]=!a.h[b][1],Ta(a))}class Ya{constructor(){this.da=function(){return!0}}get ca(){return this.h[0][0]}get ga(){return this.h[0][1]}}class Za extends Ya{constructor(){super();Ua(this,this.g.bind(this),this.g.bind(this),!0,!1);this.B=!1;this.i=1;this.F=new Uint8Array(0);this.m=this.l=this.u=this.v=0}g(){if(wa&&H.g){this.ga?$a(this.i):$a(0);if(I.h==this.F.length){let a=1;for(let b=0;b<I.h;++b)if(I.g[b]!=this.F[b]){a=0;break}if(a)return}J(K)}}}function ab(a){a.l.innerHTML="";let b,c,d;for([b,c,d]of a.H){const g=q("option");g.value=d;d==K.C.url&&(g.selected=!0,g.disabled=!0,a.g=g);b>=c&&(g.disabled=!0);var f=d;const k=f.match(/\/\/(.*?)\.shadam\.xyz/),l=f.match(/\/\/(.*?)[\/:]/);f=k?k[1]:l?l[1]:f;g.innerHTML=f[0].toUpperCase()+f.substring(1)+` (${b}/${c})`;a.l.appendChild(g)}a.l.onchange=a.la.bind(a)}function bb(){var a=L;ab(a);a.ea=setInterval(function(){fetch("servers.json",{cache:"no-store"}).then(b=>b.json()).then(function(b){L.H=b;ab(L)})},5E3)}function cb(a){a.v=0;a:{switch(a.v){case 0:var b=`Press ${h.spec_prev} or ${h.spec_next} to switch between players<br><br>Type "/menu" in chat to return to the main menu`;break a}b=void 0}a.F=b;null!=a.i&&(a.i.innerHTML=a.F)}function db(){var a=L;0==a.v&&cb(a)}function eb(){var a=L;const b=q("h5");b.id="ID_general_tooltip";b.innerHTML=a.F;setTimeout(function(){b.style.opacity=0},5E3);b.addEventListener("transitionend",a.P.bind(a));document.body.insertBefore(b,L.B);a.i=b}class fb extends Ya{constructor(){super();this.B=p("ID_menu");Va(this,function(){return 99!=this.ca?H.g||H.h:!0});Ua(this,function(){F(M,1,!1);this.B.style.display="block"}.bind(this),function(){this.B.style.display="none";G(M,1)}.bind(this),!0);this.name=p("ID_name");this.l=p("ID_select_serv");this.H=window.s;this.I=p("ID_ping");this.fa();this.u=p("ID_play");this.m=p("ID_spec");this.i=null;this.F="";this.v=-1;this.O=p("ID_spectating");this.L=p("ID_refresh");var a=p("ID_general_tooltip");a.parentElement.removeChild(a);this.L.onclick=qa;this.name.onkeypress=this.name.onpaste=ta(16);this.name.onchange=function(){H.i=!1;e.setItem("name",this.value)};this.ea=-1;a=e.getItem("name");"string"==typeof a&&16>=(new TextEncoder).encode(a).length&&(this.name.value=a);this.u.onclick=function(){gb();J(K)};this.m.onclick=function(){hb(0);J(K)}}P(){null!=this.i&&(this.i.parentElement.removeChild(this.i),this.i=null,this.v=-1)}fa(){this.I.style.display=n.show_ping?"block":"none"}async la(){this.g.disabled=!1;const a=this.g;this.g=this.l.selectedOptions[0];this.g.disabled=!0;ib();let b;const c=new Promise(function(f){b=f}),d=new jb(this.g.value,b,1);setTimeout(b,2E3);await c;0==d.U||d.C.readyState!=WebSocket.OPEN?(d.stop(),t.innerHTML="Couldn't connect, returning to previous server",this.g.disabled=!1,this.g=a,this.g.disabled=!0,setTimeout(H.m.bind(H),1E3)):kb(d)}}function J(a){a.C.send(I.i.slice(0,I.h))}function kb(a){var b=K;null!=b.C&&(b.stop(),b.once=!1,b.i=!1,b.g=[0,0]);b.N=a.N;b.V=a.V;b.J=a.J;b.A=a.A;b.C=a.C;b.C.onmessage=function(c){c=new Uint8Array(c.data);try{this.message(c)}catch(d){console.log(N.A,N.h,d),console.log(Array.from(c).map(f=>f.toString(16).padStart(2,"0")).join(" "))}}.bind(b);b.C.onclose=b.close.bind(b);lb();J(b);b.h()}function mb(a){a.N[a.A]=(new Date).getTime()-a.V;a.J=0;let b=a.A,c=0;for(let d=0;10>d;++d)0!=a.N[b]&&(a.J+=(10-c)/11*a.N[b],++c),b=(b+1)%10;0!=c&&(a.J/=.5*c);a.A=(a.A+1)%10;setTimeout(a.l.bind(a),10)}class nb{constructor(){this.C=null;this.i=this.once=!1;this.N=Array(10).fill(0);this.A=this.J=this.V=0;this.g=[0,0]}h(){this.once=!0;var a=P;a.v=Array(5).fill(0);a.m=0;a.i.innerHTML="";a.l=0;a.F="Press enter to chat";a.B();a=Q;for(let b=0;a.h;++b)void 0!=a.g[b]&&(u.g.delete(a.g[b].$),delete a.g[b],--a.h);ob();a=u;a.h=n.fov.value;a.i=a.h;cancelAnimationFrame(a.B);a.B=-1;a.u=0;a.D=0;R.l=-1;a=M;a.B=!1;a.i=1;a.F=new Uint8Array(0);a=H;a.g=!1;a.h=!1;a.i=!1;a.id=-1}message(a){N.set(a);if(0==N.h)mb(this);else{var b=T();a=!1;b!=H.id&&(H.id=b,a=!0);b=T();var c=b&1;c&&!H.h?(H.h=!0,F(L,0,!1),cb(L),eb(),L.O.style.display="block",L.m.innerHTML="Stop",F(M,3,!1)):!c&&H.h&&(H.h=!1,H.g||F(L,0,!0),L.P(),L.O.style.display="none",L.m.innerHTML="Spectate",G(M,3));(c=b&2)&&!H.g?(H.g=!0,F(L,0,!1),L.u.innerHTML="Respawn"):!c&&H.g&&(H.g=!1,F(L,0,!0),L.u.innerHTML="Play",pb.stop(),c=M,c.B=!1,c.i=1);L.m.disabled=b&4;b&=8;this.g[0]=this.g[1];this.g[1]=performance.now();c=Q;var d=c.h;for(var f=0;d;++f)void 0!=c.g[f]&&(c.g[f].x1=c.g[f].x2,c.g[f].y1=c.g[f].y2,c.g[f].r1=c.g[f].r2,--d);c=x;c.x1=c.x2;c.y1=c.y2;c=T();if(c!=R.l)d=R,d.l=c,d.width=d.h.width,d.height=d.h.height,d.o=d.h.o,d.W=d.h.W,d.X=d.h.X,ob(),c=!0;else{c=U;d=c.h;for(f=0;d;++f)void 0!=c.g[f]&&(c.g[f].x1=c.g[f].x2,c.g[f].y1=c.g[f].y2,c.g[f].r1=c.g[f].r2,c.g[f].ba=!1,--d);c=!1}for(;N.A<N.h;)switch(T()){case 1:d=Q;f=T();for(var g=0;g<f;++g){var k=T();if(void 0==d.g[k]){var l=V(),r=V(),v=V(),y=T();y=qb(y);var O=T();let ha=0;O&&(ha=T());var S=T();0<S&&W(P,y,qb(S));S=Na(u.g,y,.666*v,"#00000080");d.g[k]={x:0,y:0,r:0,x1:l,x2:l,y1:r,y2:r,r1:v,r2:v,name:y,R:O,Y:ha,$:S,aa:0};H.id==k&&(k=r,r=x,Wa(r,0)&&(r.x2=l,r.y2=k));++d.h}else if(l=T(),0==l){if(void 0==d.g[k])throw Error("trying to delete an unknown player entity id "+k);u.g.delete(d.g[k].$);delete d.g[k];--d.h}else{do{switch(l){case 1:d.g[k].x2=V();H.id==k&&(l=x,Wa(l,0)&&(l.x2=d.g[k].x2));break;case 2:d.g[k].y2=V();H.id==k&&(l=x,Wa(l,0)&&(l.y2=d.g[k].y2));break;case 3:d.g[k].r2=V();break;case 4:d.g[k].R=T();d.g[k].R&&(d.g[k].Y=T());break;case 5:l=T();W(P,d.g[k].name,qb(l));break;default:throw Error();}l=T()}while(0<l&&16>l)}}break;case 2:d=c;f=U;g=rb();for(k=0;k<g;++k){var z=void 0;d&&k<R.h.oa?z=k+1:z=rb();if(void 0==f.g[z]){l=T()-1;if(7<l)throw Error("ball type out of bounds");r=V();v=V();y=V();O=T();f.g[z]={type:l,x:0,y:0,r:0,x1:r,x2:r,y1:v,y2:v,r1:y,r2:y,ba:!!(O&128)};++f.h}else if(l=T(),0==l){if(void 0==f.g[z])throw Error("trying to delete an unknown ball entity id "+z);delete f.g[z];--f.h}else{do{switch(l){case 1:f.g[z].x2=V();break;case 2:f.g[z].y2=V();break;case 3:f.g[z].r2=V();break;default:throw Error();}l=T()}while(0<l&&16>l);l&128&&(f.g[z].ba=!0)}}break;case 3:d=P;f=T();for(g=0;g<f;++g)l=T(),k=(new TextDecoder).decode(N.g.subarray(N.A,N.A+l)),N.A+=l,l=T(),W(d,k,(new TextDecoder).decode(N.g.subarray(N.A,N.A+l))),N.A+=l;break;default:throw Error();}if(N.A>N.h)throw Error();if(255==H.id)sb(.5*R.width,.5*R.height);else if(b||a)z=Q,a=H.id,z.g[a].x1=z.g[a].x2,z.g[a].y1=z.g[a].y2,z.g[a].r1=z.g[a].r2,sb(Q.g[H.id].x2,Q.g[H.id].y2);0==this.g[0]||this.i||(this.i=!0,z=u,z.B=requestAnimationFrame(z.j.bind(z)),H.m())}}close(a){4E3==a?(tb(),t.innerHTML="Server is full"):tb()}l(){this.V=(new Date).getTime();this.C.send(new ArrayBuffer(0))}stop(){this.C.onopen=this.C.onmessage=this.C.onclose=null;this.C.close()}}class jb extends nb{constructor(a,b,c=8){super();this.U=0;this.u=a;this.B=b;this.v=c;this.code=0;this.m()}m(){this.C=new WebSocket(this.u);this.C.binaryType="arraybuffer";this.C.onopen=this.h.bind(this);this.C.onmessage=this.message.bind(this);this.C.onclose=this.close.bind(this)}h(){this.l()}message(){mb(this);++this.U==this.v&&this.B(this.C.url)}close(a){this.code=a.code;4E3!=this.code&&setTimeout(this.m.bind(this),100)}}function $a(a){var b=I;let c=0;var d=0;if(M.B){d=w.l[0]-.5*w.width;const f=w.l[1]-.5*w.height;c=Math.atan2(f,d);d=Math.hypot(d,f)/u.h}else if(M.v!=M.u||M.l!=M.m)c=Math.atan2(M.u-M.v,M.m-M.l),d=160*w.g;b.g[0]=1;b.view.setFloat32(1,c,!0);b.g[5]=d>=160*w.g?255:1.59375*d/w.g;b.g[5]*=a;b.h=6}function gb(){var a=I;ub(a);a.g[0]=0;a.h=1}function hb(a){var b=I;b.g[0]=4;b.g[1]=a;b.h=2}function lb(){var a=I;a.g[0]=5;0==oa.length?a.h=1:(a.g.set(oa,1),a.h=oa.length+1)}function T(){var a=N;return a.g[a.A++]}function rb(){var a=N;const b=a.g[a.A]|a.g[a.A+1]<<8;a.A+=2;return b}function V(){var a=N;const b=a.view.getFloat32(a.A,!0);a.A+=4;return b}function qb(a){var b=N;const c=(new TextDecoder).decode(b.g.subarray(b.A,b.A+a));b.A+=a;return c}function ub(a){if(!H.i){H.i=!0;a.g[0]=3;var b=L;b=(new TextEncoder).encode(b.name.value);a.g.set(b,1);a.h=b.length+1;J(K)}}class vb{constructor(a){this.i=new ArrayBuffer(a);this.g=new Uint8Array(this.i);this.view=new DataView(this.i);this.A=this.h=0}set(a){this.g.set(a);this.h=a.length;this.A=0}}class wb{constructor(){this.size=0}g(){this.size=n.death_arrow_size.value;const a=q("canvas");a.width=a.height=Math.ceil(this.size*ma);const b=.5*a.width,c=a.width,d=a.getContext("2d");d.beginPath();d.moveTo(b+.45*c,b);d.lineTo(b-.225*c,b-.675*c/Math.sqrt(3));d.lineTo(b-.225*c,b+.675*c/Math.sqrt(3));d.closePath();d.fillStyle="#bbbbbbb0";d.fill();d.lineWidth=.1*b;d.strokeStyle="#f00";d.stroke();this.M={M:E(u.g,a,c,c),w:b/ma,Z:b/ma}}}function W(a,b,c,d=!1){const f=q("p");f.appendChild(document.createTextNode((d?"":b+": ")+c));a.i.insertBefore(f,a.i.firstChild);++a.l>n.max_chat_messages.value&&a.i.removeChild(a.i.lastChild)}function xb(a){a.g.value="";a.g.blur();u.l.canvas.focus()}function yb(a,b){a.F=a.g.placeholder;a.g.placeholder=b;a.g.disabled=!0;a.g.value="";u.l.canvas.focus()}class zb extends Ya{constructor(){super();this.i=p("ID_messages");this.H=p("ID_send");this.g=p("ID_sendmsg");Ua(this,function(){this.i.style.display="flex";this.H.style.display="flex"}.bind(this),function(){this.i.style.display="none";this.H.style.display="none"}.bind(this),!0);this.v=Array(5).fill(0);this.m=0;this.O=ta(128);this.l=0;this.F="";this.u=-1;this.g.onkeydown=function(a){a.stopPropagation();if("Enter"==a.code){a=this.g.value.trim();switch(a){case "/help":W(this,null,">",!0);W(this,null,"Available commands:",!0);W(this,null,"/clear /c => clear the chat",!0);W(this,null,"/respawn /r => tp to the first area",!0);W(this,null,"/die /d => become downed",!0);W(this,null,"/menu /m => quit the game and open the menu",!0);W(this,null,"/spectate /s => start/stop spectating",!0);W(this,null,">",!0);xb(this);Ab.m();return;case "/c":case "/clear":this.i.innerHTML="";this.l=0;xb(this);return;case "/r":case "/respawn":gb();J(K);xb(this);return}a=(new TextEncoder).encode(a);if(0<a.length){var b=I;ub(b);b.g[0]=2;b.g.set(a,1);b.h=a.length+1;J(K);this.v[this.m]=(new Date).getTime();a=(this.m+1)%5;b=5E3-this.v[this.m]+this.v[a];this.m=a;0<b?(yb(this,"You are on cooldown for sending too many messages too quickly"),this.u=setTimeout(this.B.bind(this),b)):xb(this)}else xb(this)}}.bind(this);this.g.onkeyup=function(a){a.stopPropagation()};this.g.onkeypress=this.g.onpaste=this.O}B(){-1!=this.u&&(clearTimeout(this.u),this.u=-1);this.g.disabled=!1;this.g.placeholder=this.F}focus(){this.g.focus()}I(){for(;this.l>n.max_chat_messages.value;)this.i.removeChild(this.i.lastChild),--this.l}L(){this.i.style["font-size"]=n.chat_text_scale.value+"em"}P(){n.chat_on?F(this,0,!0):F(this,0,!1)}}function sb(a,b){var c=x;Wa(c,0)&&(c.x2=a,c.y2=b,c.x1=c.x2,c.y1=c.y2)}class Bb extends Ya{constructor(){super();Ua(this,function(){},function(){},!0);this.y2=this.x2=this.y1=this.x1=this.y=this.x=0}}class Cb{constructor(){this.g=Array(100);this.h=0}}function ob(){var a=U;a.g=Array(65535);a.h=0}class Db{constructor(){this.g=Array(65535);this.h=0}}function Eb(){var a=Fb;a.g=!0;return new Promise(function(b){a.h=function(c){a.g=!1;b(c)}})}class Gb{constructor(){this.h=null;this.g=!1}}function Hb({ma:a,na:b}){switch(pb.g){case 0:n.show_tutorial&&0==R.l&&u.g.j(u.g.create("Need help? Press KeyT for a tutorial.",20,"#f48",0),.5*R.width,2.5*R.o,1);break;case 1:u.g.j(u.g.create("<-- Your character",20,"#f48",0),x.x+110,x.y,1);u.g.j(u.g.create("Your character --\x3e",20,"#f48",0),x.x-110,x.y,1);u.g.j(u.g.create("This is your character. You can control it with these keys:",20,"#f48",0),x.x,x.y-220,1);u.g.j(u.g.create(`${h.up}: up`,20,"#f48",0),x.x,x.y-170,1);u.g.j(u.g.create(`${h.left}: left`,20,"#f48",0),x.x,x.y-130,1);u.g.j(u.g.create(`${h.down}: down`,20,"#f48",0),x.x,x.y-90,1);u.g.j(u.g.create(`${h.right}: right`,20,"#f48",0),x.x,x.y-50,1);u.g.j(u.g.create("You can also control it with mouse. Just",20,"#f48",0),x.x,x.y+50,1);u.g.j(u.g.create("press any mouse button to start or stop moving.",20,"#f48",0),x.x,x.y+70,1);u.g.j(u.g.create("Scroll to change your field of view.",20,"#f48",0),x.x,x.y+110,1);u.g.j(u.g.create("Note that you won't be able to perform some",20,"#f48",0),x.x,x.y+150,1);u.g.j(u.g.create("of the above actions until the tutorial ends.",20,"#f48",0),x.x,x.y+170,1);u.g.j(u.g.create("Press KeyT to continue",20,"#f48",0),x.x,x.y+220,1);break;case 2:u.g.j(u.g.create("--\x3e",20,"#f48",0),a+2*R.o,b-1*R.o,1);u.g.j(u.g.create("--\x3e",20,"#f48",0),a+2*R.o,b,1);u.g.j(u.g.create("--\x3e",20,"#f48",0),a+2*R.o,b+1*R.o,1);u.g.j(u.g.create("<--",20,"#f48",0),a-2*R.o,b-2*R.o,1);u.g.j(u.g.create("<--",20,"#f48",0),a-3*R.o,b-1*R.o,1);u.g.j(u.g.create("<--",20,"#f48",0),a-4*R.o,b,1);u.g.j(u.g.create("<--",20,"#f48",0),a-3*R.o,b+1*R.o,1);u.g.j(u.g.create("<--",20,"#f48",0),a-2*R.o,b+2*R.o,1);u.g.j(u.g.create("These are safezones. Enemies can't",20,"#f48",0),a,b-130,1);u.g.j(u.g.create("reach you inside of these tiles.",20,"#f48",0),a,b-110,1);u.g.j(u.g.create("Press KeyT to continue",20,"#f48",0),a,b+110,1);break;case 3:u.g.j(u.g.create("<--",20,"#f48",0),a-2*R.o,b-2*R.o,1);u.g.j(u.g.create("<--",20,"#f48",0),a-1*R.o,b-3*R.o,1);u.g.j(u.g.create("<--",20,"#f48",0),a,b-4*R.o,1);u.g.j(u.g.create("<--",20,"#f48",0),a-2*R.o,b+2*R.o,1);u.g.j(u.g.create("<--",20,"#f48",0),a-1*R.o,b+3*R.o,1);u.g.j(u.g.create("<--",20,"#f48",0),a,b+4*R.o,1);u.g.j(u.g.create("--\x3e",20,"#f48",0),a+2*R.o,b-3*R.o,1);u.g.j(u.g.create("--\x3e",20,"#f48",0),a+2*R.o,b+3*R.o,1);u.g.j(u.g.create("<--",20,"#f48",0),a+5*R.o,b-2*R.o,1);u.g.j(u.g.create("<--",20,"#f48",0),a+6*R.o,b-1*R.o,1);u.g.j(u.g.create("<--",20,"#f48",0),a+7*R.o,b,1);u.g.j(u.g.create("<--",20,"#f48",0),a+6*R.o,b+1*R.o,1);u.g.j(u.g.create("<--",20,"#f48",0),a+5*R.o,b+2*R.o,1);u.g.j(u.g.create("These are walls. Players can't walk over them.",20,"#f48",0),a,b-40,1);u.g.j(u.g.create("However, some types (colors) of enemies can.",20,"#f48",0),a,b-10,1);u.g.j(u.g.create("Press KeyT to continue",20,"#f48",0),a,b+40,1);break;case 4:u.g.j(u.g.create("--\x3e",20,"#f48",0),a,b,1);u.g.j(u.g.create("This is a teleport tile. If you walk on it,",20,"#f48",0),a,b-130,1);u.g.j(u.g.create("you will be teleported to the area it points to.",20,"#f48",0),a,b-110,1);u.g.j(u.g.create("If instead of an arrow you see a dot, that means you",20,"#f48",0),a,b-70,1);u.g.j(u.g.create("will be teleported to a tile somewhere in the same area.",20,"#f48",0),a,b-50,1);u.g.j(u.g.create("If instead you see an X mark, that teleport does not lead",20,"#f48",0),a,b+50,1);u.g.j(u.g.create("anywhere. Simply, the next area does not exist in that case.",20,"#f48",0),a,b+70,1);u.g.j(u.g.create("Press KeyT to continue",20,"#f48",0),a,b+120,1);break;case 5:u.g.j(u.g.create("Enemy ball --\x3e",20,"#f48",0),a-110,b,1);u.g.j(u.g.create("<-- Enemy ball",20,"#f48",0),a+110,b,1);u.g.j(u.g.create("This is an enemy, also called a ball. A grey ball",20,"#f48",0),a,b-110,1);u.g.j(u.g.create("doesn't do a lot - it simply moves in one direction. However,",20,"#f48",0),a,b-90,1);u.g.j(u.g.create("as you are about to find out when you start exploring the game,",20,"#f48",0),a,b-70,1);u.g.j(u.g.create("there are lots of types of enemies, each having their own color.",20,"#f48",0),a,b-50,1);u.g.j(u.g.create("Coming in contact with an enemy downs you. While downed, you can't move,",20,"#f48",0),a,b+50,1);u.g.j(u.g.create("and after a while, you die, unless other players revive you by touching you.",20,"#f48",0),a,b+70,1);u.g.j(u.g.create("Press KeyT to continue",20,"#f48",0),a,b+120,1);break;case 6:u.g.j(u.g.create(`You can press ${h.settings} to open settings.`,20,"#f48",0),a,b-80,1),u.g.j(u.g.create("There are a lot of cool options to change. Try it out later.",20,"#f48",0),a,b-60,1),u.g.j(u.g.create("That's it for this tutorial. See how far you can go!",20,"#f48",0),a,b+60,1),u.g.j(u.g.create("GLHF!",20,"#f48",0),a,b+80,1),u.g.j(u.g.create("Press KeyT to end the tutorial",20,"#f48",0),a,b+130,1)}}class Ib{constructor(){this.l=this.g=0;this.h=null;this.i=!1}progress(){0==this.g?n.show_tutorial&&H.g&&0==R.l&&(this.g=1,this.l=u.i,yb(P,"Waiting for the tutorial to finish..."),u.i=1.75,F(x,1,!1),F(Jb,1,!1),F(M,4,!1)):this.i&&(this.i=!1,7==++this.g&&(this.h.click(),u.i=this.l,this.stop()))}stop(){this.g=0;P.B();G(x,1);G(Jb,1);G(M,4)}}class Kb{constructor(){this.l=Ea("ID_canvas");this.v=new Ma(this.l);this.g=new Qa(this.l);new Ra(this.l);this.m=new Sa(this.l);this.i=this.h=n.fov.value;this.B=-1;this.D=this.u=0;this.l.canvas.onwheel=this.H.bind(this);this.l.canvas.onmousedown=this.F.bind(this)}H(a){a=.05*-Math.sign(a.deltaY);this.i=1<this.i?this.i+3*a:this.i+a;this.i=da(ca(this.i,n.fov.min),ma)}F(){M.B=!M.B;M.g()}j(a){this.u=da(ca(this.u,K.g[0]),K.g[1]);var b=this.h;this.h=+A(this.h,this.i,.1).toFixed(5);this.h!=b&&M.g();b=K.g[0]==K.g[1]?1:(this.u-K.g[0])/(K.g[1]-K.g[0]);this.u+=a-this.D;this.D=a;L.I.innerHTML=K.J.toFixed(1)+"ms";a=this.l;a.canvas.width!=w.width&&(a.canvas.width=w.width);a.canvas.height!=w.height&&(a.canvas.height=w.height);a.viewport(0,0,a.canvas.width,a.canvas.height);a.clearColor(.2,.2,.2,1);a.clear(D.COLOR_BUFFER_BIT|D.DEPTH_BUFFER_BIT);a.enable(D.DEPTH_TEST);a.enable(D.BLEND);a.blendFunc(D.ONE,D.ONE_MINUS_SRC_ALPHA);a.depthFunc(D.LEQUAL);a=pb;var c=0,d=0;switch(a.g){case 1:c=Q.g[H.id].x2;d=Q.g[H.id].y2;break;case 2:c=.5*R.width-6*R.o;d=.5*R.height;break;case 3:c=.5*R.width+6*R.o;d=.5*R.height;break;case 4:c=.5*R.o;d=.5*R.height;break;case 5:for(c=0;65535>c;++c)if(U.g[c]){var f=U.g[c];break}c=f.x;d=f.y;break;case 6:c=Q.g[H.id].x2,d=Q.g[H.id].y2}if(0!=a.g){f=d;var g=.2*b,k=x;Wa(k,2)&&(k.x2=A(k.x2,c,g),k.y2=A(k.y2,f,g))}ea(x.x-c)<=10*w.g&&ea(x.y-d)<=10*w.g&&(a.i=1);a={ma:c,na:d};x.x=A(x.x1,x.x2,b);x.y=A(x.y1,x.y2,b);R.j();this.v.l=R.i;this.g.l=R.i;this.m.l=R.i;c=0;f=U.h;for(d=0;f;++d)g=U.g[d],void 0!=g&&(--f,g.x=A(g.x1,g.x2,b),C.setFloat32(c,g.x,!0),c+=4,g.y=A(g.y1,g.y2,b),C.setFloat32(c,g.y,!0),c+=4,g.r=A(g.r1,g.r2,b),C.setFloat32(c,g.r,!0),c+=4,C.setUint32(c,ya[g.type]),c+=4);this.v.set(za.slice(0,c),c>>4);this.v.j(n.draw_ball_fill,n.draw_ball_stroke,n.ball_stroke.value/100,n.draw_ball_stroke_bright);c=0;f=Q.h;for(d=0;f;++d)g=Q.g[d],void 0!=g&&(--f,g.x=A(g.x1,g.x2,b),C.setFloat32(c,g.x,!0),c+=4,g.y=A(g.y1,g.y2,b),C.setFloat32(c,g.y,!0),c+=4,g.r=A(g.r1,g.r2,b),C.setFloat32(c,g.r,!0),c+=4,C.setUint32(c,1097458175),c+=4);this.v.set(za.slice(0,c),c>>4);this.v.j(n.draw_player_fill,n.draw_player_stroke,n.player_stroke.value/100,n.draw_player_stroke_bright);f=Q.h;for(b=0;f;++b)c=Q.g[b],void 0!=c&&(--f,n.draw_player_name&&0!=c.name.length&&(c.aa=A(c.aa,10,.1),this.g.j(c.$,c.x,c.y-c.r-c.aa,c.r)),c.R&&Pa(this.g,c.Y,c.x,c.y,c.r));Oa(this.g);if(n.show_target_arrows){c=0;f=U.h;for(b=0;f;++b){d=U.g[b];if(void 0==d)continue;--f;if(!d.ba)continue;g=Math.atan2(Q.g[H.id].y-d.y,Q.g[H.id].x-d.x);const [r,v]=va(d.x,d.y,0,!1);C.setFloat32(c,r,!0);C.setFloat32(c+4,v,!0);C.setFloat32(c+8,Math.cos(g),!0);C.setFloat32(c+12,Math.sin(g),!0);C.setFloat32(c+16,d.r,!0);c+=20}this.m.set(za.slice(0,c),c/20);this.m.j()}if(n.draw_death_arrow)for(f=Q.h,c=0;f;++c)if(d=Q.g[c],void 0!=d&&(--f,d.R)){const [r,v,y]=va(d.x,d.y,.75*Lb.size,!0);if(y){k=Math.atan2(d.y-v,d.x-r);g=Aa(R.i,r,v);b=this.g;var l=-k;k=ba(l);l=aa(l);k=g.multiply(new Float32Array([k,-l,0,l,k,0,0,0,1]));b.l=k;this.g.j(Lb.M,0,0,1);this.g.l=Ba(g,.3*Lb.size/19);Pa(this.g,d.Y,0,0,1);this.g.l=R.i}}Hb(a);Oa(this.g);this.B=requestAnimationFrame(this.j.bind(this))}}function Mb(a){var b=R;let c=0;for(;c<a.length;){var d=a[c++];const g=a[c++],k=a[c++];var f=a[c]|a[c+1]<<8;c+=2;f={oa:f,o:k,width:d*k,height:g*k,W:d,X:g,K:new Uint8Array(d*g*3),T:new Uint8Array(131072),S:new Uint8Array(131072),G:[]};let l=0;for(let r=0;r<d;++r)for(let v=0;v<g;++v){const y=a[c++];2!=y&&(3==y&&(f.G[f.G.length]=[(r+.5)*k,(v+.5)*k,0]),f.K[l++]=r,f.K[l++]=v,f.K[l++]=y)}f.K=f.K.subarray(0,l);for(l=0;;){d=a[c++];if(255==d)break;f.T[l++]=d;f.T[l++]=a[c++]}f.T=f.T.subarray(0,l);for(l=0;;){d=a[c++];if(255==d)break;f.S[l++]=d;f.S[l++]=a[c++]}f.S=f.S.subarray(0,l);for(l=0;l<f.G.length;++l)f.G[l][2]=a[c++];b.m[b.m.length]=f}}class Nb{constructor(){this.g=new La;this.X=this.W=this.o=this.height=this.width=0;this.m=[];this.i=null;this.G=Array(6);const a=q("canvas"),b=a.getContext("2d");a.width=a.height=512;b.fillStyle=b.strokeStyle="#cbb260";b.lineWidth=32;b.lineCap="round";b.arc(256,256,64,0,2*Math.PI);b.fill();this.G[0]=E(this.g,a,512,512);b.beginPath();b.clearRect(0,0,512,512);b.moveTo(256,384);b.lineTo(256,128);b.moveTo(256,128);b.lineTo(128,256);b.moveTo(256,128);b.lineTo(384,256);b.stroke();this.G[1]=E(this.g,a,512,512);b.beginPath();b.clearRect(0,0,512,512);b.moveTo(384,256);b.lineTo(128,256);b.moveTo(128,256);b.lineTo(256,128);b.moveTo(128,256);b.lineTo(256,384);b.stroke();this.G[2]=E(this.g,a,512,512);b.beginPath();b.clearRect(0,0,512,512);b.moveTo(128,256);b.lineTo(384,256);b.moveTo(384,256);b.lineTo(256,128);b.moveTo(384,256);b.lineTo(256,384);b.stroke();this.G[3]=E(this.g,a,512,512);b.beginPath();b.clearRect(0,0,512,512);b.moveTo(256,128);b.lineTo(256,384);b.moveTo(256,384);b.lineTo(128,256);b.moveTo(256,384);b.lineTo(384,256);b.stroke();this.G[4]=E(this.g,a,512,512);b.beginPath();b.clearRect(0,0,512,512);b.moveTo(128,128);b.lineTo(384,384);b.moveTo(384,128);b.lineTo(128,384);b.stroke();this.G[5]=E(this.g,a,512,512);this.l=-1}get h(){return this.m[this.l]}j(){this.g.set(this.h.K,this.h.K.length/3);this.i=Aa(Ba(Aa(new Ca,.5*w.width,.5*w.height),u.h),-x.x,-x.y);this.g.l=Ba(this.i,this.o);this.g.j();u.g.l=this.i;const a=this.o>>1;for(const [b,c,d]of this.h.G)u.g.j({M:this.G[d],w:a,Z:a},b,c,-2);Oa(u.g)}}class Ob{constructor(){this.height=this.width=this.h=this.i=this.g=0;this.l=[0,0];window.onresize=this.m.bind(this);window.onkeyup=this.B.bind(this);window.onkeydown=this.v.bind(this);window.onmousemove=this.D.bind(this);window.onbeforeunload=this.u.bind(this)}m(){if(window.devicePixelRatio!=this.g||window.innerWidth!=this.i||window.innerHeight!=this.h)this.g=window.devicePixelRatio,this.i=window.innerWidth,this.h=window.innerHeight,this.width=this.i*this.g,this.height=this.h*this.g}v(a){if(!a.repeat)if(Fb.g)a.preventDefault(),Fb.h(a.code);else if(a.code==h.settings)Xa(Jb);else if(H.h)switch(a.code){case "Enter":P.focus(a);break;case h.spec_prev:hb(-1);J(K);break;case h.spec_next:hb(1);J(K);break;case h.menu:Xa(L)}else switch(a.code){case "Enter":P.focus(a);break;case h.up:M.v||(M.v=1,M.g());break;case h.down:M.u||(M.u=1,M.g());break;case h.left:M.l||(M.l=1,M.g());break;case h.right:M.m||(M.m=1,M.g());break;case h.slowwalk:1==M.i&&(M.i=n.slowwalk_speed.value/100,M.g());break;case h.menu:Xa(L);break;case "KeyT":pb.progress()}}B(a){if(!a.repeat)switch(a.code){case h.up:M.v&&(M.v=0,M.g());break;case h.down:M.u&&(M.u=0,M.g());break;case h.left:M.l&&(M.l=0,M.g());break;case h.right:M.m&&(M.m=0,M.g());break;case h.slowwalk:1!=M.i&&(M.i=1,M.g())}}D(a){this.l=[a.clientX*this.g,a.clientY*this.g];M.g()}u(a){if(H.g)return a.preventDefault(),a.returnValue="Are you sure you want to quit?"}}function ib(){var a=H;t.innerHTML="Connecting";a.l?(F(L,0,!0),L.name.style.display="none",yb(P,"Waiting for connection...")):(a.l=!0,F(L,99,!1),F(P,99,!1),F(Jb,99,!1))}function tb(){var a=H;a.g=!1;a.h=!1;t.innerHTML="Disconnected";F(L,0,!0);yb(P,"You have been disconnected");a=L;K.once||setTimeout(pa,1E3);a.name.style.display="none";a.u.style.display="none";a.m.style.display="none";a.L.style.display="block";clearInterval(a.ea);F(Jb,99,!1)}class Pb{constructor(){this.i=this.h=this.g=!1;this.id=-1;this.l=!1}m(){G(L,99);G(P,99);G(Jb,99);F(L,0,!0);L.name.style.display="block";t.innerHTML=""}}function Qb(a,b){a.active&=~(b>>>0);e.setItem("tooltips",a.active.toString())}function Rb(a){a.set(1)&&(a.u.innerHTML="We picked a server<br>for you automatically.<br><br>You can change it here.",a.g.style.display="table");a.set(2)&&(a.v.innerHTML="Try out the map editor!<br><br>Submit your maps<br>in our Discord server",a.h.style.display="inline-block");a.set(4)&&(a.B.innerHTML='Try "/help"',a.i.style.display="inline-block")}class Sb{constructor(){const a=e.getItem("tooltips");this.active=a?+a:2147483647;this.g=p("ID_picked_server_for_you");this.u=p("ID_picked_server_for_you_tooltip");L.l.onfocus=function(){Qb(this,1);this.g.style.display="none"}.bind(this);this.h=p("ID_try_map_editor");this.v=p("ID_try_map_editor_tooltip");p("ID_map_editor_click").onclick=function(){Qb(this,2);this.h.style.display="none"}.bind(this);this.i=p("ID_try_typing_help");this.B=p("ID_try_typing_help_tooltip");this.m=function(){Qb(this,4);this.i.style.display="none"}.bind(this);Rb(this)}l(){Qb(this,1);Qb(this,2);Qb(this,4);Rb(this)}set(a){return 0!=(this.active&a>>>0)}}function Tb(a){a.l.innerHTML="";Ub(a,"CHAT");a.add(a.text("Show chat"),X("chat_on",ua(P.P.bind(P))));a.add(a.text("Max number of chat messages"),Y(a,"max_chat_messages","",ua(P.I.bind(P))));a.add(a.text("Chat text scale"),Y(a,"chat_text_scale","",ua(P.L.bind(P))));Ub(a,"MENU");a.add(a.text("Show latency"),X("show_ping",ua(L.fa.bind(L))));Ub(a,"GAME");pb.h=X("show_tutorial");a.add(a.text("Enable tutorial"),pb.h);a.add(a.text("Slow movement speed"),Y(a,"slowwalk_speed","%"));Ub(a,"VISUALS");a.add(a.text("Default FOV"),Y(a,"fov"));a.add(a.text("Draw balls' fill"),X("draw_ball_fill"));a.add(a.text("Draw balls' stroke"),X("draw_ball_stroke"));a.add(a.text("Draw stroke-only balls with brighter color"),X("draw_ball_stroke_bright"));a.add(a.text("Balls' stroke radius percentage"),Y(a,"ball_stroke","%"));a.add(a.text("Draw players' fill"),X("draw_player_fill"));a.add(a.text("Draw players' stroke"),X("draw_player_stroke"));a.add(a.text("Draw stroke-only players with brighter color"),X("draw_player_stroke_bright"));a.add(a.text("Players' stroke radius percentage"),Y(a,"player_stroke","%"));a.add(a.text("Draw players' name"),X("draw_player_name"));a.add(a.text("Draw an arrow towards dead players"),X("draw_death_arrow"));a.add(a.text("Death arrow size"),Y(a,"death_arrow_size","px",ua(Lb.g.bind(Lb))));a.add(a.text("Draw an arrow whenever a ball targets you"),X("show_target_arrows"));a.add(a.text("Target arrow size"),Y(a,"target_arrow_size","",ua(u.m.size.bind(u.m))));a.add(a.text("Target arrow distance from the ball"),Y(a,"target_arrow_dist","",ua(u.m.B.bind(u.m))));a.add(a.text("Target arrow opacity"),Y(a,"target_arrow_opacity","%",ua(u.m.v.bind(u.m))));Ub(a,"KEYBINDS");Vb(a,Wb("h5","To change, click a button on the right side and then press the key you want to assign to it."));a.add(a.text("Settings"),Z("settings"));a.add(a.text("Menu"),Z("menu"));a.add(a.text("Move up"),Z("up"));a.add(a.text("Move left"),Z("left"));a.add(a.text("Move down"),Z("down"));a.add(a.text("Move right"),Z("right"));a.add(a.text("Move slowly"),Z("slowwalk"));a.add(a.text("Spectate the previous player"),Z("spec_prev",function(){db()}));a.add(a.text("Spectate the next player"),Z("spec_next",function(){db()}));a.add(a.text("Free cam"),Z("freecam"));Ub(a,"RESET");a.add(a.text("Reset settings"),a.button("RESET",function(){n=JSON.parse(JSON.stringify(m));la();Tb(this)}.bind(a)));a.add(a.text("Reset keybinds"),a.button("RESET",function(){h=JSON.parse(JSON.stringify(ia));ja();Tb(this)}.bind(a)));a.add(a.text("Reset all tooltips"),a.button("RESET",Ab.l.bind(Ab)));a.end()}function Vb(a,b){a.l.appendChild(b)}function Ub(a,b){a.end();Vb(a,Wb("h1",b));a.g=q("table")}function Wb(a,b){a=q(a);a.innerHTML=b;return a}function X(a,b=function(){}){const c=q("button");n[a]=!n[a];let d=!0;c.onclick=function(){n[a]=!n[a];1==n[a]?(c.innerHTML="ON",c.style["background-color"]="#23c552"):(c.innerHTML="OFF",c.style["background-color"]="#f84f31");la();d?d=!1:b()};c.onclick();return c}function Z(a,b=function(){}){const c=q("button");c.innerHTML=h[a];c.onclick=async function(){c.innerHTML="...";const d=await Eb();c.innerHTML=d;h[a]=d;ja();b()};c.style.color="#000";return c}function Y(a,b,c="",d=function(){}){const f=q("div");f.className="input";const g=q("input");g.type="range";g.min=n[b].min;g.max=n[b].max;g.step=n[b].step;g.value=n[b].value;g.oninput=function(){g.nextElementSibling.innerHTML=g.value+c;n[b].value=g.valueAsNumber;d()};g.onchange=la;f.appendChild(g);f.appendChild(a.text(g.value+c));return f}class Xb extends Ya{constructor(){super();this.i=p("ID_settings_container");this.l=p("ID_settings");Ua(this,function(){F(M,2,!1);this.i.style.display="block"}.bind(this),function(){this.i.style.display="none";G(M,2)}.bind(this),!1);this.g=null;Tb(this)}add(a,b){const c=q("tr");let d=q("td");d.appendChild(a);c.appendChild(d);d=q("td");d.appendChild(b);b.onchange=la;c.appendChild(d);this.g.appendChild(c)}end(){null!=this.g&&(Vb(this,this.g),this.g=null)}text(a){return Wb("h3",a)}button(a,b){const c=q("button");c.innerHTML=a;c.onclick=b;return c}}var M,L,K,N,I,Lb,P,x,Q,U,Fb,pb,u,R,w,H,Ab,Jb;(async function(){var a=new Uint8Array(await (await fetch("memory.mem",{cache:"force-cache"})).arrayBuffer());await document.fonts.ready;M=new Za;L=new fb;K=new nb;N=new vb(1048576);I=new vb(129);Lb=new wb;P=new zb;x=new Bb;Q=new Cb;U=new Db;Fb=new Gb;pb=new Ib;u=new Kb;R=new Nb;w=new Ob;H=new Pb;Ab=new Sb;Jb=new Xb;wa=!0;w.m();Mb(a);ib();let b;const c=new Promise(function(g){b=g});a=[];for(var [,,d]of L.H)a[a.length]=new jb(d,b);setTimeout(b,2E3,"");d=await c;if(0==d.length){d=0;for(const g of a)if(g.C.readyState==WebSocket.OPEN&&g.U>d){d=g.U;var f=g.C.url}}else f=d;for(const g of a)g.C.url!=f?g.stop():kb(g);if(void 0==f){f=1;for(const g of a)if(4E3!=g.code){f=0;break}t.innerHTML=f?"Couldn't connect to any server - all servers are full":"Couldn't connect to any server";setTimeout(pa,1E3);throw Error(t.innerHTML);}bb()})();}()