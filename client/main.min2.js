const e=window.localStorage,f=e.getItem.bind(e),aa=e.setItem.bind(e),ba=f("keybinds"),k={settings:"Escape",up:"KeyW",left:"KeyA",right:"KeyD",down:"KeyS",slowwalk:"ShiftLeft",minimap:"KeyM"};let l=null!=ba?JSON.parse(ba):k;for(const a in k)a in l||(l[a]=k[a]);for(const a in l)a in k||delete l[a];function ca(){aa("keybinds",JSON.stringify(l))}const da=f("settings"),m={fov:{min:.25,max:1.75,value:1.75,step:.05},chat_on:!0,max_chat_messages:{min:1,max:1E3,value:100,step:1},chat_text_scale:{min:1,max:2,value:1,step:.05},draw_ball_fill:!0,draw_ball_stroke:!0,draw_ball_stroke_bright:!0,ball_stroke:{min:0,max:100,value:20,step:1},draw_player_fill:!0,draw_player_stroke:!0,draw_player_stroke_bright:!0,player_stroke:{min:0,max:100,value:10,step:1},draw_player_name:!0,draw_death_arrow:!0,death_arrow_size:{min:10,max:100,value:40,step:1},show_tutorial:!0,show_ping:!1};let n=null!=da?JSON.parse(da):JSON.parse(JSON.stringify(m));for(const a in m)a in n||(n[a]=m[a]);for(const a in n)a in m?(n[a].min&&n[a].min!=m[a].min&&(n[a].min=m[a].min),n[a].max&&n[a].max!=m[a].max&&(n[a].max=m[a].max),n[a].step&&n[a].step!=m[a].step&&(n[a].step=m[a].step),n[a].value=Math.max(Math.min(n[a].value,n[a].max),n[a].min)):delete n[a];function p(){aa("settings",JSON.stringify(n))}const q=document.getElementById.bind(document),r=document.createElement.bind(document),t=q("ID_status"),ea=f("token");let u=[];"string"==typeof ea&&(u=ea.split(",").map(a=>+a));function fa(){setTimeout(location.reload.bind(location),1E3)}function ha(a){return"#"+(.8*parseInt(a.substring(1,3),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(a.substring(3,5),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(a.substring(5,7),16)>>0).toString(16).padStart(2,"0")+a.substring(7)}function ia(a){const b=a.match(/\/\/(.*?)\.shadam\.xyz/),c=a.match(/\/\/(.*?)[\/:]/);return b?b[1]:c?c[1]:a}WebSocket.prototype.send=new Proxy(WebSocket.prototype.send,{apply:function(a,b,c){if(b.readyState==WebSocket.OPEN)return a.apply(b,c)},configurable:!0,enumerable:!0});WebSocket.prototype.close=new Proxy(WebSocket.prototype.close,{apply:function(a,b,c){if(b.readyState==WebSocket.CONNECTING||b.readyState==WebSocket.OPEN)return a.apply(b,c)},configurable:!0,enumerable:!0});function ja(a){return function(b){console.log(b);const c=b instanceof ClipboardEvent;if(!c||"paste"==b.type){var d=b.target.value+(c?b.clipboardData.getData("text"):b.key);if((new TextEncoder).encode(d).byteLength>a){if(""==b.target.value&&c){const g=b.target.placeholder;b.target.placeholder="Text too long to paste!";setTimeout(function(){b.target.placeholder=g},1E3)}b.preventDefault()}}}}function ka(a,b){var c=.75*v.size;c*=x.h;a=.5*x.width+(a-y.x)*x.h;const d=.5*x.height+(b-y.y)*x.h;b=!1;if(0>a||a>x.width-0)b=!0,a=Math.max(Math.min(a,x.width-c),c);0>d||d>x.height-0?(b=!0,c=Math.max(Math.min(d,x.height-c),c)):c=d;return[(a-.5*x.width)/x.h+y.x,(c-.5*x.height)/x.h+y.y,b]}function z(a,b,c){return a+(b-a)*c}if(0==window.s.length)throw t.innerHTML="No servers found",fa(),Error(t.innerHTML);t.innerHTML="Connecting";const la=["#dddddd","#aaaaaa","#333333","#fedf78"],ma="#808080 #fc46aa #008080 #ff8e06 #3cdfff #663a82".split(" ");function na(a){a.h.innerHTML="";for(const b of a.m){const c=r("option");c.value=b[2];b[2]==B.v.url&&(c.selected=!0,c.disabled=!0,a.g=c);b[0]>=b[1]&&(c.disabled=1);const d=ia(b[2]);c.innerHTML=d[0].toUpperCase()+d.substring(1)+` (${b[0]}/${b[1]})`;a.h.appendChild(c)}a.h.onfocus=function(){this.B.style.display="none"}.bind(a);a.h.onchange=async function(){this.g.disabled=!1;const b=this.g;this.g=this.h.selectedOptions[0];this.g.disabled=!0;oa();let c;const d=new Promise(function(h){c=h}),g=new pa(this.g.value,c,1);setTimeout(c,2E3);await d;0==g.I||g.v.readyState!=WebSocket.OPEN?(g.stop(),t.innerHTML="Couldn't connect, returning to previous server",this.g.disabled=!1,this.g=b,this.g.disabled=!0,setTimeout(E.j.bind(E),1E3)):qa(g)}.bind(a);f("psfy_tooltip")||(a.C.innerHTML="We picked a server<br>for you automatically.<br><br>You can change it here.",a.B.style.display="table")}function ra(){var a=F;na(a);a.A=setInterval(function(){fetch("servers.json").then(b=>b.json()).then(function(b){F.m=b;na(F)})},5E3)}function G(){F.i.style.display="block"}class sa{constructor(){this.i=q("ID_menu");this.name=q("ID_name");this.h=q("ID_select_serv");this.g=null;this.m=window.s;this.B=q("ID_picked_server_for_you");this.C=q("ID_picked_server_for_you_tooltip");this.j=q("ID_ping");this.j.style.display=n.show_ping?"block":"none";this.o=q("ID_play");this.u=q("ID_refresh");this.u.onclick=location.reload.bind(location);this.name.onkeypress=this.name.onpaste=ja(16);this.name.onchange=function(){E.i=!1;aa("name",this.value)};this.A=-1;const a=f("name");"string"==typeof a&&16>=(new TextEncoder).encode(a).length&&(this.name.value=a);this.o.onclick=function(){var b=H;ta(b);b.g[0]=0;b.h=1;I(B)}}}function I(a){a.v.send(H.g.subarray(0,H.h))}function qa(a){var b=B;null!=b.v&&(b.stop(),b.once=!1,b.i=!1,b.g=[0,0]);b.G=a.G;b.J=a.J;b.D=a.D;b.l=a.l;b.v=a.v;b.v.onmessage=b.message.bind(b);b.v.onclose=b.close.bind(b);a=H;0==u.length?a.h=1:(a.g.set(u),a.h=u.length);I(b);b.h()}function ua(a){a.G[a.l]=(new Date).getTime()-a.J;a.D=0;let b=a.l,c=0;for(let d=0;10>d;++d)0!=a.G[b]&&(a.D+=(10-c)/11*a.G[b],++c),b=(b+1)%10;0!=c&&(a.D/=.5*c);a.l=(a.l+1)%10;setTimeout(a.j.bind(a),10)}class va{constructor(){this.v=null;this.i=this.once=!1;this.G=Array(10).fill(0);this.l=this.D=this.J=0;this.g=[0,0]}h(){this.once=!0;var a=J;a.j=Array(5).fill(0);a.i=0;a.B=Array(2).fill(0);a.o=0;a.h.innerHTML="";a.m=0;a.A=!1;a.F="Press enter to chat";a.C();y.g=!1;K.g=Array(100);N.g=Array(65535);a=x;a.h=n.fov.value;a.j=a.h;a.u=0;cancelAnimationFrame(a.o);a.o=-1;a.B=!1;a.m=0;a.A=0;a=P;a.g=!1;a.o=!1;a.u=1;a.h=1;a=E;a.g=!1;a.h=!1;a.i=!1;a.id=-1}message({data:a}){H.set(new Uint8Array(a));if(0==H.h)ua(this);else{H.l=1;this.g[0]=this.g[1];this.g[1]=performance.now();a=K;for(var b=0;100>b;++b)void 0!=a.g[b]&&(a.g[b].x1=a.g[b].x2,a.g[b].y1=a.g[b].y2,a.g[b].r1=a.g[b].r2);a=N;for(b=0;65535>b;++b)void 0!=a.g[b]&&(a.g[b].x1=a.g[b].x2,a.g[b].y1=a.g[b].y2,a.g[b].r1=a.g[b].r2);for(wa(y);H.l<H.h;)switch(Q()){case 0:N.g=Array(65535);wa(y);a=R;Q();var c=Q(),d=Q();b=Q();var g=n.fov.max,h=b*g,A=Array(Q());for(var w=0;w<A.length;++w)A[w]=[(Q()+.5)*h,(Q()+.5)*h,Q()];w=Array(256);var C=Array(256);for(var L=0;L<c;++L)for(var M=0;M<d;++M){const O=H.g[H.l];2!=O&&(void 0==w[O]&&(w[O]=new Path2D,C[O]=new Path2D),w[O].rect((1.5+L*b)*g,(1.5+M*b)*g,(b-3)*g,(b-3)*g),C[O].rect(L*h,M*h,h,h));++H.l}E.id=Q()-1;(h=Q())&&!E.g?(E.g=!0,F.i.style.display="none"):!h&&E.g&&(E.g=!1,G(),P.o=!1);(h=Q())&&!E.h?(E.h=!0,F.i.style.display="none"):!h&&E.h&&(E.h=!1,G(),P.o=!1);a.width=c*b;a.height=d*b;a.h.width=a.width*g;a.h.height=a.height*g;a.i.width=a.h.width;a.i.height=a.h.height;for(c=0;256>c;++c)void 0!=w[c]&&(a.g.fillStyle=la[c]+"b0",a.g.fill(C[c]),a.g.fillStyle=la[c],a.g.fill(w[c]),a.j.fillStyle=la[c],a.j.fill(C[c]));a.g.font=`700 ${b}px Ubuntu`;a.g.textAlign="center";a.g.textBaseline="middle";a.g.fillStyle=ha(la[3]);for(var D of A)a.g.fillText(D[2],D[0],D[1]);break;case 1:a=K;b=Q();for(A=0;A<b;++A)if(c=Q(),void 0==a.g[c])d=S(),g=S(),w=S(),C=Q(),C=xa(C),h=Q(),L=0,h&&(L=Q()),M=Q(),0<M&&ya(J,C,xa(M)),a.g[c]={x:0,y:0,r:0,x1:d,x2:d,y1:g,y2:g,r1:w,r2:w,name:C,K:h,L,M:!0},E.id==c&&(c=y,c.g||(c.x2=d,c.y2=g));else if(d=Q(),0==d)delete a.g[c];else{do{switch(d){case 1:a.g[c].x2=S();E.id==c&&(d=y,d.g||(d.x2=a.g[c].x2));break;case 2:a.g[c].y2=S();E.id==c&&(d=y,d.g||(d.y2=a.g[c].y2));break;case 3:a.g[c].r2=S();break;case 4:a.g[c].K=Q();a.g[c].K&&(a.g[c].L=Q());break;case 5:d=Q();ya(J,a.g[c].name,xa(d));break;default:throw Error();}d=Q()}while(d)}break;case 2:a=N;b=za();for(A=0;A<b;++A)if(c=za(),void 0==a.g[c])d=Q()-1,g=S(),w=S(),C=S(),a.g[c]={type:d,x:0,y:0,r:0,x1:g,x2:g,y1:w,y2:w,r1:C,r2:C,M:!1};else if(d=Q(),0==d)delete a.g[c];else{do{switch(d){case 1:a.g[c].x2=S();break;case 2:a.g[c].y2=S();break;case 3:a.g[c].r2=S();break;default:throw Error();}d=Q()}while(d)}break;case 3:a=J;b=Q();for(A=0;A<b;++A)d=Q(),c=(new TextDecoder).decode(H.g.subarray(H.l,H.l+d)),H.l+=d,d=Q(),ya(a,c,(new TextDecoder).decode(H.g.subarray(H.l,H.l+d))),H.l+=d;break;default:throw Error();}if(H.l>H.h)throw Error();-1==E.id&&(D=y,a=.5*R.height,D.g||(D.x2=.5*R.width,D.y2=a),wa(D));0==this.g[0]||this.i||(this.i=!0,D=x,D.o=window.requestAnimationFrame(D.C.bind(D)),E.j())}}close(a){4E3==a?(Aa(),t.innerHTML="Server is full"):Aa()}j(){this.J=(new Date).getTime();this.v.send(new Uint8Array(0))}stop(){this.v.onopen=this.v.onmessage=this.v.onclose=null;this.v.close()}}function Ba(a){a.v=new WebSocket(a.m);a.v.binaryType="arraybuffer";a.v.onopen=a.h.bind(a);a.v.onmessage=a.message.bind(a);a.v.onclose=a.close.bind(a)}class pa extends va{constructor(a,b,c=8){super();this.I=0;this.o=c;this.u=b;this.m=a;Ba(this)}h(){this.j()}message(){ua(this);++this.I==this.o&&this.u(this.v.url)}close(){Ba(this)}}function Q(){var a=H;return a.g[a.l++]}function za(){var a=H;const b=a.g[a.l]|a.g[a.l+1]<<8;a.l+=2;return b}function S(){var a=H;const b=a.view.getFloat32(a.l,!0);a.l+=4;return b}function xa(a){var b=H;const c=(new TextDecoder).decode(b.g.subarray(b.l,b.l+a));b.l+=a;return c}function ta(a){if(!E.i){E.i=!0;a.g[0]=3;var b=F;b=(new TextEncoder).encode(b.name.value);a.g.set(b,1);a.h=b.length+1;I(B)}}class Ca{constructor(){this.i=new ArrayBuffer(1048576);this.g=new Uint8Array(this.i);this.view=new DataView(this.i);this.l=this.h=0}set(a){this.g.set(a);this.h=a.length;this.l=0}}function Da(a){var b=v;a.drawImage(b.h,.5*-b.h.width,.5*-b.h.height)}class Ea{constructor(){this.h=r("canvas");this.g=this.h.getContext("2d");this.size=0;this.i()}i(){this.size=n.death_arrow_size.value;this.h.width=this.h.height=this.size;const a=.5*this.h.width,b=this.h.width;this.g.beginPath();this.g.moveTo(a+.45*b,a);this.g.lineTo(a-.225*b,a-.675*b/Math.sqrt(3));this.g.lineTo(a-.225*b,a+.675*b/Math.sqrt(3));this.g.closePath();this.g.fillStyle="#bbbbbbb0";this.g.fill();this.g.lineWidth=.1*a;this.g.strokeStyle="#f00";this.g.stroke()}}function Fa(a,b){a.F=a.g.placeholder;a.g.placeholder=b;a.g.disabled=!0;a.g.value="";x.i.focus()}function Ga(){var a=J;!a.A&&n.chat_on&&(a.H.style.display="block")}function ya(a,b,c){const d=r("p");d.appendChild(document.createTextNode(b+": "+c));a.h.insertBefore(d,a.h.firstChild);++a.m>n.max_chat_messages.value&&a.h.removeChild(a.h.lastChild)}class Ha{constructor(){this.j=Array(5).fill(0);this.i=0;this.B=Array(2).fill(0);this.o=0;this.H=q("ID_chat");this.h=q("ID_messages");this.g=q("ID_sendmsg");this.P=ja(128);this.m=0;this.A=!1;this.F="";this.u=-1;this.g.onkeydown=function(a){a.stopPropagation();if("Enter"==a.code){var b=(new TextEncoder).encode(this.g.value.trim());if(0<b.length){a=b;var c=H;ta(c);c.g[0]=2;c.g.set(a,1);c.h=a.length+1;I(B);this.j[this.i]=(new Date).getTime();this.B[this.o]=b.length;a=(this.i+1)%5;c=this.j[this.i]-this.j[a];this.o=(this.o+1)%2;b=0;for(let d=0;2>d;++d)b+=this.B[d];b*=1E3/(this.j[this.i]-this.j[(this.i+5-2)%5]);this.i=a;5E3>c||20<b?(Fa(this,"You are on cooldown for sending too many messages too quickly"),this.u=setTimeout(this.C.bind(this),Math.max(5E3-c,100*(b-20)))):(this.g.value="",this.g.blur(),x.i.focus())}}}.bind(this);this.g.onkeyup=function(a){a.stopPropagation()};this.g.onkeypress=this.g.onpaste=this.P}C(){-1!=this.u&&(clearTimeout(this.u),this.u=-1);this.g.disabled=!1;this.g.placeholder=this.F}focus(){this.g.focus()}N(){for(;this.m>n.max_chat_messages.value;)this.h.removeChild(this.h.lastChild),--this.m}O(){this.h.style["font-size"]=n.chat_text_scale.value+"em"}}function wa(a){a.x1=a.x2;a.y1=a.y2}class Ia{constructor(){this.y2=this.x2=this.y1=this.x1=this.y=this.x=0;this.g=!1}block(){this.g=!0}}class Ja{constructor(){this.g=Array(100)}}class Ka{constructor(){this.g=Array(65535)}}function La(){var a=Ma;a.g=!0;return new Promise(function(b){a.h=function(c){a.g=!1;b(c)}})}class Na{constructor(){this.h=null;this.g=!1}}function Oa(a){a.m.innerHTML="";T(a,"CHAT");a.add(a.text("Show chat"),U("chat_on",function(b){b?Ga():(b=J,b.A||(b.H.style.display="none"))}));a.add(a.text("Max number of chat messages"),V(a,"max_chat_messages","",J.N.bind(J)));a.add(a.text("Chat text scale"),V(a,"chat_text_scale","",J.O.bind(J)));T(a,"MENU");a.add(a.text("Show latency"),U("show_ping",function(b){F.j.style.display=b?"block":"none"}));T(a,"GAME");a.add(a.text("Enable tutorial"),U("show_tutorial"));T(a,"VISUALS");a.add(a.text("Default FOV"),V(a,"fov"));a.add(a.text("Draw balls' fill"),U("draw_ball_fill"));a.add(a.text("Draw balls' stroke"),U("draw_ball_stroke"));a.add(a.text("Draw stroke-only balls with brighter color"),U("draw_ball_stroke_bright"));a.add(a.text("Balls' stroke radius percentage"),V(a,"ball_stroke","%"));a.add(a.text("Draw players' fill"),U("draw_player_fill"));a.add(a.text("Draw players' stroke"),U("draw_player_stroke"));a.add(a.text("Draw stroke-only players with brighter color"),U("draw_player_stroke_bright"));a.add(a.text("Players' stroke radius percentage"),V(a,"player_stroke","%"));a.add(a.text("Draw players' name"),U("draw_player_name"));a.add(a.text("Draw an arrow towards dead players"),U("draw_death_arrow"));a.add(a.text("Death arrow size"),V(a,"death_arrow_size","px",v.i.bind(v)));T(a,"KEYBINDS");Pa(a,Qa("h5","To change, click a button on the right side and then press the key you want to asign to it."));a.add(a.text("Settings"),W("settings"));a.add(a.text("Move up"),W("up"));a.add(a.text("Move left"),W("left"));a.add(a.text("Move down"),W("down"));a.add(a.text("Move right"),W("right"));a.add(a.text("Move slowly"),W("slowwalk"));a.add(a.text("Big minimap"),W("minimap"));T(a,"RESET");a.add(a.text("Reset settings"),a.button("RESET",function(){n=m;p();Oa(this)}.bind(a)));a.add(a.text("Reset keybinds"),a.button("RESET",function(){l=k;ca();Oa(this)}.bind(a)));a.end()}function Ra(a){a.g||(a.i=!1,a.j.style.display="none",P.g=!1,P.start())}function Pa(a,b){a.m.appendChild(b)}function T(a,b){a.end();Pa(a,Qa("h1",b));a.h=r("table")}function Qa(a,b){a=r(a);a.innerHTML=b;return a}function U(a,b=function(){}){const c=r("button");n[a]=!n[a];let d=!0;c.onclick=function(){n[a]=!n[a];1==n[a]?(c.innerHTML="ON",c.style["background-color"]="#23c552"):(c.innerHTML="OFF",c.style["background-color"]="#f84f31");p();d?d=!1:b(n[a])};c.onclick();return c}function W(a){const b=r("button");b.innerHTML=l[a];b.onclick=async function(){b.innerHTML="...";const c=await La();b.innerHTML=c;l[a]=c;ca()};b.style.color="#000";return b}function V(a,b,c="",d=function(){}){const g=r("div");g.className="input";const h=r("input");h.type="range";h.min=n[b].min;h.max=n[b].max;h.step=n[b].step;h.value=n[b].value;h.oninput=function(){h.nextElementSibling.innerHTML=h.value+c;n[b].value=h.valueAsNumber;d()};h.onchange=p;g.appendChild(h);g.appendChild(a.text(h.value+c));return g}class Sa{constructor(){this.j=q("ID_settings_container");this.m=q("ID_settings");this.g=this.i=!1;this.h=null;Oa(this)}add(a,b){const c=r("tr");let d=r("td");d.appendChild(a);c.appendChild(d);d=r("td");d.appendChild(b);b.onchange=p;c.appendChild(d);this.h.appendChild(c)}end(){null!=this.h&&Pa(this,this.h)}text(a){return Qa("h3",a)}button(a,b){const c=r("button");c.innerHTML=a;c.onclick=b;return c}}class Ta{constructor(){this.h=r("canvas");this.g=this.h.getContext("2d");this.i=r("canvas");this.j=this.i.getContext("2d");this.height=this.width=0}}class Ua{constructor(){this.i=q("ID_canvas");this.g=this.i.getContext("2d");this.height=this.width=0;this.j=this.h=n.fov.value;this.u=0;this.o=-1;this.B=!1;this.A=this.m=0;this.i.onwheel=this.H.bind(this);this.i.onmousedown=this.F.bind(this)}stop(){this.B=!0;this.i.parentElement.removeChild(this.i)}H(a){a=.05*-Math.sign(a.deltaY);this.j=1<this.j?this.j+3*a:this.j+a;this.j=Math.min(Math.max(this.j,n.fov.min),n.fov.max)}F(){P.o=!P.o;X(P)}text(a,b,c){this.g.font="700 20px Ubuntu";this.g.textAlign="center";this.g.textBaseline="middle";this.g.fillStyle="#fff";this.g.strokeStyle="#333";this.g.lineWidth=1;this.g.fillText(a,b,c);this.g.strokeText(a,b,c)}C(a){if(!this.B){this.m=Math.min(Math.max(this.m,B.g[0]),B.g[1]);var b=this.h;this.h=z(this.h,this.j,.1);this.h!=b&&X(P);b=B.g[0]==B.g[1]?1:(this.m-B.g[0])/(B.g[1]-B.g[0]);this.m+=a-this.A;this.A=a;n.show_ping&&(F.j.innerHTML=B.D.toFixed(1)+"ms");y.x=z(y.x1,y.x2,b);y.y=z(y.y1,y.y2,b);this.g.resetTransform();this.g.fillStyle="#333";this.g.fillRect(0,0,this.i.width,this.i.height);this.g.translate(.5*this.i.width,.5*this.i.height);this.g.scale(this.h,this.h);this.g.translate(-y.x,-y.y);this.g.drawImage(R.h,0,0,R.width,R.height);1>this.h&&(this.g.globalAlpha=1-4*(this.h-n.fov.min)/3,this.g.drawImage(R.i,0,0,R.width,R.height),this.g.globalAlpha=1);a=Array(65635);var c=0;if(n.draw_player_fill||n.draw_player_stroke)for(var d=0;100>d;++d)void 0!=K.g[d]&&(K.g[d].x=z(K.g[d].x1,K.g[d].x2,b),K.g[d].y=z(K.g[d].y1,K.g[d].y2,b),K.g[d].r=z(K.g[d].r1,K.g[d].r2,b),a[c++]=K.g[d]);if(n.draw_ball_fill||n.draw_ball_stroke)for(d=0;65535>d;++d)void 0!=N.g[d]&&(N.g[d].x=z(N.g[d].x1,N.g[d].x2,b),N.g[d].y=z(N.g[d].y1,N.g[d].y2,b),N.g[d].r=z(N.g[d].r1,N.g[d].r2,b),a[c++]=N.g[d]);a.sort((g,h)=>h.r-g.r);for(b=0;b<a.length;++b)if(void 0!=a[b])if(this.g.beginPath(),c=a[b],c.M){if(d=n.player_stroke.value/200*c.r,this.g.moveTo(c.x+c.r-d,c.y),this.g.arc(c.x,c.y,c.r-d,0,2*Math.PI),n.draw_player_fill&&(this.g.fillStyle="#ebecf0",this.g.fill()),n.draw_player_stroke&&(!n.draw_player_fill&&n.draw_player_stroke_bright?this.g.strokeStyle="#ebecf0":this.g.strokeStyle=ha("#ebecf0"),this.g.lineWidth=2*d,this.g.stroke()),n.draw_player_name&&0!=c.name.length&&(this.g.font=`700 ${c.r/this.h}px Ubuntu`,this.g.textAlign="center",this.g.textBaseline="middle",this.g.fillStyle="#00000080",this.u=z(this.u,1<this.h?.5*c.r:.5*c.r+2/(this.h*this.h),.1),this.g.fillText(c.name,c.x,c.y-c.r-this.u)),c.K&&(this.g.font=`700 ${c.r/Math.min(this.h,1)}px Ubuntu`,this.g.textAlign="center",this.g.textBaseline="middle",this.g.fillStyle="#f00",this.g.fillText(c.L,c.x,c.y),n.draw_death_arrow)){const [g,h,A]=ka(c.x,c.y);A&&(this.g.translate(g,h),d=Math.atan2(c.y-h,c.x-g),this.g.rotate(d),Da(this.g),this.g.rotate(-d),this.g.font=`700 ${.3*v.size}px Ubuntu`,this.g.fillText(c.L,0,0),this.g.translate(-g,-h))}}else d=n.ball_stroke.value/200*c.r,this.g.moveTo(c.x+c.r-d,c.y),this.g.arc(c.x,c.y,c.r-d,0,2*Math.PI),n.draw_ball_fill&&(this.g.fillStyle=ma[c.type],this.g.fill()),n.draw_ball_stroke&&(this.g.strokeStyle=!n.draw_ball_fill&&n.draw_ball_stroke_bright?ma[c.type]:ha(ma[c.type]),this.g.lineWidth=2*d,this.g.stroke());this.o=window.requestAnimationFrame(this.C.bind(this))}}}class Va{constructor(){this.h=this.i=this.g=0;this.j=[0,0];window.onresize=this.m.bind(this);window.onkeyup=this.A.bind(this);window.onkeydown=this.u.bind(this);window.onmousemove=this.B.bind(this);window.onbeforeunload=this.o.bind(this)}m(){if(window.devicePixelRatio!=this.g||window.innerWidth!=this.i||window.innerHeight!=this.h){this.g=window.devicePixelRatio;this.i=window.innerWidth;this.h=window.innerHeight;var a=x;a.width=Y.i*Y.g;a.height=Y.h*Y.g;a.i.width=a.width;a.i.height=a.height}}u(a){if(!a.repeat)if(Ma.g)a.preventDefault(),Ma.h(a.code);else if(a.code==l.settings)Z.i?Ra(Z):(a=Z,a.g||(a.i=!0,a.j.style.display="block",P.stop(),P.block()));else switch(a.code){case "Enter":J.focus(a);break;case l.slowwalk:1==P.u&&(Wa(.5),X(P));break;case l.up:P.A||(P.A=1,X(P));break;case l.down:P.m||(P.m=1,X(P));break;case l.left:P.i||(P.i=1,X(P));break;case l.right:P.j||(P.j=1,X(P))}}A(a){if(!a.repeat)switch(a.code){case l.slowwalk:.5==P.u&&(Wa(1),X(P));break;case l.up:P.A&&(P.A=0,X(P));break;case l.down:P.m&&(P.m=0,X(P));break;case l.left:P.i&&(P.i=0,X(P));break;case l.right:P.j&&(P.j=0,X(P))}}B(a){this.j=[a.clientX*this.g,a.clientY*this.g];X(P)}o(a){if(E.g)return a.preventDefault(),a.returnValue="Are you sure you want to quit?",p(),"Are you sure you want to quit?"}}function X(a){if(E.g&&!a.g){a=H;let c=0;var b=0;if(P.o){b=Y.j[0]-.5*x.i.width;const d=Y.j[1]-.5*x.i.height;c=Math.atan2(d,b);b=Math.hypot(b,d)/x.h}else if(P.A!=P.m||P.i!=P.j)c=Math.atan2(P.m-P.A,P.j-P.i),b=160*Y.g;a.g[0]=1;a.view.setFloat32(1,c,!0);a.g[5]=b>=160*Y.g?255*P.h:1.59375*b/Y.g*P.h;a.h=6;I(B)}}function Wa(a){var b=P;b.g||(b.h=a);b.u=a}class Xa{constructor(){this.o=!1;this.h=this.u=1;this.g=!1;this.j=this.i=this.m=this.A=0}block(){this.g=!0}stop(){this.g||(this.u=this.h,this.h=0,X(this))}start(){this.g||(this.h=this.u,X(this))}}function oa(){G();F.name.style.display="none";t.innerHTML="Connecting";Ga();Fa(J,"Waiting for connection...");var a=Z;a.i&&(a.g=!1,Ra(a));a.g=!0}function Aa(){E.g=!1;G();F.name.style.display="none";t.innerHTML="Disconnected";var a=F;B.once||fa();a.o.style.display="none";a.u.style.display="block";clearInterval(a.A)}class Ya{constructor(){this.i=this.h=this.g=!1;this.id=-1}j(){G();F.name.style.display="block";t.innerHTML="";J.C();Z.g=!1}}const F=new sa,B=new va,H=new Ca,v=new Ea,J=new Ha,y=new Ia,K=new Ja,N=new Ka,Ma=new Na,Z=new Sa,R=new Ta,x=new Ua,Y=new Va,P=new Xa,E=new Ya;Y.m();(async function(){oa();let a;var b=new Promise(function(g){a=g});const c=[];for(const [,,g]of F.m)c[c.length]=new pa(g,a);setTimeout(a,2E3,"");b=await b;let d;if(0==b.length){b=0;for(const g of c)g.v.readyState==WebSocket.OPEN&&g.I>b&&(b=g.I,d=g.v.url)}else d=b;if(void 0==d)throw t.innerHTML="Couldn't connect to any server",fa(),Error(t.innerHTML);for(const g of c)g.v.url!=d?g.stop():qa(g);ra()})();