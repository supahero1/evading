let d=document.getElementById("loading");d.innerHTML="Fetching servers...";let aa=document.getElementById("sub"),f=document.getElementById("name"),g=document.getElementById("canvas"),k=g.getContext("2d"),m=document.createElement("canvas"),p=m.getContext("2d"),r=document.createElement("canvas"),ba=r.getContext("2d"),ca=0,t=["#dddddd","#aaaaaa","#333333","#fedf78"],u=0,w=0,x=0,da=new ArrayBuffer(524288),y=new Uint8Array(da),z=new DataView(y.buffer),A=0,B=0,C=Array(256);var ea=0,fa=0,ha=0,D=0,ia=0,E=0;let F=[0,0],G=null,H=0,J=0,ja=0;var K=0,L=0,M=0,N=0,O=1,P=0,ka=0,Q=0,R=0,S=0,V=[],W=[];let X=1,Y=X,Z=[0,0];window.s.then(e=>e.json()).then(e=>la(e));function na(){setTimeout(location.reload.bind(location),1E3)}function la(e){if(0==e.length)d.innerHTML="No servers found",na();else{d.innerHTML="Connecting...";var l=e.map(function(h){h=new WebSocket(h[1]);h.binaryType="arraybuffer";h.i=[];h.onopen=function(){this.send(new Uint8Array(0));this.time=performance.now()};h.onmessage=function(){this.i[this.i.length]=performance.now()-this.time;5>this.i.length&&this.send(new Uint8Array(0))};return h});setTimeout(function(){let h=999999,n=null;for(let c of l){c.h=0;for(let T of c.i)c.h+=T;0<c.i.length?c.h/=c.i.length:c.h=999999;c.h<h&&(h=c.h,n=c)}for(let c of l)c.onopen=function(){},c.onmessage=function(){},delete c.i,delete c.time,delete c.h,c!=n&&c.close();null==n||1!=n.readyState?(d.innerHTML="Failed connecting",na()):oa(n)},1E3)}}function pa(){ha=D;ia=E;for(let e of C)e&&(e.g.x1=e.g.x2,e.g.y1=e.g.y2,e.g.r1=e.g.r2)}function oa(e){d.innerHTML="Enter your name<br>";aa.innerHTML="You are limited to 4 characters<br>Special characters might not fit<br>Press enter when you are done";f.style.display="block";f.onkeypress=f.onblur=f.onpaste=function(l){let h=l.target.value+l.key;4<(new TextEncoder).encode(h).byteLength?l.target.value=l.target.j||"":(l.target.value=h,l.target.j=h);l.preventDefault();return!1};e.onclose=function(){window.onbeforeunload=function(){};g.parentElement.removeChild(g);d.innerHTML="Disconnected";na()};window.onkeydown=function(l){13==(l.keyCode||l.which)&&(d.innerHTML="Spawning...",aa.innerHTML="",f.style.display="none",e.send(new Uint8Array([0,...(new TextEncoder).encode(f.value),0])),qa(e))}}function qa(e){function l({data:a}){y.set(new Uint8Array(a));A=a.byteLength;a=1;Z[0]=Z[1];Z[1]=performance.now();pa();if(a!=A){if(0==y[a]){++a;H=1;B=y[a++];a+=2;R=y[a]|y[a+1]<<8;a+=2;S=y[a]|y[a+1]<<8;a+=2;V=Array(256);W=Array(256);for(var b=0;b<R;++b)for(var v=0;v<S;++v)null==V[y[a]]&&(V[y[a]]=new Path2D,W[y[a]]=new Path2D),V[y[a]].rect(4*(1.5+40*b),4*(1.5+40*v),148,148),W[y[a]].rect(160*b,160*v,160,160),++a;m.width=200*R;m.height=200*S;r.width=200*R;r.height=200*S;for(b=0;256>b;++b)V[b]&&(p.fillStyle=t[b]+"b0",p.fill(W[b]),p.fillStyle=t[b],p.fill(V[b]),ba.fillStyle=t[b],ba.fill(W[b]));ca||(requestAnimationFrame(T),ca=1)}if(a!=A){if(1==y[a])for(++a,b=y[a++],v=0;v<b;++v){let q=y[a++];if(C[q]){for(var I=y[a++],U=a;I;){switch(I){case 1:C[q].g.x2=z.getFloat32(a,!0);a+=4;B==q&&(D=C[q].g.x2);break;case 2:C[q].g.y2=z.getFloat32(a,!0);a+=4;B==q&&(E=C[q].g.y2);break;case 3:C[q].g.r2=z.getFloat32(a,!0),a+=4}I=y[a++]}U==a&&(C[q]=void 0)}else{I=z.getFloat32(a,!0);a+=4;U=z.getFloat32(a,!0);a+=4;let ra=z.getFloat32(a,!0);a+=4;let ma=y[a++],sa=(new TextDecoder).decode(y.subarray(a,a+ma));a+=ma;C[q]={x:0,y:0,r:0,g:{x1:0,x2:I,y1:0,y2:U,r1:0,r2:ra},name:sa};B==q&&(D=I,E=U)}}a!=A&&2==y[a]&&++a}}}function h(){if(window.innerWidth!=u||window.innerHeight!=w||x!=window.devicePixelRatio)x=window.devicePixelRatio,u=window.innerWidth,g.width=u*x,w=window.innerHeight,g.height=w*x}function n(a,b,v){return a+(b-a)*v}function c(){ka||(K||L||M||N?(P=Math.atan2(N-K,M-L),Q=160*x):Q=P=0);z.setFloat32(0,P,!0);Q>=160*x?z.setUint8(4,255*O>>>0):z.setUint8(4,1.59375*Q/x*O>>>0);e.send(y.subarray(0,5))}function T(){if(0!=Z[0]){G?G<Z[0]?G=Z[0]:G>Z[1]&&(G=Z[1]):G=Z[0];var a=X;X=n(X,Y,.1);X!=a&&(Q=Math.hypot(F[0]-g.width/2,F[1]-g.height/2)/X,c());a=Z[0]==Z[1]?0:(G-Z[0])/(Z[1]-Z[0]);G+=16.66666;ea=n(ha,D,a);fa=n(ia,E,a);k.resetTransform();k.fillStyle="#333";k.fillRect(0,0,g.width,g.height);k.translate(g.width/2,g.height/2);k.scale(X,X);k.translate(-ea,-fa);k.drawImage(m,0,0,m.width/4,m.height/4);1>X&&(k.globalAlpha=1-X*X,k.drawImage(r,0,0,m.width/4,m.height/4),k.globalAlpha=1);for(let b of C)b&&(b.x=n(b.g.x1,b.g.x2,a),b.y=n(b.g.y1,b.g.y2,a),b.r=n(b.g.r1,b.g.r2,a),k.beginPath(),k.fillStyle="#4f4faf",k.arc(b.x,b.y,b.r,0,2*Math.PI),k.fill(),0!=b.name.length&&(k.font=`700 ${b.r/X}px Ubuntu`,k.textAlign="center",k.textBaseline="middle",k.fillStyle="#00000080",1<X?ja=10+X:ja=.5*b.r,J=n(J,ja,.1),k.fillText(b.name,b.x,b.y-b.r-J)))}requestAnimationFrame(T)}e.onmessage=function(a){H=0;l(a);H&&(d.innerHTML="",pa())};h();window.onresize=h;window.onwheel=function(a){a=.05*-Math.sign(a.deltaY);Y=1<Y?Y+3*a:Y+a;Y=Math.min(Math.max(Y,.25),4)};window.onmousemove=function(a){F=[a.clientX*x,a.clientY*x];P=Math.atan2(F[1]-g.height/2,F[0]-g.width/2);Q=Math.hypot(F[0]-g.width/2,F[1]-g.height/2)/X;c()};window.onmousedown=function(){ka=!ka;P=Math.atan2(F[1]-g.height/2,F[0]-g.width/2);Q=Math.hypot(F[0]-g.width/2,F[1]-g.height/2)/X;c()};window.onkeydown=function(a){switch(a.keyCode||a.which){case 16:1==O&&(O=.5,c());break;case 87:case 38:K||(K=1,c());break;case 65:case 37:L||(L=1,c());break;case 68:case 39:M||(M=1,c());break;case 83:case 40:N||(N=1,c())}};window.onkeyup=function(a){switch(a.keyCode||a.which){case 16:.5==O&&(O=1,c());break;case 87:case 38:K&&(K=0,c());break;case 65:case 37:L&&(L=0,c());break;case 68:case 39:M&&(M=0,c());break;case 83:case 40:N&&(N=0,c())}};window.onbeforeunload=function(a){a.preventDefault();return a.returnValue="Are you sure you want to quit?"}};