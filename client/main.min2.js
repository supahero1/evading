let e=document.getElementById("loading");e.innerHTML="Fetching servers...";let aa=document.getElementById("sub"),f=document.getElementById("name"),k=document.getElementById("canvas"),n=k.getContext("2d"),q=document.createElement("canvas"),r=q.getContext("2d"),t=document.createElement("canvas"),ba=t.getContext("2d"),ca=0,da=["#dddddd","#aaaaaa","#333333","#fedf78"],ea=["#808080","#fc46aa","#008080","#ff8e06"],v=Array(ea.length),fa=0,ha=0,x=0,ia=new ArrayBuffer(524288),y=new Uint8Array(ia),z=new DataView(y.buffer),A=0,B=0,C=Array(256),D=[];var ja=0,ka=0,la=0,E=0,ma=0,F=0;let G=[0,0],H=null,na=0,oa=0,pa=0;var I=0,J=0,K=0,L=0,M=1,N=0,qa=0,Q=0,R=0,S=0,T=[],U=[];let V=1,W=V,X=[0,0];window.s.then(g=>g.json()).then(g=>ra(g));function ta(){setTimeout(location.reload.bind(location),1E3)}function ra(g){if(0==g.length)e.innerHTML="No servers found",ta();else{e.innerHTML="Connecting...";var m=g.map(function(l){l=new WebSocket(l[1]);l.binaryType="arraybuffer";l.i=[];l.onopen=function(){this.send(new Uint8Array(0));this.time=performance.now()};l.onmessage=function(){this.i[this.i.length]=performance.now()-this.time;5>this.i.length&&this.send(new Uint8Array(0))};return l});setTimeout(function(){let l=999999,p=null;for(let d of m){d.h=0;for(let Y of d.i)d.h+=Y;0<d.i.length?d.h/=d.i.length:d.h=999999;d.h<l&&(l=d.h,p=d)}for(let d of m)d.onopen=function(){},d.onmessage=function(){},delete d.i,delete d.time,delete d.h,d!=p&&d.close();null==p||1!=p.readyState?(e.innerHTML="Failed connecting",ta()):ua(p)},1E3)}}function va(){la=E;ma=F;for(let g of C)g&&(g.g.x1=g.g.x2,g.g.y1=g.g.y2,g.g.r1=g.g.r2);for(let g of D)g&&(g.g.x1=g.g.x2,g.g.y1=g.g.y2,g.g.r1=g.g.r2)}function ua(g){e.innerHTML="Enter your name<br>";aa.innerHTML="You are limited to 4 characters<br>Special characters might not fit<br>Press enter when you are done";f.style.display="block";f.onkeypress=f.onblur=f.onpaste=function(m){let l=m.target.value+m.key;4<(new TextEncoder).encode(l).byteLength?m.target.value=m.target.m||"":(m.target.value=l,m.target.m=l);m.preventDefault();return!1};g.onclose=function(){window.onbeforeunload=function(){};k.parentElement.removeChild(k);e.innerHTML="Disconnected";aa.innerHTML="";f.style.display="none";ta()};window.onkeydown=function(m){13==(m.keyCode||m.which)&&(e.innerHTML="Spawning...",aa.innerHTML="",f.style.display="none",m=(m=window.localStorage.getItem("token"))?m.split(",").map(l=>+l):[],g.send(new Uint8Array([0,...(new TextEncoder).encode(f.value),0,...m,0])),wa(g))}}function wa(g){function m({data:a}){y.set(new Uint8Array(a));A=a.byteLength;a=1;X[0]=X[1];X[1]+=40;va();if(a!=A){if(0==y[a]){++a;na=1;D=[];B=y[a++];a+=2;R=y[a]|y[a+1]<<8;a+=2;S=y[a]|y[a+1]<<8;a+=2;T=Array(256);U=Array(256);for(var b=0;b<R;++b)for(var c=0;c<S;++c)null==T[y[a]]&&(T[y[a]]=new Path2D,U[y[a]]=new Path2D),T[y[a]].rect(4*(1.5+40*b),4*(1.5+40*c),148,148),U[y[a]].rect(160*b,160*c,160,160),++a;q.width=200*R;q.height=200*S;t.width=200*R;t.height=200*S;for(b=0;256>b;++b)T[b]&&(r.fillStyle=da[b]+"b0",r.fill(U[b]),r.fillStyle=da[b],r.fill(T[b]),ba.fillStyle=da[b],ba.fill(U[b]));ca||(requestAnimationFrame(Y),ca=1)}if(a!=A){if(1==y[a])for(++a,b=y[a++],c=0;c<b;++c){var h=y[a++];if(C[h]){for(var u=y[a++],w=a;u;){switch(u){case 1:C[h].g.x2=z.getFloat32(a,!0);a+=4;B==h&&(E=C[h].g.x2);break;case 2:C[h].g.y2=z.getFloat32(a,!0);a+=4;B==h&&(F=C[h].g.y2);break;case 3:C[h].g.r2=z.getFloat32(a,!0);a+=4;break;case 4:C[h].j=y[a++],C[h].j&&(C[h].l=y[a++])}u=y[a++]}w==a&&(C[h]=void 0)}else{u=z.getFloat32(a,!0);a+=4;w=z.getFloat32(a,!0);a+=4;var O=z.getFloat32(a,!0);a+=4;var P=y[a++],Z=(new TextDecoder).decode(y.subarray(a,a+P));a+=P;P=y[a++];let sa=0;P&&(sa=y[a++]);C[h]={x:0,y:0,r:0,g:{x1:u,x2:u,y1:w,y2:w,r1:O,r2:O},name:Z,j:P,l:sa};B==h&&(E=u,F=w)}}if(a!=A&&2==y[a])for(++a,b=y[a]|y[a+1]<<8,a+=2,c=0;c<b;++c)if(h=y[a]|y[a+1]<<8,a+=2,D[h]){u=y[a++];for(w=a;u;){switch(u){case 1:D[h].g.x2=z.getFloat32(a,!0);a+=4;break;case 2:D[h].g.y2=z.getFloat32(a,!0);a+=4;break;case 3:D[h].g.r2=z.getFloat32(a,!0),a+=4}u=y[a++]}w==a&&(D[h]=void 0)}else u=y[a++],w=z.getFloat32(a,!0),a+=4,O=z.getFloat32(a,!0),a+=4,Z=z.getFloat32(a,!0),a+=4,D[h]={type:u,x:0,y:0,r:0,g:{x1:w,x2:w,y1:O,y2:O,r1:Z,r2:Z}}}}}function l(){if(window.innerWidth!=fa||window.innerHeight!=ha||x!=window.devicePixelRatio)x=window.devicePixelRatio,fa=window.innerWidth,k.width=fa*x,ha=window.innerHeight,k.height=ha*x}function p(a,b,c){return a+(b-a)*c}function d(){qa||(I||J||K||L?(N=Math.atan2(L-I,K-J),Q=160*x):Q=N=0);z.setFloat32(0,N,!0);Q>=160*x?z.setUint8(4,255*M>>>0):z.setUint8(4,1.59375*Q/x*M>>>0);g.send(y.subarray(0,5))}function Y(){if(0!=X[0]){H?H<X[0]?H=X[0]:H>X[1]&&(H=X[1]):H=X[0];var a=V;V=p(V,W,.1);V!=a&&(Q=Math.hypot(G[0]-k.width/2,G[1]-k.height/2)/V,d());a=X[0]==X[1]?0:(H-X[0])/(X[1]-X[0]);H+=16.66666;ja=p(la,E,a);ka=p(ma,F,a);n.resetTransform();n.fillStyle="#333";n.fillRect(0,0,k.width,k.height);n.translate(k.width/2,k.height/2);n.scale(V,V);n.translate(-ja,-ka);n.drawImage(q,0,0,q.width/4,q.height/4);1>V&&(n.globalAlpha=1-V*V,n.drawImage(t,0,0,q.width/4,q.height/4),n.globalAlpha=1);for(var b of C)b&&(b.x=p(b.g.x1,b.g.x2,a),b.y=p(b.g.y1,b.g.y2,a),b.r=p(b.g.r1,b.g.r2,a),n.beginPath(),n.fillStyle="#4f4faf",n.arc(b.x,b.y,b.r,0,2*Math.PI),n.fill(),0!=b.name.length&&(n.font=`700 ${b.r/V}px Ubuntu`,n.textAlign="center",n.textBaseline="middle",n.fillStyle="#00000080",pa=1<V?.5*b.r:.5*b.r+2/(V*V),oa=p(oa,pa,.1),n.fillText(b.name,b.x,b.y-b.r-oa)),b.j&&(n.font=`700 ${b.r/Math.min(V,1)}px Ubuntu`,n.textAlign="center",n.textBaseline="middle",n.fillStyle="#f00",n.fillText(b.l,b.x,b.y)));for(b=0;b<v.length;++b)v[b]=new Path2D;for(var c of D)c&&(c.x=p(c.g.x1,c.g.x2,a),c.y=p(c.g.y1,c.g.y2,a),c.r=p(c.g.r1,c.g.r2,a),v[c.type].moveTo(c.x+c.r-2,c.y),v[c.type].arc(c.x,c.y,c.r-2,0,2*Math.PI));n.lineWidth=4;n.beginPath();for(c=0;c<v.length;++c)a=ea[c],a="#"+(.8*parseInt(a.substring(1,3),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(a.substring(3,5),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(a.substring(5,7),16)>>0).toString(16).padStart(2,"0"),n.strokeStyle=a,n.stroke(v[c]),n.fillStyle=ea[c],n.fill(v[c])}requestAnimationFrame(Y)}g.onmessage=function(a){na=0;m(a);na&&(e.innerHTML="",va())};l();window.onresize=l;window.onwheel=function(a){a=.05*-Math.sign(a.deltaY);W=1<W?W+3*a:W+a;W=Math.min(Math.max(W,.25),4)};window.onmousemove=function(a){G=[a.clientX*x,a.clientY*x];N=Math.atan2(G[1]-k.height/2,G[0]-k.width/2);Q=Math.hypot(G[0]-k.width/2,G[1]-k.height/2)/V;d()};window.onmousedown=function(){qa=!qa;N=Math.atan2(G[1]-k.height/2,G[0]-k.width/2);Q=Math.hypot(G[0]-k.width/2,G[1]-k.height/2)/V;d()};window.onkeydown=function(a){switch(a.keyCode||a.which){case 16:1==M&&(M=.5,d());break;case 87:case 38:I||(I=1,d());break;case 65:case 37:J||(J=1,d());break;case 68:case 39:K||(K=1,d());break;case 83:case 40:L||(L=1,d())}};window.onkeyup=function(a){switch(a.keyCode||a.which){case 16:.5==M&&(M=1,d());break;case 87:case 38:I&&(I=0,d());break;case 65:case 37:J&&(J=0,d());break;case 68:case 39:K&&(K=0,d());break;case 83:case 40:L&&(L=0,d())}};window.onbeforeunload=function(a){a.preventDefault();return a.returnValue="Are you sure you want to quit?"}};