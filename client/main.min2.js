let d=document.getElementById("loading");d.innerHTML="Fetching servers...";let ba=document.getElementById("sub"),e=document.getElementById("name"),k=document.getElementById("canvas"),n=k.getContext("2d"),q=document.createElement("canvas"),r=q.getContext("2d"),u=document.createElement("canvas"),ca=u.getContext("2d"),da=0,ea=["#dddddd","#aaaaaa","#333333","#fedf78"],fa=["#808080","#fc46aa","#008080","#ff8e06","#d2b48c"],w=Array(fa.length),ha=0,ia=0,x=0,ja=new ArrayBuffer(524288),y=new Uint8Array(ja),z=new DataView(y.buffer),A=0,B=0,C=Array(256),D=[];var ka=0,la=0,ma=0,E=0,na=0,F=0;let G=[0,0],H=null,oa=0,pa=0,qa=0;var I=0,J=0,K=0,L=0,M=1,O=0,ra=0,P=0,S=0,T=0,U=0,V=[],W=[];let X=1,Y=X,Z=[0,0];window.s.then(f=>f.json()).then(f=>sa(f));function va(){setTimeout(location.reload.bind(location),1E3)}function sa(f){if(0==f.length)d.innerHTML="No servers found",va();else{d.innerHTML="Connecting...";var m=f.map(function(l){l=new WebSocket(l[1]);l.binaryType="arraybuffer";l.i=[];l.onopen=function(){this.send(new Uint8Array(0));this.time=performance.now()};l.onmessage=function(){this.i[this.i.length]=performance.now()-this.time;5>this.i.length&&this.send(new Uint8Array(0))};return l});setTimeout(function(){let l=999999,p=null;for(let g of m){g.h=0;for(let t of g.i)g.h+=t;0<g.i.length?g.h/=g.i.length:g.h=999999;g.h<l&&(l=g.h,p=g)}for(let g of m)g.onopen=function(){},g.onmessage=function(){},delete g.i,delete g.time,delete g.h,g!=p&&g.close();null==p||1!=p.readyState?(d.innerHTML="Failed connecting",va()):wa(p)},1E3)}}function xa(){ma=E;na=F;for(let f of C)f&&(f.g.x1=f.g.x2,f.g.y1=f.g.y2,f.g.r1=f.g.r2);for(let f of D)f&&(f.g.x1=f.g.x2,f.g.y1=f.g.y2,f.g.r1=f.g.r2)}function wa(f){d.innerHTML="Enter your name<br>";ba.innerHTML="You are limited to 4 characters<br>Special characters might not fit<br>Press enter when you are done";e.style.display="block";e.onkeypress=e.onblur=e.onpaste=function(m){let l=m.target.value+m.key;4<(new TextEncoder).encode(l).byteLength?m.target.value=m.target.m||"":(m.target.value=l,m.target.m=l);m.preventDefault();return!1};f.onclose=function(){window.onbeforeunload=function(){};k.parentElement.removeChild(k);d.innerHTML="Disconnected";ba.innerHTML="";e.style.display="none";va()};window.onkeydown=function(m){13==(m.keyCode||m.which)&&(d.innerHTML="Spawning...",ba.innerHTML="",e.style.display="none",m=(m=window.localStorage.getItem("token"))?m.split(",").map(l=>+l):[],f.send(new Uint8Array([0,...(new TextEncoder).encode(e.value),0,...m,0])),ya(f))}}function ya(f){function m({data:a}){y.set(new Uint8Array(a));A=a.byteLength;a=1;Z[0]=Z[1];Z[1]+=40;xa();if(a!=A){if(0==y[a]){++a;oa=1;D=[];B=y[a++];a+=2;S=y[a]|y[a+1]<<8;a+=2;T=y[a]|y[a+1]<<8;a+=2;U=y[a++];V=Array(256);W=Array(256);for(var b=0;b<S;++b)for(var c=0;c<T;++c)null==V[y[a]]&&(V[y[a]]=new Path2D,W[y[a]]=new Path2D),V[y[a]].rect(4*(1.5+b*U),4*(1.5+c*U),4*(U-3),4*(U-3)),W[y[a]].rect(b*U*4,c*U*4,4*U,4*U),++a;q.width=U*S*4;q.height=U*T*4;u.width=U*S*4;u.height=U*T*4;for(b=0;256>b;++b)V[b]&&(r.fillStyle=ea[b]+"b0",r.fill(W[b]),r.fillStyle=ea[b],r.fill(V[b]),ca.fillStyle=ea[b],ca.fill(W[b]));da||(requestAnimationFrame(ta),da=1)}if(a!=A){if(1==y[a])for(++a,b=y[a++],c=0;c<b;++c){var h=y[a++];if(C[h]){var v=y[a++];if(v)for(;v;){switch(v){case 1:C[h].g.x2=z.getFloat32(a,!0);a+=4;B==h&&(E=C[h].g.x2);break;case 2:C[h].g.y2=z.getFloat32(a,!0);a+=4;B==h&&(F=C[h].g.y2);break;case 3:C[h].g.r2=z.getFloat32(a,!0);a+=4;break;case 4:C[h].j=y[a++],C[h].j&&(C[h].l=y[a++])}v=y[a++]}else C[h]=void 0}else{v=z.getFloat32(a,!0);a+=4;var N=z.getFloat32(a,!0);a+=4;var Q=z.getFloat32(a,!0);a+=4;var R=y[a++],aa=(new TextDecoder).decode(y.subarray(a,a+R));a+=R;R=y[a++];let ua=0;R&&(ua=y[a++]);C[h]={x:0,y:0,r:0,g:{x1:v,x2:v,y1:N,y2:N,r1:Q,r2:Q},name:aa,j:R,l:ua};B==h&&(E=v,F=N)}}if(a!=A&&2==y[a])for(++a,b=y[a]|y[a+1]<<8,a+=2,c=0;c<b;++c)if(h=y[a]|y[a+1]<<8,a+=2,D[h])if(v=y[a++])for(;v;){switch(v){case 1:D[h].g.x2=z.getFloat32(a,!0);a+=4;break;case 2:D[h].g.y2=z.getFloat32(a,!0);a+=4;break;case 3:D[h].g.r2=z.getFloat32(a,!0),a+=4}v=y[a++]}else D[h]=void 0;else v=y[a++],N=z.getFloat32(a,!0),a+=4,Q=z.getFloat32(a,!0),a+=4,aa=z.getFloat32(a,!0),a+=4,D[h]={type:v,x:0,y:0,r:0,g:{x1:N,x2:N,y1:Q,y2:Q,r1:aa,r2:aa}}}}}function l(){if(window.innerWidth!=ha||window.innerHeight!=ia||x!=window.devicePixelRatio)x=window.devicePixelRatio,ha=window.innerWidth,k.width=ha*x,ia=window.innerHeight,k.height=ia*x}function p(a,b,c){return a+(b-a)*c}function g(a){return"#"+(.8*parseInt(a.substring(1,3),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(a.substring(3,5),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(a.substring(5,7),16)>>0).toString(16).padStart(2,"0")+a.substring(7)}function t(){ra||(I||J||K||L?(O=Math.atan2(L-I,K-J),P=160*x):P=O=0);z.setFloat32(0,O,!0);P>=160*x?z.setUint8(4,255*M>>>0):z.setUint8(4,1.59375*P/x*M>>>0);f.send(y.subarray(0,5))}function ta(){if(0!=Z[0]){H?H<Z[0]?H=Z[0]:H>Z[1]&&(H=Z[1]):H=Z[0];var a=X;X=p(X,Y,.1);X!=a&&(P=Math.hypot(G[0]-k.width/2,G[1]-k.height/2)/X,t());a=Z[0]==Z[1]?0:(H-Z[0])/(Z[1]-Z[0]);H+=16.66666;ka=p(ma,E,a);la=p(na,F,a);n.resetTransform();n.fillStyle="#333";n.fillRect(0,0,k.width,k.height);n.translate(k.width/2,k.height/2);n.scale(X,X);n.translate(-ka,-la);n.drawImage(q,0,0,q.width/4,q.height/4);1>X&&(n.globalAlpha=1-X*X,n.drawImage(u,0,0,q.width/4,q.height/4),n.globalAlpha=1);for(let c=0;c<w.length;++c)w[c]=new Path2D;for(var b of D)b&&(b.x=p(b.g.x1,b.g.x2,a),b.y=p(b.g.y1,b.g.y2,a),b.r=p(b.g.r1,b.g.r2,a),w[b.type].moveTo(b.x+b.r-1,b.y),w[b.type].arc(b.x,b.y,b.r-1,0,2*Math.PI));n.beginPath();n.lineWidth=2;for(b=0;b<w.length;++b)n.fillStyle=fa[b],n.strokeStyle=g(fa[b]),n.stroke(w[b]),n.fill(w[b]);b=new Path2D;for(let c of C)c&&(c.x=p(c.g.x1,c.g.x2,a),c.y=p(c.g.y1,c.g.y2,a),c.r=p(c.g.r1,c.g.r2,a),b.moveTo(c.x+c.r-1,c.y),b.arc(c.x,c.y,c.r-1,0,2*Math.PI));n.beginPath();n.fillStyle="#6f2faf";n.strokeStyle=g("#6f2faf");n.lineWidth=2;n.stroke(b);n.fill(b);for(let c of C)c&&(n.beginPath(),0!=c.name.length&&(n.font=`700 ${c.r/X}px Ubuntu`,n.textAlign="center",n.textBaseline="middle",n.fillStyle="#00000080",qa=1<X?.5*c.r:.5*c.r+2/(X*X),pa=p(pa,qa,.1),n.fillText(c.name,c.x,c.y-c.r-pa)),c.j&&(n.font=`700 ${c.r/Math.min(X,1)}px Ubuntu`,n.textAlign="center",n.textBaseline="middle",n.fillStyle="#f00",n.fillText(c.l,c.x,c.y)))}requestAnimationFrame(ta)}f.onmessage=function(a){oa=0;m(a);oa&&(d.innerHTML="",xa())};l();window.onresize=l;window.onwheel=function(a){a=.05*-Math.sign(a.deltaY);Y=1<Y?Y+3*a:Y+a;Y=Math.min(Math.max(Y,.25),4)};window.onmousemove=function(a){G=[a.clientX*x,a.clientY*x];O=Math.atan2(G[1]-k.height/2,G[0]-k.width/2);P=Math.hypot(G[0]-k.width/2,G[1]-k.height/2)/X;t()};window.onmousedown=function(){ra=!ra;O=Math.atan2(G[1]-k.height/2,G[0]-k.width/2);P=Math.hypot(G[0]-k.width/2,G[1]-k.height/2)/X;t()};window.onkeydown=function(a){switch(a.keyCode||a.which){case 16:1==M&&(M=.5,t());break;case 87:case 38:I||(I=1,t());break;case 65:case 37:J||(J=1,t());break;case 68:case 39:K||(K=1,t());break;case 83:case 40:L||(L=1,t())}};window.onkeyup=function(a){switch(a.keyCode||a.which){case 16:.5==M&&(M=1,t());break;case 87:case 38:I&&(I=0,t());break;case 65:case 37:J&&(J=0,t());break;case 68:case 39:K&&(K=0,t());break;case 83:case 40:L&&(L=0,t())}};window.onbeforeunload=function(a){a.preventDefault();return a.returnValue="Are you sure you want to quit?"}};