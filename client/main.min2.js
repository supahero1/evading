const e=window.localStorage,aa=e.getItem("keybinds"),f={settings:"Escape",up:"KeyW",left:"KeyA",right:"KeyD",down:"KeyS",slowwalk:"ShiftLeft",minimap:"KeyM"};let h=null!=aa?JSON.parse(aa):f;for(const a in f)a in h||(h[a]=f[a]);for(const a in h)a in f||delete h[a];function ba(){e.setItem("keybinds",JSON.stringify(h))}const ca=e.getItem("settings"),l={fov:{min:.25,max:1.75,value:1.75,step:.05},chat_on:!0,max_chat_messages:{min:1,max:1E3,value:100,step:1},chat_text_scale:{min:1,max:2,value:1,step:.05},draw_ball_fill:!0,draw_ball_stroke:!0,draw_ball_stroke_bright:!0,ball_stroke:{min:0,max:100,value:20,step:1},draw_player_fill:!0,draw_player_stroke:!0,draw_player_stroke_bright:!0,player_stroke:{min:0,max:100,value:10,step:1},draw_player_name:!0,draw_death_arrow:!0,death_arrow_size:{min:10,max:100,value:40,step:1},show_tutorial:!0};let m=null!=ca?JSON.parse(ca):JSON.parse(JSON.stringify(l));for(const a in l)a in m||(m[a]=l[a]);for(const a in m)a in l?(m[a].min&&m[a].min!=l[a].min&&(m[a].min=l[a].min),m[a].max&&m[a].max!=l[a].max&&(m[a].max=l[a].max),m[a].step&&m[a].step!=l[a].step&&(m[a].step=l[a].step),m[a].value=Math.max(Math.min(m[a].value,m[a].max),m[a].min)):delete m[a];function n(){e.setItem("settings",JSON.stringify(m))}const q=document.getElementById.bind(document),r=document.createElement.bind(document),t=q("ID_status"),da=e.getItem("token");let u=[];"string"==typeof da&&(u=da.split(",").map(a=>+a));function ea(a){return"#"+(.8*parseInt(a.substring(1,3),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(a.substring(3,5),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(a.substring(5,7),16)>>0).toString(16).padStart(2,"0")+a.substring(7)}function fa(a){const b=a.match(/\/\/(.*?)\.shadam\.xyz/),c=a.match(/\/\/(.*?)[\/:]/);return b?b[1]:c?c[1]:a}WebSocket.prototype.send=new Proxy(WebSocket.prototype.send,{apply:function(a,b,c){if(b.readyState==WebSocket.OPEN)return a.apply(b,c)},configurable:!0,enumerable:!0});WebSocket.prototype.close=new Proxy(WebSocket.prototype.close,{apply:function(a,b,c){if(b.readyState==WebSocket.CONNECTING||b.readyState==WebSocket.OPEN)return a.apply(b,c)},configurable:!0,enumerable:!0});function ha(a){return function(b){const c=b instanceof ClipboardEvent;if(!c||"paste"==b.type){var d=b.target.value+(c?b.clipboardData.getData("text"):b.key);if((new TextEncoder).encode(d).byteLength>a){if(""==b.target.value&&c){const g=b.target.placeholder;b.target.placeholder="Text too long to paste!";setTimeout(function(){b.target.placeholder=g},1E3)}b.preventDefault()}}}}function w(a,b,c){return a+(b-a)*c}if(0==window.s.length)throw t.innerHTML="No servers found",setTimeout(location.reload.bind(location),1E3),Error(t.innerHTML);t.innerHTML="Connecting";const x=["#dddddd","#aaaaaa","#333333","#fedf78"],ia="#808080 #fc46aa #008080 #ff8e06 #3cdfff #663a82".split(" ");function ja(){var a=y;a.h.innerHTML="";for(const b of a.j){const c=r("option");c.value=b[2];b[2]==B.m.url&&(c.selected=!0,c.disabled=!0,a.g=c);b[0]>=b[1]&&(c.disabled=1);const d=fa(b[2]);c.innerHTML=d[0].toUpperCase()+d.substring(1)+` (${b[0]}/${b[1]})`;a.h.appendChild(c)}a.h.onchange=async function(){this.g.disabled=!1;const b=this.g;this.g=this.h.selectedOptions[0];this.g.disabled=!0;ka();let c;const d=new Promise(function(k){c=k}),g=new la(this.g.value,c,1);setTimeout(c,2E3);await d;0==g.C||g.m.readyState!=WebSocket.OPEN?(g.stop(),t.innerHTML="Couldn't connect, returning to previous server",this.g.disabled=!1,this.g=b,this.g.disabled=!0,setTimeout(C.j.bind(C),1E3)):ma(g)}.bind(a)}function na(){ja();setInterval(function(){fetch("servers.json").then(a=>a.json()).then(function(a){y.j=a;ja()})},5E3)}function D(){y.i.style.display="block"}class oa{constructor(){this.i=q("ID_menu");this.name=q("ID_name");this.h=q("ID_select_serv");this.g=null;this.j=window.s;this.o=q("ID_play");this.u=q("ID_spec");this.l=q("ID_refresh");this.l.onclick=location.reload.bind(location);this.name.onkeypress=this.name.onpaste=ha(16);this.name.onchange=function(){C.i=!1};const a=e.getItem("name");"string"==typeof a&&16>=(new TextEncoder).encode(a).length&&(this.name.value=a)}}function ma(a){var b=B;null!=b.m&&(b.stop(),b.once=!1,b.i=!1,b.g=[0,0]);b.m=a.m;b.m.onmessage=b.message.bind(b);b.m.onclose=b.close.bind(b);a=E;0==u.length?a.i=1:(a.h.set(u),a.i=u.length);F(b);b.h()}function F(a){a.m.send(E.h.subarray(0,E.i))}class pa{constructor(){this.m=null;this.i=this.once=!1;this.g=[0,0]}h(){this.once=!0;var a=G;a.o=Array(5).fill(0);a.i=0;a.h.innerHTML="";a.j=0;a.u=!1;H.g=!1;I.g=Array(100);J.g=Array(65535);a=K;cancelAnimationFrame(a.o);a.o=-1;a.v=!1;a.l=0;a.u=0;a=N;a.h=!1;a.v=!1;a.g=1;a.u=1;a=C;a.g=!1;a.h=!1;a.i=!1;a.id=-1}message({data:a}){E.set(new Uint8Array(a));if(!(1>=E.i)){E.g=1;this.g[0]=this.g[1];this.g[1]=performance.now();a=I;for(var b=0;100>b;++b)void 0!=a.g[b]&&(a.g[b].x1=a.g[b].x2,a.g[b].y1=a.g[b].y2,a.g[b].r1=a.g[b].r2);a=J;for(b=0;65535>b;++b)void 0!=a.g[b]&&(a.g[b].x1=a.g[b].x2,a.g[b].y1=a.g[b].y2,a.g[b].r1=a.g[b].r2);for(O(H);E.g<E.i;)switch(P()){case 0:J.g=Array(65535);O(H);a=Q;P();var c=P(),d=P();b=P();var g=m.fov.max,k=b*g,z=Array(P());for(var v=0;v<z.length;++v)z[v]=[(P()+.5)*k,(P()+.5)*k,P()];v=Array(256);var A=Array(256);for(var L=0;L<c;++L)for(var M=0;M<d;++M){const S=E.h[E.g];void 0==v[S]&&(v[S]=new Path2D,A[S]=new Path2D);v[S].rect((1.5+L*b)*g,(1.5+M*b)*g,(b-3)*g,(b-3)*g);A[S].rect(L*k,M*k,k,k);++E.g}C.id=P()-1;(k=P())&&!C.h?(C.g&&(C.g=!1,C.g=!1,D()),C.h=!0,C.g=!0,y.i.style.display="none"):!k&&C.h&&(C.h=!1,C.g=!1,D());C.g||k||C.h||-1==C.id||(C.g=!0,C.g=!0,y.i.style.display="none");a.width=c*b;a.height=d*b;a.h.width=a.width*g;a.h.height=a.height*g;a.i.width=a.h.width;a.i.height=a.h.height;for(c=0;256>c;++c)void 0!=v[c]&&(a.g.fillStyle=x[c]+"b0",a.g.fill(A[c]),a.g.fillStyle=x[c],a.g.fill(v[c]),a.j.fillStyle=x[c],a.j.fill(A[c]));a.g.font=`700 ${b}px Ubuntu`;a.g.textAlign="center";a.g.textBaseline="middle";a.g.fillStyle=ea(x[3]);for(var p of z)a.g.fillText(p[2],p[0],p[1]);break;case 1:a=I;b=P();for(z=0;z<b;++z)if(c=P(),void 0==a.g[c])d=R(),g=R(),v=R(),A=P(),A=qa(A),k=P(),L=0,k&&(L=P()),M=P(),0<M&&ra(G,A,qa(M)),a.g[c]={x:0,y:0,r:0,x1:d,x2:d,y1:g,y2:g,r1:v,r2:v,name:A,G:k,J:L,H:!0},C.id==c&&(c=H,c.g||(c.x2=d,c.y2=g));else if(d=P(),0==d)delete a.g[c],c==C.id&&C.g&&(C.g=!1,C.g=!1,D());else{do{switch(d){case 1:a.g[c].x2=R();C.id==c&&(d=H,d.g||(d.x2=a.g[c].x2));break;case 2:a.g[c].y2=R();C.id==c&&(d=H,d.g||(d.y2=a.g[c].y2));break;case 3:a.g[c].r2=R();break;case 4:a.g[c].G=P();a.g[c].G&&(a.g[c].J=P());break;case 5:d=P();ra(G,a.g[c].name,qa(d));break;default:throw Error();}d=P()}while(d)}break;case 2:a=J;b=sa();for(z=0;z<b;++z)if(c=sa(),void 0==a.g[c])d=P()-1,g=R(),v=R(),A=R(),a.g[c]={type:d,x:0,y:0,r:0,x1:g,x2:g,y1:v,y2:v,r1:A,r2:A,H:!1};else if(d=P(),0==d)delete a.g[c];else{do{switch(d){case 1:a.g[c].x2=R();break;case 2:a.g[c].y2=R();break;case 3:a.g[c].r2=R();break;default:throw Error();}d=P()}while(d)}break;case 3:a=G;b=P();for(z=0;z<b;++z)d=P(),c=(new TextDecoder).decode(E.h.subarray(E.g,E.g+d)),E.g+=d,d=P(),ra(a,c,(new TextDecoder).decode(E.h.subarray(E.g,E.g+d))),E.g+=d;break;default:throw Error();}if(E.g>E.i)throw Error();-1==C.id?(p=H,a=.5*Q.height,p.g||(p.x2=.5*Q.width,p.y2=a),O(p)):(p=H,a=I.g[C.id].y,p.g||(p.x2=I.g[C.id].x,p.y2=a),O(p));0==this.g[0]||this.i||(this.i=!0,p=K,p.o=window.requestAnimationFrame(p.A.bind(p)),C.j())}}close(a){4E3==a?(a=C,a.g=!1,ta(a),t.innerHTML="Server is full"):ta(C)}stop(){this.m.onopen=this.m.onmessage=this.m.onclose=null;this.m.close()}}function ua(a){a.m=new WebSocket(a.j);a.m.binaryType="arraybuffer";a.m.onopen=a.h.bind(a);a.m.onmessage=a.message.bind(a);a.m.onclose=a.close.bind(a)}class la extends pa{constructor(a,b,c=8){super();this.C=0;this.l=c;this.o=b;this.j=a;ua(this)}h(){this.m.send(new ArrayBuffer(0))}message(){++this.C==this.l?this.o(this.m.url):this.m.send(new ArrayBuffer(0))}close(){ua(this)}}function P(){var a=E;return a.h[a.g++]}function sa(){var a=E;const b=a.h[a.g]|a.h[a.g+1]<<8;a.g+=2;return b}function R(){var a=E;const b=a.view.getFloat32(a.g,!0);a.g+=4;return b}function qa(a){var b=E;const c=(new TextDecoder).decode(b.h.subarray(b.g,b.g+a));b.g+=a;return c}class va{constructor(){this.j=new ArrayBuffer(1048576);this.h=new Uint8Array(this.j);this.view=new DataView(this.j);this.g=this.i=0}set(a){this.h.set(a);this.i=a.length;this.g=0}}class wa{constructor(){this.h=r("canvas");this.g=this.h.getContext("2d");this.i()}i(){this.h.width=this.h.height=m.death_arrow_size.value;const a=.5*this.h.width,b=this.h.width;this.g.beginPath();this.g.moveTo(a+.45*b,a);this.g.lineTo(a-.225*b,a-.675*b/Math.sqrt(3));this.g.lineTo(a-.225*b,a+.675*b/Math.sqrt(3));this.g.closePath();this.g.fillStyle="#bbbbbbb0";this.g.fill();this.g.lineWidth=.1*a;this.g.strokeStyle="#f00";this.g.stroke()}}function xa(a,b){a.B=a.g.placeholder;a.g.placeholder=b;a.g.disabled=!0;a.g.value="";K.h.focus()}function ya(){var a=G;a.u||(a.v.style.display="block")}function ra(a,b,c){const d=r("p");d.appendChild(document.createTextNode(b+": "+c));a.h.insertBefore(d,a.h.firstChild);++a.j>m.max_chat_messages.value&&a.h.removeChild(a.h.lastChild)}class za{constructor(){this.o=Array(5).fill(0);this.i=0;this.v=q("ID_chat");this.h=q("ID_messages");this.g=q("ID_sendmsg");this.I=ha(128);this.j=0;this.u=!1;this.B="";this.l=-1;this.g.onkeydown=function(a){a.stopPropagation();if("Enter"==a.code&&(a=(new TextEncoder).encode(this.g.value.trim()),0<a.length)){var b=E;if(!C.i){C.i=!0;b.h[0]=3;var c=y;c=(new TextEncoder).encode(c.name.value);b.h.set(c,1);b.i=c.length+1;F(B)}b.h[0]=2;b.h.set(a,1);b.i=a.length+1;F(B);this.o[this.i]=(new Date).getTime();a=(this.i+1)%5;b=this.o[this.i]-this.o[a];this.i=a;5E3>b?(xa(this,"You are on cooldown for sending too many messages too fast"),this.l=setTimeout(this.A.bind(this),5E3-b)):(this.g.value="",this.g.blur(),K.h.focus())}}.bind(this);this.g.onkeyup=function(a){a.stopPropagation()};this.g.onkeypress=this.g.onpaste=this.I}A(){-1!=this.l&&(clearTimeout(this.l),this.l=-1);this.g.disabled=!1;this.g.placeholder=this.B}focus(){this.g.focus()}D(){for(;this.j>m.max_chat_messages.value;)this.h.removeChild(this.h.lastChild),--this.j}F(){this.h.style["font-size"]=m.chat_text_scale.value+"em"}}function O(a){a.x1=a.x2;a.y1=a.y2}class Aa{constructor(){this.y2=this.x2=this.y1=this.x1=this.y=this.x=0;this.g=!1}block(){this.g=!0}}class Ba{constructor(){this.g=Array(100)}}class Ca{constructor(){this.g=Array(65535)}}function Da(){var a=Ea;a.g=!0;return new Promise(function(b){a.h=function(c){a.g=!1;b(c)}})}class Fa{constructor(){this.h=null;this.g=!1}}function Ga(a){a.l.innerHTML="";T(a,"CHAT");a.add(a.text("Show chat"),U("chat_on",function(b){console.log(b);b?ya():(b=G,b.u||(b.v.style.display="none"))}));a.add(a.text("Max number of chat messages"),V(a,"max_chat_messages","",G.D));a.add(a.text("Chat text scale"),V(a,"chat_text_scale","",G.F));T(a,"HELP");a.add(a.text("Enable tutorial"),U("show_tutorial"));T(a,"VISUALS");a.add(a.text("Default FOV"),V(a,"fov"));a.add(a.text("Draw balls' fill"),U("draw_ball_fill"));a.add(a.text("Draw balls' stroke"),U("draw_ball_stroke"));a.add(a.text("Draw stroke-only balls with brighter color"),U("draw_ball_stroke_bright"));a.add(a.text("Balls' stroke radius percentage"),V(a,"ball_stroke","%"));a.add(a.text("Draw players' fill"),U("draw_player_fill"));a.add(a.text("Draw players' stroke"),U("draw_player_stroke"));a.add(a.text("Draw stroke-only players with brighter color"),U("draw_player_stroke_bright"));a.add(a.text("Players' stroke radius percentage"),V(a,"player_stroke","%"));a.add(a.text("Draw players' name"),U("draw_player_name"));a.add(a.text("Draw an arrow towards dead players"),U("draw_death_arrow"));a.add(a.text("Death arrow size"),V(a,"death_arrow_size","px",Ha.i));T(a,"KEYBINDS");Ia(a,Ja("h5","To change, click a button on the right side and then press the key you want to asign to it."));a.add(a.text("Settings"),W("settings"));a.add(a.text("Move up"),W("up"));a.add(a.text("Move left"),W("left"));a.add(a.text("Move down"),W("down"));a.add(a.text("Move right"),W("right"));a.add(a.text("Move slowly"),W("slowwalk"));a.add(a.text("Big minimap"),W("minimap"));T(a,"RESET");a.add(a.text("Reset settings"),a.button("RESET",function(){m=l;n();Ga(this)}.bind(a)));a.add(a.text("Reset keybinds"),a.button("RESET",function(){h=f;ba();Ga(this)}.bind(a)));a.end()}function Ka(a){a.g||(a.i=!1,a.j.style.display="none",N.h=!1,N.start())}function Ia(a,b){a.l.appendChild(b)}function T(a,b){a.end();Ia(a,Ja("h1",b));a.h=r("table")}function Ja(a,b){a=r(a);a.innerHTML=b;return a}function U(a,b=function(){}){const c=r("button");m[a]=!m[a];let d=!0;c.onclick=function(){m[a]=!m[a];1==m[a]?(c.innerHTML="ON",c.style["background-color"]="#23c552"):(c.innerHTML="OFF",c.style["background-color"]="#f84f31");n();d?d=!1:b(m[a])};c.onclick();return c}function W(a){const b=r("button");b.innerHTML=h[a];b.onclick=async function(){b.innerHTML="...";const c=await Da();b.innerHTML=c;h[a]=c;ba()};b.style.color="#000";return b}function V(a,b,c="",d=function(){}){const g=r("div");g.className="input";const k=r("input");k.type="range";k.min=m[b].min;k.max=m[b].max;k.step=m[b].step;k.value=m[b].value;k.oninput=function(){k.nextElementSibling.innerHTML=k.value+c;m[b].value=k.valueAsNumber;d()};k.onchange=n;g.appendChild(k);g.appendChild(a.text(k.value+c));return g}class La{constructor(){this.j=q("ID_settings_container");this.l=q("ID_settings");this.g=this.i=!1;this.h=null;Ga(this)}add(a,b){const c=r("tr");let d=r("td");d.appendChild(a);c.appendChild(d);d=r("td");d.appendChild(b);b.onchange=n;c.appendChild(d);this.h.appendChild(c)}end(){null!=this.h&&Ia(this,this.h)}text(a){return Ja("h3",a)}button(a,b){const c=r("button");c.innerHTML=a;c.onclick=b;return c}}class Ma{constructor(){this.h=r("canvas");this.g=this.h.getContext("2d");this.i=r("canvas");this.j=this.i.getContext("2d");this.height=this.width=0}}class Na{constructor(){this.h=q("ID_canvas");this.g=this.h.getContext("2d");this.height=this.width=0;this.j=this.i=m.fov.value;this.o=-1;this.v=!1;this.u=this.l=0;this.h.onwheel=this.F.bind(this);this.h.onmousedown=this.D.bind(this);this.h.oncontextmenu=this.B.bind(this)}stop(){this.v=!0;this.h.parentElement.removeChild(this.h)}F(a){a=.05*-Math.sign(a.deltaY);this.j=1<this.j?this.j+3*a:this.j+a;this.j=Math.min(Math.max(this.j,m.fov.min),m.fov.max)}D(){N.v=!N.v;X(N)}B(a){a.preventDefault();return!1}text(a,b,c){this.g.font="700 20px Ubuntu";this.g.textAlign="center";this.g.textBaseline="middle";this.g.fillStyle="#fff";this.g.strokeStyle="#333";this.g.lineWidth=1;this.g.fillText(a,b,c);this.g.strokeText(a,b,c)}A(a){if(!this.v){this.l=Math.min(Math.max(this.l,B.g[0]),B.g[1]);var b=this.i;this.i=w(this.i,this.j,.1);this.i!=b&&X(N);b=B.g[0]==B.g[1]?1:(this.l-B.g[0])/(B.g[1]-B.g[0]);this.l+=a-this.u;this.u=a;H.x=w(H.x1,H.x2,b);H.y=w(H.y1,H.y2,b);this.g.resetTransform();this.g.fillStyle="#333";this.g.fillRect(0,0,this.h.width,this.h.height);this.g.translate(.5*this.h.width,.5*this.h.height);this.g.scale(this.i,this.i);this.g.translate(-H.x,-H.y);this.g.drawImage(Q.h,0,0,Q.width,Q.height);1>this.i&&(this.g.globalAlpha=1-4*(this.i-m.fov.min)/3,this.g.drawImage(Q.i,0,0,Q.width,Q.height),this.g.globalAlpha=1);a=Array(65635);var c=0;if(m.draw_player_fill||m.draw_player_stroke)for(var d=0;100>d;++d)void 0!=I.g[d]&&(I.g[d].x=w(I.g[d].x1,I.g[d].x2,b),I.g[d].y=w(I.g[d].y1,I.g[d].y2,b),I.g[d].r=w(I.g[d].r1,I.g[d].r2,b),a[c++]=I.g[d]);if(m.draw_ball_fill||m.draw_ball_stroke)for(d=0;65535>d;++d)void 0!=J.g[d]&&(J.g[d].x=w(J.g[d].x1,J.g[d].x2,b),J.g[d].y=w(J.g[d].y1,J.g[d].y2,b),J.g[d].r=w(J.g[d].r1,J.g[d].r2,b),a[c++]=J.g[d]);a.sort((g,k)=>k.r-g.r);for(b=0;b<a.length;++b)void 0!=a[b]&&(this.g.beginPath(),c=a[b],c.H||(d=m.ball_stroke.value/200*c.r,this.g.moveTo(c.x+c.r-d,c.y),this.g.arc(c.x,c.y,c.r-d,0,2*Math.PI),m.draw_ball_fill&&(this.g.fillStyle=ia[c.type],this.g.fill()),m.draw_ball_stroke&&(this.g.strokeStyle=!m.draw_ball_fill&&m.draw_ball_stroke_bright?ia[c.type]:ea(ia[c.type]),this.g.lineWidth=2*d,this.g.stroke())));this.o=window.requestAnimationFrame(this.A.bind(this))}}}class Oa{constructor(){this.h=this.i=this.g=0;this.j=[0,0];window.onresize=this.l.bind(this);window.onkeyup=this.v.bind(this);window.onkeydown=this.u.bind(this);window.onmousemove=this.A.bind(this);window.onbeforeunload=this.o.bind(this)}l(){if(window.devicePixelRatio!=this.g||window.innerWidth!=this.i||window.innerHeight!=this.h){this.g=window.devicePixelRatio;this.i=window.innerWidth;this.h=window.innerHeight;var a=K;a.width=Y.i*Y.g;a.height=Y.h*Y.g;a.h.width=a.width;a.h.height=a.height}}u(a){if(!a.repeat)if(Ea.g)a.preventDefault(),Ea.h(a.code);else if(a.code==h.settings)Z.i?Ka(Z):(a=Z,a.g||(a.i=!0,a.j.style.display="block",N.stop(),N.block()));else switch(a.code){case "Enter":G.focus(a);break;case h.slowwalk:1==N.g&&(Pa(.5),X(N));break;case h.up:N.o||(N.o=1,X(N));break;case h.down:N.l||(N.l=1,X(N));break;case h.left:N.i||(N.i=1,X(N));break;case h.right:N.j||(N.j=1,X(N))}}v(a){if(!a.repeat)switch(a.code){case h.slowwalk:.5==N.g&&(Pa(1),X(N));break;case h.up:N.o&&(N.o=0,X(N));break;case h.down:N.l&&(N.l=0,X(N));break;case h.left:N.i&&(N.i=0,X(N));break;case h.right:N.j&&(N.j=0,X(N))}}A(a){this.j=[a.clientX*this.g,a.clientY*this.g];X(N)}o(a){if(C.g)return a.preventDefault(),a.returnValue="Are you sure you want to quit?",n(),"Are you sure you want to quit?"}}function X(a){if(-1!=C.id&&!a.h){a=E;let c=0;var b=0;if(N.v){b=Y.j[0]-.5*K.h.width;const d=Y.j[1]-.5*K.h.height;c=Math.atan2(d,b);b=Math.hypot(b,d)/K.i}else if(N.o!=N.l||N.i!=N.j)c=Math.atan2(N.l-N.o,N.j-N.i),b=160*Y.g;a.h[0]=1;a.view.setFloat32(1,c,!0);a.h[5]=b>=160*Y.g?255*N.g:1.59375*b/Y.g*N.g;a.i=6;F(B)}}function Pa(a){var b=N;b.h||(b.u=a);b.g=a}class Qa{constructor(){this.v=!1;this.u=this.g=1;this.h=!1;this.j=this.i=this.l=this.o=0}block(){this.h=!0}stop(){this.h||(this.g=this.u,this.u=0,X(this))}start(){this.h||(this.u=this.g,X(this))}}function ka(){t.innerHTML="Connecting";y.name.style.display="none";xa(G,"Waiting for connection...");var a=Z;a.i&&(a.g=!1,Ka(a));a.g=!0}function ta(a){a.g=!1;t.innerHTML="Disconnected";y.name.style.display="none";a=y;a.o.style.display="none";a.u.style.display="none";a.l.style.display="block"}class Ra{constructor(){this.i=this.h=this.g=!1;this.id=-1}j(){t.innerHTML="";y.name.style.display="block";D();ya();G.A();Z.g=!1}}const y=new oa,B=new pa,E=new va,Ha=new wa,G=new za,H=new Aa,I=new Ba,J=new Ca,Ea=new Fa,Z=new La,Q=new Ma,K=new Na,Y=new Oa,N=new Qa,C=new Ra;Y.l();(async function(){ka();let a;var b=new Promise(function(g){a=g});const c=[];for(const [,,g]of y.j)c[c.length]=new la(g,a);setTimeout(a,2E3,"");b=await b;let d;if(0==b.length){b=0;for(const g of c)g.m.readyState==WebSocket.OPEN&&g.C>b&&(b=g.C,d=g.m.url)}else d=b;if(void 0==d)throw t.innerHTML="Couldn't connect to any server",setTimeout(location.reload.bind(location),1E3),Error(t.innerHTML);for(const g of c)g.m.url!=d?g.stop():ma(g);na()})();