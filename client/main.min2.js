const f=window.localStorage,g=f.getItem.bind(f),k=f.setItem.bind(f),aa=f.removeItem.bind(f),ba=g("keybinds"),l={settings:"Escape",up:"KeyW",left:"KeyA",right:"KeyD",down:"KeyS",slowwalk:"ShiftLeft"};let m=null!=ba?JSON.parse(ba):l;for(const a in l)a in m||(m[a]=l[a]);for(const a in m)a in l||delete m[a];function ca(){k("keybinds",JSON.stringify(m))}const da=g("settings"),n={fov:{min:.25,max:1.75,value:1.75,step:.05},chat_on:!0,max_chat_messages:{min:1,max:1E3,value:100,step:1},chat_text_scale:{min:1,max:2,value:1,step:.05},draw_ball_fill:!0,draw_ball_stroke:!0,draw_ball_stroke_bright:!0,ball_stroke:{min:0,max:100,value:20,step:1},draw_player_fill:!0,draw_player_stroke:!0,draw_player_stroke_bright:!0,player_stroke:{min:0,max:100,value:10,step:1},draw_player_name:!0,draw_death_arrow:!0,death_arrow_size:{min:10,max:100,value:40,step:1},show_tutorial:!0,show_ping:!1};let p=null!=da?JSON.parse(da):JSON.parse(JSON.stringify(n));for(const a in n)a in p||(p[a]=n[a]);for(const a in p)a in n?(p[a].min&&p[a].min!=n[a].min&&(p[a].min=n[a].min),p[a].max&&p[a].max!=n[a].max&&(p[a].max=n[a].max),p[a].step&&p[a].step!=n[a].step&&(p[a].step=n[a].step),p[a].value=Math.max(Math.min(p[a].value,p[a].max),p[a].min)):delete p[a];function ea(){k("settings",JSON.stringify(p))}const q=document.getElementById.bind(document),r=document.createElement.bind(document),u=q("ID_status"),fa=g("token");let ha=[];"string"==typeof fa&&(ha=fa.split(",").map(a=>+a));function ia(){setTimeout(location.reload.bind(location),1E3)}function ja(a){return"#"+(.8*parseInt(a.substring(1,3),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(a.substring(3,5),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(a.substring(5,7),16)>>0).toString(16).padStart(2,"0")+a.substring(7)}function ka(a){const b=a.match(/\/\/(.*?)\.shadam\.xyz/),c=a.match(/\/\/(.*?)[\/:]/);return b?b[1]:c?c[1]:a}WebSocket.prototype.send=new Proxy(WebSocket.prototype.send,{apply:function(a,b,c){if(b.readyState==WebSocket.OPEN)return a.apply(b,c)},configurable:!0,enumerable:!0});WebSocket.prototype.close=new Proxy(WebSocket.prototype.close,{apply:function(a,b,c){if(b.readyState==WebSocket.CONNECTING||b.readyState==WebSocket.OPEN)return a.apply(b,c)},configurable:!0,enumerable:!0});function la(a){return function(b){const c=b instanceof ClipboardEvent;if(!c||"paste"==b.type){var d=b.target.value+(c?b.clipboardData.getData("text"):b.key);if((new TextEncoder).encode(d).byteLength-b.target.selectionEnd+b.target.selectionStart>a){if(""==b.target.value&&c){const e=b.target.placeholder;b.target.placeholder="Text too long to paste!";setTimeout(function(){b.target.placeholder=e},1E3)}b.preventDefault()}}}}function ma(a,b){var c=.75*v.size;c*=x.h;a=.5*x.width+(a-y.x)*x.h;const d=.5*x.height+(b-y.y)*x.h;b=!1;if(0>a||a>x.width-0)b=!0,a=Math.max(Math.min(a,x.width-c),c);0>d||d>x.height-0?(b=!0,c=Math.max(Math.min(d,x.height-c),c)):c=d;return[(a-.5*x.width)/x.h+y.x,(c-.5*x.height)/x.h+y.y,b]}function z(a,b,c){return a+(b-a)*c}if(0==window.s.length)throw u.innerHTML="No servers found",ia(),Error(u.innerHTML);u.innerHTML="Connecting";const na=["#dddddd","#aaaaaa","#333333","#fedf78"],oa="#808080 #fc46aa #008080 #ff8e06 #3cdfff #663a82".split(" ");function pa(a){a.h.innerHTML="";for(const b of a.j){const c=r("option");c.value=b[2];b[2]==A.u.url&&(c.selected=!0,c.disabled=!0,a.g=c);b[0]>=b[1]&&(c.disabled=1);const d=ka(b[2]);c.innerHTML=d[0].toUpperCase()+d.substring(1)+` (${b[0]}/${b[1]})`;a.h.appendChild(c)}a.h.onfocus=function(){k("psfy_tooltip","");this.B.style.display="none"}.bind(a);a.h.onchange=async function(){this.g.disabled=!1;const b=this.g;this.g=this.h.selectedOptions[0];this.g.disabled=!0;qa();let c;const d=new Promise(function(h){c=h}),e=new ra(this.g.value,c,1);setTimeout(c,2E3);await d;0==e.H||e.u.readyState!=WebSocket.OPEN?(e.stop(),u.innerHTML="Couldn't connect, returning to previous server",this.g.disabled=!1,this.g=b,this.g.disabled=!0,setTimeout(B.j.bind(B),1E3)):sa(e)}.bind(a);ta(a)}function ua(){var a=E;pa(a);a.A=setInterval(function(){fetch("servers.json").then(b=>b.json()).then(function(b){E.j=b;pa(E)})},5E3)}function F(){E.i.style.display="block"}function ta(a){void 0==g("psfy_tooltip")&&(a.F.innerHTML="We picked a server<br>for you automatically.<br><br>You can change it here.",a.B.style.display="table")}class va{constructor(){this.i=q("ID_menu");this.name=q("ID_name");this.h=q("ID_select_serv");this.g=null;this.j=window.s;this.B=q("ID_picked_server_for_you");this.F=q("ID_picked_server_for_you_tooltip");this.m=q("ID_ping");this.D();this.o=q("ID_play");this.v=q("ID_refresh");this.v.onclick=location.reload.bind(location);this.name.onkeypress=this.name.onpaste=la(16);this.name.onchange=function(){B.i=!1;k("name",this.value)};this.A=-1;const a=g("name");"string"==typeof a&&16>=(new TextEncoder).encode(a).length&&(this.name.value=a);this.o.onclick=function(){var b=G;wa(b);b.g[0]=0;b.h=1;H(A)}}D(){this.m.style.display=p.show_ping?"block":"none"}}function H(a){a.u.send(G.g.subarray(0,G.h))}function sa(a){var b=A;null!=b.u&&(b.stop(),b.once=!1,b.i=!1,b.g=[0,0]);b.G=a.G;b.I=a.I;b.C=a.C;b.l=a.l;b.u=a.u;b.u.onmessage=b.message.bind(b);b.u.onclose=b.close.bind(b);a=G;0==ha.length?a.h=1:(a.g.set(ha),a.h=ha.length);H(b);b.h()}function xa(a){a.G[a.l]=(new Date).getTime()-a.I;a.C=0;let b=a.l,c=0;for(let d=0;10>d;++d)0!=a.G[b]&&(a.C+=(10-c)/11*a.G[b],++c),b=(b+1)%10;0!=c&&(a.C/=.5*c);a.l=(a.l+1)%10;setTimeout(a.j.bind(a),10)}class ya{constructor(){this.u=null;this.i=this.once=!1;this.G=Array(10).fill(0);this.l=this.C=this.I=0;this.g=[0,0]}h(){this.once=!0;var a=I;a.o=Array(5).fill(0);a.j=0;a.h.innerHTML="";a.i=0;a.v=!1;a.B="Press enter to chat";a.A();y.g=!1;J.g=Array(100);K.g=Array(65535);a=x;a.h=p.fov.value;a.j=a.h;cancelAnimationFrame(a.o);a.o=-1;a.A=!1;a.m=0;a.v=0;a=L;a.g=!1;a.o=!1;a.v=1;a.h=1;a=B;a.g=!1;a.h=!1;a.i=!1;a.id=-1}message({data:a}){G.set(new Uint8Array(a));if(0==G.h)xa(this);else{var b=P()-1;a=!1;b!=B.id&&(B.id=b,a=!0);b=P();var c=b&1;c&&!B.g?(B.g=!0,E.i.style.display="none"):!c&&B.g&&(B.g=!1,F(),L.o=!1);(b&=2)&&!B.h?(B.h=!0,E.i.style.display="none"):!b&&B.h&&(B.h=!1,F(),L.o=!1);this.g[0]=this.g[1];this.g[1]=performance.now();b=J;for(c=0;100>c;++c)void 0!=b.g[c]&&(b.g[c].x1=b.g[c].x2,b.g[c].y1=b.g[c].y2,b.g[c].r1=b.g[c].r2);b=K;for(c=0;65535>c;++c)void 0!=b.g[c]&&(b.g[c].x1=b.g[c].x2,b.g[c].y1=b.g[c].y2,b.g[c].r1=b.g[c].r2);for(za(y);G.l<G.h;)switch(P()){case 0:K.g=Array(65535);za(y);b=Q;P();var d=P(),e=P();c=P();var h=p.fov.max,C=c*h,D=Array(P());for(var t=0;t<D.length;++t)D[t]=[(P()+.5)*C,(P()+.5)*C,P()];t=Array(256);var M=Array(256);for(var N=0;N<d;++N)for(var O=0;O<e;++O){const R=G.g[G.l];2!=R&&(void 0==t[R]&&(t[R]=new Path2D,M[R]=new Path2D),t[R].rect((1.5+N*c)*h,(1.5+O*c)*h,(c-3)*h,(c-3)*h),M[R].rect(N*C,O*C,C,C));++G.l}b.width=d*c;b.height=e*c;b.h.width=b.width*h;b.h.height=b.height*h;b.i.width=b.h.width;b.i.height=b.h.height;for(d=0;256>d;++d)void 0!=t[d]&&(b.g.fillStyle=na[d]+"b0",b.g.fill(M[d]),b.g.fillStyle=na[d],b.g.fill(t[d]),b.j.fillStyle=na[d],b.j.fill(M[d]));b.g.font=`700 ${c}px Ubuntu`;b.g.textAlign="center";b.g.textBaseline="middle";b.g.fillStyle=ja(na[3]);for(var w of D)b.g.fillText(w[2],w[0],w[1]);break;case 1:b=J;c=P();for(D=0;D<c;++D)if(d=P(),void 0==b.g[d])e=S(),h=S(),C=S(),t=P(),t=Aa(t),M=P(),N=0,M&&(N=P()),O=P(),0<O&&T(I,t,Aa(O)),b.g[d]={x:0,y:0,r:0,x1:e,x2:e,y1:h,y2:h,r1:C,r2:C,name:t,J:M,K:N,L:0,M:!0},B.id==d&&(d=y,d.g||(d.x2=e,d.y2=h));else if(e=P(),0==e)delete b.g[d];else{do{switch(e){case 1:b.g[d].x2=S();B.id==d&&(e=y,e.g||(e.x2=b.g[d].x2));break;case 2:b.g[d].y2=S();B.id==d&&(e=y,e.g||(e.y2=b.g[d].y2));break;case 3:b.g[d].r2=S();break;case 4:b.g[d].J=P();b.g[d].J&&(b.g[d].K=P());break;case 5:e=P();T(I,b.g[d].name,Aa(e));break;default:throw Error();}e=P()}while(e)}break;case 2:b=K;c=Ba();for(D=0;D<c;++D)if(d=Ba(),void 0==b.g[d])e=P()-1,h=S(),C=S(),t=S(),b.g[d]={type:e,x:0,y:0,r:0,x1:h,x2:h,y1:C,y2:C,r1:t,r2:t,M:!1};else if(e=P(),0==e)delete b.g[d];else{do{switch(e){case 1:b.g[d].x2=S();break;case 2:b.g[d].y2=S();break;case 3:b.g[d].r2=S();break;default:throw Error();}e=P()}while(e)}break;case 3:b=I;c=P();for(D=0;D<c;++D)e=P(),d=(new TextDecoder).decode(G.g.subarray(G.l,G.l+e)),G.l+=e,e=P(),T(b,d,(new TextDecoder).decode(G.g.subarray(G.l,G.l+e))),G.l+=e;break;default:throw Error();}if(G.l>G.h)throw Error();-1==B.id?(w=y,a=.5*Q.height,w.g||(w.x2=.5*Q.width,w.y2=a),za(w)):a&&(w=y,a=J.g[B.id].y2,w.g||(w.x2=J.g[B.id].x2,w.y2=a));0==this.g[0]||this.i||(this.i=!0,w=x,w.o=window.requestAnimationFrame(w.B.bind(w)),B.j())}}close(a){4E3==a?(Ca(),u.innerHTML="Server is full"):Ca()}j(){this.I=(new Date).getTime();this.u.send(new Uint8Array(0))}stop(){this.u.onopen=this.u.onmessage=this.u.onclose=null;this.u.close()}}function Da(a){a.u=new WebSocket(a.m);a.u.binaryType="arraybuffer";a.u.onopen=a.h.bind(a);a.u.onmessage=a.message.bind(a);a.u.onclose=a.close.bind(a)}class ra extends ya{constructor(a,b,c=8){super();this.H=0;this.o=c;this.v=b;this.m=a;Da(this)}h(){this.j()}message(){xa(this);++this.H==this.o&&this.v(this.u.url)}close(){Da(this)}}function P(){var a=G;return a.g[a.l++]}function Ba(){var a=G;const b=a.g[a.l]|a.g[a.l+1]<<8;a.l+=2;return b}function S(){var a=G;const b=a.view.getFloat32(a.l,!0);a.l+=4;return b}function Aa(a){var b=G;const c=(new TextDecoder).decode(b.g.subarray(b.l,b.l+a));b.l+=a;return c}function wa(a){if(!B.i){B.i=!0;a.g[0]=3;var b=E;b=(new TextEncoder).encode(b.name.value);a.g.set(b,1);a.h=b.length+1;H(A)}}class Ea{constructor(){this.i=new ArrayBuffer(1048576);this.g=new Uint8Array(this.i);this.view=new DataView(this.i);this.l=this.h=0}set(a){this.g.set(a);this.h=a.length;this.l=0}}function Fa(a){var b=v;a.drawImage(b.h,.5*-b.h.width,.5*-b.h.height)}class Ga{constructor(){this.h=r("canvas");this.g=this.h.getContext("2d");this.size=0;this.i()}i(){this.size=p.death_arrow_size.value;this.h.width=this.h.height=this.size;const a=.5*this.h.width,b=this.h.width;this.g.beginPath();this.g.moveTo(a+.45*b,a);this.g.lineTo(a-.225*b,a-.675*b/Math.sqrt(3));this.g.lineTo(a-.225*b,a+.675*b/Math.sqrt(3));this.g.closePath();this.g.fillStyle="#bbbbbbb0";this.g.fill();this.g.lineWidth=.1*a;this.g.strokeStyle="#f00";this.g.stroke()}}function Ha(a){void 0==g("tth_tooltip")&&(a.R.innerHTML='Try "/help"',a.F.style.display="inline-block")}function T(a,b,c,d=!1){const e=r("p");e.appendChild(document.createTextNode((d?"":b+": ")+c));a.h.insertBefore(e,a.h.firstChild);++a.i>p.max_chat_messages.value&&a.h.removeChild(a.h.lastChild)}function Ia(a){a.g.value="";a.g.blur();x.i.focus()}function Ja(a,b){a.B=a.g.placeholder;a.g.placeholder=b;a.g.disabled=!0;a.g.value="";x.i.focus()}function Ka(){var a=I;!a.v&&p.chat_on&&(a.D.style.display="block")}class La{constructor(){this.o=Array(5).fill(0);this.j=0;this.D=q("ID_chat");this.h=q("ID_messages");this.g=q("ID_sendmsg");this.F=q("ID_try_typing_help");this.R=q("ID_try_typing_help_tooltip");Ha(this);this.P=la(128);this.i=0;this.v=!1;this.B="";this.m=-1;this.g.onkeydown=function(a){a.stopPropagation();if("Enter"==a.code){a=this.g.value.trim();switch(a){case "/help":T(this,null,"Available commands:",!0);T(this,null,"/clear /c => clear the chat",!0);T(this,null,"/respawn /r => tp to the first area",!0);T(this,null,"/die /d => become downed",!0);T(this,null,"/menu /m => quit the game and open the menu",!0);Ia(this);k("tth_tooltip","");this.F.style.display="none";return;case "/c":case "/clear":this.h.innerHTML="";this.i=0;Ia(this);return}a=(new TextEncoder).encode(a);if(0<a.length){var b=G;wa(b);b.g[0]=2;b.g.set(a,1);b.h=a.length+1;H(A);this.o[this.j]=(new Date).getTime();a=(this.j+1)%5;b=5E3-this.o[this.j]+this.o[a];this.j=a;0<b?(Ja(this,"You are on cooldown for sending too many messages too quickly"),this.m=setTimeout(this.A.bind(this),b)):Ia(this)}}}.bind(this);this.g.onkeyup=function(a){a.stopPropagation()};this.g.onkeypress=this.g.onpaste=this.P}A(){-1!=this.m&&(clearTimeout(this.m),this.m=-1);this.g.disabled=!1;this.g.placeholder=this.B}focus(){this.g.focus()}N(){for(;this.i>p.max_chat_messages.value;)this.h.removeChild(this.h.lastChild),--this.i}O(){this.h.style["font-size"]=p.chat_text_scale.value+"em"}}function za(a){a.x1=a.x2;a.y1=a.y2}class Ma{constructor(){this.y2=this.x2=this.y1=this.x1=this.y=this.x=0;this.g=!1}block(){this.g=!0}}class Na{constructor(){this.g=Array(100)}}class Oa{constructor(){this.g=Array(65535)}}function Pa(){var a=Qa;a.g=!0;return new Promise(function(b){a.h=function(c){a.g=!1;b(c)}})}class Ra{constructor(){this.h=null;this.g=!1}}function Sa(a){a.m.innerHTML="";U(a,"CHAT");a.add(a.text("Show chat"),V("chat_on",function(b){b?Ka():(b=I,b.v||(b.D.style.display="none"))}));a.add(a.text("Max number of chat messages"),W(a,"max_chat_messages","",I.N.bind(I)));a.add(a.text("Chat text scale"),W(a,"chat_text_scale","",I.O.bind(I)));U(a,"MENU");a.add(a.text("Show latency"),V("show_ping",E.D.bind(E)));U(a,"GAME");a.add(a.text("Enable tutorial"),V("show_tutorial"));U(a,"VISUALS");a.add(a.text("Default FOV"),W(a,"fov"));a.add(a.text("Draw balls' fill"),V("draw_ball_fill"));a.add(a.text("Draw balls' stroke"),V("draw_ball_stroke"));a.add(a.text("Draw stroke-only balls with brighter color"),V("draw_ball_stroke_bright"));a.add(a.text("Balls' stroke radius percentage"),W(a,"ball_stroke","%"));a.add(a.text("Draw players' fill"),V("draw_player_fill"));a.add(a.text("Draw players' stroke"),V("draw_player_stroke"));a.add(a.text("Draw stroke-only players with brighter color"),V("draw_player_stroke_bright"));a.add(a.text("Players' stroke radius percentage"),W(a,"player_stroke","%"));a.add(a.text("Draw players' name"),V("draw_player_name"));a.add(a.text("Draw an arrow towards dead players"),V("draw_death_arrow"));a.add(a.text("Death arrow size"),W(a,"death_arrow_size","px",v.i.bind(v)));U(a,"KEYBINDS");Ta(a,Ua("h5","To change, click a button on the right side and then press the key you want to assign to it."));a.add(a.text("Settings"),X("settings"));a.add(a.text("Move up"),X("up"));a.add(a.text("Move left"),X("left"));a.add(a.text("Move down"),X("down"));a.add(a.text("Move right"),X("right"));a.add(a.text("Move slowly"),X("slowwalk"));U(a,"RESET");a.add(a.text("Reset settings"),a.button("RESET",function(){p=n;ea();Sa(this)}.bind(a)));a.add(a.text("Reset keybinds"),a.button("RESET",function(){m=l;ca();Sa(this)}.bind(a)));a.add(a.text("Reset all tooltips"),a.button("RESET",function(){aa("psfy_tooltip");ta(E);aa("tth_tooltip");Ha(I)}));a.end()}function Va(a){a.g||(a.i=!1,a.j.style.display="none",L.g=!1,L.start())}function Wa(){var a=Xa;a.i&&(a.g=!1,Va(a));a.g=!0}function Ta(a,b){a.m.appendChild(b)}function U(a,b){a.end();Ta(a,Ua("h1",b));a.h=r("table")}function Ua(a,b){a=r(a);a.innerHTML=b;return a}function V(a,b=function(){}){const c=r("button");p[a]=!p[a];let d=!0;c.onclick=function(){p[a]=!p[a];1==p[a]?(c.innerHTML="ON",c.style["background-color"]="#23c552"):(c.innerHTML="OFF",c.style["background-color"]="#f84f31");ea();d?d=!1:b(p[a])};c.onclick();return c}function X(a){const b=r("button");b.innerHTML=m[a];b.onclick=async function(){b.innerHTML="...";const c=await Pa();b.innerHTML=c;m[a]=c;ca()};b.style.color="#000";return b}function W(a,b,c="",d=function(){}){const e=r("div");e.className="input";const h=r("input");h.type="range";h.min=p[b].min;h.max=p[b].max;h.step=p[b].step;h.value=p[b].value;h.oninput=function(){h.nextElementSibling.innerHTML=h.value+c;p[b].value=h.valueAsNumber;d()};h.onchange=ea;e.appendChild(h);e.appendChild(a.text(h.value+c));return e}class Ya{constructor(){this.j=q("ID_settings_container");this.m=q("ID_settings");this.g=this.i=!1;this.h=null;Sa(this)}add(a,b){const c=r("tr");let d=r("td");d.appendChild(a);c.appendChild(d);d=r("td");d.appendChild(b);b.onchange=ea;c.appendChild(d);this.h.appendChild(c)}end(){null!=this.h&&(Ta(this,this.h),this.h=null)}text(a){return Ua("h3",a)}button(a,b){const c=r("button");c.innerHTML=a;c.onclick=b;return c}}class Za{constructor(){this.h=r("canvas");this.g=this.h.getContext("2d");this.i=r("canvas");this.j=this.i.getContext("2d");this.height=this.width=0}}class $a{constructor(){this.i=q("ID_canvas");this.g=this.i.getContext("2d");this.height=this.width=0;this.j=this.h=p.fov.value;this.o=-1;this.A=!1;this.v=this.m=0;this.i.onwheel=this.F.bind(this);this.i.onmousedown=this.D.bind(this)}stop(){this.A=!0;this.i.parentElement.removeChild(this.i)}F(a){a=.05*-Math.sign(a.deltaY);this.j=1<this.j?this.j+3*a:this.j+a;this.j=Math.min(Math.max(this.j,p.fov.min),p.fov.max)}D(){L.o=!L.o;Y(L)}text(a,b,c){this.g.font="700 20px Ubuntu";this.g.textAlign="center";this.g.textBaseline="middle";this.g.fillStyle="#fff";this.g.strokeStyle="#333";this.g.lineWidth=1;this.g.fillText(a,b,c);this.g.strokeText(a,b,c)}B(a){if(!this.A){this.m=Math.min(Math.max(this.m,A.g[0]),A.g[1]);var b=this.h;this.h=z(this.h,this.j,.1);this.h!=b&&Y(L);b=A.g[0]==A.g[1]?1:(this.m-A.g[0])/(A.g[1]-A.g[0]);this.m+=a-this.v;this.v=a;p.show_ping&&(E.m.innerHTML=A.C.toFixed(1)+"ms");y.x=z(y.x1,y.x2,b);y.y=z(y.y1,y.y2,b);this.g.resetTransform();this.g.fillStyle="#333";this.g.fillRect(0,0,this.i.width,this.i.height);this.g.translate(.5*this.i.width,.5*this.i.height);this.g.scale(this.h,this.h);this.g.translate(-y.x,-y.y);this.g.drawImage(Q.h,0,0,Q.width,Q.height);1>this.h&&(this.g.globalAlpha=1-4*(this.h-p.fov.min)/3,this.g.drawImage(Q.i,0,0,Q.width,Q.height),this.g.globalAlpha=1);a=Array(65635);var c=0;if(p.draw_player_fill||p.draw_player_stroke)for(var d=0;100>d;++d)void 0!=J.g[d]&&(J.g[d].x=z(J.g[d].x1,J.g[d].x2,b),J.g[d].y=z(J.g[d].y1,J.g[d].y2,b),J.g[d].r=z(J.g[d].r1,J.g[d].r2,b),a[c++]=J.g[d]);if(p.draw_ball_fill||p.draw_ball_stroke)for(d=0;65535>d;++d)void 0!=K.g[d]&&(K.g[d].x=z(K.g[d].x1,K.g[d].x2,b),K.g[d].y=z(K.g[d].y1,K.g[d].y2,b),K.g[d].r=z(K.g[d].r1,K.g[d].r2,b),a[c++]=K.g[d]);a.sort((e,h)=>h.r-e.r);for(b=0;b<a.length;++b)if(void 0!=a[b])if(this.g.beginPath(),c=a[b],c.M){if(d=p.player_stroke.value/200*c.r,this.g.moveTo(c.x+c.r-d,c.y),this.g.arc(c.x,c.y,c.r-d,0,2*Math.PI),p.draw_player_fill&&(this.g.fillStyle="#ebecf0",this.g.fill()),p.draw_player_stroke&&(!p.draw_player_fill&&p.draw_player_stroke_bright?this.g.strokeStyle="#ebecf0":this.g.strokeStyle=ja("#ebecf0"),this.g.lineWidth=2*d,this.g.stroke()),p.draw_player_name&&0!=c.name.length&&(this.g.font=`700 ${c.r/this.h}px Ubuntu`,this.g.textAlign="center",this.g.textBaseline="middle",this.g.fillStyle="#00000080",c.L=z(c.L,1<this.h?.5*c.r:.5*c.r+2/(this.h*this.h),.1),this.g.fillText(c.name,c.x,c.y-c.r-c.L)),c.J&&(this.g.font=`700 ${c.r/Math.min(this.h,1)}px Ubuntu`,this.g.textAlign="center",this.g.textBaseline="middle",this.g.fillStyle="#f00",this.g.fillText(c.K,c.x,c.y),p.draw_death_arrow)){const [e,h,C]=ma(c.x,c.y);C&&(this.g.translate(e,h),d=Math.atan2(c.y-h,c.x-e),this.g.rotate(d),Fa(this.g),this.g.rotate(-d),this.g.font=`700 ${.3*v.size}px Ubuntu`,this.g.fillText(c.K,0,0),this.g.translate(-e,-h))}}else d=p.ball_stroke.value/200*c.r,this.g.moveTo(c.x+c.r-d,c.y),this.g.arc(c.x,c.y,c.r-d,0,2*Math.PI),p.draw_ball_fill&&(this.g.fillStyle=oa[c.type],this.g.fill()),p.draw_ball_stroke&&(this.g.strokeStyle=!p.draw_ball_fill&&p.draw_ball_stroke_bright?oa[c.type]:ja(oa[c.type]),this.g.lineWidth=2*d,this.g.stroke());this.o=window.requestAnimationFrame(this.B.bind(this))}}}class ab{constructor(){this.h=this.i=this.g=0;this.j=[0,0];window.onresize=this.m.bind(this);window.onkeyup=this.A.bind(this);window.onkeydown=this.v.bind(this);window.onmousemove=this.B.bind(this);window.onbeforeunload=this.o.bind(this)}m(){if(window.devicePixelRatio!=this.g||window.innerWidth!=this.i||window.innerHeight!=this.h){this.g=window.devicePixelRatio;this.i=window.innerWidth;this.h=window.innerHeight;var a=x;a.width=Z.i*Z.g;a.height=Z.h*Z.g;a.i.width=a.width;a.i.height=a.height}}v(a){if(!a.repeat)if(Qa.g)a.preventDefault(),Qa.h(a.code);else if(a.code==m.settings)Xa.i?Va(Xa):(a=Xa,a.g||(a.i=!0,a.j.style.display="block",L.stop(),L.block()));else switch(a.code){case "Enter":I.focus(a);break;case m.slowwalk:1==L.v&&(bb(.5),Y(L));break;case m.up:L.A||(L.A=1,Y(L));break;case m.down:L.m||(L.m=1,Y(L));break;case m.left:L.i||(L.i=1,Y(L));break;case m.right:L.j||(L.j=1,Y(L))}}A(a){if(!a.repeat)switch(a.code){case m.slowwalk:.5==L.v&&(bb(1),Y(L));break;case m.up:L.A&&(L.A=0,Y(L));break;case m.down:L.m&&(L.m=0,Y(L));break;case m.left:L.i&&(L.i=0,Y(L));break;case m.right:L.j&&(L.j=0,Y(L))}}B(a){this.j=[a.clientX*this.g,a.clientY*this.g];Y(L)}o(a){if(B.g)return a.preventDefault(),a.returnValue="Are you sure you want to quit?"}}function Y(a){if(B.g&&!a.g){a=G;let c=0;var b=0;if(L.o){b=Z.j[0]-.5*x.i.width;const d=Z.j[1]-.5*x.i.height;c=Math.atan2(d,b);b=Math.hypot(b,d)/x.h}else if(L.A!=L.m||L.i!=L.j)c=Math.atan2(L.m-L.A,L.j-L.i),b=160*Z.g;a.g[0]=1;a.view.setFloat32(1,c,!0);a.g[5]=b>=160*Z.g?255*L.h:1.59375*b/Z.g*L.h;a.h=6;H(A)}}function bb(a){var b=L;b.g||(b.h=a);b.v=a}class cb{constructor(){this.o=!1;this.h=this.v=1;this.g=!1;this.j=this.i=this.m=this.A=0}block(){this.g=!0}stop(){this.g||(this.v=this.h,this.h=0,Y(this))}start(){this.g||(this.h=this.v,Y(this))}}function qa(){F();E.name.style.display="none";u.innerHTML="Connecting";Ka();Ja(I,"Waiting for connection...");Wa()}function Ca(){B.g=!1;F();E.name.style.display="none";u.innerHTML="Disconnected";var a=E;A.once||ia();a.o.style.display="none";a.v.style.display="block";clearInterval(a.A);Wa()}class db{constructor(){this.i=this.h=this.g=!1;this.id=-1}j(){F();E.name.style.display="block";u.innerHTML="";I.A();Xa.g=!1}}const E=new va,A=new ya,G=new Ea,v=new Ga,I=new La,y=new Ma,J=new Na,K=new Oa,Qa=new Ra,Xa=new Ya,Q=new Za,x=new $a,Z=new ab,L=new cb,B=new db;Z.m();(async function(){qa();let a;var b=new Promise(function(e){a=e});const c=[];for(const [,,e]of E.j)c[c.length]=new ra(e,a);setTimeout(a,2E3,"");b=await b;let d;if(0==b.length){b=0;for(const e of c)e.u.readyState==WebSocket.OPEN&&e.H>b&&(b=e.H,d=e.u.url)}else d=b;if(void 0==d)throw u.innerHTML="Couldn't connect to any server",ia(),Error(u.innerHTML);for(const e of c)e.u.url!=d?e.stop():sa(e);ua()})();