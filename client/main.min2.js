const f=window.localStorage,g=f.getItem.bind(f),aa=f.setItem.bind(f),ba=f.removeItem.bind(f),ca=g("keybinds"),da={settings:"Escape",up:"KeyW",left:"KeyA",right:"KeyD",down:"KeyS",slowwalk:"ShiftLeft",spec_prev:"KeyA",spec_next:"KeyD"};let h=null!=ca?JSON.parse(ca):da;for(const a in da)a in h||(h[a]=da[a]);for(const a in h)a in da||delete h[a];function ea(){aa("keybinds",JSON.stringify(h))}const fa=g("settings"),k={fov:{min:.25,max:1.75,value:1.75,step:.05},chat_on:!0,max_chat_messages:{min:1,max:1E3,value:100,step:1},chat_text_scale:{min:1,max:2,value:1,step:.05},draw_ball_fill:!0,draw_ball_stroke:!0,draw_ball_stroke_bright:!0,ball_stroke:{min:0,max:100,value:20,step:1},draw_player_fill:!0,draw_player_stroke:!0,draw_player_stroke_bright:!0,player_stroke:{min:0,max:100,value:10,step:1},draw_player_name:!0,draw_death_arrow:!0,death_arrow_size:{min:10,max:100,value:40,step:1},show_tutorial:!0,show_ping:!1};let l=null!=fa?JSON.parse(fa):JSON.parse(JSON.stringify(k));for(const a in k)a in l||(l[a]=k[a]);for(const a in l)a in k?(l[a].min&&l[a].min!=k[a].min&&(l[a].min=k[a].min),l[a].max&&l[a].max!=k[a].max&&(l[a].max=k[a].max),l[a].step&&l[a].step!=k[a].step&&(l[a].step=k[a].step),l[a].value=Math.max(Math.min(l[a].value,l[a].max),l[a].min)):delete l[a];function ha(){aa("settings",JSON.stringify(l))}const n=document.getElementById.bind(document),p=document.createElement.bind(document),q=n("ID_status"),ia=g("token");let ja=[];"string"==typeof ia&&(ja=ia.split(",").map(a=>+a));function ka(){setTimeout(location.reload.bind(location),1E3)}function la(a){return"#"+(.8*parseInt(a.substring(1,3),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(a.substring(3,5),16)>>0).toString(16).padStart(2,"0")+(.8*parseInt(a.substring(5,7),16)>>0).toString(16).padStart(2,"0")+a.substring(7)}function ma(a){const b=a.match(/\/\/(.*?)\.shadam\.xyz/),c=a.match(/\/\/(.*?)[\/:]/);return b?b[1]:c?c[1]:a}WebSocket.prototype.send=new Proxy(WebSocket.prototype.send,{apply:function(a,b,c){if(b.readyState==WebSocket.OPEN)return a.apply(b,c)},configurable:!0,enumerable:!0});WebSocket.prototype.close=new Proxy(WebSocket.prototype.close,{apply:function(a,b,c){if(b.readyState==WebSocket.CONNECTING||b.readyState==WebSocket.OPEN)return a.apply(b,c)},configurable:!0,enumerable:!0});function na(a){return function(b){const c=b instanceof ClipboardEvent;if(!c||"paste"==b.type){var d=b.target.value+(c?b.clipboardData.getData("text"):b.key);if((new TextEncoder).encode(d).byteLength-b.target.selectionEnd+b.target.selectionStart>a){if(""==b.target.value&&c){const e=b.target.placeholder;b.target.placeholder="Text too long to paste!";setTimeout(function(){b.target.placeholder=e},1E3)}b.preventDefault()}}}}function oa(a,b){var c=.75*pa.size;c*=r.h;a=.5*r.width+(a-t.x)*r.h;const d=.5*r.height+(b-t.y)*r.h;b=!1;if(0>a||a>r.width-0)b=!0,a=Math.max(Math.min(a,r.width-c),c);0>d||d>r.height-0?(b=!0,c=Math.max(Math.min(d,r.height-c),c)):c=d;return[(a-.5*r.width)/r.h+t.x,(c-.5*r.height)/r.h+t.y,b]}function u(a,b,c){return a+(b-a)*c}function v(a,b,c){r.g.font="700 20px Ubuntu";r.g.textAlign="center";r.g.textBaseline="middle";r.g.fillStyle="#fff";r.g.strokeStyle="#333";r.g.lineWidth=1;r.g.fillText(a,b,c);r.g.strokeText(a,b,c)}if(0==window.s.length)throw q.innerHTML="No servers found",ka(),Error(q.innerHTML);q.innerHTML="Connecting";const qa=["#dddddd","#aaaaaa","#333333","#fedf78"],ra="#808080 #fc46aa #008080 #ff8e06 #3cdfff #663a82".split(" ");function sa(a){a.h.innerHTML="";for(const b of a.o){const c=p("option");c.value=b[2];b[2]==w.v.url&&(c.selected=!0,c.disabled=!0,a.g=c);b[0]>=b[1]&&(c.disabled=1);const d=ma(b[2]);c.innerHTML=d[0].toUpperCase()+d.substring(1)+` (${b[0]}/${b[1]})`;a.h.appendChild(c)}a.h.onfocus=function(){aa("psfy_tooltip","");this.J.style.display="none"}.bind(a);a.h.onchange=async function(){this.g.disabled=!1;const b=this.g;this.g=this.h.selectedOptions[0];this.g.disabled=!0;ta();let c;const d=new Promise(function(m){c=m}),e=new ua(this.g.value,c,1);setTimeout(c,2E3);await d;0==e.L||e.v.readyState!=WebSocket.OPEN?(e.stop(),q.innerHTML="Couldn't connect, returning to previous server",this.g.disabled=!1,this.g=b,this.g.disabled=!0,setTimeout(y.j.bind(y),1E3)):va(e)}.bind(a);wa(a)}function xa(){var a=z;sa(a);a.I=setInterval(function(){fetch("servers.json").then(b=>b.json()).then(function(b){z.o=b;sa(z)})},5E3)}function ya(){z.j.style.display="block"}function za(){var a=z;const b=p("h5");b.id="ID_spec_help";b.innerHTML=a.R;setTimeout(function(){b.style.opacity=0},3E3);b.addEventListener("transitionend",a.H.bind(a));document.body.insertBefore(b,z.j);a.i=b}function wa(a){void 0==g("psfy_tooltip")&&(a.T.innerHTML="We picked a server<br>for you automatically.<br><br>You can change it here.",a.J.style.display="table")}class Aa{constructor(){this.j=n("ID_menu");this.name=n("ID_name");this.h=n("ID_select_serv");this.g=null;this.o=window.s;this.J=n("ID_picked_server_for_you");this.T=n("ID_picked_server_for_you_tooltip");this.A=n("ID_ping");this.K();this.B=n("ID_play");this.u=n("ID_spec");this.i=null;this.R="";this.l();this.F=n("ID_spectating");this.D=n("ID_refresh");var a=n("ID_spec_help");a.parentElement.removeChild(a);this.D.onclick=location.reload.bind(location);this.name.onkeypress=this.name.onpaste=na(16);this.name.onchange=function(){y.i=!1;aa("name",this.value)};this.I=-1;a=g("name");"string"==typeof a&&16>=(new TextEncoder).encode(a).length&&(this.name.value=a);this.B.onclick=function(){var b=B;Ba(b);b.g[0]=0;b.h=1;D(w)};this.u.onclick=function(){Ca(0);D(w)}}l(){this.R=`Press ${h.spec_prev} or ${h.spec_next} to switch between players<br><br>Type "/menu" in chat to return to the main menu`}H(){null!=this.i&&(this.i.parentElement.removeChild(this.i),this.i=null)}K(){this.A.style.display=l.show_ping?"block":"none"}}function D(a){a.v.send(B.g.subarray(0,B.h))}function va(a){var b=w;null!=b.v&&(b.stop(),b.once=!1,b.i=!1,b.g=[0,0]);b.G=a.G;b.M=a.M;b.C=a.C;b.m=a.m;b.v=a.v;b.v.onmessage=function({data:c}){try{this.message({data:c})}catch(d){console.log(d),console.log(Array.from(new Uint8Array(c)).map(e=>e.toString(16).padStart(2,"0")).join(" "))}}.bind(b);b.v.onclose=b.close.bind(b);Da();D(b);b.h()}function Ea(a){a.G[a.m]=(new Date).getTime()-a.M;a.C=0;let b=a.m,c=0;for(let d=0;10>d;++d)0!=a.G[b]&&(a.C+=(10-c)/11*a.G[b],++c),b=(b+1)%10;0!=c&&(a.C/=.5*c);a.m=(a.m+1)%10;setTimeout(a.j.bind(a),10)}class Fa{constructor(){this.v=null;this.i=this.once=!1;this.G=Array(10).fill(0);this.m=this.C=this.M=0;this.g=[0,0]}h(){this.once=!0;var a=E;a.o=Array(5).fill(0);a.j=0;a.h.innerHTML="";a.i=0;a.u=!1;a.B="Press enter to chat";a.A();t.g=!1;G.g=Array(100);I.g=Array(65535);J.l=-1;a=r;a.h=l.fov.value;a.j=a.h;cancelAnimationFrame(a.o);a.o=-1;a.A=!1;a.l=0;a.u=0;a=K;a.g=!1;a.o=!1;a.u=1;a.h=1;a=y;a.g=!1;a.h=!1;a.i=!1;a.id=-1}message({data:a}){B.set(new Uint8Array(a));if(0==B.h)Ea(this);else{var b=L()-1;a=!1;b!=y.id&&(y.id=b,a=!0);b=L();var c=b&1;c&&!y.h?(y.h=!0,z.j.style.display="none",za(),z.F.style.display="block"):!c&&y.h&&(y.h=!1,ya(),z.H(),z.F.style.display="none",K.o=!1);(c=b&2)&&!y.g?(y.g=!0,z.j.style.display="none"):!c&&y.g&&(y.g=!1,ya(),K.o=!1);z.u.disabled=b&4;this.g[0]=this.g[1];this.g[1]=performance.now();b=G;for(c=0;100>c;++c)void 0!=b.g[c]&&(b.g[c].x1=b.g[c].x2,b.g[c].y1=b.g[c].y2,b.g[c].r1=b.g[c].r2);b=I;for(c=0;65535>c;++c)void 0!=b.g[c]&&(b.g[c].x1=b.g[c].x2,b.g[c].y1=b.g[c].y2,b.g[c].r1=b.g[c].r2);Ga(t);for(b=!1;B.m<B.h;)switch(L()){case 0:b=!0;I.g=Array(65535);c=J;c.l=L();var d=L(),e=L(),m=L(),x=l.fov.max,F=m*x,H=Array(L());for(var A=0;A<H.length;++A)H[A]=[(L()+.5)*F,(L()+.5)*F,L()];A=Array(256);var Q=Array(256);for(var R=0;R<d;++R)for(var S=0;S<e;++S){const V=B.g[B.m];2!=V&&(void 0==A[V]&&(A[V]=new Path2D,Q[V]=new Path2D),A[V].rect((1.5+R*m)*x,(1.5+S*m)*x,(m-3)*x,(m-3)*x),Q[V].rect(R*F,S*F,F,F));++B.m}c.width=d*m;c.height=e*m;c.g=m;c.i.width=c.width*x;c.i.height=c.height*x;c.j.width=c.i.width;c.j.height=c.i.height;for(d=0;256>d;++d)void 0!=A[d]&&(c.h.fillStyle=qa[d]+"b0",c.h.fill(Q[d]),c.h.fillStyle=qa[d],c.h.fill(A[d]),c.o.fillStyle=qa[d],c.o.fill(Q[d]));c.h.font=`700 ${m}px Ubuntu`;c.h.textAlign="center";c.h.textBaseline="middle";c.h.fillStyle=la(qa[3]);for(var C of H)c.h.fillText(C[2],C[0],C[1]);break;case 1:c=G;m=L();for(H=0;H<m;++H)if(d=L(),void 0==c.g[d])e=M(),x=M(),F=M(),A=L(),A=Ha(A),Q=L(),R=0,Q&&(R=L()),S=L(),0<S&&N(E,A,Ha(S)),c.g[d]={x:0,y:0,r:0,x1:e,x2:e,y1:x,y2:x,r1:F,r2:F,name:A,N:Q,O:R,P:0,S:!0},y.id==d&&(d=t,d.g||(d.x2=e,d.y2=x));else if(e=L(),0==e)delete c.g[d];else{do{switch(e){case 1:c.g[d].x2=M();y.id==d&&(e=t,e.g||(e.x2=c.g[d].x2));break;case 2:c.g[d].y2=M();y.id==d&&(e=t,e.g||(e.y2=c.g[d].y2));break;case 3:c.g[d].r2=M();break;case 4:c.g[d].N=L();c.g[d].N&&(c.g[d].O=L());break;case 5:e=L();N(E,c.g[d].name,Ha(e));break;default:throw Error();}e=L()}while(e)}break;case 2:c=I;m=Ia();for(H=0;H<m;++H)if(d=Ia(),void 0==c.g[d])e=L()-1,x=M(),F=M(),A=M(),c.g[d]={type:e,x:0,y:0,r:0,x1:x,x2:x,y1:F,y2:F,r1:A,r2:A,S:!1};else if(e=L(),0==e)delete c.g[d];else{do{switch(e){case 1:c.g[d].x2=M();break;case 2:c.g[d].y2=M();break;case 3:c.g[d].r2=M();break;default:throw Error();}e=L()}while(e)}break;case 3:c=E;m=L();for(H=0;H<m;++H)e=L(),d=(new TextDecoder).decode(B.g.subarray(B.m,B.m+e)),B.m+=e,e=L(),N(c,d,(new TextDecoder).decode(B.g.subarray(B.m,B.m+e))),B.m+=e;break;default:throw Error();}if(B.m>B.h)throw Error();-1==y.id?(C=t,a=.5*J.height,C.g||(C.x2=.5*J.width,C.y2=a),Ga(C)):a&&(C=t,a=G.g[y.id].y2,C.g||(C.x2=G.g[y.id].x2,C.y2=a),b&&Ga(t));0==this.g[0]||this.i||(this.i=!0,C=r,C.o=window.requestAnimationFrame(C.B.bind(C)),y.j())}}close(a){4E3==a?(Ja(),q.innerHTML="Server is full"):Ja()}j(){this.M=(new Date).getTime();this.v.send(new Uint8Array(0))}stop(){this.v.onopen=this.v.onmessage=this.v.onclose=null;this.v.close()}}function Ka(a){a.v=new WebSocket(a.l);a.v.binaryType="arraybuffer";a.v.onopen=a.h.bind(a);a.v.onmessage=a.message.bind(a);a.v.onclose=a.close.bind(a)}class ua extends Fa{constructor(a,b,c=8){super();this.L=0;this.o=c;this.u=b;this.l=a;Ka(this)}h(){this.j()}message(){Ea(this);++this.L==this.o&&this.u(this.v.url)}close(){Ka(this)}}function Ca(a){var b=B;b.g[0]=4;b.g[1]=a;b.h=2}function Da(){var a=B;0==ja.length?a.h=1:(a.g.set(ja),a.h=ja.length)}function L(){var a=B;return a.g[a.m++]}function Ia(){var a=B;const b=a.g[a.m]|a.g[a.m+1]<<8;a.m+=2;return b}function M(){var a=B;const b=a.view.getFloat32(a.m,!0);a.m+=4;return b}function Ha(a){var b=B;const c=(new TextDecoder).decode(b.g.subarray(b.m,b.m+a));b.m+=a;return c}function Ba(a){if(!y.i){y.i=!0;a.g[0]=3;var b=z;b=(new TextEncoder).encode(b.name.value);a.g.set(b,1);a.h=b.length+1;D(w)}}class La{constructor(){this.i=new ArrayBuffer(1048576);this.g=new Uint8Array(this.i);this.view=new DataView(this.i);this.m=this.h=0}set(a){this.g.set(a);this.h=a.length;this.m=0}}function Ma(a){var b=pa;a.drawImage(b.h,.5*-b.h.width,.5*-b.h.height)}class Na{constructor(){this.h=p("canvas");this.g=this.h.getContext("2d");this.size=0;this.i()}i(){this.size=l.death_arrow_size.value;this.h.width=this.h.height=this.size;const a=.5*this.h.width,b=this.h.width;this.g.beginPath();this.g.moveTo(a+.45*b,a);this.g.lineTo(a-.225*b,a-.675*b/Math.sqrt(3));this.g.lineTo(a-.225*b,a+.675*b/Math.sqrt(3));this.g.closePath();this.g.fillStyle="#bbbbbbb0";this.g.fill();this.g.lineWidth=.1*a;this.g.strokeStyle="#f00";this.g.stroke()}}function Oa(a){void 0==g("tth_tooltip")&&(a.K.innerHTML='Try "/help"',a.F.style.display="inline-block")}function N(a,b,c,d=!1){const e=p("p");e.appendChild(document.createTextNode((d?"":b+": ")+c));a.h.insertBefore(e,a.h.firstChild);++a.i>l.max_chat_messages.value&&a.h.removeChild(a.h.lastChild)}function Pa(a){a.g.value="";a.g.blur();r.i.focus()}function Qa(a,b){a.B=a.g.placeholder;a.g.placeholder=b;a.g.disabled=!0;a.g.value="";r.i.focus()}function Ra(){var a=E;!a.u&&l.chat_on&&(a.D.style.display="block")}class Sa{constructor(){this.o=Array(5).fill(0);this.j=0;this.D=n("ID_chat");this.h=n("ID_messages");this.g=n("ID_sendmsg");this.F=n("ID_try_typing_help");this.K=n("ID_try_typing_help_tooltip");Oa(this);this.J=na(128);this.i=0;this.u=!1;this.B="";this.l=-1;this.g.onkeydown=function(a){a.stopPropagation();if("Enter"==a.code){a=this.g.value.trim();switch(a){case "/help":N(this,null,">",!0);N(this,null,"Available commands:",!0);N(this,null,"/clear /c => clear the chat",!0);N(this,null,"/respawn /r => tp to the first area",!0);N(this,null,"/die /d => become downed",!0);N(this,null,"/menu /m => quit the game and open the menu",!0);N(this,null,"/spectate /s => start/stop spectating",!0);N(this,null,">",!0);Pa(this);aa("tth_tooltip","");this.F.style.display="none";return;case "/c":case "/clear":this.h.innerHTML="";this.i=0;Pa(this);return}a=(new TextEncoder).encode(a);if(0<a.length){var b=B;Ba(b);b.g[0]=2;b.g.set(a,1);b.h=a.length+1;D(w);this.o[this.j]=(new Date).getTime();a=(this.j+1)%5;b=5E3-this.o[this.j]+this.o[a];this.j=a;0<b?(Qa(this,"You are on cooldown for sending too many messages too quickly"),this.l=setTimeout(this.A.bind(this),b)):Pa(this)}}}.bind(this);this.g.onkeyup=function(a){a.stopPropagation()};this.g.onkeypress=this.g.onpaste=this.J}A(){-1!=this.l&&(clearTimeout(this.l),this.l=-1);this.g.disabled=!1;this.g.placeholder=this.B}focus(){this.g.focus()}H(){for(;this.i>l.max_chat_messages.value;)this.h.removeChild(this.h.lastChild),--this.i}I(){this.h.style["font-size"]=l.chat_text_scale.value+"em"}}function Ga(a){a.x1=a.x2;a.y1=a.y2}function O(a,b,c){var d=t;d.x2=u(d.x2,a,c);d.y2=u(d.y2,b,c)}class Ta{constructor(){this.y2=this.x2=this.y1=this.x1=this.y=this.x=0;this.g=!1}block(){this.g=!0}}class Ua{constructor(){this.g=Array(100)}}class Va{constructor(){this.g=Array(65535)}}function Wa(){var a=Xa;a.g=!0;return new Promise(function(b){a.h=function(c){a.g=!1;b(c)}})}class Ya{constructor(){this.h=null;this.g=!1}}function Za(a){switch($a.g){case 0:l.show_tutorial&&0==J.l&&v("Need help? Press KeyT for a tutorial.",.5*J.width,2.5*J.g);break;case 1:O(G.g[y.id].x2,G.g[y.id].y2,.2*a);v("<-- Your character",t.x+110,t.y);v("Your character --\x3e",t.x-110,t.y);v("This is your character. You can control it with these keys:",t.x,t.y-220);v(`${h.up}: up`,t.x,t.y-170);v(`${h.left}: left`,t.x,t.y-130);v(`${h.down}: down`,t.x,t.y-90);v(`${h.right}: right`,t.x,t.y-50);v("You can also control it with mouse. Just",t.x,t.y+50);v("press any mouse button to start or stop moving.",t.x,t.y+70);v("Scroll to change your field of view.",t.x,t.y+110);v("Note that you won't be able to perform some",t.x,t.y+150);v("of the above actions until the tutorial ends.",t.x,t.y+170);v("Press KeyT to continue",t.x,t.y+220);break;case 2:var b=.5*J.width-6*J.g,c=.5*J.height;O(b,c,.2*a);v("--\x3e",b+2*J.g,c-1*J.g);v("--\x3e",b+2*J.g,c);v("--\x3e",b+2*J.g,c+1*J.g);v("<--",b-2*J.g,c-2*J.g);v("<--",b-3*J.g,c-1*J.g);v("<--",b-4*J.g,c);v("<--",b-3*J.g,c+1*J.g);v("<--",b-2*J.g,c+2*J.g);v("These are safezones. Enemies can't",b,c-130);v("reach you inside of these tiles.",b,c-110);v("Press KeyT to continue",b,c+110);break;case 3:b=.5*J.width+6*J.g;c=.5*J.height;O(b,c,.2*a);v("<--",b-2*J.g,c-2*J.g);v("<--",b-1*J.g,c-3*J.g);v("<--",b,c-4*J.g);v("<--",b-2*J.g,c+2*J.g);v("<--",b-1*J.g,c+3*J.g);v("<--",b,c+4*J.g);v("--\x3e",b+2*J.g,c-3*J.g);v("--\x3e",b+2*J.g,c+3*J.g);v("<--",b+5*J.g,c-2*J.g);v("<--",b+6*J.g,c-1*J.g);v("<--",b+7*J.g,c);v("<--",b+6*J.g,c+1*J.g);v("<--",b+5*J.g,c+2*J.g);v("These are walls. Players can't walk over them.",b,c-40);v("However, some types (colors) of enemies can.",b,c-10);v("Press KeyT to continue",b,c+40);break;case 4:b=.5*J.g;c=.5*J.height;O(b,c,.2*a);v("--\x3e",b,c);v("This is a teleport tile. If you walk on it,",b,c-130);v("you will be teleported to the area it points to.",b,c-110);v("Minimap is not yet implemented, but once it is, you",b,c-70);v("will be able to see where any area is located at.",b,c-50);v("If a teleport doesn't have a number on it, it doesn't point",b,c+50);v("anywhere (perhaps because the next area is under construction).",b,c+70);v("Press KeyT to continue",b,c+120);break;case 5:for(c=0;65535>c;++c)if(I.g[c]){b=I.g[c];break}c=b.x2;b=b.y2;O(c,b,.2*a);v("Enemy ball --\x3e",c-110,b);v("<-- Enemy ball",c+110,b);v("This is an enemy, also simply called a ball. A grey ball",c,b-110);v("doesn't do a lot - it simply moves in one direction. However,",c,b-90);v("as you are about to find out when you start exploring the game,",c,b-70);v("there are lots of types of enemies, each having their own color.",c,b-50);v("Coming in contact with an enemy downs you. While downed, you can't move,",c,b+50);v("and after a while, you die, unless other players revive you by touching you.",c,b+70);v("Press KeyT to continue",c,b+120);break;case 6:b=G.g[y.id].x2,c=G.g[y.id].y2,O(b,c,.2*a),v(`You can press ${h.settings} to open settings.`,b,c-80),v("There are a lot of cool options to change. Try it out later.",b,c-60),v("That's it for this tutorial. See how far you can go!",b,c+60),v("GLHF!",b,c+80),v("Press KeyT to end the tutorial",b,c+130)}}class ab{constructor(){this.i=this.g=0;this.h=null}progress(){0==this.g?l.show_tutorial&&y.g&&(this.g=1,this.i=r.j,r.j=l.fov.max,t.block(),bb(),K.stop(),K.block()):7==++this.g&&(this.h.click(),this.g=0,r.j=this.i,t.g=!1,P.g=!1,K.g=!1,K.start())}}function bb(){var a=P;a.i&&(a.g=!1,cb(a));a.g=!0}function db(a){a.l.innerHTML="";T(a,"CHAT");a.add(a.text("Show chat"),U("chat_on",function(b){b?Ra():(b=E,b.u||(b.D.style.display="none"))}));a.add(a.text("Max number of chat messages"),W(a,"max_chat_messages","",E.H.bind(E)));a.add(a.text("Chat text scale"),W(a,"chat_text_scale","",E.I.bind(E)));T(a,"MENU");a.add(a.text("Show latency"),U("show_ping",z.K.bind(z)));T(a,"GAME");$a.h=U("show_tutorial");a.add(a.text("Enable tutorial"),$a.h);T(a,"VISUALS");a.add(a.text("Default FOV"),W(a,"fov"));a.add(a.text("Draw balls' fill"),U("draw_ball_fill"));a.add(a.text("Draw balls' stroke"),U("draw_ball_stroke"));a.add(a.text("Draw stroke-only balls with brighter color"),U("draw_ball_stroke_bright"));a.add(a.text("Balls' stroke radius percentage"),W(a,"ball_stroke","%"));a.add(a.text("Draw players' fill"),U("draw_player_fill"));a.add(a.text("Draw players' stroke"),U("draw_player_stroke"));a.add(a.text("Draw stroke-only players with brighter color"),U("draw_player_stroke_bright"));a.add(a.text("Players' stroke radius percentage"),W(a,"player_stroke","%"));a.add(a.text("Draw players' name"),U("draw_player_name"));a.add(a.text("Draw an arrow towards dead players"),U("draw_death_arrow"));a.add(a.text("Death arrow size"),W(a,"death_arrow_size","px",pa.i.bind(pa)));T(a,"KEYBINDS");eb(a,fb("h5","To change, click a button on the right side and then press the key you want to assign to it."));a.add(a.text("Settings"),X("settings"));a.add(a.text("Move up"),X("up"));a.add(a.text("Move left"),X("left"));a.add(a.text("Move down"),X("down"));a.add(a.text("Move right"),X("right"));a.add(a.text("Move slowly"),X("slowwalk"));a.add(a.text("Spectate the previous player"),X("spec_prev",z.l.bind(z)));a.add(a.text("Spectate the next player"),X("spec_next",z.l.bind(z)));T(a,"RESET");a.add(a.text("Reset settings"),a.button("RESET",function(){l=JSON.parse(JSON.stringify(k));ha();db(this)}.bind(a)));a.add(a.text("Reset keybinds"),a.button("RESET",function(){h=JSON.parse(JSON.stringify(da));ea();db(this)}.bind(a)));a.add(a.text("Reset all tooltips"),a.button("RESET",function(){ba("psfy_tooltip");wa(z);ba("tth_tooltip");Oa(E)}));a.end()}function cb(a){a.g||(a.i=!1,a.j.style.display="none",K.g=!1,K.start())}function eb(a,b){a.l.appendChild(b)}function T(a,b){a.end();eb(a,fb("h1",b));a.h=p("table")}function fb(a,b){a=p(a);a.innerHTML=b;return a}function U(a,b=function(){}){const c=p("button");l[a]=!l[a];let d=!0;c.onclick=function(){l[a]=!l[a];1==l[a]?(c.innerHTML="ON",c.style["background-color"]="#23c552"):(c.innerHTML="OFF",c.style["background-color"]="#f84f31");ha();d?d=!1:b(l[a])};c.onclick();return c}function X(a,b=function(){}){const c=p("button");c.innerHTML=h[a];c.onclick=async function(){c.innerHTML="...";const d=await Wa();c.innerHTML=d;h[a]=d;ea();b()};c.style.color="#000";return c}function W(a,b,c="",d=function(){}){const e=p("div");e.className="input";const m=p("input");m.type="range";m.min=l[b].min;m.max=l[b].max;m.step=l[b].step;m.value=l[b].value;m.oninput=function(){m.nextElementSibling.innerHTML=m.value+c;l[b].value=m.valueAsNumber;d()};m.onchange=ha;e.appendChild(m);e.appendChild(a.text(m.value+c));return e}class gb{constructor(){this.j=n("ID_settings_container");this.l=n("ID_settings");this.g=this.i=!1;this.h=null;db(this)}add(a,b){const c=p("tr");let d=p("td");d.appendChild(a);c.appendChild(d);d=p("td");d.appendChild(b);b.onchange=ha;c.appendChild(d);this.h.appendChild(c)}end(){null!=this.h&&(eb(this,this.h),this.h=null)}text(a){return fb("h3",a)}button(a,b){const c=p("button");c.innerHTML=a;c.onclick=b;return c}}class hb{constructor(){this.i=p("canvas");this.h=this.i.getContext("2d");this.j=p("canvas");this.o=this.j.getContext("2d");this.g=this.height=this.width=0;this.l=-1}}class ib{constructor(){this.i=n("ID_canvas");this.g=this.i.getContext("2d");this.height=this.width=0;this.j=this.h=l.fov.value;this.o=-1;this.A=!1;this.u=this.l=0;this.i.onwheel=this.F.bind(this);this.i.onmousedown=this.D.bind(this)}stop(){this.A=!0;this.i.parentElement.removeChild(this.i)}F(a){a=.05*-Math.sign(a.deltaY);this.j=1<this.j?this.j+3*a:this.j+a;this.j=Math.min(Math.max(this.j,l.fov.min),l.fov.max)}D(){K.o=!K.o;Y(K)}text(a,b,c){this.g.font="700 20px Ubuntu";this.g.textAlign="center";this.g.textBaseline="middle";this.g.fillStyle="#fff";this.g.strokeStyle="#333";this.g.lineWidth=1;this.g.fillText(a,b,c);this.g.strokeText(a,b,c)}B(a){if(!this.A){this.l=Math.min(Math.max(this.l,w.g[0]),w.g[1]);var b=this.h;this.h=u(this.h,this.j,.1);this.h!=b&&Y(K);b=w.g[0]==w.g[1]?1:(this.l-w.g[0])/(w.g[1]-w.g[0]);this.l+=a-this.u;this.u=a;l.show_ping&&(z.A.innerHTML=w.C.toFixed(1)+"ms");t.x=u(t.x1,t.x2,b);t.y=u(t.y1,t.y2,b);this.g.resetTransform();this.g.fillStyle="#333";this.g.fillRect(0,0,this.i.width,this.i.height);this.g.translate(.5*this.i.width,.5*this.i.height);this.g.scale(this.h,this.h);this.g.translate(-t.x,-t.y);this.g.drawImage(J.i,0,0,J.width,J.height);1>this.h&&(this.g.globalAlpha=1-4*(this.h-l.fov.min)/3,this.g.drawImage(J.j,0,0,J.width,J.height),this.g.globalAlpha=1);a=Array(65635);var c=0;if(l.draw_player_fill||l.draw_player_stroke)for(var d=0;100>d;++d)void 0!=G.g[d]&&(G.g[d].x=u(G.g[d].x1,G.g[d].x2,b),G.g[d].y=u(G.g[d].y1,G.g[d].y2,b),G.g[d].r=u(G.g[d].r1,G.g[d].r2,b),a[c++]=G.g[d]);if(l.draw_ball_fill||l.draw_ball_stroke)for(d=0;65535>d;++d)void 0!=I.g[d]&&(I.g[d].x=u(I.g[d].x1,I.g[d].x2,b),I.g[d].y=u(I.g[d].y1,I.g[d].y2,b),I.g[d].r=u(I.g[d].r1,I.g[d].r2,b),a[c++]=I.g[d]);a.sort((m,x)=>x.r-m.r);for(c=0;c<a.length;++c)if(void 0!=a[c])if(this.g.beginPath(),d=a[c],d.S){var e=l.player_stroke.value/200*d.r;this.g.moveTo(d.x+d.r-e,d.y);this.g.arc(d.x,d.y,d.r-e,0,2*Math.PI);l.draw_player_fill&&(this.g.fillStyle="#ebecf0",this.g.fill());l.draw_player_stroke&&(!l.draw_player_fill&&l.draw_player_stroke_bright?this.g.strokeStyle="#ebecf0":this.g.strokeStyle=la("#ebecf0"),this.g.lineWidth=2*e,this.g.stroke());l.draw_player_name&&0!=d.name.length&&(this.g.font=`700 ${d.r/this.h}px Ubuntu`,this.g.textAlign="center",this.g.textBaseline="middle",this.g.fillStyle="#00000080",d.P=u(d.P,1<this.h?.5*d.r:.5*d.r+2/(this.h*this.h),.1),this.g.fillText(d.name,d.x,d.y-d.r-d.P));if(d.N&&(this.g.font=`700 ${d.r/Math.min(this.h,1)}px Ubuntu`,this.g.textAlign="center",this.g.textBaseline="middle",this.g.fillStyle="#f00",this.g.fillText(d.O,d.x,d.y),l.draw_death_arrow)){const [m,x,F]=oa(d.x,d.y);F&&(this.g.translate(m,x),e=Math.atan2(d.y-x,d.x-m),this.g.rotate(e),Ma(this.g),this.g.rotate(-e),this.g.font=`700 ${.3*pa.size}px Ubuntu`,this.g.fillText(d.O,0,0),this.g.translate(-m,-x))}}else e=l.ball_stroke.value/200*d.r,this.g.moveTo(d.x+d.r-e,d.y),this.g.arc(d.x,d.y,d.r-e,0,2*Math.PI),l.draw_ball_fill&&(this.g.fillStyle=ra[d.type],this.g.fill()),l.draw_ball_stroke&&(this.g.strokeStyle=!l.draw_ball_fill&&l.draw_ball_stroke_bright?ra[d.type]:la(ra[d.type]),this.g.lineWidth=2*e,this.g.stroke());Za(b);this.o=window.requestAnimationFrame(this.B.bind(this))}}}class jb{constructor(){this.h=this.i=this.g=0;this.j=[0,0];window.onresize=this.l.bind(this);window.onkeyup=this.A.bind(this);window.onkeydown=this.u.bind(this);window.onmousemove=this.B.bind(this);window.onbeforeunload=this.o.bind(this)}l(){if(window.devicePixelRatio!=this.g||window.innerWidth!=this.i||window.innerHeight!=this.h){this.g=window.devicePixelRatio;this.i=window.innerWidth;this.h=window.innerHeight;var a=r;a.width=Z.i*Z.g;a.height=Z.h*Z.g;a.i.width=a.width;a.i.height=a.height}}u(a){if(!a.repeat)if(Xa.g)a.preventDefault(),Xa.h(a.code);else if(a.code==h.settings)P.i?cb(P):(a=P,a.g||(a.i=!0,a.j.style.display="block",K.stop(),K.block()));else{if(y.h)switch(a.code){case h.spec_prev:Ca(-1);D(w);break;case h.spec_next:Ca(1),D(w)}switch(a.code){case "Enter":E.focus(a);break;case h.up:K.A||(K.A=1,Y(K));break;case h.down:K.l||(K.l=1,Y(K));break;case h.left:K.i||(K.i=1,Y(K));break;case h.right:K.j||(K.j=1,Y(K));break;case h.slowwalk:1==K.u&&(kb(.5),Y(K));break;case "KeyT":$a.progress()}}}A(a){if(!a.repeat)switch(a.code){case h.up:K.A&&(K.A=0,Y(K));break;case h.down:K.l&&(K.l=0,Y(K));break;case h.left:K.i&&(K.i=0,Y(K));break;case h.right:K.j&&(K.j=0,Y(K));break;case h.slowwalk:.5==K.u&&(kb(1),Y(K))}}B(a){this.j=[a.clientX*this.g,a.clientY*this.g];Y(K)}o(a){if(y.g)return a.preventDefault(),a.returnValue="Are you sure you want to quit?"}}function Y(a){if(y.g&&!a.g){a=B;let c=0;var b=0;if(K.o){b=Z.j[0]-.5*r.i.width;const d=Z.j[1]-.5*r.i.height;c=Math.atan2(d,b);b=Math.hypot(b,d)/r.h}else if(K.A!=K.l||K.i!=K.j)c=Math.atan2(K.l-K.A,K.j-K.i),b=160*Z.g;a.g[0]=1;a.view.setFloat32(1,c,!0);a.g[5]=b>=160*Z.g?255*K.h:1.59375*b/Z.g*K.h;a.h=6;D(w)}}function kb(a){var b=K;b.g||(b.h=a);b.u=a}class lb{constructor(){this.o=!1;this.h=this.u=1;this.g=!1;this.j=this.i=this.l=this.A=0}block(){this.g=!0}stop(){this.g||(this.u=this.h,this.h=0,Y(this))}start(){this.g||(this.h=this.u,Y(this))}}function ta(){ya();z.name.style.display="none";q.innerHTML="Connecting";Ra();Qa(E,"Waiting for connection...");bb()}function Ja(){y.g=!1;ya();q.innerHTML="Disconnected";var a=z;w.once||ka();a.name.style.display="none";a.B.style.display="none";a.u.style.display="none";a.D.style.display="block";clearInterval(a.I);bb()}class mb{constructor(){this.i=this.h=this.g=!1;this.id=-1}j(){ya();z.name.style.display="block";q.innerHTML="";E.A();P.g=!1}}const z=new Aa,w=new Fa,B=new La,pa=new Na,E=new Sa,t=new Ta,G=new Ua,I=new Va,Xa=new Ya,$a=new ab,P=new gb,J=new hb,r=new ib,Z=new jb,K=new lb,y=new mb;Z.l();(async function(){ta();let a;var b=new Promise(function(e){a=e});const c=[];for(const [,,e]of z.o)c[c.length]=new ua(e,a);setTimeout(a,2E3,"");b=await b;let d;if(0==b.length){b=0;for(const e of c)e.v.readyState==WebSocket.OPEN&&e.L>b&&(b=e.L,d=e.v.url)}else d=b;if(void 0==d)throw q.innerHTML="Couldn't connect to any server",ka(),Error(q.innerHTML);for(const e of c)e.v.url!=d?e.stop():va(e);xa()})();