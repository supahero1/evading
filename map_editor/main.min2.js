const b=document.getElementById.bind(document),e=document.createElement.bind(document),f=b("canvas"),g=f.getContext("2d"),h=e("canvas"),k=h.getContext("2d"),l=e("canvas"),m=l.getContext("2d"),p=b("tiles");p.a=p.appendChild.bind(p);const q=["#dddddd","#aaaaaa","#333333","#fedf78"],r=["Path","Safezone","Wall","Teleport"];let t=0,u=[];function v(){for(let a=0;a<u.length;++a)u[a].style["text-decoration"]=a==t?"underline":"none"}let w=0,x=0,y=new Uint8Array(0),z=10,A=10;function B(){let a=new Uint8Array(z*A);for(let c=0;c<w;++c)if(!(c>=z))for(let d=0;d<x;++d)d>=A||(a[c*A+d]=y[c*x+d]);w=z;x=A;y=a;C=1;D()}let E=0,G=0,H=0,I=.2,J=1,K=0,L=0,M=[0,0],N=0;var O=0,P=0,Q=0,R=0;let S=[0,0];var T=[],U=[];let C=!0;function V(){if(window.innerWidth!=E||window.innerHeight!=G||H!=window.devicePixelRatio)C=!0,H=window.devicePixelRatio,E=window.innerWidth,f.width=E*H,G=window.innerHeight,f.height=G*H}V();window.onresize=V;function W(a,c,d){return a+(c-a)*d}f.onwheel=function(a){a=.05*-Math.sign(a.deltaY);J=1<J?J+3*a:J+a;J=Math.min(Math.max(J,.2),2)};window.onmousemove=function(a){M=[a.clientX*H,a.clientY*H]};f.onmousedown=function(){N=1};f.onmouseup=function(){N=0};window.onkeydown=function(a){if(!a.repeat)switch(a.keyCode){case 38:case 87:Q=1;break;case 40:case 83:R=1;break;case 37:case 65:O=1;break;case 39:case 68:P=1}};window.onkeyup=function(a){if(!a.repeat)switch(a.keyCode){case 38:case 87:Q=0;break;case 40:case 83:R=0;break;case 37:case 65:O=0;break;case 39:case 68:P=0}};window.onbeforeunload=function(a){a.preventDefault();return a.returnValue="Are you sure you want to quit?"};f.oncontextmenu=function(a){a.preventDefault();return!1};function X(){let a=`struct tile_info name = { ${z}, ${A}, 40, (uint8_t[]){\n`,c="/*       ";for(var d=0;d<A;++d)c+=d.toString().padStart(3," ")+" ";c+="*/\n";a+=c+"\n";for(d=0;d<z;++d){a+=`/*${d.toString().padStart(4," ")}*/  `;for(let n=0;n<A;++n)a+=` ${y[d*A+n]}, `;a=a.substring(0,a.length-1);a+="\n\n"}a=a.substring(0,a.length-1);return btoa(a+`\n${c}  }\n};`)}function aa(a){try{a=atob(a.trim());const c=a.match(/struct tile_info \w.*? = { (\d+), (\d+), 40, \(uint8_t\[\]\){/),d=+c[1],n=+c[2];if(null==c)return 0;const F=eval(a.replace(c[0],"[").replace("}\n};","]"));if(!F.length||F.length!=d*n)return 0;y.set(F);z=d;A=n;D();C=!0;return 1}catch(c){return 0}}function D(){T=Array(q.length);U=Array(q.length);var a=0;for(let c=0;c<z;++c)for(let d=0;d<A;++d)null==T[y[a]]&&(T[y[a]]=new Path2D,U[y[a]]=new Path2D),T[y[a]].rect(2*(1.5+50*c),2*(1.5+50*d),94,94),U[y[a]].rect(100*c,100*d,100,100),++a;h.width=100*z;h.height=100*A;l.width=100*z;l.height=100*A;for(a=0;256>a;++a)T[a]&&(k.fillStyle=q[a]+"b0",k.fill(U[a]),k.fillStyle=q[a],k.fill(T[a]),m.fillStyle=q[a],m.fill(U[a]))}B();let Y=e("button");Y.innerHTML="Export & copy";Y.timeout=-1;Y.onclick=function(){window.navigator.clipboard.writeText(X());if(-1==this.timeout){const a=this.innerHTML;this.innerHTML="Exported & copied";this.timeout=setTimeout(function(){this.innerHTML=a;this.timeout=-1}.bind(this),500)}}.bind(Y);p.a(Y);Y=e("button");Y.innerHTML="Import";Y.onclick=function(){let a=prompt("Please paste the config below:");aa(a)||alert("The config is invalid, it won't be loaded.")};p.a(Y);Y=e("h4");Y.innerHTML="Width";Y.style["margin-bottom"]="2px";p.a(Y);Y=e("input");Y.type="range";Y.min=1;Y.max=128;Y.value=10;Y.step=1;Y.oninput=function(){z=this.valueAsNumber||1;this.nextElementSibling.innerHTML=z+" tiles";this.nextElementSibling.nextElementSibling.value=z;B()}.bind(Y);p.a(Y);Y=e("h4");Y.innerHTML=z+" tiles";Y.style["margin-top"]="2px";Y.style["margin-bottom"]="2px";p.a(Y);Y=e("input");Y.type="number";Y.style["margin-top"]="2px";Y.value=z;Y.min=1;Y.max=128;Y.oninput=function(){z=this.valueAsNumber||1;this.previousElementSibling.innerHTML=z+" tiles";this.previousElementSibling.previousElementSibling.value=z;B()}.bind(Y);p.a(Y);Y=e("h4");Y.innerHTML="Height";Y.style["margin-bottom"]="2px";p.a(Y);Y=e("input");Y.type="range";Y.min=1;Y.max=128;Y.value=10;Y.step=1;Y.oninput=function(){A=this.valueAsNumber||1;this.nextElementSibling.innerHTML=A+" tiles";this.nextElementSibling.nextElementSibling.value=A;B()}.bind(Y);p.a(Y);Y=e("h4");Y.innerHTML=A+" tiles";Y.style["margin-top"]="2px";Y.style["margin-bottom"]="2px";p.a(Y);Y=e("input");Y.type="number";Y.style["margin-top"]="2px";Y.value=A;Y.min=1;Y.max=128;Y.oninput=function(){A=this.valueAsNumber||1;this.previousElementSibling.innerHTML=A+" tiles";this.previousElementSibling.previousElementSibling.value=A;B()}.bind(Y);p.a(Y);for(let a=0;a<q.length;++a){const c=e("div");Y=e("h4");Y.innerHTML=r[a];c.appendChild(Y);u[u.length]=Y;Y=e("div");Y.className="tile";Y.style["background-color"]=q[a];Y.onclick=function(){t=a;v()};c.appendChild(Y);p.a(c)}v();function Z(){var a=I;I=W(I,J,.075);var c=K;let d=L;if(0==R-Q&&0==P-O)S=[W(S[0],0,.1),W(S[1],0,.1)];else{const n=Math.atan2(R-Q,P-O);S=[W(S[0],10*Math.cos(n)/I,.1),W(S[1],10*Math.sin(n)/I,.1)]}K+=S[0];L+=S[1];if(C||a!=I||c!=K||d!=L)C=!1,g.resetTransform(),g.clearRect(0,0,f.width,f.height),g.translate(.5*f.width,.5*f.height),g.scale(I,I),g.translate(-K,-L),g.drawImage(h,0,0,h.width/2,h.height/2),1>I&&(g.globalAlpha=1-I*I,g.drawImage(l,0,0,h.width/2,h.height/2),g.globalAlpha=1);if(N){{const {g:n,h:F}={g:(M[0]-.5*window.innerWidth)/I+K,h:(M[1]-.5*window.innerHeight)/I+L};c=Math.floor(n/50);0>c||c>=z?a=-1:(a=Math.floor(F/50),a=0>a||a>=A?-1:c*A+a)}c=a;-1!=c&&y[c]!=t&&(y[c]=t,a=c%A,c=(c-a)/A,k.clearRect(100*c,100*a,100,100),k.fillStyle=q[t]+"b0",k.fillRect(100*c,100*a,100,100),k.fillStyle=q[t],k.fillRect(2*(1.5+50*c),2*(1.5+50*a),94,94),m.fillStyle=q[t],m.fillRect(100*c,100*a,100,100),C=1)}requestAnimationFrame(Z)}Z();