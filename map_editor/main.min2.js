const b=document.getElementById.bind(document),e=document.createElement.bind(document),f=b("canvas"),g=f.getContext("2d"),h=e("canvas"),l=h.getContext("2d"),m=e("canvas"),n=m.getContext("2d"),p=b("tiles");p.a=p.appendChild.bind(p);const q=["#dddddd","#aaaaaa","#333333","#fedf78"],r=["Path","Safezone","Wall","Teleport"];let t=0,u=[];function v(){for(let a=0;a<u.length;++a)u[a].style["text-decoration"]=a==t?"underline":"none"}let w=0,y=0,z=new Uint8Array(0),A=10,B=10;function C(){let a=new Uint8Array(A*B);for(let c=0;c<w;++c)if(!(c>=A))for(let d=0;d<y;++d)d>=B||(a[c*B+d]=z[c*y+d]);w=A;y=B;z=a;D=1;E()}let F=0,G=0,H=0,I=.2,J=1,K=0,L=0,M=[0,0],N=0;var O=0,P=0,Q=0,R=0;let S=[0,0];var T=[],U=[];let D=!0;function V(){if(window.innerWidth!=F||window.innerHeight!=G||H!=window.devicePixelRatio)D=!0,H=window.devicePixelRatio,F=window.innerWidth,f.width=F*H,G=window.innerHeight,f.height=G*H}V();window.onresize=V;function W(a,c,d){return a+(c-a)*d}f.onwheel=function(a){a=.05*-Math.sign(a.deltaY);J=1<J?J+3*a:J+a;J=Math.min(Math.max(J,.2),2)};window.onmousemove=function(a){M=[a.clientX*H,a.clientY*H]};f.onmousedown=function(){N=1};f.onmouseup=function(){N=0};window.onkeydown=function(a){if(!a.repeat)switch(a.keyCode){case 38:case 87:Q=1;break;case 40:case 83:R=1;break;case 37:case 65:O=1;break;case 39:case 68:P=1}};window.onkeyup=function(a){if(!a.repeat)switch(a.keyCode){case 38:case 87:Q=0;break;case 40:case 83:R=0;break;case 37:case 65:O=0;break;case 39:case 68:P=0}};window.onbeforeunload=function(a){a.preventDefault();return a.returnValue="Are you sure you want to quit?"};f.oncontextmenu=function(a){a.preventDefault();return!1};function X(){let a=`struct tile_info name = { ${A}, ${B}, 40, (uint8_t[]){\n`,c="/*       ";for(var d=0;d<B;++d)c+=d.toString().padStart(3," ")+" ";c+="*/\n";a+=c+"\n";for(d=0;d<A;++d){a+=`/*${d.toString().padStart(4," ")}*/  `;for(let k=0;k<B;++k)a+=` ${z[d*B+k]}, `;a=a.substring(0,a.length-1);a+="\n\n"}a=a.substring(0,a.length-1);return btoa(a+`\n${c}  }\n};`)}function aa(a){try{a=atob(a.trim());const c=a.match(/struct tile_info \w.*? = { (\d+), (\d+), 40, \(uint8_t\[\]\){/),d=+c[1],k=+c[2];if(null==c)return 0;const x=eval(a.replace(c[0],"[").replace("}\n};","]"));console.log(x.length,d*k,x.length==d*k,x.length==d*k);if(x.length!=d*k)return 0;z.set(x);A=d;B=k;E();D=!0;return 1}catch(c){return 0}}function E(){T=Array(q.length);U=Array(q.length);var a=0;for(let c=0;c<A;++c)for(let d=0;d<B;++d)null==T[z[a]]&&(T[z[a]]=new Path2D,U[z[a]]=new Path2D),T[z[a]].rect(2*(1.5+50*c),2*(1.5+50*d),94,94),U[z[a]].rect(100*c,100*d,100,100),++a;h.width=100*A;h.height=100*B;m.width=100*A;m.height=100*B;for(a=0;256>a;++a)T[a]&&(l.fillStyle=q[a]+"b0",l.fill(U[a]),l.fillStyle=q[a],l.fill(T[a]),n.fillStyle=q[a],n.fill(U[a]))}C();let Y=e("button");Y.innerHTML="Export & copy";Y.timeout=-1;Y.onclick=function(){window.navigator.clipboard.writeText(X());if(-1==this.timeout){const a=this.innerHTML;this.innerHTML="Exported & copied";this.timeout=setTimeout(function(){this.innerHTML=a;this.timeout=-1}.bind(this),500)}}.bind(Y);p.a(Y);Y=e("button");Y.innerHTML="Import";Y.onclick=function(){let a=prompt("Please paste the config below:");aa(a)||alert("The config is invalid, it won't be loaded.")};p.a(Y);Y=e("h4");Y.innerHTML="Width";Y.style["margin-bottom"]="2px";p.a(Y);Y=e("input");Y.type="range";Y.min=1;Y.max=128;Y.value=10;Y.step=1;Y.oninput=function(){A=this.valueAsNumber||1;this.nextElementSibling.innerHTML=A+" tiles";this.nextElementSibling.nextElementSibling.value=A;C()}.bind(Y);p.a(Y);Y=e("h4");Y.innerHTML=A+" tiles";Y.style["margin-top"]="2px";Y.style["margin-bottom"]="2px";p.a(Y);Y=e("input");Y.type="number";Y.style["margin-top"]="2px";Y.value=A;Y.min=1;Y.max=128;Y.oninput=function(){A=this.valueAsNumber||1;this.previousElementSibling.innerHTML=A+" tiles";this.previousElementSibling.previousElementSibling.value=A;C()}.bind(Y);p.a(Y);Y=e("h4");Y.innerHTML="Height";Y.style["margin-bottom"]="2px";p.a(Y);Y=e("input");Y.type="range";Y.min=1;Y.max=128;Y.value=10;Y.step=1;Y.oninput=function(){B=this.valueAsNumber||1;this.nextElementSibling.innerHTML=B+" tiles";this.nextElementSibling.nextElementSibling.value=B;C()}.bind(Y);p.a(Y);Y=e("h4");Y.innerHTML=B+" tiles";Y.style["margin-top"]="2px";Y.style["margin-bottom"]="2px";p.a(Y);Y=e("input");Y.type="number";Y.style["margin-top"]="2px";Y.value=B;Y.min=1;Y.max=128;Y.oninput=function(){B=this.valueAsNumber||1;this.previousElementSibling.innerHTML=B+" tiles";this.previousElementSibling.previousElementSibling.value=B;C()}.bind(Y);p.a(Y);for(let a=0;a<q.length;++a){const c=e("div");Y=e("h4");Y.innerHTML=r[a];c.appendChild(Y);u[u.length]=Y;Y=e("div");Y.className="tile";Y.style["background-color"]=q[a];Y.onclick=function(){t=a;v()};c.appendChild(Y);p.a(c)}v();function Z(){var a=I;I=W(I,J,.075);var c=K;let d=L;if(0==R-Q&&0==P-O)S=[W(S[0],0,.1),W(S[1],0,.1)];else{const k=Math.atan2(R-Q,P-O);S=[W(S[0],10*Math.cos(k)/I,.1),W(S[1],10*Math.sin(k)/I,.1)]}K+=S[0];L+=S[1];if(D||a!=I||c!=K||d!=L)D=!1,g.resetTransform(),g.clearRect(0,0,f.width,f.height),g.translate(.5*f.width,.5*f.height),g.scale(I,I),g.translate(-K,-L),g.drawImage(h,0,0,h.width/2,h.height/2),1>I&&(g.globalAlpha=1-I*I,g.drawImage(m,0,0,h.width/2,h.height/2),g.globalAlpha=1);if(N){{const {g:k,h:x}={g:(M[0]-.5*window.innerWidth)/I+K,h:(M[1]-.5*window.innerHeight)/I+L};c=Math.floor(k/50);0>c||c>=A?a=-1:(a=Math.floor(x/50),a=0>a||a>=B?-1:c*B+a)}c=a;-1!=c&&z[c]!=t&&(z[c]=t,a=c%B,c=(c-a)/B,l.clearRect(100*c,100*a,100,100),l.fillStyle=q[t]+"b0",l.fillRect(100*c,100*a,100,100),l.fillStyle=q[t],l.fillRect(2*(1.5+50*c),2*(1.5+50*a),94,94),n.fillStyle=q[t],n.fillRect(100*c,100*a,100,100),D=1)}requestAnimationFrame(Z)}Z();