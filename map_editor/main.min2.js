const b=document.getElementById.bind(document),e=document.createElement.bind(document),f=b("canvas"),g=f.getContext("2d"),h=e("canvas"),k=h.getContext("2d"),l=e("canvas"),n=l.getContext("2d"),p=b("tiles");p.a=p.appendChild.bind(p);const q=["#dddddd","#aaaaaa","#333333","#fedf78"],aa=["Path","Safezone","Wall","Teleport"];let r=0,t=[];function u(){for(let a=0;a<t.length;++a)t[a].style["text-decoration"]=a==r?"underline":"none"}let v=0,w=0,x=new Uint8Array(0),y=10,z=10;function A(){let a=new Uint8Array(y*z);for(let c=0;c<v;++c)if(!(c>=y))for(let d=0;d<w;++d)d>=z||(a[c*z+d]=x[c*w+d]);v=y;w=z;x=a;B()}let C=0,D=0,E=0,G=.2,H=1,I=0,J=0,K=[0,0],L=0;var M=0,N=0,O=0,P=0;let Q=[0,0];var R=[],S=[];let T=!0;function U(){}function V(){}function W(){if(window.innerWidth!=C||window.innerHeight!=D||E!=window.devicePixelRatio)T=!0,E=window.devicePixelRatio,C=window.innerWidth,f.width=C*E,D=window.innerHeight,f.height=D*E}W();window.onresize=W;function X(a,c,d){return a+(c-a)*d}f.onwheel=function(a){a=.05*-Math.sign(a.deltaY);H=1<H?H+3*a:H+a;H=Math.min(Math.max(H,.2),2)};window.onmousemove=function(a){K=[a.clientX*E,a.clientY*E]};f.onmousedown=function(){L=1};f.onmouseup=function(){L=0};window.onkeydown=function(a){if(!a.repeat)switch(a.keyCode){case 38:case 87:O=1;break;case 40:case 83:P=1;break;case 37:case 65:M=1;break;case 39:case 68:N=1}};window.onkeyup=function(a){if(!a.repeat)switch(a.keyCode){case 38:case 87:O=0;break;case 40:case 83:P=0;break;case 37:case 65:M=0;break;case 39:case 68:N=0}};window.onbeforeunload=function(a){a.preventDefault();return a.returnValue="Are you sure you want to quit?"};f.oncontextmenu=function(a){a.preventDefault();return!1};function ba(){let a=`struct tile_info name = { ${y}, ${z}, 40, (uint8_t[]){\n`,c="/*       ";for(var d=0;d<z;++d)c+=d.toString().padStart(3," ")+" ";c+="*/\n";a+=c+"\n";for(d=0;d<y;++d){a+=`/*${d.toString().padStart(4," ")}*/  `;for(let m=0;m<z;++m)a+=` ${x[d*z+m]}, `;a=a.substring(0,a.length-1);a+="\n\n"}a=a.substring(0,a.length-1);return btoa(a+`\n${c}  }\n};`)}function ca(a){try{console.log("1");a=atob(a);const c=a.match(/struct tile_info \w.*? = { (\d+), (\d+), 40, \(uint8_t\[\]\){/);if(null==c)return 0;const d=+c[1],m=+c[2],F=eval(`[${a.substring(c[0].length,a.length-4)}]`);if(!(F instanceof Array)||F.length!=d*m)return 0;y=d;z=m;console.log("2");U();V();console.log("3");x=new Uint8Array(d*m);x.set(F);console.log("4");B();return 1}catch(c){return console.log(c),0}}function B(){console.log("beginning of paint bg");R=Array(q.length);S=Array(q.length);var a=0;for(let c=0;c<y;++c)for(let d=0;d<z;++d)null==R[x[a]]&&(R[x[a]]=new Path2D,S[x[a]]=new Path2D),R[x[a]].rect(2*(1.5+50*c),2*(1.5+50*d),94,94),S[x[a]].rect(100*c,100*d,100,100),++a;h.width=100*y;h.height=100*z;l.width=100*y;l.height=100*z;for(a=0;256>a;++a)R[a]&&(k.fillStyle=q[a]+"b0",k.fill(S[a]),k.fillStyle=q[a],k.fill(R[a]),n.fillStyle=q[a],n.fill(S[a]));console.log("end of paint bg");T=1}A();let Y=e("button");Y.innerHTML="Export & copy";Y.timeout=-1;Y.onclick=function(){window.navigator.clipboard.writeText(ba());-1!=this.timeout&&clearTimeout(this.timeout);this.innerHTML="Exported & copied";this.timeout=setTimeout(function(){this.innerHTML="Export & copy";this.timeout=-1}.bind(this),500)}.bind(Y);p.a(Y);Y=e("button");Y.innerHTML="Import";Y.onclick=function(){let a=prompt("Please paste the config below:");a&&(a=a.trim(),0!=a.length&&(ca(a)||alert("The config is invalid, it won't be loaded.")))};p.a(Y);Y=e("h4");Y.innerHTML="Width";Y.style["margin-bottom"]="2px";p.a(Y);Y=e("input");Y.type="range";Y.min=1;Y.max=128;Y.value=10;Y.step=1;U=function(){this.value=y;this.nextElementSibling.innerHTML=y+" tiles";this.nextElementSibling.nextElementSibling.value=y}.bind(Y);Y.oninput=function(){y=this.valueAsNumber||1;U();A()}.bind(Y);p.a(Y);Y=e("h4");Y.innerHTML=y+" tiles";Y.style["margin-top"]="2px";Y.style["margin-bottom"]="2px";p.a(Y);Y=e("input");Y.type="number";Y.style["margin-top"]="2px";Y.value=y;Y.min=1;Y.max=128;Y.oninput=function(){y=this.valueAsNumber||1;this.previousElementSibling.innerHTML=y+" tiles";this.previousElementSibling.previousElementSibling.value=y;A()}.bind(Y);p.a(Y);Y=e("h4");Y.innerHTML="Height";Y.style["margin-bottom"]="2px";p.a(Y);Y=e("input");Y.type="range";Y.min=1;Y.max=128;Y.value=10;Y.step=1;V=function(){this.value=z;this.nextElementSibling.innerHTML=z+" tiles";this.nextElementSibling.nextElementSibling.value=z}.bind(Y);Y.oninput=function(){z=this.valueAsNumber||1;V();A()}.bind(Y);p.a(Y);Y=e("h4");Y.innerHTML=z+" tiles";Y.style["margin-top"]="2px";Y.style["margin-bottom"]="2px";p.a(Y);Y=e("input");Y.type="number";Y.style["margin-top"]="2px";Y.value=z;Y.min=1;Y.max=128;Y.oninput=function(){z=this.valueAsNumber||1;this.previousElementSibling.innerHTML=z+" tiles";this.previousElementSibling.previousElementSibling.value=z;A()}.bind(Y);p.a(Y);for(let a=0;a<q.length;++a){const c=e("div");Y=e("h4");Y.innerHTML=aa[a];c.appendChild(Y);t[t.length]=Y;Y=e("div");Y.className="tile";Y.style["background-color"]=q[a];Y.onclick=function(){r=a;u()};c.appendChild(Y);p.a(c)}u();function Z(){var a=G;G=X(G,H,.075);var c=I;let d=J;if(0==P-O&&0==N-M)Q=[X(Q[0],0,.1),X(Q[1],0,.1)];else{const m=Math.atan2(P-O,N-M);Q=[X(Q[0],10*Math.cos(m)/G,.1),X(Q[1],10*Math.sin(m)/G,.1)]}I+=Q[0];J+=Q[1];if(T||a!=G||c!=I||d!=J)T=!1,g.resetTransform(),g.clearRect(0,0,f.width,f.height),g.translate(.5*f.width,.5*f.height),g.scale(G,G),g.translate(-I,-J),g.drawImage(h,0,0,h.width/2,h.height/2),1>G&&(g.globalAlpha=1-G*G,g.drawImage(l,0,0,h.width/2,h.height/2),g.globalAlpha=1);if(L){{const {g:m,h:F}={g:(K[0]-.5*window.innerWidth)/G+I,h:(K[1]-.5*window.innerHeight)/G+J};c=Math.floor(m/50);0>c||c>=y?a=-1:(a=Math.floor(F/50),a=0>a||a>=z?-1:c*z+a)}c=a;-1!=c&&x[c]!=r&&(x[c]=r,a=c%z,c=(c-a)/z,k.clearRect(100*c,100*a,100,100),k.fillStyle=q[r]+"b0",k.fillRect(100*c,100*a,100,100),k.fillStyle=q[r],k.fillRect(2*(1.5+50*c),2*(1.5+50*a),94,94),n.fillStyle=q[r],n.fillRect(100*c,100*a,100,100),T=1)}requestAnimationFrame(Z)}Z();