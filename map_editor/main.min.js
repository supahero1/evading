!function(){const c=document.getElementById.bind(document),e=document.createElement.bind(document),aa=window.localStorage,f=c("canvas"),g=f.getContext("2d"),k=e("canvas"),l=k.getContext("2d"),m=e("canvas"),n=m.getContext("2d"),p=c("tiles");p.a=p.appendChild.bind(p);const q=["#dddddd","#aaaaaa","#333333","#fedf78"],ba=["Path","Safezone","Wall","Teleport"];let r=0,t=[];function ca(){for(let a=0;a<t.length;++a)t[a].style["text-decoration"]=a==r?"underline":"none"}let u=0,v=0,w=new Uint8Array(0),x=9,z=9;function A(){let a=new Uint8Array(x*z);for(var b=0;b<u;++b)if(!(b>=x))for(let d=0;d<v;++d)d>=z||(a[b*z+d]=w[b*v+d]);for(b=0;b<B.length;++b)if(B[b][0]>=x||B[b][1]>=z)delete D[`${B[b][0]},${B[b][1]}`],B.splice(b--,1);u=x;v=z;w=a;E()}let da=0,ea=0,F=0,G=.2,H=1;const I=20*z;let J=0,K=I,fa=0,ha=0,ia=[0,0],L=0,ja=0;var M=0,ka=0,la=0,ma=0;let O=[0,0],P;var Q=[],R=[];let S=0,D={},T=!0,B=[],U=[],na=0;function oa(){}function qa(){}function V(){16<U.length&&U.shift();U[U.length]={j:new Uint8Array(w),width:x,height:z,i:JSON.stringify(D)}}function W(){if(S){var a=`${fa},${ha}`;L&&void 0==D[a]?(V(),D[a]=[fa,ha],X("S",20+40*D[a][0],20+40*D[a][1],0,!1,!1),B[B.length]=D[a]):ja&&void 0!=D[a]&&(V(),delete D[a],a=r,r=w[P],ra(),r=a,B=Object.values(D))}}function sa(){w[P]!=r&&(V(),w[P]=r,ra())}function ta(){if(window.innerWidth!=da||window.innerHeight!=ea||F!=window.devicePixelRatio)T=!0,F=window.devicePixelRatio,da=window.innerWidth,f.width=da*F,ea=window.innerHeight,f.height=ea*F}ta();window.onresize=ta;function Y(a,b,d){return a+(b-a)*d}f.onwheel=function(a){a=.05*-Math.sign(a.deltaY);H=1<H?H+3*a:H+a;H=Math.min(Math.max(H,.2),2)};window.onmousemove=function(a){ia=[a.clientX*F,a.clientY*F];P=ua();-1!=P&&(L&&!S&&sa(),W())};f.onmousedown=function(a){0==a.button?(L=1,-1!=P&&(S||sa(),W())):2==a.button&&(ja=1,W())};f.onmouseup=function(a){0==a.button?L=0:2==a.button&&(ja=0)};window.onkeydown=function(a){if(!a.repeat)switch(a.keyCode){case 81:S=1;-1!=P&&W();break;case 69:T=na=1;break;case 38:case 87:la=1;break;case 40:case 83:ma=1;break;case 37:case 65:M=1;break;case 39:case 68:ka=1;break;case 90:if(a.ctrlKey&&0!=U.length){var b=U.pop();w=b.j;x=b.width;z=b.height;u=x;v=z;oa();qa();D=JSON.parse(b.i);B=Object.values(D);E();T=1}a.preventDefault()}};window.onkeyup=function(a){if(!a.repeat)switch(a.keyCode){case 81:S=0;break;case 38:case 87:la=0;break;case 40:case 83:ma=0;break;case 37:case 65:M=0;break;case 39:case 68:ka=0}};window.onbeforeunload=function(){aa.setItem("cache",va())};f.oncontextmenu=function(a){a.preventDefault();return!1};function va(){let a=`#include "../consts.h"\n\nstatic const struct tile_info t;\n\nconst struct area_info area_000 = {\n  &t,\n  (struct ball_info[]) {\n    {0}\n  },\n  (struct pos[]){ ${B.map(h=>`{ ${h.join(", ")} }`).join(", ")} },\n  (struct teleport[]){  },\n  ${B.length}, 0\n};\n\nstatic const struct tile_info t = { ${x}, ${z}, 40, (uint8_t[]){\n`,b="/*       ";for(var d=0;d<z;++d)b+=d.toString().padStart(3," ")+" ";b+="*/\n";a+=b+"\n";for(d=0;d<x;++d){a+=`/*${d.toString().padStart(4," ")}*/  `;for(let h=0;h<z;++h)a+=` ${w[d*z+h]}, `;a=a.substring(0,a.length-1-(d==x-1));a+="\n\n"}return btoa(a+`${b}  }\n};\n\n`)}function wa(a){try{a=atob(a);let b=a.match(/\(struct pos\[\]\){ (.*?) },\n/);if(null==b)return 0;b=b[1];let d=b.match(/{ (\d+), (\d+) }/g);null==d&&(d=[]);d=d.map(za=>za.match(/\d+/g).map(Aa=>+Aa));let h=a.match(/(\d+), (\d+),?\n/);if(null==h)return 0;h=[+h[1],+h[2]];if(d.length!=h[0])return 0;const y=a.match(/{ (\d+), (\d+), \d+, \(uint8_t\[\]\){/);if(null==y)return 0;const C=+y[1],N=+y[2];if(1>C||200<C||1>N||200<N)return 0;const pa=eval(`[${a.substring(y.index+y[0].length,a.length-10)}*/]`);if(pa.length!=C*N)return 0;for(a=0;a<d.length;++a)if(d[a][0]>=C||d[a][1]>=N)return 0;x=C;z=N;u=x;v=z;U=[];oa();qa();D={};for(a=0;a<d.length;++a)D[`${d[a][0]},${d[a][1]}`]=[d[a][0],d[a][1]];B=Object.values(D);w=new Uint8Array(C*N);if(!(pa instanceof Array))return 0;w.set(pa);E();return 1}catch(b){return 0}}function E(){Q=Array(q.length);R=Array(q.length);var a=0;for(let b=0;b<x;++b)for(let d=0;d<z;++d)null==Q[w[a]]&&(Q[w[a]]=new Path2D,R[w[a]]=new Path2D),Q[w[a]].rect(2*(1.5+40*b),2*(1.5+40*d),74,74),R[w[a]].rect(80*b,80*d,80,80),++a;k.width=80*x;k.height=80*z;m.width=k.width;m.height=k.height;for(a=0;256>a;++a)Q[a]&&2!=a&&(l.fillStyle=q[a]+"b0",l.fill(R[a]),l.fillStyle=q[a],l.fill(Q[a]),n.fillStyle=q[a],n.fill(R[a]));T=1}function ra(){var a=P;const b=a%z;a=(a-b)/z;l.clearRect(80*a,80*b,80,80);n.clearRect(80*a,80*b,80,80);2!=r&&(l.fillStyle=q[r]+"b0",l.fillRect(80*a,80*b,80,80),l.fillStyle=q[r],l.fillRect(2*(1.5+40*a),2*(1.5+40*b),74,74),n.fillStyle=q[r],n.fillRect(80*a,80*b,80,80));T=1}function ua(){const {g:a,h:b}={g:(ia[0]-.5*f.width)/G+J,h:(ia[1]-.5*f.height)/G+K},d=Math.floor(a/40);if(0>d||d>=x)return-1;const h=Math.floor(b/40);if(0>h||h>=z)return-1;fa=d;ha=h;return d*z+h}A();let Z=e("button");Z.innerHTML="Export & copy";Z.timeout=-1;Z.onclick=function(){const a=va();window.navigator.clipboard.writeText(a);-1!=this.timeout&&clearTimeout(this.timeout);this.innerHTML="Exported & copied";this.timeout=setTimeout(function(){this.innerHTML="Export & copy";this.timeout=-1}.bind(this),500)}.bind(Z);p.a(Z);Z=e("button");Z.innerHTML="Import";Z.onclick=function(){let a=prompt("Please paste the config below:");a&&(a=a.trim(),0!=a.length&&(wa(a)||alert("The config is invalid, it won't be loaded.")))};p.a(Z);Z=e("button");Z.innerHTML="Rotate";Z.onclick=function(){V();let a=new Uint8Array(x*z);for(var b=0;b<x;++b)for(var d=0;d<z;++d)a[d*x+b]=w[(x-b-1)*z+d];D={};for(b=0;b<B.length;++b)d=B[b][0],B[b][0]=B[b][1],B[b][1]=x-d-1,D[`${B[b][0]},${B[b][1]}`]=[B[b][0],B[b][1]];b=x;x=z;z=b;b=c("w");b.value=x;b.oninput();b=c("h");b.value=z;b.oninput();w=a;E()};p.a(Z);Z=e("button");Z.innerHTML="Flip X";Z.onclick=function(){V();for(var a=0;a<x>>1;++a)for(let b=0;b<z;++b){const d=w[a*z+b];w[a*z+b]=w[(x-a-1)*z+b];w[(x-a-1)*z+b]=d}D={};for(a=0;a<B.length;++a)B[a][0]=x-B[a][0]-1,D[`${B[a][0]},${B[a][1]}`]=[B[a][0],B[a][1]];E()};p.a(Z);Z=e("button");Z.innerHTML="Flip Y";Z.onclick=function(){V();for(var a=0;a<x;++a)for(let b=0;b<z>>1;++b){const d=w[a*z+b];w[a*z+b]=w[a*z+(z-b-1)];w[a*z+(z-b-1)]=d}D={};for(a=0;a<B.length;++a)B[a][1]=z-B[a][1]-1,D[`${B[a][0]},${B[a][1]}`]=[B[a][0],B[a][1]];E()};p.a(Z);Z=e("h4");Z.innerHTML="Width";Z.style["margin-bottom"]="2px";p.a(Z);Z=e("input");Z.type="range";Z.min=1;Z.max=200;Z.value=10;Z.step=1;oa=function(){this.value=x;this.nextElementSibling.innerHTML=x+" tiles";this.nextElementSibling.nextElementSibling.value=x}.bind(Z);Z.oninput=function(){V();x=this.valueAsNumber||1;oa();A()}.bind(Z);p.a(Z);Z=e("h4");Z.innerHTML=x+" tiles";Z.style["margin-top"]="2px";Z.style["margin-bottom"]="2px";p.a(Z);Z=e("input");Z.type="number";Z.style["margin-top"]="2px";Z.value=x;Z.min=1;Z.max=200;Z.id="w";Z.oninput=function(){this.valueAsNumber=x=this.valueAsNumber?Math.max(Math.min(this.valueAsNumber,this.max),this.min):1;this.previousElementSibling.innerHTML=x+" tiles";this.previousElementSibling.previousElementSibling.value=x;A()}.bind(Z);p.a(Z);Z=e("h4");Z.innerHTML="Height";Z.style["margin-bottom"]="2px";p.a(Z);Z=e("input");Z.type="range";Z.min=1;Z.max=200;Z.value=10;Z.step=1;qa=function(){this.value=z;this.nextElementSibling.innerHTML=z+" tiles";this.nextElementSibling.nextElementSibling.value=z}.bind(Z);Z.oninput=function(){V();z=this.valueAsNumber||1;qa();A()}.bind(Z);p.a(Z);Z=e("h4");Z.innerHTML=z+" tiles";Z.style["margin-top"]="2px";Z.style["margin-bottom"]="2px";p.a(Z);Z=e("input");Z.type="number";Z.style["margin-top"]="2px";Z.value=z;Z.min=1;Z.max=200;Z.id="h";Z.oninput=function(){this.valueAsNumber=z=this.valueAsNumber?Math.max(Math.min(this.valueAsNumber,this.max),this.min):1;this.previousElementSibling.innerHTML=z+" tiles";this.previousElementSibling.previousElementSibling.value=z;A()}.bind(Z);p.a(Z);for(let a=0;a<q.length;++a){const b=e("div");Z=e("h4");Z.innerHTML=ba[a];b.appendChild(Z);t[t.length]=Z;Z=e("div");Z.className="tile";Z.style["background-color"]=q[a];Z.onclick=function(){r=a;ca()};b.appendChild(Z);p.a(b)}ca();function X(a,b,d,h,y,C){h*=G;b=.5*f.width+(b-J)*G;d=.5*f.height+(d-K)*G;y=((y&&(b<h||b>f.width-h)?Math.max(Math.min(b,f.width-h),h):b)-.5*f.width)/G+J;h=((C&&(d<h||d>f.height-h)?Math.max(Math.min(d,f.height-h),h):d)-.5*f.height)/G+K;g.font="700 20px Ubuntu";g.textAlign="center";g.textBaseline="middle";g.fillStyle="#fff";g.strokeStyle="#333";g.lineWidth=1;g.fillText(a,y,h);g.strokeText(a,y,h)}const xa=aa.getItem("cache");xa&&wa(xa);setInterval(function(){aa.setItem("cache",va())},1E4);function ya(){var a=G;G=Y(G,H,.075);let b=J,d=K;if(0==ma-la&&0==ka-M)O=[Y(O[0],0,.1),Y(O[1],0,.1)];else{const h=Math.atan2(ma-la,ka-M);O=[Y(O[0],10*Math.cos(h)/G,.1),Y(O[1],10*Math.sin(h)/G,.1)]}J+=O[0];K+=O[1];P=ua();-1!=P&&(L&&!S&&sa(),W());if(T||a!=G||b!=J||d!=K){T=!1;g.resetTransform();g.clearRect(0,0,f.width,f.height);g.translate(.5*f.width,.5*f.height);g.scale(G,G);g.translate(-J,-K);g.drawImage(k,0,0,k.width/2,k.height/2);1>G&&(g.globalAlpha=1-G*G,g.drawImage(m,0,0,k.width/2,k.height/2),g.globalAlpha=1);na||(X("WASD or arrow keys to move around, scroll to zoom",-500,I-100,0,!1,!1),X("Click on the left to pick what type of tile you want to place",-500,I-60,0,!1,!1),X("Set spawnpoints by clicking LMB and pressing Q at the same time",-500,I-20,0,!1,!1),X("Unset spawnpoints by clicking RMB and pressing Q at the same time",-500,I+20,0,!1,!1),X("Use Ctrl+Z to undo your last action",-500,I+60,0,!1,!1),X("Press E to hide this message",-500,I+100,0,!1,!1));for(const h of B)X("S",20+40*h[0],20+40*h[1],0,!1,!1);for(a=0;a<x;++a)X(a.toString(),20+40*a,-40,20,!1,!0);x&1?X("M",20+40*(x-1>>1),-20,40,!1,!0):(X("M",20+40*(x>>1),-20,40,!1,!0),X("M",20+40*((x>>1)-1),-20,40,!1,!0));for(a=0;a<z;++a)X(a.toString(),40*x+40,20+40*a,20,!0,!1);z&1?X("M",40*x+20,20+40*(z-1>>1),40,!0,!1):(X("M",40*x+20,20+40*(z>>1),40,!0,!1),X("M",40*x+20,20+40*((z>>1)-1),40,!0,!1))}requestAnimationFrame(ya)}ya();}()