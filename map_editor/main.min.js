!function(){const c=document.getElementById.bind(document),e=document.createElement.bind(document),aa=window.localStorage,f=c("canvas"),h=f.getContext("2d"),k=e("canvas"),l=k.getContext("2d"),m=e("canvas"),n=m.getContext("2d"),p=c("tiles");p.a=p.appendChild.bind(p);const q=["#dddddd","#aaaaaa","#333333","#fedf78"],ba=["Path","Safezone","Wall","Teleport"];let r=0,t=[];function ca(){for(let a=0;a<t.length;++a)t[a].style["text-decoration"]=a==r?"underline":"none"}let da=0,u=0,v=new Uint8Array(0),w=9,x=9;function z(){let a=new Uint8Array(w*x);for(var b=0;b<da;++b)if(!(b>=w))for(let d=0;d<u;++d)d>=x||(a[b*x+d]=v[b*u+d]);for(b=0;b<A.length;++b)if(A[b][0]>=w||A[b][1]>=x)delete C[`${A[b][0]},${A[b][1]}`],A.splice(b--,1);da=w;u=x;v=a;D()}let ea=0,fa=0,E=0,F=.2,G=1;const H=20*x;let I=0,J=H,ha=[0,0],L=0,ia=0;var M=0,N=0,O=0,P=0;let Q=[0,0],R;var S=[],T=[];let U=0,C={},V=!0,A=[],ja=[],ka=0;function ma(){}function na(){}function W(){if(U){var a=R/x|0,b=R%x,d=`${a},${b}`;L&&void 0==C[d]?(C[d]=[a,b],X("S",20+40*C[d][0],20+40*C[d][1],0,!1,!1),A[A.length]=C[d]):ia&&void 0!=C[d]&&(delete C[d],a=r,r=v[R],oa(),r=a,A=Object.values(C))}}function pa(){if(window.innerWidth!=ea||window.innerHeight!=fa||E!=window.devicePixelRatio)V=!0,E=window.devicePixelRatio,ea=window.innerWidth,f.width=ea*E,fa=window.innerHeight,f.height=fa*E}pa();window.onresize=pa;function Y(a,b,d){return a+(b-a)*d}f.onwheel=function(a){a=.05*-Math.sign(a.deltaY);G=1<G?G+3*a:G+a;G=Math.min(Math.max(G,.2),2)};window.onmousemove=function(a){ha=[a.clientX*E,a.clientY*E];R=qa();-1!=R&&(L&&!U&&v[R]!=r&&(v[R]=r,oa()),W())};f.onmousedown=function(a){0==a.button?(L=1,-1!=R&&(U||v[R]==r||(v[R]=r,oa()),W())):2==a.button&&(ia=1,W())};f.onmouseup=function(a){0==a.button?L=0:2==a.button&&(ia=0)};window.onkeydown=function(a){if(!a.repeat)switch(a.keyCode){case 81:U=1;-1!=R&&W();break;case 69:V=ka=1;break;case 38:case 87:O=1;break;case 40:case 83:P=1;break;case 37:case 65:M=1;break;case 39:case 68:N=1}};window.onkeyup=function(a){if(!a.repeat)switch(a.keyCode){case 81:U=0;break;case 38:case 87:O=0;break;case 40:case 83:P=0;break;case 37:case 65:M=0;break;case 39:case 68:N=0}};window.onbeforeunload=function(){aa.setItem("cache",ra())};f.oncontextmenu=function(a){a.preventDefault();return!1};function ra(){let a=`#include "../consts.h"\n\nstatic const struct tile_info t;\n\nconst struct area_info area_000 = {\n  &t,\n  (struct ball_info[]) {\n    {0}\n  },\n  (struct pos[]){ ${A.map(g=>`{ ${g.join(", ")} }`).join(", ")} },\n  (struct teleport[]){ ${ja.map(g=>`{ { ${g.j.join(", ")} }, { ${g.i} } }`).join(", ")} },\n  ${A.length}, ${ja.length}\n};\n\nstatic const struct tile_info t = { ${w}, ${x}, 40, (uint8_t[]){\n`,b="/*       ";for(var d=0;d<x;++d)b+=d.toString().padStart(3," ")+" ";b+="*/\n";a+=b+"\n";for(d=0;d<w;++d){a+=`/*${d.toString().padStart(4," ")}*/  `;for(let g=0;g<x;++g)a+=` ${v[d*x+g]}, `;a=a.substring(0,a.length-1-(d==w-1));a+="\n\n"}return btoa(a+`${b}  }\n};\n\n`)}function sa(a){try{a=atob(a);let b=a.match(/\(struct pos\[\]\){ (.*?) },\n/);if(null==b)return 0;b=b[1];let d=b.match(/{ (\d+), (\d+) }/g);null==d&&(d=[]);d=d.map(va=>va.match(/\d+/g).map(wa=>+wa));let g=a.match(/(\d+), (\d+),?\n/);if(null==g)return 0;g=[+g[1],+g[2]];if(d.length!=g[0])return 0;const y=a.match(/{ (\d+), (\d+), \d+, \(uint8_t\[\]\){/);if(null==y)return 0;const B=+y[1],K=+y[2];if(1>B||200<B||1>K||200<K)return 0;const la=eval(`[${a.substring(y.index+y[0].length,a.length-10)}*/]`);if(la.length!=B*K)return 0;for(a=0;a<d.length;++a)if(d[a][0]>=B||d[a][1]>=K)return 0;w=B;x=K;da=w;u=x;ma();na();C={};for(a=0;a<d.length;++a)C[`${d[a][0]},${d[a][1]}`]=[d[a][0],d[a][1]];A=Object.values(C);v=new Uint8Array(B*K);if(!(la instanceof Array))return 0;v.set(la);D();return 1}catch(b){return 0}}function D(){S=Array(q.length);T=Array(q.length);var a=0;for(let b=0;b<w;++b)for(let d=0;d<x;++d)null==S[v[a]]&&(S[v[a]]=new Path2D,T[v[a]]=new Path2D),S[v[a]].rect(2*(1.5+40*b),2*(1.5+40*d),74,74),T[v[a]].rect(80*b,80*d,80,80),++a;k.width=80*w;k.height=80*x;m.width=k.width;m.height=k.height;for(a=0;256>a;++a)S[a]&&2!=a&&(l.fillStyle=q[a]+"b0",l.fill(T[a]),l.fillStyle=q[a],l.fill(S[a]),n.fillStyle=q[a],n.fill(T[a]));V=1}function oa(){var a=R;const b=a%x;a=(a-b)/x;l.clearRect(80*a,80*b,80,80);n.clearRect(80*a,80*b,80,80);2!=r&&(l.fillStyle=q[r]+"b0",l.fillRect(80*a,80*b,80,80),l.fillStyle=q[r],l.fillRect(2*(1.5+40*a),2*(1.5+40*b),74,74),n.fillStyle=q[r],n.fillRect(80*a,80*b,80,80));V=1}function qa(){const {g:a,h:b}={g:(ha[0]-.5*f.width)/F+I,h:(ha[1]-.5*f.height)/F+J},d=Math.floor(a/40);if(0>d||d>=w)return-1;const g=Math.floor(b/40);return 0>g||g>=x?-1:d*x+g}z();let Z=e("button");Z.innerHTML="Export & copy";Z.timeout=-1;Z.onclick=function(){const a=ra();window.navigator.clipboard.writeText(a);-1!=this.timeout&&clearTimeout(this.timeout);this.innerHTML="Exported & copied";this.timeout=setTimeout(function(){this.innerHTML="Export & copy";this.timeout=-1}.bind(this),500)}.bind(Z);p.a(Z);Z=e("button");Z.innerHTML="Import";Z.onclick=function(){let a=prompt("Please paste the config below:");a&&(a=a.trim(),0!=a.length&&(sa(a)||alert("The config is invalid, it won't be loaded.")))};p.a(Z);Z=e("button");Z.innerHTML="Rotate";Z.onclick=function(){let a=new Uint8Array(w*x);for(var b=0;b<w;++b)for(var d=0;d<x;++d)a[d*w+b]=v[(w-b-1)*x+d];C={};for(b=0;b<A.length;++b)d=A[b][0],A[b][0]=A[b][1],A[b][1]=w-d-1,C[`${A[b][0]},${A[b][1]}`]=[A[b][0],A[b][1]];b=w;w=x;x=b;b=c("w");b.value=w;b.oninput();b=c("h");b.value=x;b.oninput();v=a;D()};p.a(Z);Z=e("button");Z.innerHTML="Flip X";Z.onclick=function(){for(var a=0;a<w>>1;++a)for(let b=0;b<x;++b){const d=v[a*x+b];v[a*x+b]=v[(w-a-1)*x+b];v[(w-a-1)*x+b]=d}C={};for(a=0;a<A.length;++a)A[a][0]=w-A[a][0]-1,C[`${A[a][0]},${A[a][1]}`]=[A[a][0],A[a][1]];D()};p.a(Z);Z=e("button");Z.innerHTML="Flip Y";Z.onclick=function(){for(var a=0;a<w;++a)for(let b=0;b<x>>1;++b){const d=v[a*x+b];v[a*x+b]=v[a*x+(x-b-1)];v[a*x+(x-b-1)]=d}C={};for(a=0;a<A.length;++a)A[a][1]=x-A[a][1]-1,C[`${A[a][0]},${A[a][1]}`]=[A[a][0],A[a][1]];D()};p.a(Z);Z=e("h4");Z.innerHTML="Width";Z.style["margin-bottom"]="2px";p.a(Z);Z=e("input");Z.type="range";Z.min=1;Z.max=200;Z.value=10;Z.step=1;ma=function(){this.value=w;this.nextElementSibling.innerHTML=w+" tiles";this.nextElementSibling.nextElementSibling.value=w}.bind(Z);Z.oninput=function(){w=this.valueAsNumber||1;ma();z()}.bind(Z);p.a(Z);Z=e("h4");Z.innerHTML=w+" tiles";Z.style["margin-top"]="2px";Z.style["margin-bottom"]="2px";p.a(Z);Z=e("input");Z.type="number";Z.style["margin-top"]="2px";Z.value=w;Z.min=1;Z.max=200;Z.id="w";Z.oninput=function(){this.valueAsNumber=w=this.valueAsNumber?Math.max(Math.min(this.valueAsNumber,this.max),this.min):1;this.previousElementSibling.innerHTML=w+" tiles";this.previousElementSibling.previousElementSibling.value=w;z()}.bind(Z);p.a(Z);Z=e("h4");Z.innerHTML="Height";Z.style["margin-bottom"]="2px";p.a(Z);Z=e("input");Z.type="range";Z.min=1;Z.max=200;Z.value=10;Z.step=1;na=function(){this.value=x;this.nextElementSibling.innerHTML=x+" tiles";this.nextElementSibling.nextElementSibling.value=x}.bind(Z);Z.oninput=function(){x=this.valueAsNumber||1;na();z()}.bind(Z);p.a(Z);Z=e("h4");Z.innerHTML=x+" tiles";Z.style["margin-top"]="2px";Z.style["margin-bottom"]="2px";p.a(Z);Z=e("input");Z.type="number";Z.style["margin-top"]="2px";Z.value=x;Z.min=1;Z.max=200;Z.id="h";Z.oninput=function(){this.valueAsNumber=x=this.valueAsNumber?Math.max(Math.min(this.valueAsNumber,this.max),this.min):1;this.previousElementSibling.innerHTML=x+" tiles";this.previousElementSibling.previousElementSibling.value=x;z()}.bind(Z);p.a(Z);for(let a=0;a<q.length;++a){const b=e("div");Z=e("h4");Z.innerHTML=ba[a];b.appendChild(Z);t[t.length]=Z;Z=e("div");Z.className="tile";Z.style["background-color"]=q[a];Z.onclick=function(){r=a;ca()};b.appendChild(Z);p.a(b)}ca();function X(a,b,d,g,y,B){g*=F;b=.5*f.width+(b-I)*F;d=.5*f.height+(d-J)*F;y=((y&&(b<g||b>f.width-g)?Math.max(Math.min(b,f.width-g),g):b)-.5*f.width)/F+I;g=((B&&(d<g||d>f.height-g)?Math.max(Math.min(d,f.height-g),g):d)-.5*f.height)/F+J;h.font="700 20px Ubuntu";h.textAlign="center";h.textBaseline="middle";h.fillStyle="#fff";h.strokeStyle="#333";h.lineWidth=1;h.fillText(a,y,g);h.strokeText(a,y,g)}const ta=aa.getItem("cache");ta&&sa(ta);setInterval(function(){aa.setItem("cache",ra())},1E4);function ua(){var a=F;F=Y(F,G,.075);let b=I,d=J;if(0==P-O&&0==N-M)Q=[Y(Q[0],0,.1),Y(Q[1],0,.1)];else{const g=Math.atan2(P-O,N-M);Q=[Y(Q[0],10*Math.cos(g)/F,.1),Y(Q[1],10*Math.sin(g)/F,.1)]}I+=Q[0];J+=Q[1];R=qa();-1!=R&&(L&&!U&&v[R]!=r&&(v[R]=r,oa()),W());if(V||a!=F||b!=I||d!=J){V=!1;h.resetTransform();h.clearRect(0,0,f.width,f.height);h.translate(.5*f.width,.5*f.height);h.scale(F,F);h.translate(-I,-J);h.drawImage(k,0,0,k.width/2,k.height/2);1>F&&(h.globalAlpha=1-F*F,h.drawImage(m,0,0,k.width/2,k.height/2),h.globalAlpha=1);ka||(X("WASD or arrow keys to move around, scroll to zoom",-500,H-80,0,!1,!1),X("Click on the left to pick what type of tile you want to place",-500,H-40,0,!1,!1),X("Set spawnpoints by clicking LMB and pressing Q at the same time",-500,H,0,!1,!1),X("Unset spawnpoints by clicking RMB and pressing Q at the same time",-500,H+40,0,!1,!1),X("Press E to hide this message",-500,H+80,0,!1,!1));for(const g of A)X("S",20+40*g[0],20+40*g[1],0,!1,!1);for(a=0;a<w;++a)X(a.toString(),20+40*a,-40,20,!1,!0);w&1?X("M",20+40*(w-1>>1),-20,40,!1,!0):(X("M",20+40*(w>>1),-20,40,!1,!0),X("M",20+40*((w>>1)-1),-20,40,!1,!0));for(a=0;a<x;++a)X(a.toString(),40*w+40,20+40*a,20,!0,!1);x&1?X("M",40*w+20,20+40*(x-1>>1),40,!0,!1):(X("M",40*w+20,20+40*(x>>1),40,!0,!1),X("M",40*w+20,20+40*((x>>1)-1),40,!0,!1))}requestAnimationFrame(ua)}ua();}()